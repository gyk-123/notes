<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx 核心知识 | 月落 - Personal Notes</title>
    <meta name="description" content="Web Developer & JS Fancier">
    <link rel="stylesheet" href="/notes/assets/style.b0784ff1.css">
    <link rel="modulepreload" href="/notes/assets/app.3c6e9e4e.js">
    <link rel="modulepreload" href="/notes/assets/nginx_index.md.0915afde.lean.js">
    
    <link rel="icon" href="/notes/favicon.ico">
  <script>(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-6b5fd0a9><!--[--><!--]--><!--[--><span tabindex="-1" data-v-45f6ae50></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-45f6ae50> Skip to content </a><!--]--><!----><header class="VPNav" data-v-6b5fd0a9 data-v-0e356168><div class="VPNavBar has-sidebar" data-v-0e356168 data-v-8856f192><div class="container" data-v-8856f192><div class="VPNavBarTitle has-sidebar" data-v-8856f192 data-v-6a6f7ff6><a class="title" href="/notes/" data-v-6a6f7ff6><!----><!--[-->Personal Notes<!--]--></a></div><div class="content" data-v-8856f192><!----><!----><!----><div class="VPNavBarAppearance appearance" data-v-8856f192 data-v-311055f2><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-311055f2 data-v-781f9d1b data-v-1dda4c9c><span class="check" data-v-1dda4c9c><span class="icon" data-v-1dda4c9c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-781f9d1b><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-781f9d1b><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-8856f192 data-v-0ae890f7 data-v-4dcbaf3a><!--[--><a class="VPSocialLink" href="https://github.com/yw0525" title="github" target="_blank" rel="noopener noreferrer" data-v-4dcbaf3a data-v-48c45ef6><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-48c45ef6><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="visually-hidden" data-v-48c45ef6>github</span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-8856f192 data-v-0562f5c0 data-v-8dccea88><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-8dccea88><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-8dccea88><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-8dccea88><div class="VPMenu" data-v-8dccea88 data-v-e73581a2><!----><!--[--><!--[--><!----><div class="group" data-v-0562f5c0><div class="item appearance" data-v-0562f5c0><p class="label" data-v-0562f5c0>Appearance</p><div class="appearance-action" data-v-0562f5c0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-0562f5c0 data-v-781f9d1b data-v-1dda4c9c><span class="check" data-v-1dda4c9c><span class="icon" data-v-1dda4c9c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-781f9d1b><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-781f9d1b><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-0562f5c0><div class="item social-links" data-v-0562f5c0><div class="VPSocialLinks social-links-list" data-v-0562f5c0 data-v-4dcbaf3a><!--[--><a class="VPSocialLink" href="https://github.com/yw0525" title="github" target="_blank" rel="noopener noreferrer" data-v-4dcbaf3a data-v-48c45ef6><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-48c45ef6><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="visually-hidden" data-v-48c45ef6>github</span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-8856f192 data-v-6f008456><span class="container" data-v-6f008456><span class="top" data-v-6f008456></span><span class="middle" data-v-6f008456></span><span class="bottom" data-v-6f008456></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-6b5fd0a9 data-v-92b0f14a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-92b0f14a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-92b0f14a><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-92b0f14a>Menu</span></button><a class="top-link" href="#" data-v-92b0f14a> Return to top </a></div><aside class="VPSidebar" data-v-6b5fd0a9 data-v-55e4c7db><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-55e4c7db><span class="visually-hidden" id="sidebar-aria-label" data-v-55e4c7db> Sidebar Navigation </span><!--[--><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>alg</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/alg/algorithm/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>algorithm</span><!--]--><!----></a><a class="VPLink link" href="/notes/alg/algorithm_google/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>algorithm_google</span><!--]--><!----></a><a class="VPLink link" href="/notes/alg/javascript/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>javascript</span><!--]--><!----></a><a class="VPLink link" href="/notes/alg/leetcode75/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>leetcode75</span><!--]--><!----></a><a class="VPLink link" href="/notes/alg/training/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>training</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>bom</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/bom/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>bom</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>books</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><span class="VPLink" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>MDN</span><!--]--><!----></span><a class="VPLink link" href="/notes/books/lodash/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>lodash</span><!--]--><!----></a><a class="VPLink link" href="/notes/books/%E5%9B%BE%E8%A7%A3HTTP/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>图解HTTP</span><!--]--><!----></a><a class="VPLink link" href="/notes/books/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>浏览器工作原理与实践</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>css3</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/css3/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>css3</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>doc</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/doc/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>doc</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>dom</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/dom/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>dom</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>ecma_script</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/ecma_script/Built_in_objects/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>Built_in_objects</span><!--]--><!----></a><a class="VPLink link" href="/notes/ecma_script/base/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>base</span><!--]--><!----></a><a class="VPLink link" href="/notes/ecma_script/closure/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>closure</span><!--]--><!----></a><a class="VPLink link" href="/notes/ecma_script/es6/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>es6</span><!--]--><!----></a><a class="VPLink link" href="/notes/ecma_script/front_end_optimize/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>front_end_optimize</span><!--]--><!----></a><a class="VPLink link" href="/notes/ecma_script/functional/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>functional</span><!--]--><!----></a><a class="VPLink link" href="/notes/ecma_script/loss_of_precision/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>loss_of_precision</span><!--]--><!----></a><a class="VPLink link" href="/notes/ecma_script/optimize/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>optimize</span><!--]--><!----></a><a class="VPLink link" href="/notes/ecma_script/promise/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>promise</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>electron</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/electron/base/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>base</span><!--]--><!----></a><a class="VPLink link" href="/notes/electron/combat/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>combat</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>engineering</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/engineering/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>engineering</span><!--]--><!----></a><span class="VPLink" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>gulp</span><!--]--><!----></span><span class="VPLink" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>yeoman</span><!--]--><!----></span><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>eslint</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/eslint/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>eslint</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>fragment</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/fragment/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>fragment</span><!--]--><!----></a><a class="VPLink link" href="/notes/fragment/case/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>case</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>git</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/git/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>git</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>go</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/go/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>go</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>hand_writing</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/hand_writing/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>hand_writing</span><!--]--><!----></a><a class="VPLink link" href="/notes/hand_writing/vue_source/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vue_source</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>html5</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/html5/base/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>base</span><!--]--><!----></a><a class="VPLink link" href="/notes/html5/canvas/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>canvas</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>jenkins</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/jenkins/jenkins2.x/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>jenkins2.x</span><!--]--><!----></a><a class="VPLink link" href="/notes/jenkins/practice/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>practice</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>jest</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/jest/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>jest</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>micro_frontends</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/micro_frontends/base/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>base</span><!--]--><!----></a><a class="VPLink link" href="/notes/micro_frontends/module_federation/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>module_federation</span><!--]--><!----></a><a class="VPLink link" href="/notes/micro_frontends/module_federation_example/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>module_federation_example</span><!--]--><!----></a><a class="VPLink link" href="/notes/micro_frontends/source/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>source</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>network</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/network/base/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>base</span><!--]--><!----></a><a class="VPLink link" href="/notes/network/plus/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>plus</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>nginx</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link active" href="/notes/nginx/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>nginx</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>node</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/node/base/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>base</span><!--]--><!----></a><a class="VPLink link" href="/notes/node/koa/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>koa</span><!--]--><!----></a><a class="VPLink link" href="/notes/node/plus/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>plus</span><!--]--><!----></a><a class="VPLink link" href="/notes/node/tars/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>tars</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>npm</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/npm/base/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>base</span><!--]--><!----></a><a class="VPLink link" href="/notes/npm/repos/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>repos</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>react</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/react/Fiber/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>Fiber</span><!--]--><!----></a><a class="VPLink link" href="/notes/react/chakra_ui/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>chakra_ui</span><!--]--><!----></a><a class="VPLink link" href="/notes/react/css_in_js/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>css_in_js</span><!--]--><!----></a><a class="VPLink link" href="/notes/react/form_optimize/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>form_optimize</span><!--]--><!----></a><a class="VPLink link" href="/notes/react/formik/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>formik</span><!--]--><!----></a><a class="VPLink link" href="/notes/react/mobx/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>mobx</span><!--]--><!----></a><a class="VPLink link" href="/notes/react/optimize/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>optimize</span><!--]--><!----></a><a class="VPLink link" href="/notes/react/react_base/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>react_base</span><!--]--><!----></a><a class="VPLink link" href="/notes/react/react_hooks/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>react_hooks</span><!--]--><!----></a><a class="VPLink link" href="/notes/react/react_hooks_plus/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>react_hooks_plus</span><!--]--><!----></a><a class="VPLink link" href="/notes/react/react_source/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>react_source</span><!--]--><!----></a><a class="VPLink link" href="/notes/react/redux/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>redux</span><!--]--><!----></a><a class="VPLink link" href="/notes/react/virtual_dom/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>virtual_dom</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>superset</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/superset/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>superset</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>test</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/test/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>test</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>typescript</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/typescript/base/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>base</span><!--]--><!----></a><a class="VPLink link" href="/notes/typescript/challenges/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>challenges</span><!--]--><!----></a><a class="VPLink link" href="/notes/typescript/declaration/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>declaration</span><!--]--><!----></a><a class="VPLink link" href="/notes/typescript/examples/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>examples</span><!--]--><!----></a><a class="VPLink link" href="/notes/typescript/plus/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>plus</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>visualization</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/visualization/three.js/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>three.js</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>vite</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/vite/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vite</span><!--]--><!----></a><a class="VPLink link" href="/notes/vite/vite_source/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vite_source</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>vue</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/vue/vue3/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vue3</span><!--]--><!----></a><a class="VPLink link" href="/notes/vue/vue3_diff/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vue3_diff</span><!--]--><!----></a><a class="VPLink link" href="/notes/vue/vue3_renderer/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vue3_renderer</span><!--]--><!----></a><a class="VPLink link" href="/notes/vue/vue3_source/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vue3_source</span><!--]--><!----></a><a class="VPLink link" href="/notes/vue/vue3_source_design/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vue3_source_design</span><!--]--><!----></a><a class="VPLink link" href="/notes/vue/vue_base/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vue_base</span><!--]--><!----></a><a class="VPLink link" href="/notes/vue/vue_cli/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vue_cli</span><!--]--><!----></a><a class="VPLink link" href="/notes/vue/vue_inteview/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vue_inteview</span><!--]--><!----></a><a class="VPLink link" href="/notes/vue/vue_router/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vue_router</span><!--]--><!----></a><a class="VPLink link" href="/notes/vue/vue_source/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vue_source</span><!--]--><!----></a><a class="VPLink link" href="/notes/vue/vue_source_design/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vue_source_design</span><!--]--><!----></a><a class="VPLink link" href="/notes/vue/vue_source_plus/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vue_source_plus</span><!--]--><!----></a><a class="VPLink link" href="/notes/vue/vue_source_review/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vue_source_review</span><!--]--><!----></a><a class="VPLink link" href="/notes/vue/vue_ssr/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vue_ssr</span><!--]--><!----></a><a class="VPLink link" href="/notes/vue/vue_vite/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vue_vite</span><!--]--><!----></a><a class="VPLink link" href="/notes/vue/vuex/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vuex</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>webpack</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/notes/webpack/webpack/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>webpack</span><!--]--><!----></a><span class="VPLink" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>webpack_npm_source</span><!--]--><!----></span><a class="VPLink link" href="/notes/webpack/webpack_tencent/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>webpack_tencent</span><!--]--><!----></a><a class="VPLink link" href="/notes/webpack/webpack_write/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>webpack_write</span><!--]--><!----></a><a class="VPLink link" href="/notes/webpack/webpack_write_plus/index.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>webpack_write_plus</span><!--]--><!----></a><!--]--></div></section></div><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-6b5fd0a9 data-v-a4c57a06><div class="VPDoc has-sidebar" data-v-a4c57a06 data-v-79ca2460><div class="container" data-v-79ca2460><div class="aside" data-v-79ca2460><div class="aside-curtain" data-v-79ca2460></div><div class="aside-container" data-v-79ca2460><div class="aside-content" data-v-79ca2460><div class="VPDocAside" data-v-79ca2460 data-v-779d834d><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline has-outline" data-v-779d834d data-v-51e5a8ce><div class="content" data-v-51e5a8ce><div class="outline-marker" data-v-51e5a8ce></div><div class="outline-title" data-v-51e5a8ce>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-51e5a8ce><span class="visually-hidden" id="doc-outline-aria-label" data-v-51e5a8ce> Table of Contents for current page </span><ul class="root" data-v-51e5a8ce><!--[--><li style="" data-v-51e5a8ce><a class="outline-link" href="#一、nginx-基础" data-v-51e5a8ce>一、Nginx 基础</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#二、nginx-架构基础" data-v-51e5a8ce>二、Nginx 架构基础</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#三、http-模块" data-v-51e5a8ce>三、HTTP 模块</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#四、反向代理与负载均衡" data-v-51e5a8ce>四、反向代理与负载均衡</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#五、nginx-系统层性能优化" data-v-51e5a8ce>五、Nginx 系统层性能优化</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#六、深入使用-nginx-与-openresty" data-v-51e5a8ce>六、深入使用 Nginx 与 OpenResty</a><!----></li><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-779d834d></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-79ca2460><div class="content-container" data-v-79ca2460><!--[--><!--]--><main class="main" data-v-79ca2460><div style="position:relative;" class="vp-doc _notes_nginx_index" data-v-79ca2460><div><h1 id="nginx-核心知识" tabindex="-1">Nginx 核心知识 <a class="header-anchor" href="#nginx-核心知识" aria-hidden="true">#</a></h1><h2 id="一、nginx-基础" tabindex="-1">一、Nginx 基础 <a class="header-anchor" href="#一、nginx-基础" aria-hidden="true">#</a></h2><h3 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-hidden="true">#</a></h3><h4 id="主流-web-服务器" tabindex="-1">主流 Web 服务器 <a class="header-anchor" href="#主流-web-服务器" aria-hidden="true">#</a></h4><p>Nginx、Apache、Tomcat。</p><h4 id="nginx-的优点" tabindex="-1">Nginx 的优点 <a class="header-anchor" href="#nginx-的优点" aria-hidden="true">#</a></h4><p>2014 发展至今。</p><ul><li>高并发，高性能</li><li>可扩展性好</li><li>高可靠性</li><li>热部署</li><li>BSD 许可证</li></ul><h3 id="nginx-应用场景" tabindex="-1">Nginx 应用场景 <a class="header-anchor" href="#nginx-应用场景" aria-hidden="true">#</a></h3><ul><li>静态资源托管 <ul><li>通过本地文件系统提供服务</li></ul></li><li>反向代理服务 <ul><li>Nginx 的强大功能</li><li>缓存</li><li>负载均衡</li></ul></li><li>API 服务 <ul><li>OpenResty</li></ul></li></ul><img src="/notes/assets/view.d39eed92.png" style="zoom:80%;"><h3 id="nginx-历史背景" tabindex="-1">Nginx 历史背景 <a class="header-anchor" href="#nginx-历史背景" aria-hidden="true">#</a></h3><ul><li>互联网的数据量快速增长 <ul><li>互联网的快速普及</li><li>全球化</li><li>物联网</li></ul></li><li>摩尔定律：性能提升</li><li>低效的 Apache <ul><li>一个连接对应一个进程</li></ul></li></ul><h3 id="nginx-优点" tabindex="-1">Nginx 优点 <a class="header-anchor" href="#nginx-优点" aria-hidden="true">#</a></h3><ul><li>高并发，高性能</li><li>可扩展性好</li><li>高可靠性</li><li>热部署</li><li>BSD 许可证</li></ul><h3 id="nginx-组成部分" tabindex="-1">Nginx 组成部分 <a class="header-anchor" href="#nginx-组成部分" aria-hidden="true">#</a></h3><ul><li>Nginx 二进制可执行文件 <ul><li>由各模块源码编译出的一个文件</li></ul></li><li>Nginx.conf 配置文件 <ul><li>控制 Nginx 的行为</li></ul></li><li>access.log 访问日志 <ul><li>记录每一条 http 请求信息</li></ul></li><li>error.log 错误日志 <ul><li>定位问题</li></ul></li></ul><h3 id="nginx-版本发布历史" tabindex="-1">Nginx 版本发布历史 <a class="header-anchor" href="#nginx-版本发布历史" aria-hidden="true">#</a></h3><p>nginx 版本发布情况（mainline）。2002 年开发时间，2004 推出第一个版本。</p><img src="/notes/assets/mainline.999e0c6e.png" style="zoom:80%;"><p><a href="https://nginx.org/en/download.html%E3%80%82" target="_blank" rel="noopener noreferrer">https://nginx.org/en/download.html。</a></p><h3 id="nginx-发行版本选择" tabindex="-1">Nginx 发行版本选择 <a class="header-anchor" href="#nginx-发行版本选择" aria-hidden="true">#</a></h3><p>开源免费的 Nginx 与商业版 Nginx Plus。</p><p>开源版：<a href="http://nginx.org" target="_blank" rel="noopener noreferrer">nginx.org</a></p><p>商业版：<a href="http://nginx.com" target="_blank" rel="noopener noreferrer">nginx.com</a></p><img src="/notes/assets/version.f3a02e27.png" style="zoom:80%;"><p>阿里巴巴的 Tengine，<a href="http://tengine.taobao.org/%E3%80%82" target="_blank" rel="noopener noreferrer">http://tengine.taobao.org/。</a></p><blockquote><p>Tengine是由淘宝网发起的Web服务器项目。它在<a href="http://nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>的基础上，针对大访问量网站的需求，添加了很多高级功能和特性。Tengine的性能和稳定性已经在大型的网站如<a href="http://www.taobao.com/" target="_blank" rel="noopener noreferrer">淘宝网</a>，<a href="http://www.tmall.com/" target="_blank" rel="noopener noreferrer">天猫商城</a>等得到了很好的检验。它的最终目标是打造一个高效、稳定、安全、易用的Web平台。</p><p>从2011年12月开始，Tengine成为一个开源项目，Tengine团队在积极地开发和维护着它。Tengine团队的核心成员来自于<a href="http://www.taobao.com/" target="_blank" rel="noopener noreferrer">淘宝</a>、<a href="http://www.sogou.com/" target="_blank" rel="noopener noreferrer">搜狗</a>等互联网企业。Tengine是社区合作的成果，我们欢迎大家<a href="http://tengine.taobao.org/source_cn.html" target="_blank" rel="noopener noreferrer">参与其中</a>，贡献自己的力量。</p></blockquote><p>免费 OpenResty 与商业版 OpenRestry</p><p>开源 OpenRestry：<a href="http://openresty.org" target="_blank" rel="noopener noreferrer">http://openresty.org</a>。</p><blockquote><p>OpenResty® 是一个基于 <a href="http://openresty.org/cn/nginx.html" target="_blank" rel="noopener noreferrer">Nginx</a> 与 Lua 的高性能 Web 平台，其内部集成了大量精良的 Lua 库、第三方模块以及大多数的依赖项。用于方便地搭建能够处理超高并发、扩展性极高的动态 Web 应用、Web 服务和动态网关。</p><p>OpenResty® 通过汇聚各种设计精良的 <a href="http://openresty.org/cn/nginx.html" target="_blank" rel="noopener noreferrer">Nginx</a> 模块（主要由 OpenResty 团队自主开发），从而将 <a href="http://openresty.org/cn/nginx.html" target="_blank" rel="noopener noreferrer">Nginx</a> 有效地变成一个强大的通用 Web 应用平台。这样，Web 开发人员和系统工程师可以使用 Lua 脚本语言调动 <a href="http://openresty.org/cn/nginx.html" target="_blank" rel="noopener noreferrer">Nginx</a> 支持的各种 C 以及 Lua 模块，快速构造出足以胜任 10K 乃至 1000K 以上单机并发连接的高性能 Web 应用系统。</p></blockquote><p>商业版 OpenResty：<a href="https://openresty.com" target="_blank" rel="noopener noreferrer">https://openresty.com</a>。</p><blockquote><p>技术支持比较好。</p></blockquote><img src="/notes/assets/openresty.af546e4d.png" style="zoom:100%;"><h3 id="编译适合自己的-nginx" tabindex="-1">编译适合自己的 Nginx <a class="header-anchor" href="#编译适合自己的-nginx" aria-hidden="true">#</a></h3><h4 id="下载-nginx" tabindex="-1">下载 Nginx <a class="header-anchor" href="#下载-nginx" aria-hidden="true">#</a></h4><p><a href="https://nginx.org" target="_blank" rel="noopener noreferrer">https://nginx.org</a></p><p>download</p><p>Mainline version、Stable version</p><p>下载稳定版。</p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">wget </span><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//nginx.org/download/nginx-1.20.1.tar.gz</span></span>
<span class="line"><span style="color:#A6ACCD;">tar </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">xzf nginx</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1.20</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tar</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">gz</span></span>
<span class="line"><span style="color:#A6ACCD;">cd nginx</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1.20</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">1</span></span>
<span class="line"></span></code></pre></div><h4 id="目录介绍" tabindex="-1">目录介绍 <a class="header-anchor" href="#目录介绍" aria-hidden="true">#</a></h4><img src="/notes/assets/contents.5973aeb8.png"><ul><li>auto <ul><li>cc 编译</li><li>lib</li><li>os</li><li>types</li></ul></li><li>CHANGES：Nginx 每个版本中提供提供的特性和修复的 BUG</li><li><a href="http://CHANGES.ru" target="_blank" rel="noopener noreferrer">CHANGES.ru</a>：俄罗斯版本的 CHANGEES 文件，作者是俄罗斯的</li><li>conf 示例文件</li><li>configure：脚本，生成中间文件，执行编译前的必备动作</li><li>contrib：提供脚本和 VIM 工具 <ul><li>cp -r contrib/vim/* ～/.vim/ 可以使 vim 支持 nginx 语法</li></ul></li><li>html：提供标准 HTML 文件，500 错误文件与默认 nginx 欢迎界面</li><li>main：linux 对 nginx 的帮助文件</li><li>src：Nginx 源代码</li></ul><h4 id="configure" tabindex="-1">Configure <a class="header-anchor" href="#configure" aria-hidden="true">#</a></h4><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">./</span><span style="color:#A6ACCD;">configure </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">help </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> more </span><span style="color:#676E95;font-style:italic;">// 查看帮助文件</span></span>
<span class="line"></span></code></pre></div><p>默认参数编译</p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">./</span><span style="color:#A6ACCD;">configure </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">prefix</span><span style="color:#89DDFF;">=/</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">nginx</span></span>
<span class="line"></span></code></pre></div><img src="/notes/assets/configura.3dc973bf.png"><h4 id="中间文件介绍" tabindex="-1">中间文件介绍 <a class="header-anchor" href="#中间文件介绍" aria-hidden="true">#</a></h4><img src="/notes/assets/contents02.8fad7652.png"><p>objs</p><ul><li><p>ngx_modules.c：决定 nginx 编译时有哪些模块会被编译进 nginx</p></li><li><p>src</p></li></ul><h4 id="编译" tabindex="-1">编译 <a class="header-anchor" href="#编译" aria-hidden="true">#</a></h4><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">make </span><span style="color:#676E95;font-style:italic;">// 编译</span></span>
<span class="line"></span></code></pre></div><p>编译结束后，会在 objs 目录下生成大量二进制文件。</p><blockquote><p>c 语言编译时生成的所有的中间文件都会放到 src 目录</p></blockquote><p>nginx 版本升级时，需要将 objs 目录下的文件拷贝到安装目录中。</p><p>如果我们使用动态模块，动态模块会生成 so 动态文件，也会放到 objs 目录下。</p><h4 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-hidden="true">#</a></h4><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">make install </span><span style="color:#676E95;font-style:italic;">// 首次安装时可以使用此命令</span></span>
<span class="line"></span></code></pre></div><p>安装完成后可以去指定目录查看。</p><img src="/notes/assets/install.643e62c9.png"><p>sbin：nginx 二进制文件</p><p>config：和源代码中配置文件相同，决定 nginx 功能文件</p><p>logs：日志文件</p><h3 id="配置文件的通用语法介绍" tabindex="-1">配置文件的通用语法介绍 <a class="header-anchor" href="#配置文件的通用语法介绍" aria-hidden="true">#</a></h3><h4 id="基础语法" tabindex="-1">基础语法 <a class="header-anchor" href="#基础语法" aria-hidden="true">#</a></h4><ul><li>配置文件由指令与指令块组成</li><li>每条指令以 ；分号结尾，指令与参数间以空格符号分割</li><li>指令块以 {} 大括号将多条指令组织在一起</li><li>include 语句允许组合多个配置文件以提升可维护性</li><li>使用 # 符号添加注释，提高可读性</li><li>使用 $ 符号使用变量</li><li>部分指令的参数支持正则表达式</li></ul><h4 id="配置参数：时间单位" tabindex="-1">配置参数：时间单位 <a class="header-anchor" href="#配置参数：时间单位" aria-hidden="true">#</a></h4><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ms milliseconds</span></span>
<span class="line"><span style="color:#A6ACCD;">d days</span></span>
<span class="line"><span style="color:#A6ACCD;">s seconds</span></span>
<span class="line"><span style="color:#A6ACCD;">w weeks</span></span>
<span class="line"><span style="color:#A6ACCD;">m minutes</span></span>
<span class="line"><span style="color:#A6ACCD;">M months</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">30</span><span style="color:#A6ACCD;"> days</span></span>
<span class="line"><span style="color:#A6ACCD;">h hours</span></span>
<span class="line"><span style="color:#A6ACCD;">y years</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">365</span><span style="color:#A6ACCD;"> days</span></span>
<span class="line"></span></code></pre></div><h4 id="配置参数：空间单位" tabindex="-1">配置参数：空间单位 <a class="header-anchor" href="#配置参数：空间单位" aria-hidden="true">#</a></h4><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">bytes</span></span>
<span class="line"><span style="color:#A6ACCD;">k</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">K kilobytes</span></span>
<span class="line"><span style="color:#A6ACCD;">m</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">M megabytes</span></span>
<span class="line"><span style="color:#A6ACCD;">g</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">G gigabytes</span></span>
<span class="line"></span></code></pre></div><h4 id="http-配置的指令块" tabindex="-1">http 配置的指令块 <a class="header-anchor" href="#http-配置的指令块" aria-hidden="true">#</a></h4><p>http：表示内部所有执行由 http 解析并执行</p><p>server：定义域名或者一组域名</p><p>location：url 表达式</p><p>upstream：上游服务，nginx 需要与 tomcat 等其他服务交互时，我们可以定义 upstream</p><h3 id="命令行：重载、热部署、日志切割" tabindex="-1">命令行：重载、热部署、日志切割 <a class="header-anchor" href="#命令行：重载、热部署、日志切割" aria-hidden="true">#</a></h3><h4 id="linux-命令行" tabindex="-1">linux 命令行 <a class="header-anchor" href="#linux-命令行" aria-hidden="true">#</a></h4><ul><li>格式：nginx -s reload</li><li>帮助：-? -h</li><li>使用指定的配置文件：-c</li><li>指定配置指令：-g</li><li>指定运行目录：-p</li><li>发送信号：-s <ul><li>立刻停止服务：stop</li><li>优雅的停止服务：quit</li><li>重载配置文件：reload</li><li>重新开始记录日志文件：reopen</li></ul></li><li>测试配置文件是否有语法错误：-t、-T</li><li>打印 nginx 的版本信息、编译信息等：-v、-V</li></ul><h4 id="重载配置文件" tabindex="-1">重载配置文件 <a class="header-anchor" href="#重载配置文件" aria-hidden="true">#</a></h4><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">./</span><span style="color:#A6ACCD;">nginx </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">s reload </span><span style="color:#676E95;font-style:italic;">// 不停止服务的情况下，重新载入配置文件</span></span>
<span class="line"></span></code></pre></div><h4 id="热部署" tabindex="-1">热部署 <a class="header-anchor" href="#热部署" aria-hidden="true">#</a></h4><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ps </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">ef </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> grep nginx </span><span style="color:#676E95;font-style:italic;">// 查看进程状况</span></span>
<span class="line"></span></code></pre></div><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">// 备份现有二进制文件</span></span>
<span class="line"><span style="color:#A6ACCD;">cp nginx nginx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">old</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 替换正在运行的二进制文件</span></span>
<span class="line"><span style="color:#A6ACCD;">cp </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">r nginx </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">nginx</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">sbin</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">f </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 向 master 进程发送信号</span></span>
<span class="line"><span style="color:#A6ACCD;">kill </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">USR2 </span><span style="color:#F78C6C;">13195</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 向老的进程发送关闭信号（关闭 work 进程，老的 master 进程还可以重新拉起 worker 进程）</span></span>
<span class="line"><span style="color:#A6ACCD;">kill </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">WINCH </span><span style="color:#F78C6C;">13195</span></span>
<span class="line"></span></code></pre></div><h4 id="日志切割" tabindex="-1">日志切割 <a class="header-anchor" href="#日志切割" aria-hidden="true">#</a></h4><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">mv blog</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log blog</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">bak</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">./</span><span style="color:#A6ACCD;">nginx </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">s reopen</span></span>
<span class="line"></span></code></pre></div><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">// bash 脚本</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">crontab </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">l</span></span>
<span class="line"></span></code></pre></div><h3 id="搭建静态资源-web-服务器" tabindex="-1">搭建静态资源 Web 服务器 <a class="header-anchor" href="#搭建静态资源-web-服务器" aria-hidden="true">#</a></h3><p>ngx_http_gzip_module</p><ul><li>Embeded Variables <ul><li>$gzip_ratio 表示当时使用的压缩比率</li></ul></li></ul><p>autoindex module</p><blockquote><p>当我们访问以 “/” 结尾的 url 时，当我们对应到这个目录中，显示这个目录的结构</p></blockquote><p>ngx_http_core_module</p><ul><li>Embeded Variables <ul><li>$limit_rate 限制响应速度</li><li>$content_length 记录请求头部长度</li><li>。。。</li></ul></li></ul><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">test.yueluo.club</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 压缩</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_min_length </span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 小于多少字节就不再压缩</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_comp_level </span><span style="color:#A6ACCD;">2</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 压缩级别</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_types </span><span style="color:#A6ACCD;">text/plain application/X-javascript text/css image/jpeg</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 压缩类型</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> alias </span><span style="color:#A6ACCD;">www/project/</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># / 代表所有请求</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 通常使用 alias，root 会携带路径</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 这里就是说 project 目录下后面的路径和 url 是一一对应的</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> autoindex </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 显示文件结构，当路径是一个文件时</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> set $</span><span style="color:#A6ACCD;">limit_rate </span><span style="color:#F78C6C;">1k</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 限制 nginx 向客户端浏览器发送响应的速度，每秒传输多少字节到浏览器中</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>日志相关</p><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">http</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># 命名 main，方便对不同的 url 或者域名做不同的处理</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> log_format </span><span style="color:#A6ACCD;">main </span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr</span><span style="color:#C3E88D;"> - </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_user</span><span style="color:#C3E88D;"> [</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">time_local</span><span style="color:#C3E88D;">] &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request</span><span style="color:#C3E88D;">&quot; &#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">status</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">body_bytes_sent</span><span style="color:#C3E88D;"> &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_referer</span><span style="color:#C3E88D;">&quot; &#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">&#39;&quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_user_agent</span><span style="color:#C3E88D;">&quot; &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_x_forwarded_for</span><span style="color:#C3E88D;">&quot;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">test.yueluo.club</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> access_log </span><span style="color:#A6ACCD;">data/logs/test/access.log</span><span style="color:#89DDFF;"> main;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 使用 main 的日志格式，定义输出目录</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 压缩</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_min_length </span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 小于多少字节就不再压缩</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_comp_level </span><span style="color:#A6ACCD;">2</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 压缩级别</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_types </span><span style="color:#A6ACCD;">text/plain application/X-javascript text/css image/jpeg</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 压缩类型</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> alias </span><span style="color:#A6ACCD;">www/project/</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># / 代表所有请求</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 通常使用 alias，root 会携带路径</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 这里就是说 project 目录下后面的路径和 url 是一一对应的</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> autoindex </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 显示文件结构，当路径是一个文件时</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> set $</span><span style="color:#A6ACCD;">limit_rate </span><span style="color:#F78C6C;">1k</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 限制 nginx 向客户端浏览器发送响应的速度，每秒传输多少字节到浏览器中</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="搭建具备缓存功能的反向代理服务" tabindex="-1">搭建具备缓存功能的反向代理服务 <a class="header-anchor" href="#搭建具备缓存功能的反向代理服务" aria-hidden="true">#</a></h3><p>listen 8080</p><p>listen 127.0.0.1:8080 表示只能本机访问 8080 端口</p><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">127.0.0.1:8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>搭建反向代理服务</p><p>ngx_http_proxy_module</p><ul><li>proxy_cache nginx 性能领先于上游服务器性能，使用 cache 对小的站点会有非常大的性能提升</li></ul><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">http</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># 缓存文件相关参数配置</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> proxy_cache_path </span><span style="color:#A6ACCD;">/tmp/nginxcache levels=1:2 keys_zone=my_cache:10m max_size:10g inactive=60m use_temp_path=off</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">local </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 127.0.0.1:8080;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">test.yueluo.club</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Host </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">host</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Real-IP </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Forwarded-For </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">proxy_add_x_forwared_for</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_cache </span><span style="color:#A6ACCD;">my_cache</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_cache_key $</span><span style="color:#A6ACCD;">host</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">uri</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">is_args</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_cache_valid </span><span style="color:#A6ACCD;">200 </span><span style="color:#F78C6C;">304</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">302</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1d</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://local</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }  </span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="goaccess-实现日志可视化" tabindex="-1">GoAccess 实现日志可视化 <a class="header-anchor" href="#goaccess-实现日志可视化" aria-hidden="true">#</a></h3><p><a href="https://goaccess.io" target="_blank" rel="noopener noreferrer">https://goaccess.io</a></p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">goaccess access</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">o report</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">html </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">log</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">format</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">COMBINED</span></span>
<span class="line"></span></code></pre></div><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">goaccess access</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">o </span><span style="color:#89DDFF;">../</span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">report</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">html </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">real</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">time</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">html </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">time</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">format</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">%H:%M:%S</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">date</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">format</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">%d/%b/%Y</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">log</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">format</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">COMBINED</span></span>
<span class="line"></span></code></pre></div><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">	access_log </span><span style="color:#A6ACCD;">logs/access.log</span><span style="color:#89DDFF;"> main;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/report.html </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> alias </span><span style="color:#A6ACCD;">/data/log/blog/report.html</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="从网络原理来看-ssl-安全协议" tabindex="-1">从网络原理来看 SSL 安全协议 <a class="header-anchor" href="#从网络原理来看-ssl-安全协议" aria-hidden="true">#</a></h3><img src="/notes/assets/SSL.580002fe.png" style="zoom:80%;"><img src="/notes/assets/TLS.62dff575.png" style="zoom:80%;"><h3 id="对称加密与非对称加密" tabindex="-1">对称加密与非对称加密 <a class="header-anchor" href="#对称加密与非对称加密" aria-hidden="true">#</a></h3><h4 id="对称加密" tabindex="-1">对称加密 <a class="header-anchor" href="#对称加密" aria-hidden="true">#</a></h4><img src="/notes/assets/tls_secret_01.754d59fc.png" style="zoom:80%;"><img src="/notes/assets/tls_secret_02.3f04e942.png" style="zoom:80%;"><h4 id="非对称加密" tabindex="-1">非对称加密 <a class="header-anchor" href="#非对称加密" aria-hidden="true">#</a></h4><img src="/notes/assets/tls_secret_03.eb68d7cc.png" style="zoom:80%;"><h3 id="ssl-如何保证公信力" tabindex="-1">SSL 如何保证公信力 <a class="header-anchor" href="#ssl-如何保证公信力" aria-hidden="true">#</a></h3><h4 id="pki-公钥基础设施" tabindex="-1">PKI 公钥基础设施 <a class="header-anchor" href="#pki-公钥基础设施" aria-hidden="true">#</a></h4><img src="/notes/assets/pki.a7604f71.png" style="zoom:100%;"><h4 id="证书类型" tabindex="-1">证书类型 <a class="header-anchor" href="#证书类型" aria-hidden="true">#</a></h4><img src="/notes/assets/domain.e16e1ef2.png" style="zoom:100%;"><h4 id="证书链" tabindex="-1">证书链 <a class="header-anchor" href="#证书链" aria-hidden="true">#</a></h4><img src="/notes/assets/domain_02.99eb44f7.png" style="zoom:100%;"><h3 id="ssl-协议握手的-nginx-性能瓶颈" tabindex="-1">SSL 协议握手的 Nginx 性能瓶颈 <a class="header-anchor" href="#ssl-协议握手的-nginx-性能瓶颈" aria-hidden="true">#</a></h3><h4 id="tls-通讯过程" tabindex="-1">TLS 通讯过程 <a class="header-anchor" href="#tls-通讯过程" aria-hidden="true">#</a></h4><img src="/notes/assets/tls_connection.cca19f8f.png" style="zoom:100%;"><h4 id="nginx-握手性能" tabindex="-1">Nginx 握手性能 <a class="header-anchor" href="#nginx-握手性能" aria-hidden="true">#</a></h4><img src="/notes/assets/tls_nginx.d6bd52fd.png" style="zoom:100%;"><h4 id="nginx-数据加密性能" tabindex="-1">Nginx 数据加密性能 <a class="header-anchor" href="#nginx-数据加密性能" aria-hidden="true">#</a></h4><img src="/notes/assets/tls_nginx_02.22e40dc7.png" style="zoom:100%;"><h4 id="nginx-综合性能" tabindex="-1">Nginx 综合性能 <a class="header-anchor" href="#nginx-综合性能" aria-hidden="true">#</a></h4><img src="/notes/assets/tls_nginx_03.7ef73216.png" style="zoom:100%;"><h3 id="免费-ssl-证书实现一个站点" tabindex="-1">免费 SSL 证书实现一个站点 <a class="header-anchor" href="#免费-ssl-证书实现一个站点" aria-hidden="true">#</a></h3><div class="language-jsx"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">yum install python2</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">certbot</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">nginx </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">yum install certbot </span><span style="color:#676E95;font-style:italic;">// 最新</span></span>
<span class="line"></span></code></pre></div><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">certbot </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">nginx </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">nginx</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">root</span><span style="color:#89DDFF;">=/</span><span style="color:#A6ACCD;">etc</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">nginx</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">conf</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">d music</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">yueluo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">club</span></span>
<span class="line"></span></code></pre></div><h3 id="基于-openresty-实现简单服务" tabindex="-1">基于 OpenResty 实现简单服务 <a class="header-anchor" href="#基于-openresty-实现简单服务" aria-hidden="true">#</a></h3><h4 id="下载-openresty" tabindex="-1">下载 OpenResty <a class="header-anchor" href="#下载-openresty" aria-hidden="true">#</a></h4><p><a href="https://openresty.org/cn/" target="_blank" rel="noopener noreferrer">https://openresty.org/cn/</a></p><blockquote><p>OpenResty® 是一个基于 <a href="https://openresty.org/cn/nginx.html" target="_blank" rel="noopener noreferrer">Nginx</a> 与 Lua 的高性能 Web 平台，其内部集成了大量精良的 Lua 库、第三方模块以及大多数的依赖项。用于方便地搭建能够处理超高并发、扩展性极高的动态 Web 应用、Web 服务和动态网关。</p></blockquote><p>下载页面：<a href="https://openresty.org/cn/download.html" target="_blank" rel="noopener noreferrer">https://openresty.org/cn/download.html</a></p><p>通常我们不会下载二进制版本，我们需要下载源码，复制其下载链接</p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">wget </span><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//openresty.org/download/openresty-1.19.3.2.tar.gz</span></span>
<span class="line"></span></code></pre></div><h4 id="分析目录结构" tabindex="-1">分析目录结构 <a class="header-anchor" href="#分析目录结构" aria-hidden="true">#</a></h4><ul><li><p>build 编译生成的目标文件</p></li><li><p>bundle 模块文件，基于 nginx 二次开发</p><ul><li>nginx c 模块</li><li>lua 模块</li></ul></li><li><p>configure</p><ul><li>./configure --help 帮助命令</li></ul></li><li><p>patches</p></li><li><p>util</p></li></ul><h4 id="编译-1" tabindex="-1">编译 <a class="header-anchor" href="#编译-1" aria-hidden="true">#</a></h4><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">./</span><span style="color:#A6ACCD;">configure</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">make</span></span>
<span class="line"></span></code></pre></div><h4 id="添加-lua-代码" tabindex="-1">添加 lua 代码 <a class="header-anchor" href="#添加-lua-代码" aria-hidden="true">#</a></h4><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">vim nginx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">conf</span></span>
<span class="line"></span></code></pre></div><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/lua </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> default_type </span><span style="color:#A6ACCD;">text/html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># http 请求内容生成阶段用 lua 处理</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">content_by_lua</span><span style="color:#A6ACCD;"> &#39;ngx.</span><span style="color:#82AAFF;">say</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">User-Agent: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">, ngx.req.</span><span style="color:#82AAFF;">get_headers</span><span style="color:#A6ACCD;">()[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">User-Agent</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">])&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> alias </span><span style="color:#A6ACCD;">html/music/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="运行" tabindex="-1">运行 <a class="header-anchor" href="#运行" aria-hidden="true">#</a></h4><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">nginx </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">s reload</span></span>
<span class="line"></span></code></pre></div><h2 id="二、nginx-架构基础" tabindex="-1">二、Nginx 架构基础 <a class="header-anchor" href="#二、nginx-架构基础" aria-hidden="true">#</a></h2><h3 id="nginx-的请求处理流程" tabindex="-1">Nginx 的请求处理流程 <a class="header-anchor" href="#nginx-的请求处理流程" aria-hidden="true">#</a></h3><img src="/notes/assets/request.b7829247.png" style="zoom:80%;"><h3 id="nginx-的进程结构" tabindex="-1">Nginx 的进程结构 <a class="header-anchor" href="#nginx-的进程结构" aria-hidden="true">#</a></h3><ul><li>单进程结构 <ul><li>不适合生产环境，只适合开发，调试</li></ul></li><li>多进程结构</li></ul><p>多进程模型</p><ul><li>nginx 需要保持高可用性和高可靠性，所以不能使用线程，线程之间存在共享空间</li><li>master 进程中通常不会加入第三方模块代码 <ul><li>master 主要是用来做进程管理，处理 worker 进程</li><li>缓存需要被 worker 进程使用，也要被 Cache manager 进程使用</li></ul></li><li>woker 进程为什么很多 <ul><li>nginx 采用事件驱动模型之后，希望每个 worker 进程从头到尾占用一个 CPU，可以更好地使用 CPU 缓存</li></ul></li></ul><img src="/notes/assets/nginx_model.da8177a3.png" style="zoom:100%;"><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ps </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">ef </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> grep nginx </span><span style="color:#676E95;font-style:italic;">// 查看 nginx 进程</span></span>
<span class="line"></span></code></pre></div><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">nginx </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">s reload </span><span style="color:#676E95;font-style:italic;">// 重载 nginx 服务，会重新开启新的 worker 子进程和 Cache manager 进程</span></span>
<span class="line"><span style="color:#A6ACCD;">kill </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">SIGHUP </span><span style="color:#F78C6C;">9170</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// SIGHUP 信号和 reload 作用是一致的</span></span>
<span class="line"></span></code></pre></div><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">kill </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">SIGTERM </span><span style="color:#F78C6C;">9862</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 退出子进程，子进程会通知父进程，父进程会重启一个子进程</span></span>
<span class="line"></span></code></pre></div><h3 id="信号管理-nginx-父进程" tabindex="-1">信号管理 Nginx 父进程 <a class="header-anchor" href="#信号管理-nginx-父进程" aria-hidden="true">#</a></h3><p>Master 进程</p><ul><li><p>TERM 立刻停止 Nginx 进程</p></li><li><p>QUIT 优雅的停止 Nginx 进程</p></li><li><p>HUP 重载配置文件</p></li><li><p>USR1 重新打开日志文件，进行日志文件切割</p></li><li><p>以上 4 个命令可以通过命令行向 master 进程发送</p></li><li><p>USR2</p></li><li><p>WINCH</p></li><li><p>以上 2 个命令只能通过 kill linux 命令行向 master 进程发送</p></li></ul><img src="/notes/assets/nginx_sign.7cdf1187.png" style="zoom:90%;"><blockquote><p>调用 Nginx 命令行发送相应命令本质是也是发送信号指令。</p></blockquote><h3 id="reload-重载配置文件的原理" tabindex="-1">reload 重载配置文件的原理 <a class="header-anchor" href="#reload-重载配置文件的原理" aria-hidden="true">#</a></h3><img src="/notes/assets/nginx_reload.df69de3c.png" style="zoom:90%;"><img src="/notes/assets/nginx_reload02.eda989a6.png" style="zoom:90%;"><p>老进程由于异常导致无法正常关闭，这时可以配置 worker_shutdonwn_timeout 最长等待时间，master 开启子进程之后会开启定时器，如果定时时间到达之后，老的 workder 进程还没有关闭，会强制关闭。</p><h3 id="热升级的完整流程" tabindex="-1">热升级的完整流程 <a class="header-anchor" href="#热升级的完整流程" aria-hidden="true">#</a></h3><p>替换 Nginx 文件：替换 bundary 文件。</p><img src="/notes/assets/nginx_upgrade.29c42e7c.png" style="zoom:90%;"><img src="/notes/assets/nginx_upgrade02.539c9420.png" style="zoom:90%;"><h3 id="优雅地关闭-worker-进程" tabindex="-1">优雅地关闭 worker 进程 <a class="header-anchor" href="#优雅地关闭-worker-进程" aria-hidden="true">#</a></h3><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">nginx </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">s reload </span><span style="color:#676E95;font-style:italic;">// 优雅关闭</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">s stop </span><span style="color:#676E95;font-style:italic;">// 立即关闭</span></span>
<span class="line"></span></code></pre></div><p>优雅关闭是对 worker 进程 的 http 请求 而言的。</p><p>当老进程进行 WebSocket 通信时，或者进行 TCP 请求时，nginx 不知道什么时候应该关闭。</p><img src="/notes/assets/nginx_reload03.a954372e.png" style="zoom:90%;"><h3 id="网络收发与-nginx-事件间的对应关系" tabindex="-1">网络收发与 Nginx 事件间的对应关系 <a class="header-anchor" href="#网络收发与-nginx-事件间的对应关系" aria-hidden="true">#</a></h3><p>Nginx 是一个事件驱动的框架，这里的事件指的是网络事件。</p><h4 id="网络传输" tabindex="-1">网络传输 <a class="header-anchor" href="#网络传输" aria-hidden="true">#</a></h4><img src="/notes/assets/network.1ba61d58.png" style="zoom:90%;"><h4 id="tcp-与报文" tabindex="-1">TCP 与报文 <a class="header-anchor" href="#tcp-与报文" aria-hidden="true">#</a></h4><img src="/notes/assets/tcp.57d9db8b.png" style="zoom:90%;"><h4 id="tcp-协议与非阻塞接口" tabindex="-1">TCP 协议与非阻塞接口 <a class="header-anchor" href="#tcp-协议与非阻塞接口" aria-hidden="true">#</a></h4><p>事件收集、分发器，我们会定义每个事件对应的消费者。</p><img src="/notes/assets/interface.cb45a937.png" style="zoom:90%;"><h3 id="nginx-的事件驱动模型" tabindex="-1">Nginx 的事件驱动模型 <a class="header-anchor" href="#nginx-的事件驱动模型" aria-hidden="true">#</a></h3><img src="/notes/assets/nginx_loop.7bb3915a.png" style="zoom:90%;"><h3 id="epoll-的优势及原理" tabindex="-1">epoll 的优势及原理 <a class="header-anchor" href="#epoll-的优势及原理" aria-hidden="true">#</a></h3><img src="/notes/assets/epoll.d8d3b7f8.png" style="zoom:90%;"><h3 id="nginx-的事件切换" tabindex="-1">Nginx 的事件切换 <a class="header-anchor" href="#nginx-的事件切换" aria-hidden="true">#</a></h3><img src="/notes/assets/request_switch.da18dcf1.png" style="zoom:90%;"><h3 id="同步，异步、阻塞与非阻塞" tabindex="-1">同步，异步、阻塞与非阻塞 <a class="header-anchor" href="#同步，异步、阻塞与非阻塞" aria-hidden="true">#</a></h3><p>阻塞和非阻塞主要是指操作系统或者底层 C 库提供的方法或者系统调用，调用方法是否会导致进程进程 sleep 状态。</p><h4 id="阻塞调用" tabindex="-1">阻塞调用 <a class="header-anchor" href="#阻塞调用" aria-hidden="true">#</a></h4><img src="/notes/assets/nginx_sleep.c19d3988.png" style="zoom:90%;"><h4 id="非阻塞调用" tabindex="-1">非阻塞调用 <a class="header-anchor" href="#非阻塞调用" aria-hidden="true">#</a></h4><img src="/notes/assets/nginx_no_sleep.5784dbbf.png" style="zoom:90%;"><h4 id="非阻塞调用下的同步与异步" tabindex="-1">非阻塞调用下的同步与异步 <a class="header-anchor" href="#非阻塞调用下的同步与异步" aria-hidden="true">#</a></h4><img src="/notes/assets/nginx_no_sleep02.0fd89cd0.png" style="zoom:90%;"><h3 id="nginx-的模块" tabindex="-1">Nginx 的模块 <a class="header-anchor" href="#nginx-的模块" aria-hidden="true">#</a></h3><p><a href="https://nginx.org/en/docs" target="_blank" rel="noopener noreferrer">https://nginx.org/en/docs</a> 官方文档。</p><p>我们可以从官方文档或者编译出的 nginx 源码来查看具体使用方式。</p><p>Nginx 模块定义：</p><ul><li>ngx_module_t 是每一个模块都具备的 <ul><li>type 定义模块类型</li></ul></li></ul><img src="/notes/assets/modules_def.c8be54b5.png" style="zoom:90%;"><h3 id="nginx-模块的分类" tabindex="-1">Nginx 模块的分类 <a class="header-anchor" href="#nginx-模块的分类" aria-hidden="true">#</a></h3><ul><li><p>ngx_conf_module：解析 Nginx conf 文件</p></li><li><p>核心模块</p><ul><li>http <ul><li>ngx_http_core_module</li><li>请求过滤模块</li><li>响应过滤模块</li></ul></li><li>cvcnts</li><li>strcam</li></ul></li></ul><img src="/notes/assets/modules_cates.04b99755.png" style="zoom:90%;"><h3 id="nginx-如何通过连接池处理网络请求" tabindex="-1">Nginx 如何通过连接池处理网络请求 <a class="header-anchor" href="#nginx-如何通过连接池处理网络请求" aria-hidden="true">#</a></h3><p>。。。。</p><h2 id="三、http-模块" tabindex="-1">三、HTTP 模块 <a class="header-anchor" href="#三、http-模块" aria-hidden="true">#</a></h2><h3 id="冲突的配置指令以谁为准" tabindex="-1">冲突的配置指令以谁为准 <a class="header-anchor" href="#冲突的配置指令以谁为准" aria-hidden="true">#</a></h3><h4 id="配置块嵌套" tabindex="-1">配置块嵌套 <a class="header-anchor" href="#配置块嵌套" aria-hidden="true">#</a></h4><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">main</span></span>
<span class="line"><span style="color:#C792EA;">http</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> {...}</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> split_clients </span><span style="color:#A6ACCD;">{...}</span></span>
<span class="line"><span style="color:#A6ACCD;">  map {}</span></span>
<span class="line"><span style="color:#A6ACCD;">  geo {}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  server {</span></span>
<span class="line"><span style="color:#A6ACCD;">    if () {}</span></span>
<span class="line"><span style="color:#A6ACCD;">    location {</span></span>
<span class="line"><span style="color:#A6ACCD;">      limit_except {...}</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    location {</span></span>
<span class="line"><span style="color:#A6ACCD;">      location {</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  server {</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="指令的-context" tabindex="-1">指令的 Context <a class="header-anchor" href="#指令的-context" aria-hidden="true">#</a></h4><img src="/notes/assets/direction_context.e32ee024.png" style="zoom:90%;"><h4 id="指令的合并" tabindex="-1">指令的合并 <a class="header-anchor" href="#指令的合并" aria-hidden="true">#</a></h4><img src="/notes/assets/direction_merge.969a67cf.png" style="zoom:90%;"><h4 id="存储值的指令继承规则：向上覆盖" tabindex="-1">存储值的指令继承规则：向上覆盖 <a class="header-anchor" href="#存储值的指令继承规则：向上覆盖" aria-hidden="true">#</a></h4><img src="/notes/assets/direction_merge_rule01.50041bf0.png" style="zoom:90%;"><h4 id="http-模块合并配置的实现" tabindex="-1">HTTP 模块合并配置的实现 <a class="header-anchor" href="#http-模块合并配置的实现" aria-hidden="true">#</a></h4><p>并不是所有的指令合并都遵循向上覆盖的原则，我们还需要注意以下几点。</p><img src="/notes/assets/direction_merge_rule02.613d8f64.png" style="zoom:90%;"><h3 id="listen-指令的用法" tabindex="-1">Listen 指令的用法 <a class="header-anchor" href="#listen-指令的用法" aria-hidden="true">#</a></h3><img src="/notes/assets/nginx_listen.7823957d.png" style="zoom:90%;"><h3 id="处理-http-请求头部的流程" tabindex="-1">处理 HTTP 请求头部的流程 <a class="header-anchor" href="#处理-http-请求头部的流程" aria-hidden="true">#</a></h3><h4 id="接收请求事件模块" tabindex="-1">接收请求事件模块 <a class="header-anchor" href="#接收请求事件模块" aria-hidden="true">#</a></h4><img src="/notes/assets/request_module.e94fc36c.png" style="zoom:90%;"><h4 id="接收请求-http-模块" tabindex="-1">接收请求 HTTP 模块 <a class="header-anchor" href="#接收请求-http-模块" aria-hidden="true">#</a></h4><img src="/notes/assets/request_module02.553e395f.png" style="zoom:90%;"><h3 id="nginx-中的正则表达式" tabindex="-1">Nginx 中的正则表达式 <a class="header-anchor" href="#nginx-中的正则表达式" aria-hidden="true">#</a></h3><p>可以使用 pcre test 测试正则表达式。</p><img src="/notes/assets/reg01.77d6b9ac.png" style="zoom:90%;"><img src="/notes/assets/reg02.7481226c.png" style="zoom:90%;"><h3 id="如何找到处理请求的-server-指令" tabindex="-1">如何找到处理请求的 server 指令 <a class="header-anchor" href="#如何找到处理请求的-server-指令" aria-hidden="true">#</a></h3><h4 id="server-name-指令" tabindex="-1">server_name 指令 <a class="header-anchor" href="#server-name-指令" aria-hidden="true">#</a></h4><p>指令后可以跟多个域名，第 1 个是主域名。</p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#FFCB6B;">Syntax</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> server_name_in_direct on </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">Default</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> server_name_in_redirect off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">Context</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> http</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">location</span></span>
<span class="line"></span></code></pre></div><p>*泛域名：仅支持在最前或者最后</p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">例如：server_name </span><span style="color:#89DDFF;">*.</span><span style="color:#A6ACCD;">yueluo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">club</span></span>
<span class="line"></span></code></pre></div><p>正则表达式：加 ~ 前缀</p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">server_name www</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">yueluo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">club </span><span style="color:#89DDFF;">~^</span><span style="color:#A6ACCD;">www\d</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">\</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">yueluo\</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">club$</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>用正则表达式创建变量：用小括号</p><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> server_name ~</span><span style="color:#A6ACCD;">^(www\.)?(.+)S</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/sites/</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">2</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> server_name ~</span><span style="color:#A6ACCD;">^(www\.)?(?&lt;domain&gt;.+)S</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/sites/</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">domain</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>其他</p><ul><li>.yueluo.club 可以匹配 yueluo.club *.yueluo.club</li><li>_匹配所有 <ul><li>yueluo.club_</li></ul></li><li>“” 匹配没有传递 Host 头部</li></ul><h4 id="server-匹配顺序" tabindex="-1">Server 匹配顺序 <a class="header-anchor" href="#server-匹配顺序" aria-hidden="true">#</a></h4><ul><li><p>精确匹配</p></li><li><p><code>*</code> 在前的泛域名</p></li><li><p><code>*</code> 在后的泛域名</p></li><li><p>按文件中的顺序匹配正则表达式域名</p></li><li><p>default server</p><ul><li>第 1 个</li><li>listen 指定 default</li></ul></li></ul><h3 id="http-请求的-11-个阶段" tabindex="-1">HTTP 请求的 11 个阶段 <a class="header-anchor" href="#http-请求的-11-个阶段" aria-hidden="true">#</a></h3><img src="/notes/assets/nginx_request01.6da3f064.png" style="zoom:100%;"><img src="/notes/assets/nginx_request02.f62ff0ff.png" style="zoom:100%;"><h3 id="postread-阶段" tabindex="-1">postread 阶段 <a class="header-anchor" href="#postread-阶段" aria-hidden="true">#</a></h3><h4 id="获取真实客户端地址的-realip-模块" tabindex="-1">获取真实客户端地址的 realip 模块 <a class="header-anchor" href="#获取真实客户端地址的-realip-模块" aria-hidden="true">#</a></h4><ul><li>TCP 连接四元组（src ip，src port，dst ip，dst port）</li><li>HTTP 头部 X-Forwarded-For 用于传递 IP</li><li>HTTP 头部 X-Real-IP 用户传递用户 IP</li><li>网络中存在许多反向代理</li></ul><img src="/notes/assets/src_ip.9015500f.png" style="zoom:60%;"><p>我们可以根据 X-Forwarded-For 获取到真实 IP，获取到真实 IP 之后如何使用？</p><p>答案是基于变量。像 binary_remote_addr、remote_addr 这样的变量，其值就是真实的 IP，这样做连接限制（limit_conn 模块）才有意义。</p><h4 id="realip-模块" tabindex="-1">realip 模块 <a class="header-anchor" href="#realip-模块" aria-hidden="true">#</a></h4><p>realip 模块默认不会编译进 Nginx</p><ul><li>通过 --with-http_realip_module 启用功能</li></ul><p>功能</p><ul><li>修改客户端地址</li></ul><p>变量</p><ul><li>realip_remote_addr</li><li>realip_remote_port</li></ul><p>指令</p><ul><li>set_real_ip_from</li><li>real_ip_header</li><li>real_ip_Rrcursive</li></ul><img src="/notes/assets/direction_realip.ec5e7df7.png" style="zoom:80%;"><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">realip.yueluo.club</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> error_log </span><span style="color:#A6ACCD;">data/logs/realip/error.log dubug</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> set_real_ip_from </span><span style="color:#A6ACCD;">xxx.xx.xxx.xxx</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># real_ip_header X-Real_IP;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> real_ip_recursive </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 环回地址</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># real_ip_reucrsize on;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> real_ip_header </span><span style="color:#A6ACCD;">X-Forwared-For</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    	</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&quot;Client real ip: </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr\n</span><span style="color:#C3E88D;">&quot;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="rewrite-阶段" tabindex="-1">rewrite 阶段 <a class="header-anchor" href="#rewrite-阶段" aria-hidden="true">#</a></h3><h4 id="return-指令" tabindex="-1">return 指令 <a class="header-anchor" href="#return-指令" aria-hidden="true">#</a></h4><img src="/notes/assets/nginx_rewrite.43efd7e4.png" style="zoom:80%;"><img src="/notes/assets/nginx_error_page.82cb1797.png" style="zoom:80%;"><p>server 与 location 块下的 return 指令关系？</p><p>return 与 error_page 指令的关系？</p><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">return.yueluo.club</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">html/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> error_page </span><span style="color:#A6ACCD;">404 /403.html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">403</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">404</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&quot;find nothing!&quot;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>return 是 rewrite 提供的指令。</p><h4 id="rewrite-指令" tabindex="-1">rewrite 指令 <a class="header-anchor" href="#rewrite-指令" aria-hidden="true">#</a></h4><img src="/notes/assets/nginx_rewrite02.d4173aa5.png" style="zoom:80%;"><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">html/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/first </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> /first(.*)/second</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;"> last;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&quot;first!&quot;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/second </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> /second(.*)/third</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1 </span><span style="color:#F78C6C;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&quot;second!&quot;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/thrid </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&quot;third!&quot;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/redirect1 </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> /redirect(.*)</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1 </span><span style="color:#F78C6C;">permanent</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/redirect2 </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> /redirect2(.*)</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1 </span><span style="color:#F78C6C;">redirect</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/redirect3 </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> /redirect3(.*) http://rewrite.yueluo.club</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/redirect4 </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> /redirect4(.*) http://rewrite.yueluo.club</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1 </span><span style="color:#F78C6C;">permanent</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><img src="/notes/assets/nginx_error_log.a9dde9df.png" style="zoom:80%;"><blockquote><p>rewrite_on 指令默认是不打开的，如果打开会记录到 error.log 日志中。</p></blockquote><h4 id="条件判断-if" tabindex="-1">条件判断 if <a class="header-anchor" href="#条件判断-if" aria-hidden="true">#</a></h4><img src="/notes/assets/nginx_if.efc999f4.png" style="zoom:80%;"><p>if 指令的条件表达式</p><ul><li>检查变量为空或者值是否为 0，直接使用</li><li>将变量与字符串做匹配，使用 = 或者 !=</li><li>将变量与正则表达式做匹配 <ul><li>大小写敏感，~ 或者 !~</li><li>大小写不敏感，~* 或者 !~*，忽略大小写</li></ul></li><li>检查文件是否存在，使用 -f 或者 !-f</li><li>检查目录是否存在，使用 -d 或者 !-d</li><li>检查文件、目录、软链接是否存在，使用 -e 或者 !-e</li><li>检查是否为可执行文件，使用 -x 或者 !-x</li></ul><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_user_agent </span><span style="color:#89DDFF;">~ </span><span style="color:#A6ACCD;">MSIE) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">rewrite</span><span style="color:#F07178;"> </span><span style="color:#C3E88D;">^(.*)$</span><span style="color:#F07178;"> /mise/</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_cookie </span><span style="color:#89DDFF;">~* </span><span style="color:#C3E88D;">&quot;id=([^;]+)()?:;|$) {</span></span>
<span class="line"><span style="color:#C3E88D;">	set </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">id</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1</span><span style="color:#C3E88D;">;</span></span>
<span class="line"><span style="color:#C3E88D;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">if (</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request_method</span><span style="color:#C3E88D;"> = POST) {</span></span>
<span class="line"><span style="color:#C3E88D;">  return 405;</span></span>
<span class="line"><span style="color:#C3E88D;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">if (</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">slow</span><span style="color:#C3E88D;">) {</span></span>
<span class="line"><span style="color:#C3E88D;">  limit_rate 10k;</span></span>
<span class="line"><span style="color:#C3E88D;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">if (</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">invalid_referer</span><span style="color:#C3E88D;">) {</span></span>
<span class="line"><span style="color:#C3E88D;">  return 403;</span></span>
<span class="line"><span style="color:#C3E88D;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="find-config-阶段" tabindex="-1">find_config 阶段 <a class="header-anchor" href="#find-config-阶段" aria-hidden="true">#</a></h3><h4 id="location-指令" tabindex="-1">location 指令 <a class="header-anchor" href="#location-指令" aria-hidden="true">#</a></h4><img src="/notes/assets/nginx_location.a966cf87.png" style="zoom:80%;"><p>location 匹配规则：仅匹配 URI，忽略参数</p><ul><li>合并连续的 / 符号 <ul><li>merge_slashes on</li></ul></li><li>前缀字符串 <ul><li>常规</li><li>=: 精确匹配</li><li>^~：匹配上后则不再进行正则表达式匹配</li></ul></li><li>用于内部跳转的命名 location <ul><li>@</li></ul></li><li>正则表达式 <ul><li>~：大小写敏感的正则匹配</li><li>~*：忽略大小写的正则匹配</li></ul></li></ul><p>location 匹配顺序</p><img src="/notes/assets/nginx_location02.31c866d2.png" style="zoom:80%;"><h3 id="preaccess-阶段" tabindex="-1">preaccess 阶段 <a class="header-anchor" href="#preaccess-阶段" aria-hidden="true">#</a></h3><h4 id="limit-conn" tabindex="-1">limit_conn <a class="header-anchor" href="#limit-conn" aria-hidden="true">#</a></h4><p>限制每个客户端的并发连接数</p><img src="/notes/assets/nginx_limit_conn.a34302b2.png" style="zoom:80%;"><p>步骤：</p><ul><li>定义共享内存（包括大小），以及 key 关键字</li></ul><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#FFCB6B;">Syntax</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> limit_conn_zone key zone</span><span style="color:#89DDFF;">=</span><span style="color:#FFCB6B;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">size</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 共享内存大小</span></span>
<span class="line"><span style="color:#FFCB6B;">Default</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span></span>
<span class="line"><span style="color:#FFCB6B;">Context</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> http</span></span>
<span class="line"></span></code></pre></div><ul><li>限制并发连接数</li></ul><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#FFCB6B;">Syntax</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> limit_conn zone number</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">Default</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span></span>
<span class="line"><span style="color:#FFCB6B;">Context</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> http</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> server</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> location</span></span>
<span class="line"></span></code></pre></div><ul><li>限制发生时的日志级别</li></ul><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#FFCB6B;">Syntax</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> limit_conn_log_level info </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> notice </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> warn </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> error</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">Default</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> limit_conn_log_level error</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">Context</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> http</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> server</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> location</span></span>
<span class="line"></span></code></pre></div><ul><li>限制发生时向客户端返回的错误码</li></ul><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#FFCB6B;">Syntax</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> limit_conn_status code</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">Default</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> limit_conn_status </span><span style="color:#F78C6C;">503</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">Context</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> http</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> server</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> location</span></span>
<span class="line"></span></code></pre></div><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">limit_conn_zone $</span><span style="color:#A6ACCD;">binary_remote_addr zone=addr:10m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># limit_conn_zone $binary_remote_addr zone=one: 10m rate=3r/s;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">limit.yueluo.club</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">html/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> error_log </span><span style="color:#A6ACCD;">logs/myerror.log info</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> limit_conn_status </span><span style="color:#A6ACCD;">500</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> limit_conn_log_level </span><span style="color:#A6ACCD;">warn</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> limit_rate </span><span style="color:#A6ACCD;">50</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> limit_conn </span><span style="color:#A6ACCD;">addr </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># limit_req zone=one brust=1 nodelay;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># limit_req zone=one;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="limit-req" tabindex="-1">limit_req <a class="header-anchor" href="#limit-req" aria-hidden="true">#</a></h4><p>限制每个客户端的每秒处理请求数</p><img src="/notes/assets/nginx_limit_req.0ad884cc.png" style="zoom:80%;"><p>步骤：</p><ul><li>定义共享内存（包括大小），以及 key 关键字和限制速率</li></ul><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#FFCB6B;">Syntax</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> limit_req_zone key zone</span><span style="color:#89DDFF;">=</span><span style="color:#FFCB6B;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">size rate</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">rate</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">Default</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> _</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">Context</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> http</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// rate 单位为 r/s 或者 r/m</span></span>
<span class="line"></span></code></pre></div><ul><li>限制并发连接数</li></ul><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#FFCB6B;">Syntax</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> limit_req zone</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">name [brust</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">number][nodelay]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">Default</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> _</span></span>
<span class="line"><span style="color:#FFCB6B;">Context</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> http</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">location</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// brust 默认为 0</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// nodelay，对 burst 中的请求不再采用延时处理的做法，而是立即处理</span></span>
<span class="line"></span></code></pre></div><ul><li>限制发生时的日志级别</li></ul><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#FFCB6B;">Syntax</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> limit_req_log_level info </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> notice </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> warn </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> error</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">Default</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> limit_req_log_level error</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">Context</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> http</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> server</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> location</span></span>
<span class="line"></span></code></pre></div><ul><li>限制发生时向客户端返回的错误码</li></ul><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#FFCB6B;">Syntax</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> limit_red_status code</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">Default</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> limit_red_status </span><span style="color:#F78C6C;">503</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">Context</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> http</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> server</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> location</span></span>
<span class="line"></span></code></pre></div><p>limit_req 与 limit_conn 配置同时生效时，那个有效？</p><p>nodelay 添加与否，有什么不同？</p><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">limit_conn_zone $</span><span style="color:#A6ACCD;">binary_remote_addr zone=addr:10m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">limit_conn_zone $</span><span style="color:#A6ACCD;">binary_remote_addr zone=one: </span><span style="color:#F78C6C;">10m</span><span style="color:#A6ACCD;"> rate=2r/m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">limit.yueluo.club</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">html/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> error_log </span><span style="color:#A6ACCD;">logs/myerror.log info</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> limit_conn_status </span><span style="color:#A6ACCD;">500</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> limit_conn_log_level </span><span style="color:#A6ACCD;">warn</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># limit_rate 50;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># limit_conn addr 1;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> limit_req </span><span style="color:#A6ACCD;">zone=one brust=1 nodelay</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> limit_req </span><span style="color:#A6ACCD;">zone=one</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="access-阶段" tabindex="-1">access 阶段 <a class="header-anchor" href="#access-阶段" aria-hidden="true">#</a></h3><p>nginx_http_access_module 模块</p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">生效阶段：NGX_HTPP_ACCESS_PHASE</span></span>
<span class="line"><span style="color:#A6ACCD;">模块：http_access_module</span></span>
<span class="line"><span style="color:#A6ACCD;">默认编译进 nginx，通过 </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">without</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">http_access_module 禁用功能</span></span>
<span class="line"><span style="color:#A6ACCD;">生效范围：进入 access 阶段前不生效</span></span>
<span class="line"></span></code></pre></div><h4 id="deny-allow：限制-ip" tabindex="-1">deny/allow：限制 IP <a class="header-anchor" href="#deny-allow：限制-ip" aria-hidden="true">#</a></h4><img src="/notes/assets/access_allow.614272b3.png" style="zoom:80%;"><h4 id="auth-basic：用户名密码限制" tabindex="-1">auth_basic：用户名密码限制 <a class="header-anchor" href="#auth-basic：用户名密码限制" aria-hidden="true">#</a></h4><img src="/notes/assets/rfc2617.77822868.png" style="zoom:80%;"><img src="/notes/assets/access_auth_basic.08749bb6.png" style="zoom:80%;"><p>如何生成密码文件</p><ul><li>文件格式</li></ul><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;"># comment</span></span>
<span class="line"><span style="color:#FFCB6B;">name1</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">password1</span></span>
<span class="line"><span style="color:#FFCB6B;">name2</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">password2</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">comment</span></span>
<span class="line"><span style="color:#FFCB6B;">name3</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">password3</span></span>
<span class="line"></span></code></pre></div><ul><li>生成工具 htpasswd</li></ul><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">依赖安装包：httpd</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">tools</span></span>
<span class="line"><span style="color:#A6ACCD;">htpasswd </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">c file </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">b user pass</span></span>
<span class="line"></span></code></pre></div><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> default_type </span><span style="color:#A6ACCD;">text/plain</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> satisfy </span><span style="color:#A6ACCD;">any</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> auth_basic </span><span style="color:#C3E88D;">&quot;test auth_basic&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> auth_basic_user_file </span><span style="color:#A6ACCD;">examples/auth.pass</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> deny </span><span style="color:#A6ACCD;">all</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/auth_request </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> auth_request </span><span style="color:#A6ACCD;">/test_auth</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/test_auth </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://127.0.0.1:8090/auth_upstream</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass_request_body </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Content-Length </span><span style="color:#C3E88D;">&quot;&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Original-URI </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request_uri</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="auth-request：第三方权限控制" tabindex="-1">auth_request：第三方权限控制 <a class="header-anchor" href="#auth-request：第三方权限控制" aria-hidden="true">#</a></h4><p>统一的用户权限验证系统</p><img src="/notes/assets/access_request.6bb3e117.png" style="zoom:80%;"><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> auth_request </span><span style="color:#A6ACCD;">/test_auth</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/test_auth </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://127.0.0.1:8090/auth_upstream</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass_request_body </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Content-Length </span><span style="color:#C3E88D;">&quot;&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Original-URI </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request_uri</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="satisfy-指令" tabindex="-1">satisfy 指令 <a class="header-anchor" href="#satisfy-指令" aria-hidden="true">#</a></h4><p>satisfy 模块允许改变模块执行顺序。</p><img src="/notes/assets/access_satisfy.c00136cc.png" style="zoom:80%;"><p>如果有 return 指令，access 阶段会生效吗？</p><blockquote><p>不会生效，return 指令生效阶段在 rewrite 阶段，领先于 access。</p></blockquote><p>多个 access 模块的顺序有影响吗？</p><ul><li>查看 ngx_modules.c <ul><li>&amp;ngx_http_auth_request_module</li><li>&amp;ngx_http_auth_basic_module</li><li>&amp;ngx_http_access_module</li></ul></li></ul><blockquote><p>会。</p></blockquote><p>输对密码，下面可以访问到文件吗？</p><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> satisfy </span><span style="color:#A6ACCD;">any</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> auth_basic </span><span style="color:#C3E88D;">&quot;test auth_basic&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> auth_basic_user_file </span><span style="color:#A6ACCD;">examples/auth.pass</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> deny </span><span style="color:#A6ACCD;">all</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><blockquote><p>可以。</p></blockquote><p>如果把 deny all 提到 auth_basic 之前呢？</p><blockquote><p>可以。</p></blockquote><p>如果改为 allow all，有机会输入密码吗？</p><blockquote><p>没有机会。</p></blockquote><h3 id="precontent-阶段" tabindex="-1">precontent 阶段 <a class="header-anchor" href="#precontent-阶段" aria-hidden="true">#</a></h3><h4 id="try-files-指令" tabindex="-1">try_files 指令 <a class="header-anchor" href="#try-files-指令" aria-hidden="true">#</a></h4><p>默认编译进 nginx 中。</p><img src="/notes/assets/precontent_try_files.83528f0e.png" style="zoom:80%;"><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/first </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> try_files </span><span style="color:#A6ACCD;">/system/index.html </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">uri </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">uri/index.html </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">uri @lasturl</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">@lasturl </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;lasturl!</span><span style="color:#A6ACCD;">\n</span><span style="color:#C3E88D;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/second </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> try_files $</span><span style="color:#A6ACCD;">uri </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">uri/index.html </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">uri.html = </span><span style="color:#F78C6C;">404</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="mirror-模块：实时拷贝流量" tabindex="-1">mirror 模块：实时拷贝流量 <a class="header-anchor" href="#mirror-模块：实时拷贝流量" aria-hidden="true">#</a></h4><img src="/notes/assets/precontent_mirror.7e87a1bd.png" style="zoom:80%;"><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">10020</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;mirror response!&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">8081</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> error_log </span><span style="color:#A6ACCD;">data/error.log</span><span style="color:#89DDFF;"> debug;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> mirror </span><span style="color:#A6ACCD;">/mirror</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> mirror_request_body </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/mirror </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">internal;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 内部请求</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://127.0.0.1:10020</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request_uri</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass_request_body </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Content-Length </span><span style="color:#C3E88D;">&quot;&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Original-URI </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request_uri</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="content-阶段" tabindex="-1">content 阶段 <a class="header-anchor" href="#content-阶段" aria-hidden="true">#</a></h3><h4 id="static-模块" tabindex="-1">static 模块 <a class="header-anchor" href="#static-模块" aria-hidden="true">#</a></h4><h5 id="root-和-alias-指令" tabindex="-1">root 和 alias 指令 <a class="header-anchor" href="#root-和-alias-指令" aria-hidden="true">#</a></h5><p>都会用于把 URL 映射为文件，返回静态资源。</p><p>不过 root 会将完整 URL 映射进文件路径中，alias 只会将 location 后的 URL 路径映射到文件路径中。</p><img src="/notes/assets/content_root_alias.fad5c7e4.png" style="zoom:80%;"><p>root 使用范围更广，且具有默认值。</p><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/root </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/alias </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> alias </span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">~/root/(\w+\.txt) </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">html/first/</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/alias/(\w+\.txt) </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> alias </span><span style="color:#A6ACCD;">html/first/</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="三个-nginx-变量" tabindex="-1">三个 nginx 变量 <a class="header-anchor" href="#三个-nginx-变量" aria-hidden="true">#</a></h5><p>当我们访问一个 URI 文件时，会生成三个相关变量。</p><ul><li>request_filename：待访问文件的完整路径</li><li>document_root：由 URI 和 root/alias 规则生成的文件夹路径</li><li>realpath_root：将 document_root 中的软链接等换成真实路径</li></ul><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/RealPath/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> alias </span><span style="color:#A6ACCD;">html/realpath/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request_filename</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">document_root</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">document_root</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">realpath_root\n</span><span style="color:#C3E88D;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="静态文件返回的-content-type" tabindex="-1">静态文件返回的 content-type <a class="header-anchor" href="#静态文件返回的-content-type" aria-hidden="true">#</a></h5><img src="/notes/assets/content_content_type.ee7ab6ef.png" style="zoom:80%;"><h5 id="未找到文件的错误日志" tabindex="-1">未找到文件的错误日志 <a class="header-anchor" href="#未找到文件的错误日志" aria-hidden="true">#</a></h5><img src="/notes/assets/content_no_log.918d8b72.png" style="zoom:80%;"><p>可以关闭文件获取不到的错误日志。</p><h5 id="url-不以斜杠结尾访问目录" tabindex="-1">url 不以斜杠结尾访问目录 <a class="header-anchor" href="#url-不以斜杠结尾访问目录" aria-hidden="true">#</a></h5><p>访问目录时 URL 最后没有带 / ?</p><blockquote><p>static 模块实现了 root/alias 功能，发现访问目标时目录，但 URL 末尾加 / 时，会返回 301 重定向</p></blockquote><img src="/notes/assets/content_redirect.ed25b43e.png" style="zoom:80%;"><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">return.yueluo.club dir.yueluo.club</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name_in_redirect </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">8088</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> port_in_redirect </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> absolute_redirect </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">html/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="index、autoindex-模块" tabindex="-1">index、autoindex 模块 <a class="header-anchor" href="#index、autoindex-模块" aria-hidden="true">#</a></h4><p>访问 / 时的处理</p><img src="/notes/assets/content_index.d43c472c.png" style="zoom:80%;"><p>显示目录内容：content 阶段的 autoindex 模块</p><img src="/notes/assets/content_auto_index01.d6e6fab7.png" style="zoom:80%;"><p>autoindex 模块的指令</p><img src="/notes/assets/content_auto_index02.72f8172c.png" style="zoom:80%;"><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">autoindex.yueluo.club</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> alias </span><span style="color:#A6ACCD;">html/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> autoindex </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># index a.html</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> autoindex_exact_size </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> autoindex_format </span><span style="color:#A6ACCD;">json</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> autoindex_localtime </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="concat-模块：提升多个小文件性能" tabindex="-1">concat 模块：提升多个小文件性能 <a class="header-anchor" href="#concat-模块：提升多个小文件性能" aria-hidden="true">#</a></h4><img src="/notes/assets/content_concat.9299e684.png" style="zoom:80%;"><p>concat 模块的指令</p><img src="/notes/assets/content_concat02.7aa6ea86.png" style="zoom:80%;"><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">concat.yueluo.club</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> error_log </span><span style="color:#A6ACCD;">logs/error.log</span><span style="color:#89DDFF;"> debug;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">concat</span><span style="color:#A6ACCD;"> on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/concat </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">concat_max_files</span><span style="color:#A6ACCD;"> 20</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">concat_types</span><span style="color:#A6ACCD;"> text/plain</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">concat_unique</span><span style="color:#A6ACCD;"> on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">concat_delimiter</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;:::&#39;</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># ::: 来分割多个文件</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">concat_ignore_file_error</span><span style="color:#A6ACCD;"> on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="log-阶段" tabindex="-1">log 阶段 <a class="header-anchor" href="#log-阶段" aria-hidden="true">#</a></h3><h4 id="log-模块：记录请求访问日志" tabindex="-1">log 模块：记录请求访问日志 <a class="header-anchor" href="#log-模块：记录请求访问日志" aria-hidden="true">#</a></h4><p>功能：将 HTTP 请求相关信息记录到日志</p><p>模块：ngx_http_log_module 无法禁用</p><p>access 日志格式</p><img src="/notes/assets/log.d077fefc.png" style="zoom:80%;"><p>配置日志文件路径</p><img src="/notes/assets/log02.802991a0.png" style="zoom:80%;"><p>日志文件名包含变量时的优化</p><img src="/notes/assets/log03.121d52a5.png" style="zoom:80%;"><h3 id="http-过滤模块" tabindex="-1">HTTP 过滤模块 <a class="header-anchor" href="#http-过滤模块" aria-hidden="true">#</a></h3><p>介于 content 模块之后，log 模块之前介入请求处理。</p><img src="/notes/assets/filter.2929e933.png" style="zoom:80%;"><p>返回响应-加工响应内容</p><img src="/notes/assets/filter02.c7340a4e.png" style="zoom:80%;"><h4 id="sub-模块" tabindex="-1">sub 模块 <a class="header-anchor" href="#sub-模块" aria-hidden="true">#</a></h4><p>替换响应中的字符串：sub 模块。ngx_http_sub_filter_module。</p><img src="/notes/assets/filter_sub.336c7c81.png" style="zoom:80%;"><p>sub 模块的指令。</p><img src="/notes/assets/filter_sub02.4aeee997.png" style="zoom:80%;"><p>sub_fillter_last_modified：是否显示修改之前的 last_modified 内容，默认是关闭的。</p><p>sub_filter_once：只替换一次</p><p>sub_filter_types：针对什么类型进行替换，默认是 text/html。</p><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">sub.yueluo.club</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> error_log </span><span style="color:#A6ACCD;">logs/error.log info</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># sub_filter &#39;Nginx.oRg&#39; &#39;$host/nginx&#39;;  # 替换时忽略大小写</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># sub_filter &#39;nginx.cOm&#39; &#39;$host/nginx&#39;;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># sub_filter_once on;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># sub_filter_once off;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># sub_filter_last_modifed off;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># sub_filter_last_modifed on;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="addition-模块" tabindex="-1">addition 模块 <a class="header-anchor" href="#addition-模块" aria-hidden="true">#</a></h4><p>响应前或者响应后增加内容。</p><img src="/notes/assets/filter_addition.5e1b335b.png" style="zoom:80%;"><p>addition 模块的指令。</p><img src="/notes/assets/filter_addition02.37a8ee4e.png" style="zoom:80%;"><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">addition.yueluo.club</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> error_log </span><span style="color:#A6ACCD;">logs/error.log info</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> add_before_body </span><span style="color:#A6ACCD;">/before_action</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> add_after_body </span><span style="color:#A6ACCD;">/after_action</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> addition_types </span><span style="color:#A6ACCD;">*</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/brefore_action </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;new content before</span><span style="color:#A6ACCD;">\n</span><span style="color:#C3E88D;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/after_action </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;new content after</span><span style="color:#A6ACCD;">\n</span><span style="color:#C3E88D;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/testhost </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> uninitialized_variable_warn </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> set $</span><span style="color:#A6ACCD;">foo </span><span style="color:#C3E88D;">&#39;testhost&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">gzip_ratio\n</span><span style="color:#C3E88D;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="nginx-变量的运行原理" tabindex="-1">Nginx 变量的运行原理 <a class="header-anchor" href="#nginx-变量的运行原理" aria-hidden="true">#</a></h3><h4 id="惰性求值" tabindex="-1">惰性求值 <a class="header-anchor" href="#惰性求值" aria-hidden="true">#</a></h4><img src="/notes/assets/var01.835d6cc1.png" style="zoom:80%;"><h4 id="变量的特性" tabindex="-1">变量的特性 <a class="header-anchor" href="#变量的特性" aria-hidden="true">#</a></h4><ul><li>惰性求值</li><li>变量值可以时刻变化，其值为使用的那一刻的值</li></ul><h3 id="http-框架提供的请求相关的变量" tabindex="-1">HTTP 框架提供的请求相关的变量 <a class="header-anchor" href="#http-框架提供的请求相关的变量" aria-hidden="true">#</a></h3><ul><li>HTTP 请求相关的变量</li><li>TCP 连接相关的变量</li><li>Nginx 处理请求过程中产生的变量</li><li>发送 HTTP 响应时相关的变量</li><li>Nginx 系统变量</li></ul><h4 id="http-请求相关的变量" tabindex="-1">HTTP 请求相关的变量 <a class="header-anchor" href="#http-请求相关的变量" aria-hidden="true">#</a></h4><table><thead><tr><th>参数</th><th>参数含义</th></tr></thead><tbody><tr><td>arg_参数名</td><td>URL 中某个具体参数的值</td></tr><tr><td>query_string</td><td>与 args 变量完全相同</td></tr><tr><td>args</td><td>全部 URL 参数</td></tr><tr><td>is_args</td><td>如果请求 URL 中有参数则返回 ？否则返回空</td></tr><tr><td>content_length</td><td>HTTP 请求中标识包体长度的 Content-Length 头部的值</td></tr><tr><td>content_type</td><td>标识请求包体类型的 Content-Type 头部的值</td></tr><tr><td>uri</td><td>请求的 URI （不同于 URL，不包括 ？后的参数）</td></tr><tr><td>document_uri</td><td>与 uri 完全相同</td></tr><tr><td>request_uri</td><td>请求的 URL（包括 URI 以及完整的参数）</td></tr><tr><td>scheme</td><td>协议名，例如 HTTP 或者 HTTPS</td></tr><tr><td>request_method</td><td>请求方法，例如 GET 或者 POST</td></tr><tr><td>request_length</td><td>所有请求内容的大小，包括请求行、头部、包体等</td></tr><tr><td>remote_user</td><td>由 HTTP Basic Authentication 协议传入的用户名</td></tr><tr><td>request_body_file</td><td>临时存放请求包体的文件（如果包体非常小不会存文件、client_body_in_file_body 强制所有包体存入文件，且可以决定是否删除）</td></tr><tr><td>request_body</td><td>请求中的包体，这个变量当且仅当使用反向代理，且设定用内存暂存包体时才有效</td></tr><tr><td>request</td><td>原始的 url 请求，含有方法与协议版本，例如 GET /?a=1&amp;b=22 HTTP/1.1</td></tr><tr><td>host</td><td>先从请求行中获取，如果含有 Host 头部，则用其值替换掉请求行中的主机名，如果前两者都取不到，则使用匹配上的 server_name</td></tr><tr><td>http_头部名字</td><td>返回一个具体请求头部的值（特殊：http_host、http_user_agent、http_referer、http_via、http_x_forward_for、http_cookie）</td></tr></tbody></table><h4 id="tcp-连接相关的变量" tabindex="-1">TCP 连接相关的变量 <a class="header-anchor" href="#tcp-连接相关的变量" aria-hidden="true">#</a></h4><table><thead><tr><th>参数</th><th>参数含义</th></tr></thead><tbody><tr><td>binary_remote_addr</td><td>客户端地址的整型格式，对于 IPv4 是 4 字节，对于 IPv6 是 16 字节</td></tr><tr><td>connection</td><td>递增的连接序号</td></tr><tr><td>connection_requests</td><td>当前连接上执行过的请求数，对 keepalive 连接有意义</td></tr><tr><td>remote_addr</td><td>客户端地址</td></tr><tr><td>remote_port</td><td>客户端端口</td></tr><tr><td>proxy_protocol_addr</td><td>若使用 proxy_protocol 协议则返回协议中的地址，否则返回空</td></tr><tr><td>proxy_protocol_port</td><td>若使用 proxy_protocol 协议则返回协议中的端口，否则返回空</td></tr><tr><td>server_addr</td><td>服务端地址</td></tr><tr><td>server_port</td><td>服务端端口</td></tr><tr><td>TCP_INFO</td><td>tcp 内核层参数，包括 $tcpinfp_rtt，$tcpinfo_rttvar，$tcpinfo_snd_cwnd，$tcpinco_rcv_space</td></tr><tr><td>server_protocol</td><td>服务端协议，例如 HTTP/1.1</td></tr></tbody></table><h4 id="nginx-处理请求过程中产生的变量" tabindex="-1">Nginx 处理请求过程中产生的变量 <a class="header-anchor" href="#nginx-处理请求过程中产生的变量" aria-hidden="true">#</a></h4><table><thead><tr><th>参数</th><th>参数含义</th></tr></thead><tbody><tr><td>request_time</td><td>请求处理到现在的耗时，单位为秒，精确到毫秒</td></tr><tr><td>server_name</td><td>匹配上请求的 server_name 值</td></tr><tr><td>https</td><td>如果开启了 TLS/SSL ，则返回 on，否则返回空</td></tr><tr><td>request_competion</td><td>如请求处理完则返回 OK，否则返回空</td></tr><tr><td>request_id</td><td>以 16 进制输出的请求标识 id，该 id 共含有 16 个字节，是随机生成的</td></tr><tr><td>request_filename</td><td>待访问文件的完整路径</td></tr><tr><td>document_root</td><td>由 URI 和 root/alias 规则生成的文件夹路径</td></tr><tr><td>realpath_root</td><td>将 document_root 中的软链接等换成真实路径</td></tr><tr><td>limit_rate</td><td>返回客户端响应时的速度上限，单位为每秒字节数。可以通过 set 指令修改对请求产生效果</td></tr></tbody></table><h4 id="发送-http-响应时相关的变量" tabindex="-1">发送 HTTP 响应时相关的变量 <a class="header-anchor" href="#发送-http-响应时相关的变量" aria-hidden="true">#</a></h4><table><thead><tr><th>参数</th><th>参数含义</th></tr></thead><tbody><tr><td>body_bytes_sent</td><td>响应中 body 包体的长度</td></tr><tr><td>byte_sent</td><td>全部 http 响应的长度</td></tr><tr><td>status</td><td>http 响应中的返回码</td></tr><tr><td>sent_trailer_名字</td><td>把响应结尾内容里值返回</td></tr><tr><td>request_id</td><td>以 16 进制输出的请求标识 id，该 id 共含有 16 个字节，是随机生成的</td></tr><tr><td>sent_http_头部名字</td><td>响应中某个具体头部的值</td></tr></tbody></table><p>特殊处理：</p><ul><li>sent_http_content_type</li><li>sent_http_content_length</li><li>sent_http_location</li><li>sent_http_last_modified</li><li>sent_http_connection</li><li>sent_http_keep_alive</li><li>sent_http_transfer_encoding</li><li>sent_http_cache_control</li><li>sent_http_link</li></ul><h4 id="nginx-系统变量" tabindex="-1">Nginx 系统变量 <a class="header-anchor" href="#nginx-系统变量" aria-hidden="true">#</a></h4><table><thead><tr><th>参数</th><th>参数含义</th></tr></thead><tbody><tr><td>time_local</td><td>以本地时间标准输出的当前时间</td></tr><tr><td>time_iso8601</td><td>使用 ISO 8601 标准输出的当前事件</td></tr><tr><td>nginx_version</td><td>Nginx 版本号</td></tr><tr><td>pid</td><td>所属 worker 进程的进程 id</td></tr><tr><td>pipe</td><td>使用了管道则返回 p，否则返回 .</td></tr><tr><td>hostname</td><td>所在服务器的主机名，与 hostname 命令输出一致</td></tr><tr><td>msec</td><td>1970 年 1 月 1 日到现在的时间，单位为秒，小数点后精确到毫秒</td></tr></tbody></table><h3 id="referer-模块：变量防盗链" tabindex="-1">referer 模块：变量防盗链 <a class="header-anchor" href="#referer-模块：变量防盗链" aria-hidden="true">#</a></h3><h4 id="referer-模块" tabindex="-1">referer 模块 <a class="header-anchor" href="#referer-模块" aria-hidden="true">#</a></h4><p>场景：某网站通过 url 引用了你的页面，当用户在浏览器上点击 url 时，http 请求的头部中会通过 referer 头部，将该网站当前页面的 url 带上，告诉服务器本次请求是否这个页面发起的。</p><p>目的：拒绝非正常的网站访问我们站点的资源</p><p>思路：通过 referer，用 invalid_referer 变量根据配置判断 referer 头部是否合法</p><p>referer 模块：默认编译进 Nginx，通过 --without-http_referer_module 禁用</p><h4 id="referer-模块的指令" tabindex="-1">referer 模块的指令 <a class="header-anchor" href="#referer-模块的指令" aria-hidden="true">#</a></h4><img src="/notes/assets/referer_module.f79d4e8b.png" style=""><h4 id="valid-referers-指令" tabindex="-1">valid_referers 指令 <a class="header-anchor" href="#valid-referers-指令" aria-hidden="true">#</a></h4><p>可同时携带多个参数，表示多个 referer 头部都生效</p><img src="/notes/assets/referer_module02.c1162a7d.png" style=""><h3 id="secure-link：变量实现防盗链" tabindex="-1">secure_link：变量实现防盗链 <a class="header-anchor" href="#secure-link：变量实现防盗链" aria-hidden="true">#</a></h3><h4 id="secure-模块" tabindex="-1">secure 模块 <a class="header-anchor" href="#secure-模块" aria-hidden="true">#</a></h4><img src="/notes/assets/secure_link.1805bcd5.png" style=""><img src="/notes/assets/secure_link02.5e225e2f.png" style=""><h4 id="变量值及带过期时间的配置" tabindex="-1">变量值及带过期时间的配置 <a class="header-anchor" href="#变量值及带过期时间的配置" aria-hidden="true">#</a></h4><p>变量</p><ul><li>secure_link <ul><li>值为空字符串：验证不通过</li><li>值为 0：URL 过期</li><li>值为 1：验证通过</li></ul></li><li>secure_link_expires <ul><li>时间戳的值</li></ul></li></ul><img src="/notes/assets/secure_link03.09fa0982.png" style=""><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> secure_link $</span><span style="color:#A6ACCD;">arg_md5,</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">arg_expires</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> secure_link_md5 </span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">secure_link_expires</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">uri</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr</span><span style="color:#C3E88D;"> secret&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">secure_link </span><span style="color:#89DDFF;">= </span><span style="color:#C3E88D;">&#39;0&#39;</span><span style="color:#A6ACCD;">) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">410</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#F07178;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">secure_link</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">secure_link_expires\n</span><span style="color:#C3E88D;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="仅对-uri-进行哈希" tabindex="-1">仅对 URI 进行哈希 <a class="header-anchor" href="#仅对-uri-进行哈希" aria-hidden="true">#</a></h4><ul><li>将请求 URL 分为三部分，<code>/prefix/hash/link</code></li><li>Hash 生成方式 <ul><li>对 “link 密钥” 做 md5 哈希值</li></ul></li><li>用 secure_link_secret secret; 配置密钥</li></ul><img src="/notes/assets/secure_link04.db93aa71.png" style=""><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/p/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> secure_link_secret </span><span style="color:#A6ACCD;">mysecret2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">secure_link </span><span style="color:#89DDFF;">= </span><span style="color:#C3E88D;">&quot; &quot;</span><span style="color:#A6ACCD;">) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">403</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#F07178;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">^ /secure/$</span><span style="color:#A6ACCD;">secure_link</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/secure/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> alias </span><span style="color:#A6ACCD;">html/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">internal;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="map-模块：为复杂业务生成新变量" tabindex="-1">map 模块：为复杂业务生成新变量 <a class="header-anchor" href="#map-模块：为复杂业务生成新变量" aria-hidden="true">#</a></h3><p>可以根据一个或者多个变量组合而成的值做判断，修改新的变量的值，通过判断新变量的值实现复杂的业务逻辑。</p><img src="/notes/assets/map.1245c835.png" style=""><img src="/notes/assets/map03.6fbb6b48.png" style=""><img src="/notes/assets/map02.713c10fb.png" style=""><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">map</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_host </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">name {</span></span>
<span class="line"><span style="color:#A6ACCD;">  hostnames</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> default</span><span style="color:#A6ACCD;">       </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;">map</span><span style="color:#89DDFF;">\.tao\w+\.org.cn 1; *.taohui.org.cn   2; map.taohui.tech   3; map.taohui.*    </span><span style="color:#A6ACCD;">4</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">map</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_user_agent </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">mobile { </span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> default</span><span style="color:#A6ACCD;">       </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">&quot;~Opera Mini&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> default_type </span><span style="color:#A6ACCD;">text/plain</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">name</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">mobile\n</span><span style="color:#C3E88D;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="split-client-模块：指定少量用户实现-ab-测试" tabindex="-1">split_client 模块：指定少量用户实现 AB 测试 <a class="header-anchor" href="#split-client-模块：指定少量用户实现-ab-测试" aria-hidden="true">#</a></h3><img src="/notes/assets/split_clients.d980fdee.png" style="zoom:80%;"><img src="/notes/assets/split_clients02.f93bb0cf.png" style="zoom:80%;"><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">split_clients </span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">${</span><span style="color:#A6ACCD;">http_testcli</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">variant {</span></span>
<span class="line"><span style="color:#A6ACCD;">  0.51% .one</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  20.0% .two;</span></span>
<span class="line"><span style="color:#A6ACCD;">  50.5% .three;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># 40%   .four; 超过 100 不能访问</span></span>
<span class="line"><span style="color:#A6ACCD;">  *     &quot;&quot;;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">split_clients.yueluo.club</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> error_log </span><span style="color:#A6ACCD;">logs/error.log</span><span style="color:#89DDFF;"> debug;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> default_type </span><span style="color:#A6ACCD;">text/plain</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  	</span><span style="color:#89DDFF;">rteurn</span><span style="color:#A6ACCD;"> 200 </span><span style="color:#C3E88D;">&#39;ABtestfile</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">variant\n</span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">curl </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">H </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">testcli: 213213231adadasdad</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> split_clients</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">yueluo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">club</span></span>
<span class="line"></span></code></pre></div><h3 id="geo-模块：根据-ip-范围的匹配生成新变量" tabindex="-1">geo 模块：根据 IP 范围的匹配生成新变量 <a class="header-anchor" href="#geo-模块：根据-ip-范围的匹配生成新变量" aria-hidden="true">#</a></h3><img src="/notes/assets/geo.1e01c337.png" style="zoom:80%;"><img src="/notes/assets/geo02.3b6ef0a0.png" style="zoom:80%;"><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">geo $</span><span style="color:#A6ACCD;">country {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> default</span><span style="color:#A6ACCD;">        ZZ</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># include        conf/geo.conf;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">proxy</span><span style="color:#A6ACCD;">          116.62.160.193</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  127.0.0.0/</span><span style="color:#89DDFF;">24</span><span style="color:#A6ACCD;">   US</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  127.0.0.1/</span><span style="color:#89DDFF;">32</span><span style="color:#A6ACCD;">   RU</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  10.1.0.0/</span><span style="color:#89DDFF;">16</span><span style="color:#A6ACCD;">    RU</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  192.168.1.0/</span><span style="color:#89DDFF;">24</span><span style="color:#A6ACCD;"> UK</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">geo.yueluo.club</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">country\n</span><span style="color:#C3E88D;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="geoip-模块：获取用户地理位置" tabindex="-1">geoip 模块：获取用户地理位置 <a class="header-anchor" href="#geoip-模块：获取用户地理位置" aria-hidden="true">#</a></h3><h5 id="基于-maxmind-数据库从客户端获取变量" tabindex="-1">基于 MaxMind 数据库从客户端获取变量 <a class="header-anchor" href="#基于-maxmind-数据库从客户端获取变量" aria-hidden="true">#</a></h5><img src="/notes/assets/geoip.4948d343.png" style="zoom:80%;"><h4 id="geoip-country-指令提供的变量" tabindex="-1">geoip_country 指令提供的变量 <a class="header-anchor" href="#geoip-country-指令提供的变量" aria-hidden="true">#</a></h4><img src="/notes/assets/geoip02.197e76f5.png" style="zoom:80%;"><h4 id="geoip-city-指令提供的变量" tabindex="-1">geoip_city 指令提供的变量 <a class="header-anchor" href="#geoip-city-指令提供的变量" aria-hidden="true">#</a></h4><img src="/notes/assets/geoip03.434e0cfb.png" style="zoom:80%;"><img src="/notes/assets/geoip04.87c99856.png" style="zoom:80%;"><p>maxmind 网站，下载 c 语言代码库和地址库，对它进行编译。</p><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">geoip_country </span><span style="color:#A6ACCD;">/usr/local/share/GeoIP/GeoIP.dat</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">geoip_city </span><span style="color:#A6ACCD;">/usr/local/share/GeoIP/GeoLiteCity.dat</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">geoip_proxy </span><span style="color:#A6ACCD;">116.62.160.193/32</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">geoip_proxy_recursize</span><span style="color:#A6ACCD;"> on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;country:</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">geoip_country_code</span><span style="color:#C3E88D;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">curl </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">H </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">X-Forwarded-For: ip</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> geoip</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">yueluo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">club</span></span>
<span class="line"></span></code></pre></div><h3 id="对客户端使用-keeplive-提升连接效率" tabindex="-1">对客户端使用 keeplive 提升连接效率 <a class="header-anchor" href="#对客户端使用-keeplive-提升连接效率" aria-hidden="true">#</a></h3><p>http 协议的 keepalive，不是指 tcp 协议的 keepalive。</p><img src="/notes/assets/keepalive.cccff3f6.png" style="zoom:80%;"><img src="/notes/assets/keepalive02.b86fbd46.png" style="zoom:80%;"><h2 id="四、反向代理与负载均衡" tabindex="-1">四、反向代理与负载均衡 <a class="header-anchor" href="#四、反向代理与负载均衡" aria-hidden="true">#</a></h2><h3 id="反向代理与负载均衡原理" tabindex="-1">反向代理与负载均衡原理 <a class="header-anchor" href="#反向代理与负载均衡原理" aria-hidden="true">#</a></h3><h4 id="负载均衡" tabindex="-1">负载均衡 <a class="header-anchor" href="#负载均衡" aria-hidden="true">#</a></h4><img src="/notes/assets/banlance.1aad4231.png" style="zoom:80%;"><h4 id="nginx-在-akf-扩展立方体上的应用" tabindex="-1">nginx 在 AKF 扩展立方体上的应用 <a class="header-anchor" href="#nginx-在-akf-扩展立方体上的应用" aria-hidden="true">#</a></h4><img src="/notes/assets/nginx.42f92a3c.png" style="zoom:80%;"><h4 id="支持多种协议的反向代理" tabindex="-1">支持多种协议的反向代理 <a class="header-anchor" href="#支持多种协议的反向代理" aria-hidden="true">#</a></h4><img src="/notes/assets/nginx02.499eef1a.png" style="zoom:80%;"><h4 id="反向代理与缓存" tabindex="-1">反向代理与缓存 <a class="header-anchor" href="#反向代理与缓存" aria-hidden="true">#</a></h4><img src="/notes/assets/nginx03.1e319263.png" style="zoom:80%;"><h3 id="负载均衡算法：round-robin-算法" tabindex="-1">负载均衡算法：round-robin 算法 <a class="header-anchor" href="#负载均衡算法：round-robin-算法" aria-hidden="true">#</a></h3><p>round-robin 算法 所有负载均衡算法的基础。其他负载均衡算法失效时，降级都是 round-robin 算法。</p><h4 id="指定上游服务器的-upstream-与-server-指令" tabindex="-1">指定上游服务器的 upstream 与 server 指令 <a class="header-anchor" href="#指定上游服务器的-upstream-与-server-指令" aria-hidden="true">#</a></h4><img src="/notes/assets/upstream.b8191cbb.png" style="zoom:80%;"><img src="/notes/assets/upstream02.118409fc.png" style="zoom:80%;"><h4 id="加权-round-robin-负载均衡算法" tabindex="-1">加权 Round-Robin 负载均衡算法 <a class="header-anchor" href="#加权-round-robin-负载均衡算法" aria-hidden="true">#</a></h4><p>Rounb-Robin：依次执行，轮询的方式</p><img src="/notes/assets/upstream03.b3aec391.png" style="zoom:80%;"><h4 id="对上游服务使用-keep-alive-长连接" tabindex="-1">对上游服务使用 keep-alive 长连接 <a class="header-anchor" href="#对上游服务使用-keep-alive-长连接" aria-hidden="true">#</a></h4><img src="/notes/assets/keepalive03.7dccb8a6.png" style="zoom:80%;"><h4 id="upstream-keepalive-指令" tabindex="-1">upstream_keepalive 指令 <a class="header-anchor" href="#upstream-keepalive-指令" aria-hidden="true">#</a></h4><img src="/notes/assets/keepalive04.6dd448da.png" style="zoom:80%;"><h4 id="指定上游服务器域名解析的-resolver-指令" tabindex="-1">指定上游服务器域名解析的 resolver 指令 <a class="header-anchor" href="#指定上游服务器域名解析的-resolver-指令" aria-hidden="true">#</a></h4><img src="/notes/assets/keepalive05.02fbf882.png" style="zoom:80%;"><p>upserver.config</p><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">8011</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> default_type </span><span style="color:#A6ACCD;">text/plain</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;8011 server response. </span><span style="color:#A6ACCD;">\n</span><span style="color:#C3E88D;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">8012</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> default_type </span><span style="color:#A6ACCD;">text/plain</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># client_body_in_single_buffer on;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;8012 server response. </span><span style="color:#A6ACCD;">\n</span><span style="color:#C3E88D;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>rrups.config</p><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">rrups </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 127.0.0.1:8011 weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> max_conns=2 max_fails</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> fail_timeout=5;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 127.0.0.1:8012;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> keepalive </span><span style="color:#A6ACCD;">32</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">rrups.yueluo.club</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> error_log </span><span style="color:#A6ACCD;">/logs/error.log</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">https://rrups</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_http_version </span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Connection </span><span style="color:#C3E88D;">&quot;&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="负载均衡算法哈希算法：ip-hash-与-hash-模块" tabindex="-1">负载均衡算法哈希算法：ip_hash 与 hash 模块 <a class="header-anchor" href="#负载均衡算法哈希算法：ip-hash-与-hash-模块" aria-hidden="true">#</a></h3><h4 id="upstream-ip-hash-模块" tabindex="-1">upstream_ip_hash 模块 <a class="header-anchor" href="#upstream-ip-hash-模块" aria-hidden="true">#</a></h4><p>基于客户端 IP 地址的 Hash 算法实现负载均衡。</p><img src="/notes/assets/upstream_ip_hash.0fc50fba.png" style="zoom:80%;"><h4 id="upstaream-hash-模块" tabindex="-1">upstaream_hash 模块 <a class="header-anchor" href="#upstaream-hash-模块" aria-hidden="true">#</a></h4><img src="/notes/assets/upstream_hash.4074d268.png" style="zoom:80%;"><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">iphashups </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">ip_hash;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># hash user_$arg_username;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 127.0.0.1:8011 weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> max_conns=2 max_fails</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> fail_timeout=5;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 127.0.0.1:8012 weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">server {</span></span>
<span class="line"><span style="color:#A6ACCD;">  set_real_ip_from </span><span style="color:#F78C6C;">116.62.160.193</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">real_ip_recursize</span><span style="color:#A6ACCD;"> on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> real_ip_header </span><span style="color:#A6ACCD;">X-Forwared-For</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">iphash.yueluo.club</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#89DDFF;">	error_log </span><span style="color:#A6ACCD;">logs/error.log</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> access_log </span><span style="color:#A6ACCD;">logs/access.log</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://iphashups</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_http_version </span><span style="color:#A6ACCD;">1.1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Connection </span><span style="color:#C3E88D;">&quot;&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="一致性-hash-算法：hash-模块" tabindex="-1">一致性 Hash 算法：Hash 模块 <a class="header-anchor" href="#一致性-hash-算法：hash-模块" aria-hidden="true">#</a></h3><h4 id="hash-算法的问题" tabindex="-1">Hash 算法的问题 <a class="header-anchor" href="#hash-算法的问题" aria-hidden="true">#</a></h4><img src="/notes/assets/upstream_hash_error.5fbc9ca6.png" style="zoom:80%;"><h4 id="宕机或者扩容时，hash-算法引发大量路由变更，导致缓存大范围失效" tabindex="-1">宕机或者扩容时，hash 算法引发大量路由变更，导致缓存大范围失效 <a class="header-anchor" href="#宕机或者扩容时，hash-算法引发大量路由变更，导致缓存大范围失效" aria-hidden="true">#</a></h4><img src="/notes/assets/upstream_hash_error02.a1a3071c.png" style="zoom:80%;"><h4 id="一致性-hash-算法" tabindex="-1">一致性 Hash 算法 <a class="header-anchor" href="#一致性-hash-算法" aria-hidden="true">#</a></h4><p><strong>扩容前：</strong></p><img src="/notes/assets/upstream_hash_before.0d204815.png" style="zoom:80%;"><p><strong>扩容后：</strong></p><img src="/notes/assets/upstream_hash_after.4ba688ff.png" style="zoom:80%;"><h4 id="使用一致性-hash-算法：upstream-hash-模块" tabindex="-1">使用一致性 Hash 算法：upstream_hash 模块 <a class="header-anchor" href="#使用一致性-hash-算法：upstream-hash-模块" aria-hidden="true">#</a></h4><p>原有基础上增加配置 <code>[consistent]</code></p><img src="/notes/assets/upstream_hash02.92763790.png" style="zoom:80%;"><h3 id="最少连接算法以及如何跨-worker-进程生效" tabindex="-1">最少连接算法以及如何跨 worker 进程生效 <a class="header-anchor" href="#最少连接算法以及如何跨-worker-进程生效" aria-hidden="true">#</a></h3><h4 id="upstream-least-conn-模块" tabindex="-1">upstream_least_conn 模块 <a class="header-anchor" href="#upstream-least-conn-模块" aria-hidden="true">#</a></h4><p>优先选择连接最少的上游服务器。</p><img src="/notes/assets/upstream_least_conn.8264115f.png" style="zoom:80%;"><h4 id="upstream-zone-模块" tabindex="-1">upstream_zone 模块 <a class="header-anchor" href="#upstream-zone-模块" aria-hidden="true">#</a></h4><p>使用共享内存使负载均衡对所有 worker 进程生效。</p><img src="/notes/assets/upstream_zone.d52902eb.png" style="zoom:80%;"><h4 id="upstream-模块间的顺序：功能正常运行" tabindex="-1">upstream 模块间的顺序：功能正常运行 <a class="header-anchor" href="#upstream-模块间的顺序：功能正常运行" aria-hidden="true">#</a></h4><img src="/notes/assets/upstream_order.0fc652b7.png" style="zoom:80%;"><h3 id="upstream-模块提供的变量（不含-cache）" tabindex="-1">upstream 模块提供的变量（不含 cache） <a class="header-anchor" href="#upstream-模块提供的变量（不含-cache）" aria-hidden="true">#</a></h3><table><thead><tr><th>变量</th><th>含义</th></tr></thead><tbody><tr><td>upstream_addr</td><td>上游服务器的 IP 地址，格式为可读的字符串，例如 127.0.0.1: 8012</td></tr><tr><td>upstream_connect_time</td><td>与上游服务器建立连接消耗的时间，单位为秒，精确到毫秒</td></tr><tr><td>upstream_header_time</td><td>接收上游服务发回响应中 http 头部所消耗的时间，单位为秒，精确到毫秒</td></tr><tr><td>upstream_response_time</td><td>接收完整的上游服务响应所消耗的时间，单位为秒，精确到毫秒</td></tr><tr><td>upstream_http_名称</td><td>从上游服务返回的响应头部的值</td></tr><tr><td>upstream_bytes_received</td><td>从上游服务接收到的响应长度，单位为字节</td></tr><tr><td>upstream_response_length</td><td>从上游服务返回的响应包体长度，单位为字节</td></tr><tr><td>upstream_status</td><td>上游服务返回的 HTTP 响应中的状态码。如果未连接上，该变量值为 502</td></tr><tr><td>upstream_cookie_名称</td><td>从上游服务器发回的响应头 Set-Cookie 中取出的 cookie 值</td></tr><tr><td>upstream_trailer_名称</td><td>从上游服务的响应尾部取到的值</td></tr></tbody></table><h3 id="proxy-模块处理请求的流程" tabindex="-1">proxy 模块处理请求的流程 <a class="header-anchor" href="#proxy-模块处理请求的流程" aria-hidden="true">#</a></h3><img src="/notes/assets/proxy_pass.39c6aef5.png" style="zoom:80%;"><h3 id="proxy-模块中的-proxy-pass-指令" tabindex="-1">proxy 模块中的 proxy_pass 指令 <a class="header-anchor" href="#proxy-模块中的-proxy-pass-指令" aria-hidden="true">#</a></h3><h4 id="http-协议的反向代理：proxy-模块" tabindex="-1">HTTP 协议的反向代理：proxy 模块 <a class="header-anchor" href="#http-协议的反向代理：proxy-模块" aria-hidden="true">#</a></h4><img src="/notes/assets/proxy_pass02.f76f878b.png" style="zoom:80%;"><img src="/notes/assets/proxy_pass03.686d00f3.png" style="zoom:80%;"><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">8011</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> default_type </span><span style="color:#A6ACCD;">text/plain</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;8011 server response. </span><span style="color:#A6ACCD;">\n</span><span style="color:#C3E88D;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">8012</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> default_type </span><span style="color:#A6ACCD;">text/plain</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;8012 server response. uri：</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">uri</span><span style="color:#C3E88D;"> </span><span style="color:#A6ACCD;">\n</span><span style="color:#C3E88D;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">proxyups </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 127.0.0.1:8012 weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">server {</span></span>
<span class="line"><span style="color:#A6ACCD;">  server_name proxy.yueluo.club;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> error_log </span><span style="color:#A6ACCD;">logs/error.log</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> access_log </span><span style="color:#A6ACCD;">logs/upstream_access.log varups</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/a </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://proxyups/addurl</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">proxy_pass </span><span style="color:#FFCB6B;">http</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//proxyups/addurl;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">curl proxy</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">yueluo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">club</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">c </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> uri：</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">c</span></span>
<span class="line"></span></code></pre></div><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">proxy_pass </span><span style="color:#FFCB6B;">http</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//proxyups/addurl/www;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">curl proxy</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">yueluo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">club</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">c </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> uri：</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">www</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">c</span></span>
<span class="line"></span></code></pre></div><p>proxy_pass 是动作类指令，指定某个阶段使用 proxy 模块处理请求，proxy_pass 是否加 url 可能产生不同的结果。</p><h3 id="根据指令修改发往上游的请求" tabindex="-1">根据指令修改发往上游的请求 <a class="header-anchor" href="#根据指令修改发往上游的请求" aria-hidden="true">#</a></h3><h4 id="proxy-模块：生成发往上游的请求行" tabindex="-1">proxy 模块：生成发往上游的请求行 <a class="header-anchor" href="#proxy-模块：生成发往上游的请求行" aria-hidden="true">#</a></h4><img src="/notes/assets/proxy_pass04.dcfe3cd6.png" style="zoom:80%;"><h4 id="proxy-模块：生成发往上游的请求头部" tabindex="-1">proxy 模块：生成发往上游的请求头部 <a class="header-anchor" href="#proxy-模块：生成发往上游的请求头部" aria-hidden="true">#</a></h4><img src="/notes/assets/proxy_pass05.2d3a8d87.png" style="zoom:80%;"><h4 id="proxy-模块：生成发往上游的包体" tabindex="-1">proxy 模块：生成发往上游的包体 <a class="header-anchor" href="#proxy-模块：生成发往上游的包体" aria-hidden="true">#</a></h4><img src="/notes/assets/proxy_pass06.7ef6eb9e.png" style="zoom:80%;"><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">8011</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> default_type </span><span style="color:#A6ACCD;">text/plain</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;8011 server response. </span><span style="color:#A6ACCD;">\n</span><span style="color:#C3E88D;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">8012</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> default_type </span><span style="color:#A6ACCD;">text/plain</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;8012 server response. </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">uri</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request_method</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_name</span><span style="color:#C3E88D;"> </span><span style="color:#A6ACCD;">\n</span><span style="color:#C3E88D;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">proxyups </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 127.0.0.1:8012 weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">server {</span></span>
<span class="line"><span style="color:#A6ACCD;">  server_name proxy.yueluo.club;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> error_log </span><span style="color:#A6ACCD;">logs/error.log</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> access_log </span><span style="color:#A6ACCD;">logs/upstream_access.log varups</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/a </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://proxyups/addurl</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_method </span><span style="color:#A6ACCD;">POST</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass_request_headers </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass_request_body </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_set_body </span><span style="color:#C3E88D;">&#39;hello-wrold&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">name </span><span style="color:#C3E88D;">&#39;&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_http_version </span><span style="color:#A6ACCD;">1.1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Connection </span><span style="color:#C3E88D;">&quot;&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="接收用户请求包体的方式" tabindex="-1">接收用户请求包体的方式 <a class="header-anchor" href="#接收用户请求包体的方式" aria-hidden="true">#</a></h3><h4 id="接收客户端请求的包体：收完再转发还是边收变转发" tabindex="-1">接收客户端请求的包体：收完再转发还是边收变转发 <a class="header-anchor" href="#接收客户端请求的包体：收完再转发还是边收变转发" aria-hidden="true">#</a></h4><img src="/notes/assets/receive.81919c01.png" style="zoom:80%;"><h4 id="客户端包体的接收" tabindex="-1">客户端包体的接收 <a class="header-anchor" href="#客户端包体的接收" aria-hidden="true">#</a></h4><img src="/notes/assets/receive02.7d73aa7e.png" style="zoom:80%;"><h4 id="最大包体长度限制" tabindex="-1">最大包体长度限制 <a class="header-anchor" href="#最大包体长度限制" aria-hidden="true">#</a></h4><img src="/notes/assets/receive03.850fdf31.png" style="zoom:80%;"><h4 id="临时文件路径格式" tabindex="-1">临时文件路径格式 <a class="header-anchor" href="#临时文件路径格式" aria-hidden="true">#</a></h4><img src="/notes/assets/receive04.653d8948.png" style="zoom:80%;"><h4 id="读取包体的超时" tabindex="-1">读取包体的超时 <a class="header-anchor" href="#读取包体的超时" aria-hidden="true">#</a></h4><img src="/notes/assets/receive05.e97755d0.png" style="zoom:80%;"><h3 id="与上游服务器建立连接" tabindex="-1">与上游服务器建立连接 <a class="header-anchor" href="#与上游服务器建立连接" aria-hidden="true">#</a></h3><h4 id="与上游服务器建立连接-1" tabindex="-1">与上游服务器建立连接 <a class="header-anchor" href="#与上游服务器建立连接-1" aria-hidden="true">#</a></h4><img src="/notes/assets/up_server.9dcc230f.png" style="zoom:80%;"><p>当出现状态码 502 时，可以换一个服务器继续处理，通过 proxy_next_upstream。</p><h4 id="上游连接启动-tcp-keepalive" tabindex="-1">上游连接启动 TCP keepalive <a class="header-anchor" href="#上游连接启动-tcp-keepalive" aria-hidden="true">#</a></h4><img src="/notes/assets/up_server02.926ee154.png" style="zoom:80%;"><h4 id="上游连接启用-http-keepalive" tabindex="-1">上游连接启用 HTTP keepalive <a class="header-anchor" href="#上游连接启用-http-keepalive" aria-hidden="true">#</a></h4><img src="/notes/assets/up_server03.174d5f4e.png" style="zoom:80%;"><h4 id="修改-tcp-连接中的-local-address" tabindex="-1">修改 TCP 连接中的 local address <a class="header-anchor" href="#修改-tcp-连接中的-local-address" aria-hidden="true">#</a></h4><img src="/notes/assets/up_server04.7cb2d7a2.png" style="zoom:80%;"><h4 id="当客户端关闭连接时" tabindex="-1">当客户端关闭连接时 <a class="header-anchor" href="#当客户端关闭连接时" aria-hidden="true">#</a></h4><img src="/notes/assets/up_server05.954c900c.png" style="zoom:80%;"><h3 id="接收上游的响应" tabindex="-1">接收上游的响应 <a class="header-anchor" href="#接收上游的响应" aria-hidden="true">#</a></h3><h4 id="接收上游的-http-响应头部" tabindex="-1">接收上游的 HTTP 响应头部 <a class="header-anchor" href="#接收上游的-http-响应头部" aria-hidden="true">#</a></h4><p>限定了上游 server 最大值。</p><img src="/notes/assets/http_receive.811a9ea6.png" style="zoom:80%;"><h4 id="接收上游的-http-包体" tabindex="-1">接收上游的 HTTP 包体 <a class="header-anchor" href="#接收上游的-http-包体" aria-hidden="true">#</a></h4><img src="/notes/assets/http_receive02.94d0b60f.png" style="zoom:80%;"><img src="/notes/assets/http_receive03.66d1df00.png" style="zoom:80%;"><h4 id="及时转发包体" tabindex="-1">及时转发包体 <a class="header-anchor" href="#及时转发包体" aria-hidden="true">#</a></h4><img src="/notes/assets/http_receive04.4f50bea6.png" style="zoom:80%;"><h4 id="接收上游时网络速度相关指令" tabindex="-1">接收上游时网络速度相关指令 <a class="header-anchor" href="#接收上游时网络速度相关指令" aria-hidden="true">#</a></h4><img src="/notes/assets/http_receive05.fe8ab601.png" style="zoom:80%;"><h4 id="上游包体的持久化" tabindex="-1">上游包体的持久化 <a class="header-anchor" href="#上游包体的持久化" aria-hidden="true">#</a></h4><img src="/notes/assets/http_receive06.1c39c4ed.png" style="zoom:80%;"><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">8012</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> default_type </span><span style="color:#A6ACCD;">text/plain</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/test </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;8012 server resonse.&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-nginx"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">proxyups </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 127.0.0.1:8012 weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">server {</span></span>
<span class="line"><span style="color:#A6ACCD;">  listen </span><span style="color:#F78C6C;">80</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">store.yueluo.club</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> error_log </span><span style="color:#A6ACCD;">logs/error.log</span><span style="color:#89DDFF;"> debug;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/tmp</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://proxyups</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_store </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_store_access </span><span style="color:#A6ACCD;">user:rw group:rw all:r</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">cur store</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">yueluo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">club tech</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">txt</span></span>
<span class="line"></span></code></pre></div><h3 id="处理上游的响应头部" tabindex="-1">处理上游的响应头部 <a class="header-anchor" href="#处理上游的响应头部" aria-hidden="true">#</a></h3><h2 id="五、nginx-系统层性能优化" tabindex="-1">五、Nginx 系统层性能优化 <a class="header-anchor" href="#五、nginx-系统层性能优化" aria-hidden="true">#</a></h2><h2 id="六、深入使用-nginx-与-openresty" tabindex="-1">六、深入使用 Nginx 与 OpenResty <a class="header-anchor" href="#六、深入使用-nginx-与-openresty" aria-hidden="true">#</a></h2></div></div></main><footer class="VPDocFooter" data-v-79ca2460 data-v-04568844><div class="edit-info" data-v-04568844><!----><!----></div><div class="prev-next" data-v-04568844><div class="pager" data-v-04568844><a class="pager-link prev" href="/notes/network/plus/index.html" data-v-04568844><span class="desc" data-v-04568844>Previous page</span><span class="title" data-v-04568844>plus</span></a></div><div class="has-prev pager" data-v-04568844><a class="pager-link next" href="/notes/node/base/index.html" data-v-04568844><span class="desc" data-v-04568844>Next page</span><span class="title" data-v-04568844>base</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><footer class="VPFooter has-sidebar" data-v-6b5fd0a9 data-v-5b331722><div class="container" data-v-5b331722><p class="message" data-v-5b331722></p><p class="copyright" data-v-5b331722>Copyright © 2022-月落 版权所有</p></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"alg_algorithm_index.md\":\"0a3f45b5\",\"alg_algorithm_google_index.md\":\"48ce9180\",\"alg_javascript_index.md\":\"aa45ea64\",\"alg_leetcode75_index.md\":\"0ac6039a\",\"alg_training_index.md\":\"38de3119\",\"bom_index.md\":\"05ef20c5\",\"books_mdn_array_index.md\":\"604a0d68\",\"books_lodash_index.md\":\"90e18dad\",\"books_图解http_index.md\":\"b4c71e23\",\"books_浏览器工作原理与实践_index.md\":\"c16258be\",\"css3_index.md\":\"2ebfe78a\",\"doc_index.md\":\"f64ef4d9\",\"dom_index.md\":\"28be6814\",\"ecma_script_built_in_objects_index.md\":\"d2f65ff0\",\"ecma_script_base_index.md\":\"9af8818b\",\"ecma_script_closure_index.md\":\"38fa77a5\",\"ecma_script_es6_index.md\":\"db9e743a\",\"ecma_script_front_end_optimize_index.md\":\"ba951c66\",\"ecma_script_functional_index.md\":\"6740acd9\",\"ecma_script_loss_of_precision_index.md\":\"f9a036a3\",\"ecma_script_optimize_index.md\":\"04b33b6f\",\"ecma_script_promise_index.md\":\"e4fbfc24\",\"electron_base_index.md\":\"305c858b\",\"electron_combat_index.md\":\"c9550787\",\"engineering_index.md\":\"bdc41edf\",\"eslint_index.md\":\"4614bc47\",\"fragment_case_index.md\":\"827942fd\",\"fragment_index.md\":\"aff3938f\",\"git_index.md\":\"d83dc5c1\",\"go_index.md\":\"4c360798\",\"hand_writing_index.md\":\"03d7f15c\",\"hand_writing_vue_source_index.md\":\"df341740\",\"html5_base_index.md\":\"2e44175c\",\"html5_canvas_index.md\":\"33ee2b04\",\"index.md\":\"211e6e70\",\"jenkins_jenkins2.x_index.md\":\"d205e2eb\",\"jenkins_practice_index.md\":\"f45631f2\",\"jest_index.md\":\"c446f09e\",\"micro_frontends_base_index.md\":\"dab91980\",\"micro_frontends_module_federation_index.md\":\"11337c30\",\"micro_frontends_module_federation_example_index.md\":\"0cf23a84\",\"micro_frontends_source_index.md\":\"b6fe30e1\",\"network_base_index.md\":\"417c6415\",\"network_plus_index.md\":\"49e7d472\",\"nginx_index.md\":\"0915afde\",\"node_base_index.md\":\"67a4bd34\",\"node_koa_index.md\":\"b23c6fbb\",\"node_plus_index.md\":\"a3092288\",\"node_tars_index.md\":\"e5e8b9e8\",\"npm_base_index.md\":\"5f385074\",\"npm_repos_index.md\":\"b6c5535b\",\"react_fiber_index.md\":\"74dd78c1\",\"react_chakra_ui_index.md\":\"1cead14e\",\"react_css_in_js_index.md\":\"773e64d6\",\"react_form_optimize_index.md\":\"9d34b01d\",\"react_formik_index.md\":\"198256cb\",\"react_mobx_index.md\":\"857b41b3\",\"react_optimize_index.md\":\"3526aad1\",\"react_react_base_index.md\":\"60b2e87c\",\"react_react_hooks_index.md\":\"d81080f2\",\"react_react_hooks_plus_index.md\":\"2f1aa583\",\"react_react_source_index.md\":\"b4a0993e\",\"react_redux_index.md\":\"c4410c96\",\"react_virtual_dom_index.md\":\"df52d263\",\"superset_index.md\":\"29e9a327\",\"test_index.md\":\"af0d971b\",\"typescript_base_index.md\":\"302625c0\",\"typescript_challenges_index.md\":\"072b11a1\",\"typescript_declaration_index.md\":\"6b36108b\",\"typescript_examples_index.md\":\"871527dd\",\"typescript_plus_index.md\":\"c934c336\",\"visualization_three.js_index.md\":\"78185fe6\",\"vite_index.md\":\"8cdcea27\",\"vite_vite_source_index.md\":\"f78b8ddb\",\"vue_vue3_index.md\":\"51ea8c43\",\"vue_vue3_diff_index.md\":\"f76f95bd\",\"vue_vue3_renderer_index.md\":\"256030ba\",\"vue_vue3_source_index.md\":\"7c9c9262\",\"vue_vue3_source_design_index.md\":\"b32012e3\",\"vue_vue_base_index.md\":\"56f6c8be\",\"vue_vue_cli_index.md\":\"1553bdec\",\"vue_vue_inteview_index.md\":\"64c8e1b9\",\"vue_vue_router_index.md\":\"59eba75e\",\"vue_vue_source_index.md\":\"47233828\",\"vue_vue_source_design_index.md\":\"2f6ce6bf\",\"vue_vue_source_plus_index.md\":\"8238c5e5\",\"vue_vue_source_review_index.md\":\"4e02116d\",\"vue_vue_ssr_index.md\":\"b852a7df\",\"vue_vue_vite_index.md\":\"48f65503\",\"vue_vuex_index.md\":\"b63385eb\",\"webpack_webpack_index.md\":\"0297a6f3\",\"webpack_webpack_tencent_index.md\":\"35bee7e9\",\"webpack_webpack_write_index.md\":\"ead6e2cd\",\"webpack_webpack_write_plus_index.md\":\"5e4a9d02\"}")</script>
    <script type="module" async src="/notes/assets/app.3c6e9e4e.js"></script>
    
  </body>
</html>