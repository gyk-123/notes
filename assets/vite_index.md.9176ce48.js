import{_ as s}from"./chunks/design.bb8e3e64.js";import{_ as n,c as a,o as l,a as p}from"./app.b55c6369.js";const o="/assets/prompt.457da89d.png",e="/assets/img.237c5c7a.png",c="/assets/img02.b7c88219.png",t="/assets/svg.05b0731e.png",r="/assets/worker.107cef4f.png",F="/assets/imagemin.08447e8f.png",D="/assets/svg02.954d64a9.png",y="/assets/svg03.3b946429.png",i="/assets/pre-build.a4eb6bd0.png",C="/assets/error.12c2108a.png",A="/assets/pre-bundle.2ee09305.png",d="/assets/performance.b2d244de.png",u="/assets/compiler.ebe2d66d.png",g="/assets/react-benchmark-medium.eda622a2.png",m="/assets/minify.a20efbdc.png",E="/assets/test.9fbc4792.png",h="/assets/transform.002a25c5.png",b="/assets/plugin.284983ec.png",v="/assets/esbuild_resource.b2942ee9.png",f="/assets/react-dom.7e7938d1.png",j="/assets/download01.8f276aca.png",q="/assets/download02.f9fdd059.png",B="/assets/serve.9a8480f8.png",S="/assets/esbuild_html.04fec52d.png",x="/assets/rollup_build.46623ca2.png",k="/assets/rollup_build02.9d28ef0d.png",_="/assets/rollup_source.71532a8e.png",V="/assets/rollup_hook.51377ed7.png",R="/assets/rollup_hook02.4efeb255.png",w="/assets/rollup_hook03.c9c6c617.png",I="/assets/vite_hook.3f646b24.png",P="/assets/vie_plugin_order.8fe6788a.png",M="/assets/vite_plugin_alert.483980a6.png",T="/assets/vite_plugin_env.026f55b0.png",H="/assets/logo.4fe7c92f.png",L="/assets/inspect.37b75d02.png",O="/assets/inspect02.02960161.png",N="/assets/inspect03.e9b7d2f2.png",J="/assets/hmr.18c29fde.gif",U="/assets/hmr_multi.cc84b270.gif",W="/assets/hmr_multi.6d469fe5.png",z="/assets/hmr_multi_error.c7943bb4.gif",Q="/assets/hmr_multi_error02.1816da71.gif",G="/assets/hmr_source.25fd7d8d.png",cs=JSON.parse('{"title":"Vite","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u9879\u76EE\u642D\u5EFA","slug":"\u9879\u76EE\u642D\u5EFA","link":"#\u9879\u76EE\u642D\u5EFA","children":[{"level":3,"title":"\u4F7F\u7528 pnpm","slug":"\u4F7F\u7528-pnpm","link":"#\u4F7F\u7528-pnpm","children":[]},{"level":3,"title":"\u9879\u76EE\u521D\u59CB\u5316","slug":"\u9879\u76EE\u521D\u59CB\u5316","link":"#\u9879\u76EE\u521D\u59CB\u5316","children":[]},{"level":3,"title":"\u76EE\u5F55\u7ED3\u6784","slug":"\u76EE\u5F55\u7ED3\u6784","link":"#\u76EE\u5F55\u7ED3\u6784","children":[]},{"level":3,"title":"\u914D\u7F6E\u6587\u4EF6","slug":"\u914D\u7F6E\u6587\u4EF6","link":"#\u914D\u7F6E\u6587\u4EF6","children":[]},{"level":3,"title":"\u751F\u4EA7\u73AF\u5883\u6784\u5EFA","slug":"\u751F\u4EA7\u73AF\u5883\u6784\u5EFA","link":"#\u751F\u4EA7\u73AF\u5883\u6784\u5EFA","children":[]},{"level":3,"title":"\u603B\u7ED3","slug":"\u603B\u7ED3","link":"#\u603B\u7ED3","children":[]}]},{"level":2,"title":"CSS \u5DE5\u7A0B\u5316\u65B9\u6848","slug":"css-\u5DE5\u7A0B\u5316\u65B9\u6848","link":"#css-\u5DE5\u7A0B\u5316\u65B9\u6848","children":[{"level":3,"title":"\u6837\u5F0F\u65B9\u6848\u7684\u610F\u4E49","slug":"\u6837\u5F0F\u65B9\u6848\u7684\u610F\u4E49","link":"#\u6837\u5F0F\u65B9\u6848\u7684\u610F\u4E49","children":[]},{"level":3,"title":"CSS \u9884\u5904\u7406\u5668","slug":"css-\u9884\u5904\u7406\u5668","link":"#css-\u9884\u5904\u7406\u5668","children":[]},{"level":3,"title":"CSS Modules","slug":"css-modules","link":"#css-modules","children":[]},{"level":3,"title":"PostCSS","slug":"postcss","link":"#postcss","children":[]},{"level":3,"title":"CSS In JS","slug":"css-in-js","link":"#css-in-js","children":[]},{"level":3,"title":"CSS \u539F\u5B50\u5316\u6846\u67B6","slug":"css-\u539F\u5B50\u5316\u6846\u67B6","link":"#css-\u539F\u5B50\u5316\u6846\u67B6","children":[]},{"level":3,"title":"\u603B\u7ED3","slug":"\u603B\u7ED3-1","link":"#\u603B\u7ED3-1","children":[]}]},{"level":2,"title":"Lint \u5DE5\u5177\u94FE\u914D\u7F6E","slug":"lint-\u5DE5\u5177\u94FE\u914D\u7F6E","link":"#lint-\u5DE5\u5177\u94FE\u914D\u7F6E","children":[{"level":3,"title":"ESLint","slug":"eslint","link":"#eslint","children":[]},{"level":3,"title":"Prettier","slug":"prettier","link":"#prettier","children":[]},{"level":3,"title":"Vite \u63A5\u5165 ESLint","slug":"vite-\u63A5\u5165-eslint","link":"#vite-\u63A5\u5165-eslint","children":[]},{"level":3,"title":"\u6837\u5F0F\u89C4\u8303\u5DE5\u5177\uFF1AStylelint","slug":"\u6837\u5F0F\u89C4\u8303\u5DE5\u5177\uFF1Astylelint","link":"#\u6837\u5F0F\u89C4\u8303\u5DE5\u5177\uFF1Astylelint","children":[]},{"level":3,"title":"Husky + lint-staged","slug":"husky-lint-staged","link":"#husky-lint-staged","children":[]},{"level":3,"title":"\u603B\u7ED3","slug":"\u603B\u7ED3-2","link":"#\u603B\u7ED3-2","children":[]}]},{"level":2,"title":"\u9759\u6001\u8D44\u6E90\u5904\u7406","slug":"\u9759\u6001\u8D44\u6E90\u5904\u7406","link":"#\u9759\u6001\u8D44\u6E90\u5904\u7406","children":[{"level":3,"title":"\u56FE\u7247\u52A0\u8F7D","slug":"\u56FE\u7247\u52A0\u8F7D","link":"#\u56FE\u7247\u52A0\u8F7D","children":[]},{"level":3,"title":"JSON \u52A0\u8F7D","slug":"json-\u52A0\u8F7D","link":"#json-\u52A0\u8F7D","children":[]},{"level":3,"title":"WebWorker \u811A\u672C","slug":"webworker-\u811A\u672C","link":"#webworker-\u811A\u672C","children":[]},{"level":3,"title":"Web Assembly \u6587\u4EF6","slug":"web-assembly-\u6587\u4EF6","link":"#web-assembly-\u6587\u4EF6","children":[]},{"level":3,"title":"\u5176\u4ED6\u9759\u6001\u8D44\u6E90","slug":"\u5176\u4ED6\u9759\u6001\u8D44\u6E90","link":"#\u5176\u4ED6\u9759\u6001\u8D44\u6E90","children":[]},{"level":3,"title":"\u7279\u6B8A\u8D44\u6E90\u540E\u7F00","slug":"\u7279\u6B8A\u8D44\u6E90\u540E\u7F00","link":"#\u7279\u6B8A\u8D44\u6E90\u540E\u7F00","children":[]},{"level":3,"title":"\u751F\u4EA7\u73AF\u5883\u5904\u7406","slug":"\u751F\u4EA7\u73AF\u5883\u5904\u7406","link":"#\u751F\u4EA7\u73AF\u5883\u5904\u7406","children":[]},{"level":3,"title":"\u603B\u7ED3","slug":"\u603B\u7ED3-3","link":"#\u603B\u7ED3-3","children":[]}]},{"level":2,"title":"\u79D2\u7EA7\u4F9D\u8D56\u9884\u6784\u5EFA","slug":"\u79D2\u7EA7\u4F9D\u8D56\u9884\u6784\u5EFA","link":"#\u79D2\u7EA7\u4F9D\u8D56\u9884\u6784\u5EFA","children":[{"level":3,"title":"\u4E3A\u4EC0\u4E48\u9700\u8981\u9884\u6784\u5EFA","slug":"\u4E3A\u4EC0\u4E48\u9700\u8981\u9884\u6784\u5EFA","link":"#\u4E3A\u4EC0\u4E48\u9700\u8981\u9884\u6784\u5EFA","children":[]},{"level":3,"title":"\u5982\u4F55\u5F00\u542F\u9884\u6784\u5EFA","slug":"\u5982\u4F55\u5F00\u542F\u9884\u6784\u5EFA","link":"#\u5982\u4F55\u5F00\u542F\u9884\u6784\u5EFA","children":[]},{"level":3,"title":"\u81EA\u5B9A\u4E49\u914D\u7F6E\u8BE6\u89E3","slug":"\u81EA\u5B9A\u4E49\u914D\u7F6E\u8BE6\u89E3","link":"#\u81EA\u5B9A\u4E49\u914D\u7F6E\u8BE6\u89E3","children":[]},{"level":3,"title":"\u603B\u7ED3","slug":"\u603B\u7ED3-4","link":"#\u603B\u7ED3-4","children":[]}]},{"level":2,"title":"\u53CC\u5F15\u64CE\u67B6\u6784","slug":"\u53CC\u5F15\u64CE\u67B6\u6784","link":"#\u53CC\u5F15\u64CE\u67B6\u6784","children":[{"level":3,"title":"Vite \u67B6\u6784\u56FE","slug":"vite-\u67B6\u6784\u56FE","link":"#vite-\u67B6\u6784\u56FE","children":[]},{"level":3,"title":"ESBuild","slug":"esbuild","link":"#esbuild","children":[]},{"level":3,"title":"Rollup","slug":"rollup","link":"#rollup","children":[]},{"level":3,"title":"\u603B\u7ED3","slug":"\u603B\u7ED3-5","link":"#\u603B\u7ED3-5","children":[]}]},{"level":2,"title":"ESBuild \u63D2\u4EF6\u5F00\u53D1\u5B9E\u6218","slug":"esbuild-\u63D2\u4EF6\u5F00\u53D1\u5B9E\u6218","link":"#esbuild-\u63D2\u4EF6\u5F00\u53D1\u5B9E\u6218","children":[{"level":3,"title":"\u4E3A\u4EC0\u4E48 ESBuild \u6027\u80FD\u6781\u9AD8","slug":"\u4E3A\u4EC0\u4E48-esbuild-\u6027\u80FD\u6781\u9AD8","link":"#\u4E3A\u4EC0\u4E48-esbuild-\u6027\u80FD\u6781\u9AD8","children":[]},{"level":3,"title":"ESBuild \u529F\u80FD\u4F7F\u7528","slug":"esbuild-\u529F\u80FD\u4F7F\u7528","link":"#esbuild-\u529F\u80FD\u4F7F\u7528","children":[]},{"level":3,"title":"ESBuild \u63D2\u4EF6\u5F00\u53D1","slug":"esbuild-\u63D2\u4EF6\u5F00\u53D1","link":"#esbuild-\u63D2\u4EF6\u5F00\u53D1","children":[]},{"level":3,"title":"\u603B\u7ED3","slug":"\u603B\u7ED3-6","link":"#\u603B\u7ED3-6","children":[]}]},{"level":2,"title":"Rollup \u57FA\u672C\u6982\u5FF5\u53CA\u4F7F\u7528","slug":"rollup-\u57FA\u672C\u6982\u5FF5\u53CA\u4F7F\u7528","link":"#rollup-\u57FA\u672C\u6982\u5FF5\u53CA\u4F7F\u7528","children":[{"level":3,"title":"\u5FEB\u901F\u4E0A\u624B","slug":"\u5FEB\u901F\u4E0A\u624B","link":"#\u5FEB\u901F\u4E0A\u624B","children":[]},{"level":3,"title":"\u5E38\u7528\u914D\u7F6E\u89E3\u8BFB","slug":"\u5E38\u7528\u914D\u7F6E\u89E3\u8BFB","link":"#\u5E38\u7528\u914D\u7F6E\u89E3\u8BFB","children":[]},{"level":3,"title":"\u603B\u7ED3","slug":"\u603B\u7ED3-7","link":"#\u603B\u7ED3-7","children":[]}]},{"level":2,"title":"Rollup \u63D2\u4EF6\u673A\u5236","slug":"rollup-\u63D2\u4EF6\u673A\u5236","link":"#rollup-\u63D2\u4EF6\u673A\u5236","children":[{"level":3,"title":"Rollup \u6574\u4F53\u6784\u5EFA\u9636\u6BB5","slug":"rollup-\u6574\u4F53\u6784\u5EFA\u9636\u6BB5","link":"#rollup-\u6574\u4F53\u6784\u5EFA\u9636\u6BB5","children":[]},{"level":3,"title":"\u62C6\u89E3\u63D2\u4EF6\u5DE5\u4F5C\u6D41","slug":"\u62C6\u89E3\u63D2\u4EF6\u5DE5\u4F5C\u6D41","link":"#\u62C6\u89E3\u63D2\u4EF6\u5DE5\u4F5C\u6D41","children":[]},{"level":3,"title":"\u5E38\u7528 hook \u5B9E\u6218","slug":"\u5E38\u7528-hook-\u5B9E\u6218","link":"#\u5E38\u7528-hook-\u5B9E\u6218","children":[]},{"level":3,"title":"\u603B\u7ED3","slug":"\u603B\u7ED3-8","link":"#\u603B\u7ED3-8","children":[]}]},{"level":2,"title":"Vite \u63D2\u4EF6\u5F00\u53D1","slug":"vite-\u63D2\u4EF6\u5F00\u53D1","link":"#vite-\u63D2\u4EF6\u5F00\u53D1","children":[{"level":3,"title":"\u63D2\u4EF6\u793A\u4F8B","slug":"\u63D2\u4EF6\u793A\u4F8B","link":"#\u63D2\u4EF6\u793A\u4F8B","children":[]},{"level":3,"title":"hook \u4ECB\u7ECD","slug":"hook-\u4ECB\u7ECD","link":"#hook-\u4ECB\u7ECD","children":[]},{"level":3,"title":"\u63D2\u4EF6\u5E94\u7528\u4F4D\u7F6E","slug":"\u63D2\u4EF6\u5E94\u7528\u4F4D\u7F6E","link":"#\u63D2\u4EF6\u5E94\u7528\u4F4D\u7F6E","children":[]},{"level":3,"title":"\u63D2\u4EF6\u5F00\u53D1\u5B9E\u6218","slug":"\u63D2\u4EF6\u5F00\u53D1\u5B9E\u6218","link":"#\u63D2\u4EF6\u5F00\u53D1\u5B9E\u6218","children":[]},{"level":3,"title":"\u603B\u7ED3","slug":"\u603B\u7ED3-9","link":"#\u603B\u7ED3-9","children":[]}]},{"level":2,"title":"HMR API \u539F\u7406","slug":"hmr-api-\u539F\u7406","link":"#hmr-api-\u539F\u7406","children":[{"level":3,"title":"HMR \u7B80\u4ECB","slug":"hmr-\u7B80\u4ECB","link":"#hmr-\u7B80\u4ECB","children":[]},{"level":3,"title":"HMR API","slug":"hmr-api","link":"#hmr-api","children":[]},{"level":3,"title":"\u603B\u7ED3","slug":"\u603B\u7ED3-10","link":"#\u603B\u7ED3-10","children":[]}]},{"level":2,"title":"\u4EE3\u7801\u5206\u5272","slug":"\u4EE3\u7801\u5206\u5272","link":"#\u4EE3\u7801\u5206\u5272","children":[{"level":3,"title":"Code Splitting \u89E3\u51B3\u7684\u95EE\u9898","slug":"code-splitting-\u89E3\u51B3\u7684\u95EE\u9898","link":"#code-splitting-\u89E3\u51B3\u7684\u95EE\u9898","children":[]}]},{"level":2,"title":"\u63D2\u4EF6\u6D41\u6C34\u7EBF","slug":"\u63D2\u4EF6\u6D41\u6C34\u7EBF","link":"#\u63D2\u4EF6\u6D41\u6C34\u7EBF","children":[{"level":3,"title":"\u63D2\u4EF6\u5BB9\u5668","slug":"\u63D2\u4EF6\u5BB9\u5668","link":"#\u63D2\u4EF6\u5BB9\u5668","children":[]},{"level":3,"title":"\u63D2\u4EF6\u5DE5\u4F5C\u6D41\u6982\u89C8","slug":"\u63D2\u4EF6\u5DE5\u4F5C\u6D41\u6982\u89C8","link":"#\u63D2\u4EF6\u5DE5\u4F5C\u6D41\u6982\u89C8","children":[]},{"level":3,"title":"\u63D2\u4EF6\u529F\u80FD\u68B3\u7406","slug":"\u63D2\u4EF6\u529F\u80FD\u68B3\u7406","link":"#\u63D2\u4EF6\u529F\u80FD\u68B3\u7406","children":[]},{"level":3,"title":"\u603B\u7ED3","slug":"\u603B\u7ED3-11","link":"#\u603B\u7ED3-11","children":[]}]}],"relativePath":"vite/index.md"}'),$={name:"vite/index.md"},X=p(`<h1 id="vite" tabindex="-1">Vite <a class="header-anchor" href="#vite" aria-hidden="true">#</a></h1><h2 id="\u9879\u76EE\u642D\u5EFA" tabindex="-1">\u9879\u76EE\u642D\u5EFA <a class="header-anchor" href="#\u9879\u76EE\u642D\u5EFA" aria-hidden="true">#</a></h2><h3 id="\u4F7F\u7528-pnpm" tabindex="-1">\u4F7F\u7528 pnpm <a class="header-anchor" href="#\u4F7F\u7528-pnpm" aria-hidden="true">#</a></h3><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">npm i </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">g pnpm</span></span>
<span class="line"></span></code></pre></div><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm config set registry </span><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;">//registry.npmmirror.com/</span></span>
<span class="line"></span></code></pre></div><h3 id="\u9879\u76EE\u521D\u59CB\u5316" tabindex="-1">\u9879\u76EE\u521D\u59CB\u5316 <a class="header-anchor" href="#\u9879\u76EE\u521D\u59CB\u5316" aria-hidden="true">#</a></h3><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm create vite</span></span>
<span class="line"></span></code></pre></div><blockquote><p>framework\uFF1Areact\u3001variant\uFF1Areact-ts</p></blockquote><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// \u8FDB\u5165\u9879\u76EE\u76EE\u5F55</span></span>
<span class="line"><span style="color:#A6ACCD;">cd vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">project</span></span>
<span class="line"><span style="color:#676E95;">// \u5B89\u88C5\u4F9D\u8D56</span></span>
<span class="line"><span style="color:#A6ACCD;">pnpm install</span></span>
<span class="line"><span style="color:#676E95;">// \u542F\u52A8\u9879\u76EE</span></span>
<span class="line"><span style="color:#A6ACCD;">pnpm run dev</span></span>
<span class="line"></span></code></pre></div><h3 id="\u76EE\u5F55\u7ED3\u6784" tabindex="-1">\u76EE\u5F55\u7ED3\u6784 <a class="header-anchor" href="#\u76EE\u5F55\u7ED3\u6784" aria-hidden="true">#</a></h3><p>\u9879\u76EE\u76EE\u5F55\u7ED3\u6784\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">.</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">html</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 package</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">json</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 pnpm</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">lock</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">yaml</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 src</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u251C\u2500\u2500 App</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">css</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u251C\u2500\u2500 App</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tsx</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u251C\u2500\u2500 favicon</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u251C\u2500\u2500 index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">css</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u251C\u2500\u2500 logo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u251C\u2500\u2500 main</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tsx</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u2514\u2500\u2500 vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">env</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">d</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ts</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 tsconfig</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">json</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2514\u2500\u2500 vite</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ts</span></span>
<span class="line"></span></code></pre></div><p>\u5728\u9879\u76EE\u6839\u76EE\u5F55\u4E2D\u6709\u4E00\u4E2A<code>index.html</code>\u6587\u4EF6\uFF0C\u8FD9\u4E2A\u6587\u4EF6\u5341\u5206\u5173\u952E\uFF0C\u56E0\u4E3A Vite \u9ED8\u8BA4\u4F1A\u628A\u9879\u76EE\u6839\u76EE\u5F55\u4E0B\u7684<code>index.html</code>\u4F5C\u4E3A\u5165\u53E3\u6587\u4EF6\u3002 \u4E5F\u5C31\u662F\u8BF4\uFF0C\u5F53\u4F60\u8BBF\u95EE<code>http://localhost:3000</code>\u7684\u65F6\u5019\uFF0CVite \u7684 Dev Server \u4F1A\u81EA\u52A8\u8FD4\u56DE\u8FD9\u4E2A HTML \u6587\u4EF6\u7684\u5185\u5BB9\u3002\u6211\u4EEC\u6765\u770B\u770B\u8FD9\u4E2A HTML \u7A76\u7ADF\u5199\u4E86\u4EC0\u4E48:</p><div class="language-html"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F07178;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">lang</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">en</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">charset</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UTF-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">link</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">rel</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">icon</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">image/svg+xml</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">href</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/favicon.svg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">viewport</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">content</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width=device-width, initial-scale=1.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">Vite App</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">    &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/main.tsx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u4E2A HTML \u6587\u4EF6\u7684\u5185\u5BB9\u975E\u5E38\u7B80\u6D01\uFF0C\u5728 <code>body</code> \u6807\u7B7E\u4E2D\u9664\u4E86 id \u4E3A root \u7684\u6839\u8282\u70B9\u4E4B\u5916\uFF0C\u8FD8\u5305\u542B\u4E86\u4E00\u4E2A\u58F0\u660E\u4E86<code>type=&quot;module&quot;</code>\u7684 <code>script</code> \u6807\u7B7E:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/main.tsx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u7531\u4E8E\u73B0\u4EE3\u6D4F\u89C8\u5668\u539F\u751F\u652F\u6301\u4E86 ES \u6A21\u5757\u89C4\u8303\uFF0C\u56E0\u6B64\u539F\u751F\u7684 ES \u8BED\u6CD5\u4E5F\u53EF\u4EE5\u76F4\u63A5\u653E\u5230\u6D4F\u89C8\u5668\u4E2D\u6267\u884C\uFF0C\u53EA\u9700\u8981\u5728 script \u6807\u7B7E\u4E2D\u58F0\u660E <code>type=&quot;module&quot;</code> \u5373\u53EF\u3002\u6BD4\u5982\u4E0A\u9762\u7684 script \u6807\u7B7E\u5C31\u58F0\u660E\u4E86 type=&quot;module&quot;\uFF0C\u540C\u65F6 src \u6307\u5411\u4E86<code>/src/main.tsx</code>\u6587\u4EF6\uFF0C\u6B64\u65F6\u76F8\u5F53\u4E8E\u8BF7\u6C42\u4E86<code>http://localhost:3000/src/main.tsx</code>\u8FD9\u4E2A\u8D44\u6E90\uFF0CVite \u7684 Dev Server \u6B64\u65F6\u4F1A\u63A5\u53D7\u5230\u8FD9\u4E2A\u8BF7\u6C42\uFF0C\u7136\u540E\u8BFB\u53D6\u5BF9\u5E94\u7684\u6587\u4EF6\u5185\u5BB9\uFF0C\u8FDB\u884C\u4E00\u5B9A\u7684\u4E2D\u95F4\u5904\u7406\uFF0C\u6700\u540E\u5C06\u5904\u7406\u7684\u7ED3\u679C\u8FD4\u56DE\u7ED9\u6D4F\u89C8\u5668\u3002</p><p>\u6211\u4EEC\u53EF\u4EE5\u6765\u770B\u770B <code>main.tsx</code> \u7684\u5185\u5BB9:</p><div class="language-tsx"><button class="copy"></button><span class="lang">tsx</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> React </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> ReactDOM </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react-dom/client</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> App </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./App</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">ReactDOM</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createRoot</span><span style="color:#A6ACCD;">(document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">React.StrictMode</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">App</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#FFCB6B;">React.StrictMode</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>\u4F60\u53EF\u80FD\u4F1A\u8BE7\u5F02: \u6D4F\u89C8\u5668\u5E76\u4E0D\u8BC6\u522B tsx \u8BED\u6CD5\uFF0C\u4E5F\u65E0\u6CD5\u76F4\u63A5 import css \u6587\u4EF6\uFF0C\u4E0A\u9762\u8FD9\u6BB5\u4EE3\u7801\u7A76\u7ADF\u662F\u5982\u4F55\u88AB\u6D4F\u89C8\u5668\u6B63\u5E38\u6267\u884C\u7684\u5462\uFF1F</p><p>\u8FD9\u5C31\u5F52\u529F\u4E86 Vite Dev Server \u6240\u505A\u7684\u201C\u4E2D\u95F4\u5904\u7406\u201D\u4E86\uFF0C\u4E5F\u5C31\u662F\u8BF4\uFF0C\u5728\u8BFB\u53D6\u5230 <code>main.tsx</code>\u6587\u4EF6\u7684\u5185\u5BB9\u4E4B\u540E\uFF0CVite \u4F1A\u5BF9\u6587\u4EF6\u7684\u5185\u5BB9\u8FDB\u884C\u7F16\u8BD1\uFF0C\u5927\u5BB6\u53EF\u4EE5\u4ECE Chrome \u7684\u7F51\u7EDC\u8C03\u8BD5\u9762\u677F\u770B\u5230\u7F16\u8BD1\u540E\u7684\u7ED3\u679C:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> _jsxFileName </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">D:</span><span style="color:#A6ACCD;">\\\\</span><span style="color:#C3E88D;">workspace</span><span style="color:#A6ACCD;">\\\\</span><span style="color:#C3E88D;">notes</span><span style="color:#A6ACCD;">\\\\</span><span style="color:#C3E88D;">vite</span><span style="color:#A6ACCD;">\\\\</span><span style="color:#C3E88D;">vite-project</span><span style="color:#A6ACCD;">\\\\</span><span style="color:#C3E88D;">src</span><span style="color:#A6ACCD;">\\\\</span><span style="color:#C3E88D;">main.tsx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> __vite__cjsImport0_react </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/node_modules/.vite/deps/react.js?v=d559f595</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> React </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> __vite__cjsImport0_react</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__esModule </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> __vite__cjsImport0_react</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">default </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> __vite__cjsImport0_react</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> __vite__cjsImport1_reactDom_client </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/node_modules/.vite/deps/react-dom_client.js?v=d559f595</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> ReactDOM </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> __vite__cjsImport1_reactDom_client</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__esModule </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> __vite__cjsImport1_reactDom_client</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">default </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> __vite__cjsImport1_reactDom_client</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> App </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/App.tsx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/index.css</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> __vite__cjsImport4_react_jsxDevRuntime </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/node_modules/.vite/deps/react_jsx-dev-runtime.js?v=d559f595</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> _jsxDEV </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> __vite__cjsImport4_react_jsxDevRuntime[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">jsxDEV</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">ReactDOM</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createRoot</span><span style="color:#A6ACCD;">(document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;">(</span><span style="color:#676E95;">/* @__PURE__ */</span></span>
<span class="line"><span style="color:#82AAFF;">_jsxDEV</span><span style="color:#A6ACCD;">(React</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">StrictMode</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">children</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">/* @__PURE__ */</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">_jsxDEV</span><span style="color:#A6ACCD;">(App</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{},</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">fileName</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> _jsxFileName</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">lineNumber</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">columnNumber</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">this</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">fileName</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> _jsxFileName</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">lineNumber</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">7</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">columnNumber</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">this</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJtYXBwaW5ncyI6IjtBQUFBO0FBQ0E7QUFDQTtBQUNBOztBQUVBQSxTQUFTQyxXQUFXQyxTQUFTQyxlQUFlLE1BQXhCLENBQXBCLEVBQXNEQyxPQUNwRCx3QkFBQyxNQUFNLFlBQVA7QUFBQSxZQUNFLHdCQUFDLEtBQUQ7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQURGO0FBQUE7QUFBQTtBQUFBO0FBQUEsUUFERiIsIm5hbWVzIjpbIlJlYWN0RE9NIiwiY3JlYXRlUm9vdCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJyZW5kZXIiXSwic291cmNlcyI6WyJEOi93b3Jrc3BhY2Uvbm90ZXMvdml0ZS92aXRlLXByb2plY3Qvc3JjL21haW4udHN4Il0sImZpbGUiOiJEOi93b3Jrc3BhY2Uvbm90ZXMvdml0ZS92aXRlLXByb2plY3Qvc3JjL21haW4udHN4Iiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0J1xuaW1wb3J0IFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbS9jbGllbnQnXG5pbXBvcnQgQXBwIGZyb20gJy4vQXBwJ1xuaW1wb3J0ICcuL2luZGV4LmNzcydcblxuUmVhY3RET00uY3JlYXRlUm9vdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncm9vdCcpISkucmVuZGVyKFxuICA8UmVhY3QuU3RyaWN0TW9kZT5cbiAgICA8QXBwIC8+XG4gIDwvUmVhY3QuU3RyaWN0TW9kZT5cbilcbiJdfQ==</span></span>
<span class="line"></span></code></pre></div><p>Vite \u4F1A\u5C06\u9879\u76EE\u7684\u6E90\u4EE3\u7801\u7F16\u8BD1\u6210\u6D4F\u89C8\u5668\u53EF\u4EE5\u8BC6\u522B\u7684\u4EE3\u7801\uFF0C\u4E0E\u6B64\u540C\u65F6\uFF0C\u4E00\u4E2A import \u8BED\u53E5\u5373\u4EE3\u8868\u4E86\u4E00\u4E2A HTTP \u8BF7\u6C42\uFF0C\u5982\u4E0B\u9762\u4E24\u4E2A import \u8BED\u53E5:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/index.css</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> App </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/App.tsx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u5728 Vite \u9879\u76EE\u4E2D\uFF0C\u4E00\u4E2A<code>import \u8BED\u53E5\u5373\u4EE3\u8868\u4E00\u4E2A HTTP \u8BF7\u6C42</code>\u3002\u4E0A\u8FF0\u4E24\u4E2A\u8BED\u53E5\u5219\u5206\u522B\u4EE3\u8868\u4E86\u4E24\u4E2A\u4E0D\u540C\u7684\u8BF7\u6C42\uFF0CVite Dev Server \u4F1A\u8BFB\u53D6\u672C\u5730\u6587\u4EF6\uFF0C\u8FD4\u56DE\u6D4F\u89C8\u5668\u53EF\u4EE5\u89E3\u6790\u7684\u4EE3\u7801\u3002\u5F53\u6D4F\u89C8\u5668\u89E3\u6790\u5230\u65B0\u7684 import \u8BED\u53E5\uFF0C\u53C8\u4F1A\u53D1\u51FA\u65B0\u7684\u8BF7\u6C42\uFF0C\u4EE5\u6B64\u7C7B\u63A8\uFF0C\u76F4\u5230\u6240\u6709\u7684\u8D44\u6E90\u90FD\u52A0\u8F7D\u5B8C\u6210\u3002</p><p>\u73B0\u5728\uFF0C\u4F60\u5E94\u8BE5\u77E5\u9053\u4E86 Vite \u6240\u5021\u5BFC\u7684<code>no-bundle</code>\u7406\u5FF5\u7684\u771F\u6B63\u542B\u4E49: <strong>\u5229\u7528\u6D4F\u89C8\u5668\u539F\u751F ES \u6A21\u5757\u7684\u652F\u6301\uFF0C\u5B9E\u73B0\u5F00\u53D1\u9636\u6BB5\u7684 Dev Server\uFF0C\u8FDB\u884C\u6A21\u5757\u7684\u6309\u9700\u52A0\u8F7D</strong>\uFF0C\u800C\u4E0D\u662F<strong>\u5148\u6574\u4F53\u6253\u5305\u518D\u8FDB\u884C\u52A0\u8F7D</strong>\u3002\u76F8\u6BD4 Webpack \u8FD9\u79CD\u5FC5\u987B\u6253\u5305\u518D\u52A0\u8F7D\u7684\u4F20\u7EDF\u6784\u5EFA\u6A21\u5F0F\uFF0CVite \u5728\u5F00\u53D1\u9636\u6BB5\u7701\u7565\u4E86\u7E41\u7410\u4E14\u8017\u65F6\u7684\u6253\u5305\u8FC7\u7A0B\uFF0C\u8FD9\u4E5F\u662F\u5B83\u4E3A\u4EC0\u4E48\u5FEB\u7684\u4E00\u4E2A\u91CD\u8981\u539F\u56E0\u3002</p><h3 id="\u914D\u7F6E\u6587\u4EF6" tabindex="-1">\u914D\u7F6E\u6587\u4EF6 <a class="header-anchor" href="#\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a></h3><p>\u5728\u4F7F\u7528 Vite \u7684\u8FC7\u7A0B\uFF0C\u6211\u4EEC\u9700\u8981\u5BF9 Vite \u505A\u4E00\u4E9B\u914D\u7F6E\uFF0C\u4EE5\u6EE1\u8DB3\u65E5\u5E38\u5F00\u53D1\u7684\u9700\u8981\u3002\u4F60\u53EF\u4EE5\u901A\u8FC7\u4E24\u79CD\u65B9\u5F0F\u6765\u5BF9 Vite \u8FDB\u884C\u914D\u7F6E\uFF0C\u4E00\u662F\u901A\u8FC7\u547D\u4EE4\u884C\u53C2\u6570\uFF0C\u5982<code>vite --port=8888</code>\uFF0C\u4E8C\u662F\u901A\u8FC7\u914D\u7F6E\u6587\u4EF6\uFF0C\u4E00\u822C\u60C5\u51B5\u4E0B\uFF0C\u5927\u591A\u6570\u7684\u914D\u7F6E\u90FD\u901A\u8FC7\u914D\u7F6E\u6587\u4EF6\u7684\u65B9\u5F0F\u6765\u58F0\u660E\u3002</p><p>Vite \u5F53\u4E2D\u652F\u6301\u591A\u79CD\u914D\u7F6E\u6587\u4EF6\u7C7B\u578B\uFF0C\u5305\u62EC<code>.js</code>\u3001<code>.ts</code>\u3001<code>.mjs</code>\u4E09\u79CD\u540E\u7F00\u7684\u6587\u4EF6\uFF0C\u5B9E\u9645\u9879\u76EE\u4E2D\u4E00\u822C\u4F7F\u7528 <code>vite.config.ts </code>\u4F5C\u4E3A\u914D\u7F6E\u6587\u4EF6\uFF0C\u4EE5\u811A\u624B\u67B6\u9879\u76EE\u4E2D\u7684\u914D\u7F6E\u4E3A\u4F8B\uFF0C\u5177\u4F53\u7684\u914D\u7F6E\u4EE3\u7801\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defineConfig</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> react </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@vitejs/plugin-react</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// https://vitejs.dev/config/</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">react</span><span style="color:#A6ACCD;">()]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>\u53EF\u4EE5\u770B\u5230\u914D\u7F6E\u6587\u4EF6\u4E2D\u9ED8\u8BA4\u5728 <code>plugins</code> \u6570\u7EC4\u4E2D\u914D\u7F6E\u4E86\u5B98\u65B9\u7684 react \u63D2\u4EF6\uFF0C\u6765\u63D0\u4F9B React \u9879\u76EE\u7F16\u8BD1\u548C\u70ED\u66F4\u65B0\u7684\u529F\u80FD\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u6211\u4EEC\u53EF\u4EE5\u57FA\u4E8E\u8FD9\u4E2A\u6587\u4EF6\u5B8C\u6210\u66F4\u52A0\u4E30\u5BCC\u7684\u914D\u7F6E\u3002\u4F8B\u5982\u6211\u4EEC\u53EF\u4EE5\u4FEE\u6539\u9875\u9762\u5165\u53E3\u6587\u4EF6 <code>index.html</code> \u7684\u4F4D\u7F6E\u3002</p><p>\u9875\u9762\u7684\u5165\u53E3\u6587\u4EF6<code>index.html</code>\u5E76\u4E0D\u5728\u9879\u76EE\u6839\u76EE\u5F55\u4E0B\uFF0C\u800C\u9700\u8981\u653E\u5230 <code>src</code> \u76EE\u5F55\u4E0B\uFF0C\u5982\u4F55\u5728\u8BBF\u95EE<code>localhost:3000</code>\u7684\u65F6\u5019\u8BA9 Vite \u81EA\u52A8\u8FD4\u56DE src \u76EE\u5F55\u4E0B\u7684<code>index.html</code>\u5462\uFF1F\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7<code>root</code>\u53C2\u6570\u914D\u7F6E\u9879\u76EE\u6839\u76EE\u5F55\u7684\u4F4D\u7F6E:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defineConfig</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;">// \u5F15\u5165 path \u5305\u6CE8\u610F\u4E24\u70B9:</span></span>
<span class="line"><span style="color:#676E95;">// 1. \u4E3A\u907F\u514D\u7C7B\u578B\u62A5\u9519\uFF0C\u4F60\u9700\u8981\u901A\u8FC7 \`pnpm i @types/node -D\` \u5B89\u88C5\u7C7B\u578B</span></span>
<span class="line"><span style="color:#676E95;">// 2. tsconfig.node.json \u4E2D\u8BBE\u7F6E \`allowSyntheticDefaultImports: true\`\uFF0C\u4EE5\u5141\u8BB8\u4E0B\u9762\u7684 default \u5BFC\u5165\u65B9\u5F0F</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> path </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">path</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> react </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@vitejs/plugin-react</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u624B\u52A8\u6307\u5B9A\u9879\u76EE\u6839\u76EE\u5F55\u4F4D\u7F6E</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">root</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#A6ACCD;">(__dirname</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  plugins: [</span><span style="color:#82AAFF;">react</span><span style="color:#A6ACCD;">()]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>\u5F53\u624B\u52A8\u6307\u5B9A<code>root</code>\u53C2\u6570\u4E4B\u540E\uFF0CVite \u4F1A\u81EA\u52A8\u4ECE\u8FD9\u4E2A\u8DEF\u5F84\u4E0B\u5BFB\u627E<code>index.html</code>\u6587\u4EF6\uFF0C\u4E5F\u5C31\u662F\u8BF4\u5F53\u6211\u76F4\u63A5\u8BBF\u95EE <code>localhost:3000</code>\u7684\u65F6\u5019\uFF0CVite \u4ECE<code>src</code>\u76EE\u5F55\u4E0B\u8BFB\u53D6\u5165\u53E3\u6587\u4EF6\uFF0C\u8FD9\u6837\u5C31\u6210\u529F\u5B9E\u73B0\u4E86\u521A\u624D\u7684\u9700\u6C42\u3002</p><h3 id="\u751F\u4EA7\u73AF\u5883\u6784\u5EFA" tabindex="-1">\u751F\u4EA7\u73AF\u5883\u6784\u5EFA <a class="header-anchor" href="#\u751F\u4EA7\u73AF\u5883\u6784\u5EFA" aria-hidden="true">#</a></h3><p>\u6709\u4EBA\u8BF4<code>Vite</code>\u56E0\u4E3A\u5176\u4E0D\u6253\u5305\u7684\u7279\u6027\u800C\u4E0D\u80FD\u4E0A\u751F\u4EA7\u73AF\u5883\uFF0C\u5176\u5B9E\u8FD9\u79CD\u89C2\u70B9\u662F\u76F8\u5F53\u6709\u8BEF\u7684\u3002</p><p>\u5728\u5F00\u53D1\u9636\u6BB5 Vite \u901A\u8FC7 Dev Server \u5B9E\u73B0\u4E86\u4E0D\u6253\u5305\u7684\u7279\u6027\uFF0C\u800C\u5728\u751F\u4EA7\u73AF\u5883\u4E2D\uFF0CVite \u4F9D\u7136\u4F1A\u57FA\u4E8E Rollup \u8FDB\u884C\u6253\u5305\uFF0C\u5E76\u91C7\u53D6\u4E00\u7CFB\u5217\u7684\u6253\u5305\u4F18\u5316\u624B\u6BB5\u3002\u4ECE\u811A\u624B\u67B6\u9879\u76EE\u7684<code>package.json</code>\u4E2D\u5C31\u53EF\u89C1\u4E00\u6591\uFF1A</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5F00\u53D1\u9636\u6BB5\u542F\u52A8 Vite Dev Server</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">dev</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u751F\u4EA7\u73AF\u5883\u6253\u5305</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">build</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tsc &amp;&amp; vite build</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u751F\u4EA7\u73AF\u5883\u6253\u5305\u5B8C\u9884\u89C8\u4EA7\u7269</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">preview</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite preview</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u76F8\u4FE1\u4F60\u5DF2\u7ECF\u6CE8\u610F\u5230\u5176\u4E2D\u7684<code>build</code>\u547D\u4EE4\u4E86\uFF0C\u6CA1\u9519\uFF0C\u8FD9\u4E2A\u547D\u4EE4\u5C31\u662F Vite \u4E13\u95E8\u7528\u6765\u8FDB\u884C\u751F\u4EA7\u73AF\u5883\u6253\u5305\u7684\u3002\u4F46\u53EF\u80FD\u4F60\u4F1A\u6709\u70B9\u7591\u60D1\uFF0C\u4E3A\u4EC0\u4E48\u5728<code>vite build</code>\u547D\u4EE4\u6267\u884C\u4E4B\u524D\u8981\u5148\u6267\u884C<code>tsc</code>\u5462\uFF1F</p><p><code>tsc</code> \u4F5C\u4E3A TypeScript \u7684\u5B98\u65B9\u7F16\u8BD1\u547D\u4EE4\uFF0C\u53EF\u4EE5\u7528\u6765\u7F16\u8BD1 TypeScript \u4EE3\u7801\u5E76\u8FDB\u884C\u7C7B\u578B\u68C0\u67E5\uFF0C\u800C\u8FD9\u91CC\u7684\u4F5C\u7528\u4E3B\u8981\u662F\u7528\u6765\u505A\u7C7B\u578B\u68C0\u67E5\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4ECE\u9879\u76EE\u7684<code>tsconfig.json</code>\u4E2D\u6CE8\u610F\u5230\u8FD9\u6837\u4E00\u4E2A\u914D\u7F6E:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">compilerOptions</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u7701\u7565\u5176\u4ED6\u914D\u7F6E</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// 1. noEmit \u8868\u793A\u53EA\u505A\u7C7B\u578B\u68C0\u67E5\uFF0C\u800C\u4E0D\u4F1A\u8F93\u51FA\u4EA7\u7269\u6587\u4EF6</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// 2. \u8FD9\u884C\u914D\u7F6E\u4E0E tsc --noEmit \u547D\u4EE4\u7B49\u6548</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">noEmit</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u867D\u7136 Vite \u63D0\u4F9B\u4E86\u5F00\u7BB1\u5373\u7528\u7684 TypeScript \u4EE5\u53CA JSX \u7684\u7F16\u8BD1\u80FD\u529B\uFF0C\u4F46\u5B9E\u9645\u4E0A\u5E95\u5C42\u5E76\u6CA1\u6709\u5B9E\u73B0 TypeScript \u7684\u7C7B\u578B\u6821\u9A8C\u7CFB\u7EDF\uFF0C\u56E0\u6B64\u9700\u8981\u501F\u52A9 <code>tsc</code> \u6765\u5B8C\u6210\u7C7B\u578B\u6821\u9A8C(\u5728 Vue \u9879\u76EE\u4E2D\u4F7F\u7528 <code>vue-tsc</code> \u8FD9\u4E2A\u5DE5\u5177\u6765\u5B8C\u6210)\uFF0C\u5728\u6253\u5305\u524D\u63D0\u65E9\u66B4\u9732\u51FA\u7C7B\u578B\u76F8\u5173\u7684\u95EE\u9898\uFF0C\u4FDD\u8BC1\u4EE3\u7801\u7684\u5065\u58EE\u6027\u3002</p><p>\u4F60\u53EF\u4EE5\u8BD5\u7740\u6267\u884C\u4E00\u4E0B\u8FD9\u4E2A\u6253\u5305\u547D\u4EE4:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">PS </span><span style="color:#FFCB6B;">D</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">\\workspace\\notes\\vite\\vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">project</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> pnpm run build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">project@</span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> build </span><span style="color:#FFCB6B;">D</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">\\workspace\\notes\\vite\\vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">project</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> tsc </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> vite build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">vite v2</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">9.5</span><span style="color:#A6ACCD;"> building for production</span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2713 </span><span style="color:#F78C6C;">34</span><span style="color:#A6ACCD;"> modules transformed</span><span style="color:#89DDFF;">.</span></span>
<span class="line"><span style="color:#A6ACCD;">dist</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">assets</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">logo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ecc203fb</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg    </span><span style="color:#F78C6C;">2.61</span><span style="color:#A6ACCD;"> KiB</span></span>
<span class="line"><span style="color:#A6ACCD;">dist</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">html                  </span><span style="color:#F78C6C;">0.44</span><span style="color:#A6ACCD;"> KiB</span></span>
<span class="line"><span style="color:#A6ACCD;">dist</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">assets</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">62f502b0</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">css   </span><span style="color:#F78C6C;">0.75</span><span style="color:#A6ACCD;"> KiB </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">gzip</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.48</span><span style="color:#A6ACCD;"> KiB</span></span>
<span class="line"></span></code></pre></div><p>\u6B64\u65F6 Vite \u5DF2\u7ECF\u751F\u6210\u4E86\u6700\u7EC8\u7684\u6253\u5305\u4EA7\u7269\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7 <code>pnpm run preview</code> \u547D\u4EE4\u9884\u89C8\u4E00\u4E0B\u6253\u5305\u4EA7\u7269\u7684\u6267\u884C\u6548\u679C\u3002</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">PS </span><span style="color:#FFCB6B;">D</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">\\workspace\\notes\\vite\\vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">project</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> pnpm run preview</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">project@</span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> preview </span><span style="color:#FFCB6B;">D</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">\\workspace\\notes\\vite\\vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">project</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> vite preview</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Local</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">http</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;">//localhost:4173/</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Network</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> use </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">--host</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> to expose</span></span>
<span class="line"></span></code></pre></div><p>\u5728\u6D4F\u89C8\u5668\u4E2D\u6253\u5F00<code>http://localhost:5000</code>\u5730\u5740\uFF0C\u4F60\u5C06\u770B\u5230\u548C\u5F00\u53D1\u9636\u6BB5\u4E00\u6837\u7684\u9875\u9762\u5185\u5BB9\uFF0C\u8BC1\u660E\u6211\u4EEC\u6210\u529F\u5B8C\u6210\u7B2C\u4E00\u4E2A Vite \u9879\u76EE\u7684\u751F\u4EA7\u73AF\u5883\u6784\u5EFA\u3002</p><h3 id="\u603B\u7ED3" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3" aria-hidden="true">#</a></h3><p>\u672C\u8282\u4E2D\u6211\u4EEC\u4E00\u8D77\u642D\u5EFA\u4E86\u57FA\u672C\u7684\u524D\u7AEF\u5F00\u53D1\u73AF\u5883\uFF0C\u5B89\u88C5\u5E38\u7528\u7684\u7F16\u8F91\u5668\u3001\u6D4F\u89C8\u5668\u3001Node.js \u73AF\u5883\u53CA\u5305\u7BA1\u7406\u5668 pnpm\uFF0C\u63A5\u7740\u6211\u548C\u4F60\u4F7F\u7528 Vite \u7684\u521D\u59CB\u5316\u547D\u4EE4\u521B\u5EFA\u4E00\u4E2A React \u9879\u76EE\u5E76\u6210\u529F\u542F\u52A8\uFF0C\u8BA9\u4F60\u771F\u5207\u5730\u4F53\u9A8C\u5230 Vite \u7684\u5FEB\u901F\u548C\u8F7B\u91CF\u3002</p><p>\u9879\u76EE\u542F\u52A8\u4E4B\u540E\u6211\u4E5F\u4E0E\u4F60\u5206\u6790\u4E86\u9879\u76EE\u80CC\u540E\u7684\u542F\u52A8\u6D41\u7A0B\uFF0C\u5F3A\u8C03\u4E86 <code>\u4E00\u4E2A import \u8BED\u53E5\u4EE3\u8868\u4E00\u4E2A HTTP \u8BF7\u6C42</code>\uFF0C\u800C\u6B63\u662F Vite \u7684 Dev Server \u6765\u63A5\u6536\u8FD9\u4E9B\u8BF7\u6C42\u3001\u8FDB\u884C\u6587\u4EF6\u8F6C\u8BD1\u4EE5\u53CA\u8FD4\u56DE\u6D4F\u89C8\u5668\u53EF\u4EE5\u8FD0\u884C\u7684\u4EE3\u7801\uFF0C\u4ECE\u800C\u8BA9\u9879\u76EE\u6B63\u5E38\u8FD0\u884C\u3002</p><p>\u4E0D\u4EC5\u5982\u6B64\uFF0C\u6211\u8FD8\u5E26\u4F60\u4E00\u8D77\u521D\u6B65\u63A5\u89E6\u4E86 Vite \u7684\u914D\u7F6E\u6587\u4EF6\uFF0C\u5E76\u5C1D\u8BD5\u8FDB\u884C\u751F\u4EA7\u73AF\u5883\u7684\u6253\u5305\uFF0C\u4E3A\u4E0B\u4E00\u8282\u7684\u5B66\u4E60\u4F5C\u4E0B\u4E86\u94FA\u57AB\u3002</p><h2 id="css-\u5DE5\u7A0B\u5316\u65B9\u6848" tabindex="-1">CSS \u5DE5\u7A0B\u5316\u65B9\u6848 <a class="header-anchor" href="#css-\u5DE5\u7A0B\u5316\u65B9\u6848" aria-hidden="true">#</a></h2><h3 id="\u6837\u5F0F\u65B9\u6848\u7684\u610F\u4E49" tabindex="-1">\u6837\u5F0F\u65B9\u6848\u7684\u610F\u4E49 <a class="header-anchor" href="#\u6837\u5F0F\u65B9\u6848\u7684\u610F\u4E49" aria-hidden="true">#</a></h3><p>\u5BF9\u521D\u5B66\u8005\u6765\u8BF4\uFF0C\u8C08\u5230\u5F00\u53D1\u524D\u7AEF\u7684\u6837\u5F0F\uFF0C\u9996\u5148\u60F3\u5230\u7684\u4FBF\u662F\u76F4\u63A5\u5199\u539F\u751F CSS\u3002 \u4F46\u65F6\u95F4\u4E00\u957F\uFF0C\u96BE\u514D\u4F1A\u53D1\u73B0\u539F\u751F CSS \u5F00\u53D1\u7684\u5404\u79CD\u95EE\u9898\u3002\u90A3\u4E48\uFF0C\u5982\u679C\u6211\u4EEC\u4E0D\u7528\u4EFB\u4F55 CSS \u5DE5\u7A0B\u65B9\u6848\uFF0C\u53C8\u4F1A\u51FA\u73B0\u54EA\u4E9B\u95EE\u9898\u5462\uFF1F</p><p><strong>\u5F00\u53D1\u4F53\u9A8C</strong> \u6B20\u4F73\u3002\u6BD4\u5982\u539F\u751F CSS \u4E0D\u652F\u6301\u9009\u62E9\u5668\u7684\u5D4C\u5957:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// \u9009\u62E9\u5668\u53EA\u80FD\u5E73\u94FA\uFF0C\u4E0D\u80FD\u5D4C\u5957</span></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">container </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">header </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">nav </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">title </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">text </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">color</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">blue</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">container </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">header </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">nav </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">box </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">color</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">blue</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">border</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> 1</span><span style="color:#A6ACCD;">px</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">solid</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">grey</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>**\u6837\u5F0F\u6C61\u67D3 **\u95EE\u9898\u3002\u5982\u679C\u51FA\u73B0\u540C\u6837\u7684\u7C7B\u540D\uFF0C\u5F88\u5BB9\u6613\u9020\u6210\u4E0D\u540C\u7684\u6837\u5F0F\u4E92\u76F8\u8986\u76D6\u548C\u6C61\u67D3\u3002</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// a.css</span></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">container </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">color</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">red</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// b.css</span></span>
<span class="line"><span style="color:#676E95;">// \u5F88\u6709\u53EF\u80FD\u8986\u76D6 a.css \u7684\u6837\u5F0F\uFF01</span></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">container </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">color</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">blue</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><strong>\u6D4F\u89C8\u5668\u517C\u5BB9</strong> \u95EE\u9898\u3002\u4E3A\u4E86\u517C\u5BB9\u4E0D\u540C\u7684\u6D4F\u89C8\u5668\uFF0C\u6211\u4EEC\u9700\u8981\u5BF9\u4E00\u4E9B\u5C5E\u6027(\u5982<code>transition</code>)\u52A0\u4E0A\u4E0D\u540C\u7684\u6D4F\u89C8\u5668\u524D\u7F00\uFF0C\u6BD4\u5982 <code>-webkit-</code>\u3001<code>-moz-</code>\u3001<code>-ms-</code>\u3001<code>-o-</code>\uFF0C\u610F\u5473\u7740\u5F00\u53D1\u8005\u8981\u9488\u5BF9\u540C\u4E00\u4E2A\u6837\u5F0F\u5C5E\u6027\u5199\u5F88\u591A\u7684\u5197\u4F59\u4EE3\u7801\u3002</p><p>\u6253\u5305\u540E\u7684 <strong>\u4EE3\u7801\u4F53\u79EF</strong> \u95EE\u9898\u3002\u5982\u679C\u4E0D\u7528\u4EFB\u4F55\u7684 CSS \u5DE5\u7A0B\u5316\u65B9\u6848\uFF0C\u6240\u6709\u7684 CSS \u4EE3\u7801\u90FD\u5C06\u6253\u5305\u5230\u4EA7\u7269\u4E2D\uFF0C\u5373\u4F7F\u6709\u90E8\u5206\u6837\u5F0F\u5E76\u6CA1\u6709\u5728\u4EE3\u7801\u4E2D\u4F7F\u7528\uFF0C\u5BFC\u81F4\u4EA7\u7269\u4F53\u79EF\u8FC7\u5927\u3002</p><p>\u9488\u5BF9\u5982\u4E0A\u539F\u751F CSS \u7684\u75DB\u70B9\uFF0C\u793E\u533A\u4E2D\u8BDE\u751F\u4E86\u4E0D\u5C11\u89E3\u51B3\u65B9\u6848\uFF0C\u5E38\u89C1\u7684\u6709 5 \u7C7B\u3002</p><ul><li><code>CSS \u9884\u5904\u7406\u5668</code>\uFF1A\u4E3B\u6D41\u7684\u5305\u62EC <code>Sass/Scss</code>\u3001<code>Less</code> \u548C <code>Stylus</code>\u3002\u8FD9\u4E9B\u65B9\u6848\u5404\u81EA\u5B9A\u4E49\u4E86\u4E00\u5957\u8BED\u6CD5\uFF0C\u8BA9 CSS \u4E5F\u80FD\u4F7F\u7528\u5D4C\u5957\u89C4\u5219\uFF0C\u751A\u81F3\u80FD\u50CF\u7F16\u7A0B\u8BED\u8A00\u4E00\u6837\u5B9A\u4E49\u53D8\u91CF\u3001\u5199\u6761\u4EF6\u5224\u65AD\u548C\u5FAA\u73AF\u8BED\u53E5\uFF0C\u5927\u5927\u589E\u5F3A\u4E86\u6837\u5F0F\u8BED\u8A00\u7684\u7075\u6D3B\u6027\uFF0C\u89E3\u51B3\u539F\u751F CSS \u7684 <strong>\u5F00\u53D1\u4F53\u9A8C\u95EE\u9898</strong>\uFF1B</li><li><code>CSS Modules</code>\uFF1A\u80FD\u5C06 CSS \u7C7B\u540D\u5904\u7406\u6210\u54C8\u5E0C\u503C\uFF0C\u8FD9\u6837\u5C31\u53EF\u4EE5\u907F\u514D\u540C\u540D\u7684\u60C5\u51B5\u4E0B <strong>\u6837\u5F0F\u6C61\u67D3</strong> \u7684\u95EE\u9898\uFF1B</li><li>CSS \u540E\u5904\u7406\u5668 <code>PostCSS</code>\uFF0C\u7528\u6765\u89E3\u6790\u548C\u5904\u7406 CSS \u4EE3\u7801\uFF0C\u53EF\u4EE5\u5B9E\u73B0\u7684\u529F\u80FD\u975E\u5E38\u4E30\u5BCC\uFF0C\u6BD4\u5982\u5C06 <code>px</code> \u8F6C\u6362\u4E3A <code>rem</code>\u3001\u6839\u636E\u76EE\u6807\u6D4F\u89C8\u5668\u60C5\u51B5\u81EA\u52A8\u52A0\u4E0A\u7C7B\u4F3C\u4E8E <code>--moz--</code>\u3001<code>-o-</code> \u7684\u5C5E\u6027\u524D\u7F00\u7B49\u7B49\uFF1B</li><li><code>CSS in JS</code> \u65B9\u6848\uFF0C\u4E3B\u6D41\u7684\u5305\u62EC <code>emotion</code>\u3001<code>styled-components</code> \u7B49\u7B49\uFF0C\u987E\u540D\u601D\u4E49\uFF0C\u8FD9\u7C7B\u65B9\u6848\u53EF\u4EE5\u5B9E\u73B0\u76F4\u63A5\u5728 JS \u4E2D\u5199\u6837\u5F0F\u4EE3\u7801\uFF0C\u57FA\u672C\u5305\u542B <code>CSS \u9884\u5904\u7406\u5668</code> \u548C <code>CSS Modules</code> \u7684\u5404\u9879\u4F18\u70B9\uFF0C\u975E\u5E38\u7075\u6D3B\uFF0C\u89E3\u51B3\u4E86\u5F00\u53D1\u4F53\u9A8C\u548C\u5168\u5C40\u6837\u5F0F\u6C61\u67D3\u7684\u95EE\u9898\uFF1B</li><li>CSS \u539F\u5B50\u5316\u6846\u67B6\uFF0C\u5982 <code>Tailwind CSS</code>\u3001<code>Windi CSS</code>\uFF0C\u901A\u8FC7\u7C7B\u540D\u6765\u6307\u5B9A\u6837\u5F0F\uFF0C\u5927\u5927\u7B80\u5316\u4E86\u6837\u5F0F\u5199\u6CD5\uFF0C\u63D0\u9AD8\u4E86\u6837\u5F0F\u5F00\u53D1\u7684\u6548\u7387\uFF0C\u4E3B\u8981\u89E3\u51B3\u4E86\u539F\u751F CSS <strong>\u5F00\u53D1\u4F53\u9A8C</strong>\u7684\u95EE\u9898\u3002</li></ul><p>\u4E0D\u8FC7\uFF0C\u5404\u79CD\u65B9\u6848\u6CA1\u6709\u5B70\u4F18\u5B70\u52A3\uFF0C\u5404\u81EA\u89E3\u51B3\u7684\u65B9\u6848\u6709\u91CD\u53E0\u7684\u90E8\u5206\uFF0C\u4F46\u4E5F\u6709\u4E00\u5B9A\u7684\u5DEE\u5F02\uFF0C\u5927\u5BB6\u53EF\u4EE5\u6839\u636E\u81EA\u5DF1\u9879\u76EE\u7684\u75DB\u70B9\u6765\u5F15\u5165\u3002</p><h3 id="css-\u9884\u5904\u7406\u5668" tabindex="-1">CSS \u9884\u5904\u7406\u5668 <a class="header-anchor" href="#css-\u9884\u5904\u7406\u5668" aria-hidden="true">#</a></h3><p>Vite \u672C\u8EAB\u5BF9 CSS \u5404\u79CD\u9884\u5904\u7406\u5668\u8BED\u8A00(<code>Sass/Scss</code>\u3001<code>Less</code>\u548C<code>Stylus</code>)\u505A\u4E86\u5185\u7F6E\u652F\u6301\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C\u5373\u4F7F\u4F60\u4E0D\u7ECF\u8FC7\u4EFB\u4F55\u7684\u914D\u7F6E\u4E5F\u53EF\u4EE5\u76F4\u63A5\u4F7F\u7528\u5404\u79CD CSS \u9884\u5904\u7406\u5668\u3002\u6211\u4EEC\u4EE5 <code>Sass/Scss</code> \u4E3A\u4F8B\uFF0C\u6765\u5177\u4F53\u611F\u53D7\u4E00\u4E0B Vite \u7684 <code>\u96F6\u914D\u7F6E</code> \u7ED9\u6211\u4EEC\u5E26\u6765\u7684\u4FBF\u5229\u3002</p><p>\u7531\u4E8E Vite \u5E95\u5C42\u4F1A\u8C03\u7528 CSS \u9884\u5904\u7406\u5668\u7684\u5B98\u65B9\u5E93\u8FDB\u884C\u7F16\u8BD1\uFF0C\u800C Vite \u4E3A\u4E86\u5B9E\u73B0\u6309\u9700\u52A0\u8F7D\uFF0C\u5E76\u6CA1\u6709\u5185\u7F6E\u8FD9\u4E9B\u5DE5\u5177\u5E93\uFF0C\u800C\u662F\u8BA9\u7528\u6237\u6839\u636E\u9700\u8981\u5B89\u88C5\u3002\u56E0\u6B64\uFF0C\u6211\u4EEC\u9996\u5148\u5B89\u88C5 Sass \u7684\u5B98\u65B9\u5E93\uFF0C\u5B89\u88C5\u547D\u4EE4\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i sass </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\uFF0C\u5728\u4E0A\u4E00\u8282\u521D\u59CB\u5316\u540E\u7684\u9879\u76EE\u4E2D\u65B0\u5EFA <code>src/components/Header</code> \u76EE\u5F55\uFF0C\u5E76\u4E14\u5206\u522B\u65B0\u5EFA<code>index.tsx</code> \u548C <code>index.scss</code>\u6587\u4EF6\uFF0C\u4EE3\u7801\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// index.tsx</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./index.scss</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Header</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">header</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">This is Header</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// index.scss</span></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">header </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">color</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">red</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u6837\u5C31\u5B8C\u6210\u4E86\u4E00\u4E2A\u6700\u7B80\u5355\u7684 demo \u7EC4\u4EF6\u3002\u63A5\u7740\u6211\u4EEC\u5728 <code>App.tsx</code> \u5E94\u7528\u8FD9\u4E2A\u7EC4\u4EF6:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">useState</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> logo </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./logo.svg</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./App.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Header</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./components/Header</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">App</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">count</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">setCount</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">useState</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">App</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">header</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">App-header</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Header</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">       	// ...</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">header</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> App</span></span>
<span class="line"></span></code></pre></div><p>\u73B0\u5728\u4F60\u53EF\u4EE5\u6267\u884C<code>pnpm run dev</code>\uFF0C\u7136\u540E\u5230\u6D4F\u89C8\u5668\u4E0A\u67E5\u770B\u6548\u679C\u3002\u63A5\u4E0B\u6765\u6211\u4EEC\u5C01\u88C5\u4E00\u4E2A\u5168\u5C40\u7684\u4E3B\u9898\u8272\uFF0C\u65B0\u5EFA<code>src/variable.scss</code>\u6587\u4EF6\uFF0C\u5185\u5BB9\u5982\u4E0B:</p><div class="language-scss"><button class="copy"></button><span class="lang">scss</span><pre><code><span class="line"><span style="color:#676E95;">// variable.scss</span></span>
<span class="line"><span style="color:#A6ACCD;">$theme-color</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> red</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\uFF0C\u6211\u4EEC\u5728\u539F\u6765 Header \u7EC4\u4EF6\u7684\u6837\u5F0F\u4E2D\u5E94\u7528\u8FD9\u4E2A\u53D8\u91CF:</p><div class="language-scss"><button class="copy"></button><span class="lang">scss</span><pre><code><span class="line"><span style="color:#89DDFF;">@import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../../variable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">header</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">color</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> $theme-color</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u56DE\u5230\u6D4F\u89C8\u5668\u8BBF\u95EE\u9875\u9762\uFF0C\u53EF\u4EE5\u770B\u5230\u6837\u5F0F\u4F9D\u7136\u751F\u6548\u3002\u4F60\u53EF\u80FD\u4F1A\u6CE8\u610F\u5230\uFF0C\u6BCF\u6B21\u8981\u4F7F\u7528<code>$theme-color</code>\u5C5E\u6027\u7684\u65F6\u5019\u6211\u4EEC\u90FD\u9700\u8981\u624B\u52A8\u5F15\u5165<code>variable.scss</code>\u6587\u4EF6\uFF0C\u90A3\u6709\u6CA1\u6709\u81EA\u52A8\u5F15\u5165\u7684\u65B9\u6848\u5462\uFF1F\u8FD9\u5C31\u9700\u8981\u5728 Vite \u4E2D\u8FDB\u884C\u4E00\u4E9B\u81EA\u5B9A\u4E49\u914D\u7F6E\u4E86\uFF0C\u5728\u914D\u7F6E\u6587\u4EF6\u4E2D\u589E\u52A0\u5982\u4E0B\u7684\u5185\u5BB9:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defineConfig</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">normalizePath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;">// \u5982\u679C\u7C7B\u578B\u62A5\u9519\uFF0C\u9700\u8981\u5B89\u88C5 @types/node: pnpm i @types/node -D</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> path </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">path</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> react </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@vitejs/plugin-react</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u5168\u5C40 scss \u6587\u4EF6\u7684\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#676E95;">// \u7528 normalizePath \u89E3\u51B3 window \u4E0B\u7684\u8DEF\u5F84\u95EE\u9898</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> variablePath </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">normalizePath</span><span style="color:#A6ACCD;">(path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./src/variable.scss</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// https://vitejs.dev/config/</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">root</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#A6ACCD;">(__dirname</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">react</span><span style="color:#A6ACCD;">()]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">css</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">preprocessorOptions</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">scss</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// additionalData \u7684\u5185\u5BB9\u4F1A\u5728\u6BCF\u4E2A scss \u6587\u4EF6\u7684\u5F00\u5934\u81EA\u52A8\u6CE8\u5165</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">additionalData</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">@import &quot;</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">variablePath</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&quot;;</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>\u73B0\u5728\u4F60\u53EF\u4EE5\u76F4\u63A5\u5728\u6587\u4EF6\u4E2D\u4F7F\u7528\u5168\u5C40\u6587\u4EF6\u7684\u53D8\u91CF\uFF0C\u76F8\u5F53\u4E8E\u4E4B\u524D\u624B\u52A8\u5F15\u5165\u7684\u65B9\u5F0F\u663E\u7136\u65B9\u4FBF\u4E86\u8BB8\u591A:</p><div class="language-scss"><button class="copy"></button><span class="lang">scss</span><pre><code><span class="line"><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">header</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">color</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> $theme-color</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u540C\u6837\u7684\uFF0C\u4F60\u53EF\u4EE5\u5BF9 <code>less</code>\u548C<code>stylus</code>\u8FDB\u884C\u4E00\u4E9B\u80FD\u529B\u7684\u914D\u7F6E\uFF0C\u5982\u679C\u6709\u9700\u8981\u4F60\u53EF\u4EE5\u53BB\u4E0B\u9762\u7684\u5B98\u65B9\u6587\u6863\u4E2D\u67E5\u9605\u66F4\u591A\u7684\u914D\u7F6E\u9879:</p><ul><li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fsass-lang.com%2Fdocumentation%2Fjs-api%2Fmodules%23render" target="_blank" rel="noreferrer">Sass</a></li><li><a href="https://link.juejin.cn/?target=https%3A%2F%2Flesscss.org%2Fusage%2F%23less-options" target="_blank" rel="noreferrer">Less</a></li><li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fstylus-lang.com%2Fdocs%2Fjs.html" target="_blank" rel="noreferrer">Stylus</a></li></ul><h3 id="css-modules" tabindex="-1">CSS Modules <a class="header-anchor" href="#css-modules" aria-hidden="true">#</a></h3><p>CSS Modules \u5728 Vite \u4E5F\u662F\u4E00\u4E2A\u5F00\u7BB1\u5373\u7528\u7684\u80FD\u529B\uFF0CVite \u4F1A\u5BF9\u540E\u7F00\u5E26\u6709<code>.module</code>\u7684\u6837\u5F0F\u6587\u4EF6\u81EA\u52A8\u5E94\u7528 CSS Modules\u3002\u63A5\u4E0B\u6765\u6211\u4EEC\u901A\u8FC7\u4E00\u4E2A\u7B80\u5355\u7684\u4F8B\u5B50\u6765\u4F7F\u7528\u8FD9\u4E2A\u529F\u80FD\u3002</p><p>\u9996\u5148\uFF0C\u5C06 Header \u7EC4\u4EF6\u4E2D\u7684 <code>index.scss</code> \u66F4\u540D\u4E3A <code>index.module.scss</code>\uFF0C\u7136\u540E\u7A0D\u5FAE\u6539\u52A8\u4E00\u4E0B <code>index.tsx</code> \u7684\u5185\u5BB9\uFF0C\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// index.tsx</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> styles </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./index.module.scss</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Header</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">={</span><span style="color:#A6ACCD;">styles</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">header</span><span style="color:#89DDFF;">}&gt;</span><span style="color:#A6ACCD;">This is Header</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>\u73B0\u5728\u6253\u5F00\u6D4F\u89C8\u5668\uFF0C\u53EF\u4EE5\u770B\u89C1 p \u6807\u7B7E\u7684\u7C7B\u540D\u5DF2\u7ECF\u88AB\u5904\u7406\u6210\u4E86\u54C8\u5E0C\u503C\u7684\u5F62\u5F0F:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_header_gxlcr_1 </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">color</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">red</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u8BF4\u660E\u73B0\u5728 CSS Modules \u5DF2\u7ECF\u6B63\u5F0F\u751F\u6548\u4E86\uFF01\u540C\u6837\u7684\uFF0C\u4F60\u4E5F\u53EF\u4EE5\u5728\u914D\u7F6E\u6587\u4EF6\u4E2D\u7684<code>css.modules</code>\u9009\u9879\u6765\u914D\u7F6E CSS Modules \u7684\u529F\u80FD\uFF0C\u6BD4\u5982\u4E0B\u9762\u8FD9\u4E2A\u4F8B\u5B50:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defineConfig</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">normalizePath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> path </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">path</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> react </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@vitejs/plugin-react</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> variablePath </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">normalizePath</span><span style="color:#A6ACCD;">(path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./src/variable.scss</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// https://vitejs.dev/config/</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">root</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#A6ACCD;">(__dirname</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">react</span><span style="color:#A6ACCD;">()]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">css</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">preprocessorOptions</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">scss</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// additionalData \u7684\u5185\u5BB9\u4F1A\u5728\u6BCF\u4E2A scss \u6587\u4EF6\u7684\u5F00\u5934\u81EA\u52A8\u6CE8\u5165</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">additionalData</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">@import &quot;</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">variablePath</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&quot;;</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">modules</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u4E00\u822C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7 generateScopedName \u5C5E\u6027\u6765\u5BF9\u751F\u6210\u7684\u7C7B\u540D\u8FDB\u884C\u81EA\u5B9A\u4E49</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u5176\u4E2D\uFF0Cname \u8868\u793A\u5F53\u524D\u6587\u4EF6\u540D\uFF0Clocal \u8868\u793A\u7C7B\u540D</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">generateScopedName</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">[name]__[local]___[hash:base64:5]</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>\u518D\u6B21\u8BBF\u95EE\u9875\u9762\uFF0C\u6211\u4EEC\u53EF\u4EE5\u53D1\u73B0\u521A\u624D\u7684\u7C7B\u540D\u5DF2\u7ECF\u53D8\u6210\u4E86\u6211\u4EEC\u81EA\u5B9A\u4E49\u7684\u5F62\u5F0F:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// html</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">index-module__header___IdNfn</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">This is Header</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// css</span></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">index</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">module__header___IdNfn </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">color</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">red</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u662F\u4E00\u4E2A CSS Modules \u4E2D\u5F88\u5E38\u89C1\u7684\u914D\u7F6E\uFF0C\u5BF9\u5F00\u53D1\u65F6\u7684\u8C03\u8BD5\u975E\u5E38\u6709\u7528\u3002\u5176\u5B83\u7684\u4E00\u4E9B\u914D\u7F6E\u9879\u4E0D\u592A\u5E38\u7528\uFF0C\u5927\u5BB6\u53EF\u4EE5\u53BB\u8FD9\u4E2A <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fmadyankin%2Fpostcss-modules" target="_blank" rel="noreferrer">\u5730\u5740</a> \u8FDB\u884C\u67E5\u9605\u3002</p><h3 id="postcss" tabindex="-1">PostCSS <a class="header-anchor" href="#postcss" aria-hidden="true">#</a></h3><p>\u4E00\u822C\u4F60\u53EF\u4EE5\u901A\u8FC7 <code>postcss.config.js</code> \u6765\u914D\u7F6E postcss \uFF0C\u4E0D\u8FC7\u5728 Vite \u914D\u7F6E\u6587\u4EF6\u4E2D\u5DF2\u7ECF\u63D0\u4F9B\u4E86 PostCSS \u7684\u914D\u7F6E\u5165\u53E3\uFF0C\u6211\u4EEC\u53EF\u4EE5\u76F4\u63A5\u5728 Vite \u914D\u7F6E\u6587\u4EF6\u4E2D\u8FDB\u884C\u64CD\u4F5C\u3002</p><p>\u9996\u5148\uFF0C\u6211\u4EEC\u6765\u5B89\u88C5\u4E00\u4E2A\u5E38\u7528\u7684 PostCSS \u63D2\u4EF6 \u2014\u2014 <code>autoprefixer</code>:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i autoprefixer postcss </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u4E2A\u63D2\u4EF6\u4E3B\u8981\u7528\u6765\u81EA\u52A8\u4E3A\u4E0D\u540C\u7684\u76EE\u6807\u6D4F\u89C8\u5668\u6DFB\u52A0\u6837\u5F0F\u524D\u7F00\uFF0C\u89E3\u51B3\u7684\u662F\u6D4F\u89C8\u5668\u517C\u5BB9\u6027\u7684\u95EE\u9898\u3002\u63A5\u4E0B\u6765\u8BA9\u6211\u4EEC\u5728 Vite \u4E2D\u63A5\u5165\u8FD9\u4E2A\u63D2\u4EF6:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defineConfig</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">normalizePath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> path </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">path</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> react </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@vitejs/plugin-react</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> autoprefixer </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">autoprefixer</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> variablePath </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">normalizePath</span><span style="color:#A6ACCD;">(path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./src/variable.scss</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// https://vitejs.dev/config/</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">root</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#A6ACCD;">(__dirname</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">react</span><span style="color:#A6ACCD;">()]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">css</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;"> 		</span><span style="color:#676E95;">// ...</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u8FDB\u884C PostCSS \u914D\u7F6E</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">postcss</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">autoprefixer</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;">// \u6307\u5B9A\u76EE\u6807\u6D4F\u89C8\u5668</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">overrideBrowserslist</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Chrome &gt; 40</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ff &gt; 31</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ie 11</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">      ]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>\u914D\u7F6E\u5B8C\u6210\u540E\uFF0C\u6211\u4EEC\u56DE\u5230 Header \u7EC4\u4EF6\u7684\u6837\u5F0F\u6587\u4EF6\u4E2D\u6DFB\u52A0\u4E00\u4E2A\u65B0\u7684 CSS \u5C5E\u6027:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">header </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">color</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">$theme</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">color</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">text</span><span style="color:#89DDFF;">-</span><span style="color:#FFCB6B;">decoration</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dashed</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u4F60\u53EF\u4EE5\u5237\u65B0\u6D4F\u89C8\u5668\u6216\u8005\u6267\u884C<code>pnpm run build</code>\u547D\u4EE4\u8FDB\u884C\u6253\u5305\uFF0C\u53EF\u4EE5\u770B\u5230\u4EA7\u7269\u4E2D\u81EA\u52A8\u8865\u4E0A\u4E86\u6D4F\u89C8\u5668\u524D\u7F00\uFF0C\u5982:</p><div class="language-css"><button class="copy"></button><span class="lang">css</span><pre><code><span class="line"><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">index-module__header___IdNfn</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#B2CCD6;">color</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> red</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">-webkit-text-decoration</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> dashed</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">-moz-text-decoration</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> dashed</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#B2CCD6;">text-decoration</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> dashed</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u7531\u4E8E\u6709 CSS \u4EE3\u7801\u7684 AST (\u62BD\u8C61\u8BED\u6CD5\u6811)\u89E3\u6790\u80FD\u529B\uFF0CPostCSS \u53EF\u4EE5\u505A\u7684\u4E8B\u60C5\u975E\u5E38\u591A\uFF0C\u751A\u81F3\u80FD\u5B9E\u73B0 CSS \u9884\u5904\u7406\u5668\u8BED\u6CD5\u548C CSS Modules\uFF0C\u793E\u533A\u5F53\u4E2D\u4E5F\u6709\u4E0D\u5C11\u7684 PostCSS \u63D2\u4EF6\uFF0C\u9664\u4E86\u521A\u521A\u63D0\u5230\u7684 <code>autoprefixer</code> \u63D2\u4EF6\uFF0C\u5E38\u89C1\u7684\u63D2\u4EF6\u8FD8\u5305\u62EC:</p><ul><li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fcuth%2Fpostcss-pxtorem" target="_blank" rel="noreferrer">postcss-pxtorem</a>\uFF1A \u7528\u6765\u5C06 px \u8F6C\u6362\u4E3A rem \u5355\u4F4D\uFF0C\u5728\u9002\u914D\u79FB\u52A8\u7AEF\u7684\u573A\u666F\u4E0B\u5F88\u5E38\u7528\u3002</li><li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fcsstools%2Fpostcss-preset-env" target="_blank" rel="noreferrer">postcss-preset-env</a>: \u901A\u8FC7\u5B83\uFF0C\u4F60\u53EF\u4EE5\u7F16\u5199\u6700\u65B0\u7684 CSS \u8BED\u6CD5\uFF0C\u4E0D\u7528\u62C5\u5FC3\u517C\u5BB9\u6027\u95EE\u9898\u3002</li><li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fcssnano%2Fcssnano" target="_blank" rel="noreferrer">cssnano</a>: \u4E3B\u8981\u7528\u6765\u538B\u7F29 CSS \u4EE3\u7801\uFF0C\u8DDF\u5E38\u89C4\u7684\u4EE3\u7801\u538B\u7F29\u5DE5\u5177\u4E0D\u4E00\u6837\uFF0C\u5B83\u80FD\u505A\u5F97\u66F4\u52A0\u667A\u80FD\uFF0C\u6BD4\u5982\u63D0\u53D6\u4E00\u4E9B\u516C\u5171\u6837\u5F0F\u8FDB\u884C\u590D\u7528\u3001\u7F29\u77ED\u4E00\u4E9B\u5E38\u89C1\u7684\u5C5E\u6027\u503C\u7B49\u7B49\u3002</li></ul><p>\u5173\u4E8E PostCSS \u63D2\u4EF6\uFF0C\u8FD9\u91CC\u8FD8\u7ED9\u5927\u5BB6\u63A8\u8350\u4E00\u4E2A\u7AD9\u70B9\uFF1A<a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.postcss.parts%2F" target="_blank" rel="noreferrer">www.postcss.parts/</a> \uFF0C\u4F60\u53EF\u4EE5\u53BB\u91CC\u9762\u63A2\u7D22\u66F4\u591A\u7684\u5185\u5BB9\u3002</p><h3 id="css-in-js" tabindex="-1">CSS In JS <a class="header-anchor" href="#css-in-js" aria-hidden="true">#</a></h3><p>\u793E\u533A\u4E2D\u6709\u4E24\u6B3E\u4E3B\u6D41\u7684 <code>CSS In JS</code> \u65B9\u6848: <code>styled-components</code> \u548C <code>emotion</code>\u3002</p><p>\u5BF9\u4E8E CSS In JS \u65B9\u6848\uFF0C\u5728\u6784\u5EFA\u4FA7\u6211\u4EEC\u9700\u8981\u8003\u8651 <code>\u9009\u62E9\u5668\u547D\u540D\u95EE\u9898</code>\u3001<code>DCE</code>(Dead Code Elimination \u5373\u65E0\u7528\u4EE3\u7801\u5220\u9664)\u3001<code>\u4EE3\u7801\u538B\u7F29</code>\u3001<code>\u751F\u6210 SourceMap</code>\u3001<code>\u670D\u52A1\u7AEF\u6E32\u67D3(SSR)</code>\u7B49\u95EE\u9898\uFF0C\u800C <code>styled-components</code> \u548C <code>emotion</code> \u5DF2\u7ECF\u63D0\u4F9B\u4E86\u5BF9\u5E94\u7684 babel \u63D2\u4EF6\u6765\u89E3\u51B3\u8FD9\u4E9B\u95EE\u9898\uFF0C\u6211\u4EEC\u5728 Vite \u4E2D\u8981\u505A\u7684\u5C31\u662F\u96C6\u6210\u8FD9\u4E9B babel \u63D2\u4EF6\u3002</p><p>\u5177\u4F53\u6765\u8BF4\uFF0C\u4E0A\u8FF0\u7684\u4E24\u79CD\u4E3B\u6D41 CSS in JS \u65B9\u6848\u5728 Vite \u4E2D\u96C6\u6210\u65B9\u5F0F\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defineConfig</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> react </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@vitejs/plugin-react</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// https://vitejs.dev/config/</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">react</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">babel</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u52A0\u5165 babel \u63D2\u4EF6</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u4EE5\u4E0B\u63D2\u4EF6\u5305\u90FD\u9700\u8981\u63D0\u524D\u5B89\u88C5</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u5F53\u7136\uFF0C\u901A\u8FC7\u8FD9\u4E2A\u914D\u7F6E\u4F60\u4E5F\u53EF\u4EE5\u6DFB\u52A0\u5176\u5B83\u7684 Babel \u63D2\u4EF6</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;">// \u9002\u914D styled-component</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">babel-plugin-styled-components</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;">// \u9002\u914D emotion</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@emotion/babel-plugin</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        ]</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u6CE8\u610F: \u5BF9\u4E8E emotion\uFF0C\u9700\u8981\u5355\u72EC\u52A0\u4E0A\u8FD9\u4E2A\u914D\u7F6E</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u901A\u8FC7 \`@emotion/react\` \u5305\u7F16\u8BD1 emotion \u4E2D\u7684\u7279\u6B8A jsx \u8BED\u6CD5</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">jsxImportSource</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@emotion/react</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="css-\u539F\u5B50\u5316\u6846\u67B6" tabindex="-1">CSS \u539F\u5B50\u5316\u6846\u67B6 <a class="header-anchor" href="#css-\u539F\u5B50\u5316\u6846\u67B6" aria-hidden="true">#</a></h3><p>\u5728\u76EE\u524D\u7684\u793E\u533A\u5F53\u4E2D\uFF0CCSS \u539F\u5B50\u5316\u6846\u67B6\u4E3B\u8981\u5305\u62EC <code>Tailwind CSS</code> \u548C <code>Windi CSS</code>\u3002Windi CSS \u4F5C\u4E3A\u524D\u8005\u7684\u66FF\u6362\u65B9\u6848\uFF0C\u5B9E\u73B0\u4E86\u6309\u9700\u751F\u6210 CSS \u7C7B\u540D\u7684\u529F\u80FD\uFF0C\u5F00\u53D1\u73AF\u5883\u4E0B\u7684 CSS \u4EA7\u7269\u4F53\u79EF\u5927\u5927\u51CF\u5C11\uFF0C\u901F\u5EA6\u4E0A\u6BD4<code>Tailwind CSS v2</code>\u5FEB 20~100 \u500D\uFF01\u5F53\u7136\uFF0CTailwind CSS \u5728 v3 \u7248\u672C\u4E5F\u5F15\u5165 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fv2.tailwindcss.com%2Fdocs%2Fjust-in-time-mode" target="_blank" rel="noreferrer">JIT(\u5373\u65F6\u7F16\u8BD1)</a> \u7684\u529F\u80FD\uFF0C\u89E3\u51B3\u4E86\u5F00\u53D1\u73AF\u5883\u4E0B CSS \u4EA7\u7269\u4F53\u79EF\u5E9E\u5927\u7684\u95EE\u9898\u3002\u63A5\u4E0B\u6765\u6211\u4EEC\u5C06\u8FD9\u4E24\u4E2A\u65B9\u6848\u5206\u522B\u63A5\u5165\u5230 Vite \u4E2D\uFF0C\u5728\u5B9E\u9645\u7684\u9879\u76EE\u4E2D\u4F60\u53EA\u9700\u8981\u4F7F\u7528\u5176\u4E2D\u4E00\u79CD\u5C31\u53EF\u4EE5\u4E86\u3002</p><h4 id="windi-css" tabindex="-1">Windi CSS <a class="header-anchor" href="#windi-css" aria-hidden="true">#</a></h4><p>\u9996\u5148\u5B89\u88C5 <code>windicss</code> \u53CA\u5BF9\u5E94\u7684 Vite \u63D2\u4EF6:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i windicss vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">windicss </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"></span></code></pre></div><p>\u968F\u540E\u6211\u4EEC\u5728\u914D\u7F6E\u6587\u4EF6\u4E2D\u6765\u4F7F\u7528\u5B83:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// ...</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> windi </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-windicss</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// https://vitejs.dev/config/</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">root</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#A6ACCD;">(__dirname</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// ...</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">react</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">windi</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>\u63A5\u7740\u8981\u6CE8\u610F\u5728 <code>src/main.tsx</code> \u4E2D\u5F15\u5165\u4E00\u4E2A\u5FC5\u9700\u7684 import \u8BED\u53E5:</p><div class="language-jsx"><button class="copy"></button><span class="lang">jsx</span><pre><code><span class="line"><span style="color:#676E95;">// \u7528\u6765\u6CE8\u5165 Windi CSS \u6240\u9700\u8981\u7684\u6837\u5F0F</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">virtual:windi.css</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">ReactDOM</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createRoot</span><span style="color:#A6ACCD;">(document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">React.StrictMode</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">App</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#FFCB6B;">React.StrictMode</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u6837\u6211\u4EEC\u5C31\u5B8C\u6210\u4E86 Windi CSS \u5728 Vite \u4E2D\u7684\u63A5\u5165\uFF0C\u63A5\u4E0B\u6765\u6211\u4EEC\u5728 Header \u7EC4\u4EF6\u4E2D\u6765\u6D4B\u8BD5\uFF0C\u7EC4\u4EF6\u4EE3\u7801\u4FEE\u6539\u5982\u4E0B:</p><blockquote><p>\u6837\u5F0F\u751F\u6548\u7684\u524D\u63D0\u662F index.html \u5FC5\u987B\u518D \u6839\u76EE\u5F55\uFF0C\u4E0D\u80FD\u5728 src \u76EE\u5F55\u4E0B\u3002</p></blockquote><div class="language-jsx"><button class="copy"></button><span class="lang">jsx</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> styles </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./index.module.scss</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">devDependencies</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../../../package.json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Header</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">p-20px text-center</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">={</span><span style="color:#A6ACCD;"> styles</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">header </span><span style="color:#89DDFF;">}&gt;</span><span style="color:#A6ACCD;">This is Header</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">font-bold text-2xl mb-2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        vite version\uFF1A</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> devDependencies</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">vite </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>\u9664\u4E86\u672C\u8EAB\u7684\u539F\u5B50\u5316 CSS \u80FD\u529B\uFF0CWindi CSS \u8FD8\u6709\u4E00\u4E9B\u975E\u5E38\u597D\u7528\u7684\u9AD8\u7EA7\u529F\u80FD\uFF0C\u4F8B\u5982 <strong>attributify</strong> \u548C <strong>shortcuts</strong>\u3002</p><p>\u8981\u5F00\u542F\u8FD9\u4E24\u4E2A\u529F\u80FD\uFF0C\u6211\u4EEC\u9700\u8981\u5728\u9879\u76EE\u6839\u76EE\u5F55\u65B0\u5EFA <code>windi.config.ts</code>\uFF0C\u914D\u7F6E\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defineConfig</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite-plugin-windicss</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5F00\u542F attributify</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">attributify</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u9996\u5148\u6211\u4EEC\u6765\u770B\u770B <code>attributify</code>\uFF0C\u7FFB\u8BD1\u8FC7\u6765\u5C31\u662F <code>\u5C5E\u6027\u5316</code>\uFF0C\u4E5F\u5C31\u662F\u8BF4\u6211\u4EEC\u53EF\u4EE5\u7528 props \u7684\u65B9\u5F0F\u53BB\u5B9A\u4E49\u6837\u5F0F\u5C5E\u6027\uFF0C\u5982\u4E0B\u6240\u793A:</p><div class="language-jsx"><button class="copy"></button><span class="lang">jsx</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;"> </span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#C792EA;">bg</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">blue-400 hover:blue-500 dark:blue-500 dark:hover:blue-600</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#C792EA;">text</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sm white</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#C792EA;">font</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">mono light</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#C792EA;">p</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">y-2 x-4</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#C792EA;">border</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2 rounded blue-200</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  Button</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u6837\u7684\u5F00\u53D1\u65B9\u5F0F\u4E0D\u4EC5\u7701\u53BB\u4E86\u7E41\u7410\u7684 className \u5185\u5BB9\uFF0C\u8FD8\u52A0\u5F3A\u4E86\u8BED\u4E49\u5316\uFF0C\u8BA9\u4EE3\u7801\u66F4\u6613\u7EF4\u62A4\uFF0C\u5927\u5927\u63D0\u5347\u4E86\u5F00\u53D1\u4F53\u9A8C\u3002</p><p>\u4E0D\u8FC7\u4F7F\u7528 <code>attributify</code> \u7684\u65F6\u5019\u9700\u8981\u6CE8\u610F\u7C7B\u578B\u95EE\u9898\uFF0C\u4F60\u9700\u8981\u6DFB\u52A0<code>types/shim.d.ts</code>\u6765\u589E\u52A0\u7C7B\u578B\u58F0\u660E\uFF0C\u4EE5\u9632\u7C7B\u578B\u62A5\u9519:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// src/types/shim.d.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">AttributifyAttributes</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">windicss/types/jsx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">declare</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">module</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">type</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">HTMLAttributes</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">AttributifyAttributes</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>shortcuts</code> \u7528\u6765\u5C01\u88C5\u4E00\u7CFB\u5217\u7684\u539F\u5B50\u5316\u80FD\u529B\uFF0C\u5C24\u5176\u662F\u4E00\u4E9B\u5E38\u89C1\u7684\u7C7B\u540D\u96C6\u5408\uFF0C\u6211\u4EEC\u5728 <code>windi.config.ts </code>\u6765\u914D\u7F6E\u5B83:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defineConfig</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite-plugin-windicss</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5F00\u542F attributify</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">attributify</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">shortcuts</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">flex-c</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">flex justify-center items-center</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u6BD4\u5982\u8FD9\u91CC\u5C01\u88C5\u4E86 <code>flex-c</code> \u7684\u7C7B\u540D\uFF0C\u63A5\u4E0B\u6765\u6211\u4EEC\u53EF\u4EE5\u5728\u4E1A\u52A1\u4EE3\u7801\u76F4\u63A5\u4F7F\u7528\u8FD9\u4E2A\u7C7B\u540D:</p><div class="language-jsx"><button class="copy"></button><span class="lang">jsx</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">flex-c</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;!--</span><span style="color:#A6ACCD;"> \u7B49\u540C\u4E8E\u4E0B\u9762\u8FD9\u6BB5 </span><span style="color:#89DDFF;">--&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">flex justify-center items-center</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><h4 id="tailwind-css" tabindex="-1">Tailwind CSS <a class="header-anchor" href="#tailwind-css" aria-hidden="true">#</a></h4><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u6765\u63A5\u5165 Tailwind CSS \u65B9\u6848\uFF0C\u4E3A\u4E86\u907F\u514D\u548C\u4E4B\u524D\u7684 Windi CSS \u6DF7\u6DC6\uFF0C\u5EFA\u8BAE\u4F60\u65B0\u8D77\u4E00\u4E2A Vite \u9879\u76EE\u3002</p><p>\u9996\u5148\u5B89\u88C5 <code>tailwindcss</code> \u53CA\u5176\u5FC5\u8981\u7684\u4F9D\u8D56 :</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm install </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D tailwindcss postcss autoprefixer</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\u65B0\u5EFA\u4E24\u4E2A\u914D\u7F6E\u6587\u4EF6 <code>tailwind.config.js</code> \u548C <code>postcss.config.js</code>:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// tailwind.config.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">content</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./index.html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./src/**/*.{vue,js,ts,jsx,tsx}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">theme</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">extend</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// postcss.config.js</span></span>
<span class="line"><span style="color:#676E95;">// \u4ECE\u4E2D\u4F60\u53EF\u4EE5\u770B\u5230\uFF0CTailwind CSS \u7684\u7F16\u8BD1\u80FD\u529B\u662F\u901A\u8FC7 PostCSS \u63D2\u4EF6\u5B9E\u73B0\u7684</span></span>
<span class="line"><span style="color:#676E95;">// \u800C Vite \u672C\u8EAB\u5185\u7F6E\u4E86 PostCSS\uFF0C\u56E0\u6B64\u53EF\u4EE5\u901A\u8FC7 PostCSS \u914D\u7F6E\u63A5\u5165 Tailwind CSS </span></span>
<span class="line"><span style="color:#676E95;">// \u6CE8\u610F: Vite \u914D\u7F6E\u6587\u4EF6\u4E2D\u5982\u679C\u6709 PostCSS \u914D\u7F6E\u7684\u60C5\u51B5\u4E0B\u4F1A\u8986\u76D6\u6389 postcss.config.js \u7684\u5185\u5BB9!</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">tailwindcss</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">autoprefixer</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u7740\u5728\u9879\u76EE\u7684\u5165\u53E3 CSS \u4E2D\u5F15\u5165\u5FC5\u8981\u7684\u6837\u677F\u4EE3\u7801:</p><div class="language-css"><button class="copy"></button><span class="lang">css</span><pre><code><span class="line"><span style="color:#89DDFF;">@tailwind</span><span style="color:#A6ACCD;"> base</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">@tailwind</span><span style="color:#A6ACCD;"> components</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">@tailwind</span><span style="color:#A6ACCD;"> utilities</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u73B0\u5728\uFF0C\u4F60\u5C31\u53EF\u4EE5\u5728\u9879\u76EE\u4E2D\u5B89\u5FC3\u5730\u4F7F\u7528 Tailwind \u6837\u5F0F\u4E86\uFF0C\u5982\u4E0B\u6240\u793A:</p><div class="language-jsx"><button class="copy"></button><span class="lang">jsx</span><pre><code><span class="line"><span style="color:#676E95;">// App.tsx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> logo </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./logo.svg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./App.css</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">App</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">header</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">App-header</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">img</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">={</span><span style="color:#A6ACCD;">logo</span><span style="color:#89DDFF;">} </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">w-20</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">alt</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">logo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">bg-red-400</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">Hello Vite + React!</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">header</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> App</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u5F53\u4F60\u542F\u52A8\u9879\u76EE\u4E4B\u540E\u5C31\u53EF\u4EE5\u770B\u5230 Tailwind CSS \u7684\u6837\u5F0F\u5DF2\u7ECF\u6B63\u5E38\u751F\u6548\u3002</p><h3 id="\u603B\u7ED3-1" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3-1" aria-hidden="true">#</a></h3><p>\u901A\u8FC7\u672C\u7BC7\u6587\u7AE0\u6211\u4EEC\u53EF\u4EE5\u638C\u63E1\u524D\u7AEF\u5DE5\u7A0B\u4E2D\u5404\u79CD\u6837\u5F0F\u65B9\u6848\u5728 Vite \u7684\u63A5\u5165\u65B9\u6CD5\u3002 \u8FD9\u4E9B\u6837\u5F0F\u65B9\u6848\u5305\u62EC\uFF0C\u5305\u62EC <code>CSS \u9884\u5904\u7406\u5668</code>\u3001<code>CSS Modules</code>\u3001<code>PostCSS</code>\u3001<code>CSS In JS</code> \u548C <code>CSS \u539F\u5B50\u5316\u6846\u67B6(Windi CSS)</code>\u3002</p><h2 id="lint-\u5DE5\u5177\u94FE\u914D\u7F6E" tabindex="-1">Lint \u5DE5\u5177\u94FE\u914D\u7F6E <a class="header-anchor" href="#lint-\u5DE5\u5177\u94FE\u914D\u7F6E" aria-hidden="true">#</a></h2><blockquote><p>\u4EE3\u7801\u4E0D\u4EC5\u662F\u8BA9\u673A\u5668\u770B\u7684\uFF0C\u5B83\u4E5F\u662F\u7ED9\u4EBA\u770B\u7684\u3002</p></blockquote><p>\u5728\u771F\u5B9E\u7684\u5DE5\u7A0B\u9879\u76EE\u4E2D\uFF0C\u5C24\u5176\u662F\u591A\u4EBA\u534F\u4F5C\u7684\u573A\u666F\u4E0B\uFF0C\u4EE3\u7801\u89C4\u8303\u5C31\u53D8\u5F97\u975E\u5E38\u91CD\u8981\u4E86\uFF0C\u5B83\u53EF\u4EE5\u7528\u6765\u7EDF\u4E00\u56E2\u961F\u4EE3\u7801\u98CE\u683C\uFF0C\u907F\u514D\u4E0D\u540C\u98CE\u683C\u7684\u4EE3\u7801\u6DF7\u6742\u5230\u4E00\u8D77\u96BE\u4EE5\u9605\u8BFB\uFF0C\u6709\u6548\u63D0\u9AD8<strong>\u4EE3\u7801\u8D28\u91CF</strong>\uFF0C\u751A\u81F3\u53EF\u4EE5\u5C06\u4E00\u4E9B<strong>\u8BED\u6CD5\u9519\u8BEF</strong>\u5728\u5F00\u53D1\u9636\u6BB5\u63D0\u524D\u89C4\u907F\u6389\u3002\u4F46\u4EC5\u6709\u89C4\u8303\u672C\u8EAB\u4E0D\u591F\uFF0C\u6211\u4EEC\u9700\u8981<strong>\u81EA\u52A8\u5316\u7684\u5DE5\u5177</strong>(\u5373<code>Lint \u5DE5\u5177</code>)\u6765\u4FDD\u8BC1\u89C4\u8303\u7684\u843D\u5730\uFF0C\u628A\u4EE3\u7801\u89C4\u8303\u68C0\u67E5(\u5305\u62EC<code>\u81EA\u52A8\u4FEE\u590D</code>)\u8FD9\u4EF6\u4E8B\u60C5\u4EA4\u7ED9\u673A\u5668\u5B8C\u6210\uFF0C\u5F00\u53D1\u8005\u53EA\u9700\u8981\u4E13\u6CE8\u5E94\u7528\u903B\u8F91\u672C\u8EAB\u3002</p><p>\u901A\u8FC7\u672C\u7BC7\u6587\u7AE0\uFF0C\u4F60\u4E0D\u4EC5\u80FD\u719F\u6089\u8BF8\u5982<code>ESLint</code>\u3001<code>Prettier</code>\u3001<code>Stylelint</code>\u548C<code>Commitlint</code> \u7B49\u8BF8\u591A\u4E3B\u6D41 Lint \u5DE5\u5177\u7684\u6982\u5FF5\u548C\u4F7F\u7528\uFF0C\u8FD8\u80FD\u914D\u5408<code>husky</code>\u3001<code>lint-staged</code>\u3001<code>VSCode \u63D2\u4EF6</code>\u548C<code>Vite \u751F\u6001</code>\u5728\u9879\u76EE\u4E2D\u96C6\u6210\u5B8C\u6574\u7684 Lint \u5DE5\u5177\u94FE\uFF0C\u642D\u5EFA\u8D77\u5B8C\u6574\u7684\u524D\u7AEF\u5F00\u53D1\u548C\u4EE3\u7801\u63D0\u4EA4\u5DE5\u4F5C\u6D41\uFF0C\u8FD9\u90E8\u5206\u5185\u5BB9\u867D\u7136\u548C Vite \u6CA1\u6709\u76F4\u63A5\u7684\u8054\u7CFB\uFF0C\u4F46\u4E5F\u662F Vite \u9879\u76EE\u642D\u5EFA\u4E2D\u975E\u5E38\u91CD\u8981\u7684\u4E00\u73AF\uFF0C\u662F\u524D\u7AEF\u5DE5\u7A0B\u5316\u7684\u5FC5\u5907\u77E5\u8BC6\u3002</p><h3 id="eslint" tabindex="-1">ESLint <a class="header-anchor" href="#eslint" aria-hidden="true">#</a></h3><h4 id="\u7B80\u4ECB" tabindex="-1">\u7B80\u4ECB <a class="header-anchor" href="#\u7B80\u4ECB" aria-hidden="true">#</a></h4><blockquote><p>ESLint \u662F\u5728 ECMAScript/JavaScript \u4EE3\u7801\u4E2D\u8BC6\u522B\u548C\u62A5\u544A\u6A21\u5F0F\u5339\u914D\u7684\u5DE5\u5177\uFF0C\u5B83\u7684\u76EE\u6807\u662F\u4FDD\u8BC1\u4EE3\u7801\u7684\u4E00\u81F4\u6027\u548C\u907F\u514D\u9519\u8BEF\u3002</p></blockquote><p>Eslint \u662F\u56FD\u5916\u7684\u524D\u7AEF\u5927\u725B <code>Nicholas C. Zakas</code> \u5728 2013 \u5E74\u53D1\u8D77\u7684\u4E00\u4E2A\u5F00\u6E90\u9879\u76EE\uFF0C\u6709\u4E00\u672C\u4E66\u88AB\u8A89\u4E3A\u524D\u7AEF\u754C\u7684&quot;\u5723\u7ECF&quot;\uFF0C\u53EB\u300AJavaScript \u9AD8\u7EA7\u7A0B\u5E8F\u8BBE\u8BA1\u300B(\u5373\u7EA2\u5B9D\u4E66)\uFF0C\u4ED6\u6B63\u662F\u8FD9\u672C\u4E66\u7684\u4F5C\u8005\u3002</p><p><code>Nicholas</code> \u5F53\u521D\u505A\u8FD9\u4E2A\u5F00\u6E90\u9879\u76EE\uFF0C\u5C31\u662F\u4E3A\u4E86\u6253\u9020\u4E00\u6B3E\u63D2\u4EF6\u5316\u7684 JavaScript \u4EE3\u7801\u9759\u6001\u68C0\u67E5\u5DE5\u5177\uFF0C\u901A\u8FC7\u89E3\u6790\u4EE3\u7801\u7684 AST \u6765\u5206\u6790\u4EE3\u7801\u683C\u5F0F\uFF0C\u68C0\u67E5\u4EE3\u7801\u7684\u98CE\u683C\u548C\u8D28\u91CF\u95EE\u9898\u3002\u73B0\u5728\uFF0CEslint \u5DF2\u7ECF\u6210\u4E3A\u4E00\u4E2A\u975E\u5E38\u6210\u529F\u7684\u5F00\u6E90\u9879\u76EE\u4E86\uFF0C\u57FA\u672C\u4E0A\u5C5E\u4E8E\u524D\u7AEF\u9879\u76EE\u4E2D Lint \u5DE5\u5177\u7684\u6807\u914D\u3002</p><p>ESLint \u7684\u4F7F\u7528\u5E76\u4E0D\u590D\u6742\uFF0C\u4E3B\u8981\u901A\u8FC7\u914D\u7F6E\u6587\u4EF6\u5BF9\u5404\u79CD\u4EE3\u7801\u683C\u5F0F\u7684\u89C4\u5219(<code>rules</code>)\u8FDB\u884C\u914D\u7F6E\uFF0C\u4EE5\u6307\u5B9A\u5177\u4F53\u7684\u4EE3\u7801\u89C4\u8303\u3002\u76EE\u524D\u5F00\u6E90\u793E\u533A\u4E5F\u6709\u4E00\u4E9B\u6210\u719F\u7684\u89C4\u8303\u96C6\u53EF\u4F9B\u4F7F\u7528\uFF0C\u8457\u540D\u7684\u5305\u62EC <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fairbnb%2Fjavascript" target="_blank" rel="noreferrer">Airbnb JavaScript \u4EE3\u7801\u89C4\u8303</a>\u3001<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fstandard%2Fstandard%2Fblob%2Fmaster%2Fdocs%2FREADME-zhcn.md" target="_blank" rel="noreferrer">Standard JavaScript \u89C4\u8303</a>\u3001<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgoogle.github.io%2Fstyleguide%2Fjsguide.html" target="_blank" rel="noreferrer">Google JavaScript \u89C4\u8303</a> \u7B49\u7B49\uFF0C\u4F60\u53EF\u4EE5\u5728\u9879\u76EE\u4E2D\u76F4\u63A5\u4F7F\u7528\u8FD9\u4E9B\u6210\u719F\u7684\u89C4\u8303\uFF0C\u4E5F\u53EF\u4EE5\u81EA\u5DF1\u5B9A\u5236\u4E00\u5957\u56E2\u961F\u72EC\u6709\u7684\u4EE3\u7801\u89C4\u8303\uFF0C\u8FD9\u5728\u4E00\u4E9B\u5927\u578B\u56E2\u961F\u5F53\u4E2D\u8FD8\u662F\u5F88\u5E38\u89C1\u7684\u3002</p><h4 id="\u521D\u59CB\u5316" tabindex="-1">\u521D\u59CB\u5316 <a class="header-anchor" href="#\u521D\u59CB\u5316" aria-hidden="true">#</a></h4><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u6765\u5229\u7528 ESLint \u5B98\u65B9\u7684 cli \u5728\u73B0\u6709\u7684\u811A\u624B\u67B6\u9879\u76EE\u4E2D\u8FDB\u884C\u521D\u59CB\u5316\u64CD\u4F5C\uFF0C\u9996\u5148\u6211\u4EEC\u9700\u8981\u5B89\u88C5 ESLint:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i eslint </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u7740\u6267\u884C ESLint \u7684\u521D\u59CB\u5316\u547D\u4EE4\uFF0C\u5E76\u8FDB\u884C\u5982\u4E0B\u7684\u547D\u4EE4\u884C\u4EA4\u4E92:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">npx eslint </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">init</span></span>
<span class="line"></span></code></pre></div><img src="`+o+`" style="zoom:70%;"><p>\u63A5\u7740 ESLint \u4F1A\u5E2E\u6211\u4EEC\u81EA\u52A8\u751F\u6210<code>.eslintrc.js</code>\u914D\u7F6E\u6587\u4EF6\u3002\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u5728\u4E0A\u8FF0\u521D\u59CB\u5316\u6D41\u7A0B\u4E2D\u6211\u4EEC\u5E76\u6CA1\u6709\u7528 npm \u5B89\u88C5\u4F9D\u8D56\uFF0C\u9700\u8981\u8FDB\u884C\u624B\u52A8\u5B89\u88C5:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i eslint</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">react@latest </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">typescript</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">eslint</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">eslint</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">plugin@latest </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">typescript</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">eslint</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">parser@latest </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"></span></code></pre></div><h4 id="\u6838\u5FC3\u914D\u7F6E\u6587\u4EF6" tabindex="-1">\u6838\u5FC3\u914D\u7F6E\u6587\u4EF6 <a class="header-anchor" href="#\u6838\u5FC3\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a></h4><p>\u521D\u6B21\u63A5\u89E6\u914D\u7F6E\u6587\u4EF6\u53EF\u80FD\u4F1A\u6709\u70B9\u4E0D\u592A\u7406\u89E3\uFF0C\u63A5\u4E0B\u6765\u6211\u6765\u4E3A\u4F60\u4ECB\u7ECD\u4E00\u4E0B\u51E0\u4E2A\u6838\u5FC3\u7684\u914D\u7F6E\u9879\uFF0C\u4F60\u53EF\u4EE5\u5BF9\u7167\u76EE\u524D\u751F\u6210\u7684<code>.eslintrc.js</code>\u4E00\u8D77\u5B66\u4E60\u3002</p><h5 id="parser-\u89E3\u6790\u5668" tabindex="-1">parser - \u89E3\u6790\u5668 <a class="header-anchor" href="#parser-\u89E3\u6790\u5668" aria-hidden="true">#</a></h5><p>ESLint \u5E95\u5C42\u9ED8\u8BA4\u4F7F\u7528 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Feslint%2Fespree" target="_blank" rel="noreferrer">Espree</a> \u6765\u8FDB\u884C AST \u89E3\u6790\uFF0C\u8FD9\u4E2A\u89E3\u6790\u5668\u76EE\u524D\u5DF2\u7ECF\u57FA\u4E8E <code>Acron</code> \u6765\u5B9E\u73B0\uFF0C\u867D\u7136\u8BF4 <code>Acron</code> \u76EE\u524D\u80FD\u591F\u89E3\u6790\u7EDD\u5927\u591A\u6570\u7684 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Facornjs%2Facorn%2Ftree%2Fmaster%2Facorn" target="_blank" rel="noreferrer">ECMAScript \u89C4\u8303\u7684\u8BED\u6CD5</a>\uFF0C\u4F46\u8FD8\u662F\u4E0D\u652F\u6301 TypeScript \uFF0C\u56E0\u6B64\u9700\u8981\u5F15\u5165\u5176\u4ED6\u7684\u89E3\u6790\u5668\u5B8C\u6210 TS \u7684\u89E3\u6790\u3002</p><p>\u793E\u533A\u63D0\u4F9B\u4E86 <code>@typescript-eslint/parser</code> \u8FD9\u4E2A\u89E3\u51B3\u65B9\u6848\uFF0C\u4E13\u95E8\u4E3A\u4E86 TypeScript \u7684\u89E3\u6790\u800C\u8BDE\u751F\uFF0C\u5C06 <code>TS</code> \u4EE3\u7801\u8F6C\u6362\u4E3A <code>Espree</code> \u80FD\u591F\u8BC6\u522B\u7684\u683C\u5F0F(\u5373 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Festree%2Festree" target="_blank" rel="noreferrer"><strong>Estree \u683C\u5F0F</strong></a>)\uFF0C\u7136\u540E\u5728 Eslint \u4E0B\u901A\u8FC7 <code>Espree</code>\u8FDB\u884C\u683C\u5F0F\u68C0\u67E5\uFF0C \u4EE5\u6B64\u517C\u5BB9\u4E86 TypeScript \u8BED\u6CD5\u3002</p><h5 id="parseroptions-\u89E3\u6790\u5668\u9009\u9879" tabindex="-1">parserOptions - \u89E3\u6790\u5668\u9009\u9879 <a class="header-anchor" href="#parseroptions-\u89E3\u6790\u5668\u9009\u9879" aria-hidden="true">#</a></h5><p>\u8FD9\u4E2A\u914D\u7F6E\u53EF\u4EE5\u5BF9\u4E0A\u8FF0\u7684\u89E3\u6790\u5668\u8FDB\u884C\u80FD\u529B\u5B9A\u5236\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B ESLint \u652F\u6301 ES5 \u8BED\u6CD5\uFF0C\u4F60\u53EF\u4EE5\u914D\u7F6E\u8FD9\u4E2A\u9009\u9879\uFF0C\u5177\u4F53\u5185\u5BB9\u5982\u4E0B:</p><ul><li>ecmaVersion: \u8FD9\u4E2A\u914D\u7F6E\u548C <code>Acron</code> \u7684 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Facornjs%2Facorn%2Ftree%2Fmaster%2Facorn" target="_blank" rel="noreferrer">ecmaVersion</a> \u662F\u517C\u5BB9\u7684\uFF0C\u53EF\u4EE5\u914D\u7F6E <code>ES + \u6570\u5B57</code>(\u5982 ES6)\u6216\u8005<code>ES + \u5E74\u4EFD</code>(\u5982 ES2015)\uFF0C\u4E5F\u53EF\u4EE5\u76F4\u63A5\u914D\u7F6E\u4E3A<code>latest</code>\uFF0C\u542F\u7528\u6700\u65B0\u7684 ES \u8BED\u6CD5;</li><li>sourceType: \u9ED8\u8BA4\u4E3A <code>script</code>\uFF0C\u5982\u679C\u4F7F\u7528 ES Module \u5219\u5E94\u8BBE\u7F6E\u4E3A <code>module</code>;</li><li>ecmaFeatures: \u4E3A\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u8868\u793A\u60F3\u4F7F\u7528\u7684\u989D\u5916\u8BED\u8A00\u7279\u6027\uFF0C\u5982\u5F00\u542F <code>jsx</code>\u3002</li></ul><h5 id="rules-\u4EE3\u7801\u89C4\u5219" tabindex="-1">rules - \u4EE3\u7801\u89C4\u5219 <a class="header-anchor" href="#rules-\u4EE3\u7801\u89C4\u5219" aria-hidden="true">#</a></h5><p><code>rules</code> \u914D\u7F6E\u5373\u4EE3\u8868\u5728 ESLint \u4E2D\u624B\u52A8\u8C03\u6574\u54EA\u4E9B\u4EE3\u7801\u89C4\u5219\uFF0C\u6BD4\u5982 <code>\u7981\u6B62\u5728 if \u8BED\u53E5\u4E2D\u4F7F\u7528\u8D4B\u503C\u8BED\u53E5</code> \u8FD9\u6761\u89C4\u5219\u53EF\u4EE5\u50CF\u5982\u4E0B\u7684\u65B9\u5F0F\u914D\u7F6E:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// .eslintrc.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5176\u5B83\u914D\u7F6E\u7701\u7565</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// key \u4E3A\u89C4\u5219\u540D\uFF0Cvalue \u914D\u7F6E\u5185\u5BB9</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">no-cond-assign</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">always</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5728 rules \u5BF9\u8C61\u4E2D\uFF0C<code>key</code> \u4E00\u822C\u4E3A<code>\u89C4\u5219\u540D</code>\uFF0C<code>value</code> \u4E3A\u5177\u4F53\u7684\u914D\u7F6E\u5185\u5BB9\uFF0C\u5728\u4E0A\u8FF0\u7684\u4F8B\u5B50\u4E2D\u6211\u4EEC\u8BBE\u7F6E\u4E3A\u4E00\u4E2A\u6570\u7EC4\uFF0C\u6570\u7EC4\u7B2C\u4E00\u9879\u4E3A\u89C4\u5219\u7684 <code>ID</code>\uFF0C\u7B2C\u4E8C\u9879\u4E3A<code>\u89C4\u5219\u7684\u914D\u7F6E</code>\u3002</p><p>\u8FD9\u91CC\u91CD\u70B9\u8BF4\u4E00\u8BF4\u89C4\u5219\u7684 ID\uFF0C\u5B83\u7684\u8BED\u6CD5\u5BF9\u6240\u6709\u89C4\u5219\u90FD\u9002\u7528\uFF0C\u4F60\u53EF\u4EE5\u8BBE\u7F6E\u4EE5\u4E0B\u7684\u503C:</p><ul><li><code>off</code> \u6216 <code>0</code>: \u8868\u793A\u5173\u95ED\u89C4\u5219\uFF1B</li><li><code>warn</code> \u6216 <code>1</code>: \u8868\u793A\u5F00\u542F\u89C4\u5219\uFF0C\u4E0D\u8FC7\u8FDD\u80CC\u89C4\u5219\u540E\u53EA\u629B\u51FA warning\uFF0C\u800C\u4E0D\u4F1A\u5BFC\u81F4\u7A0B\u5E8F\u9000\u51FA\uFF1B</li><li><code>error</code> \u6216 <code>2</code>: \u8868\u793A\u5F00\u542F\u89C4\u5219\uFF0C\u4E0D\u8FC7\u8FDD\u80CC\u89C4\u5219\u540E\u629B\u51FA error\uFF0C\u7A0B\u5E8F\u4F1A\u9000\u51FA\u3002</li></ul><p>\u5177\u4F53\u7684\u89C4\u5219\u914D\u7F6E\u53EF\u80FD\u4F1A\u4E0D\u4E00\u6837\uFF0C\u6709\u7684\u662F\u4E00\u4E2A\u5B57\u7B26\u4E32\uFF0C\u6709\u7684\u53EF\u4EE5\u914D\u7F6E\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u4F60\u53EF\u4EE5\u53C2\u8003 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fcn.eslint.org%2Fdocs%2Frules%2F" target="_blank" rel="noreferrer">ESLint \u5B98\u65B9\u6587\u6863</a>\u3002</p><p>\u5F53\u7136\uFF0C\u4F60\u4E5F\u80FD\u76F4\u63A5\u5C06 <code>rules</code> \u5BF9\u8C61\u7684 <code>value</code> \u914D\u7F6E\u6210 ID\uFF0C\u5982: <code>&quot;no-cond-assign&quot;: &quot;error&quot;</code>\u3002</p><h5 id="plugins" tabindex="-1">plugins <a class="header-anchor" href="#plugins" aria-hidden="true">#</a></h5><p>\u4E0A\u9762\u63D0\u5230\u8FC7 ESLint \u7684 parser \u57FA\u4E8E <code>Acorn</code> \u5B9E\u73B0\uFF0C\u4E0D\u80FD\u76F4\u63A5\u89E3\u6790 TypeScript\uFF0C\u9700\u8981\u6211\u4EEC\u6307\u5B9A parser \u9009\u9879\u4E3A <code>@typescript-eslint/parser</code>\u624D\u80FD\u517C\u5BB9 TS \u7684\u89E3\u6790\u3002\u540C\u7406\uFF0CESLint \u672C\u8EAB\u4E5F\u6CA1\u6709\u5185\u7F6E TypeScript \u7684\u4EE3\u7801\u89C4\u5219\uFF0C\u8FD9\u4E2A\u65F6\u5019 ESLint \u7684\u63D2\u4EF6\u7CFB\u7EDF\u5C31\u6D3E\u4E0A\u7528\u573A\u4E86\u3002\u6211\u4EEC\u9700\u8981\u901A\u8FC7\u6DFB\u52A0 ESLint \u63D2\u4EF6\u6765\u589E\u52A0\u4E00\u4E9B\u7279\u5B9A\u7684\u89C4\u5219\uFF0C\u6BD4\u5982\u6DFB\u52A0<code>@typescript-eslint/eslint-plugin</code> \u6765\u62D3\u5C55\u4E00\u4E9B\u5173\u4E8E TS \u4EE3\u7801\u7684\u89C4\u5219\uFF0C\u5982\u4E0B\u4EE3\u7801\u6240\u793A:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// .eslintrc.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u6DFB\u52A0 TS \u89C4\u5219\uFF0C\u53EF\u7701\u7565\`eslint-plugin\`</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@typescript-eslint</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u503C\u5F97\u6CE8\u610F\u7684\u662F\uFF0C\u6DFB\u52A0\u63D2\u4EF6\u540E\u53EA\u662F\u62D3\u5C55\u4E86 ESLint \u672C\u8EAB\u7684\u89C4\u5219\u96C6\uFF0C\u4F46 ESLint \u9ED8\u8BA4\u5E76<strong>\u6CA1\u6709\u5F00\u542F</strong>\u8FD9\u4E9B\u89C4\u5219\u7684\u6821\u9A8C\uFF01\u5982\u679C\u8981\u5F00\u542F\u6216\u8005\u8C03\u6574\u8FD9\u4E9B\u89C4\u5219\uFF0C\u4F60\u9700\u8981\u5728 rules \u4E2D\u8FDB\u884C\u914D\u7F6E\uFF0C\u5982:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// .eslintrc.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5F00\u542F\u4E00\u4E9B TS \u89C4\u5219</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">@typescript-eslint/ban-ts-comment</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">@typescript-eslint/no-explicit-any</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">warn</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="extends-\u7EE7\u627F\u914D\u7F6E" tabindex="-1">extends - \u7EE7\u627F\u914D\u7F6E <a class="header-anchor" href="#extends-\u7EE7\u627F\u914D\u7F6E" aria-hidden="true">#</a></h5><p>extends \u76F8\u5F53\u4E8E <code>\u7EE7\u627F</code> \u53E6\u5916\u4E00\u4EFD ESLint \u914D\u7F6E\uFF0C\u53EF\u4EE5\u914D\u7F6E\u4E3A\u4E00\u4E2A\u5B57\u7B26\u4E32\uFF0C\u4E5F\u53EF\u4EE5\u914D\u7F6E\u6210\u4E00\u4E2A\u5B57\u7B26\u4E32\u6570\u7EC4\u3002\u4E3B\u8981\u5206\u5982\u4E0B 3 \u79CD\u60C5\u51B5:</p><ol><li>\u4ECE ESLint \u672C\u8EAB\u7EE7\u627F\uFF1B</li><li>\u4ECE\u7C7B\u4F3C <code>eslint-config-xxx</code> \u7684 npm \u5305\u7EE7\u627F\uFF1B</li><li>\u4ECE ESLint \u63D2\u4EF6\u7EE7\u627F\u3002</li></ol><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// .eslintrc.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">extends</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">     </span><span style="color:#676E95;">// \u7B2C1\u79CD\u60C5\u51B5 </span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">eslint:recommended</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">     </span><span style="color:#676E95;">// \u7B2C2\u79CD\u60C5\u51B5\uFF0C\u4E00\u822C\u914D\u7F6E\u7684\u65F6\u5019\u53EF\u4EE5\u7701\u7565 \`eslint-config\`</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">standard</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">     </span><span style="color:#676E95;">// \u7B2C3\u79CD\u60C5\u51B5\uFF0C\u53EF\u4EE5\u7701\u7565\u5305\u540D\u4E2D\u7684 \`eslint-plugin\`</span></span>
<span class="line"><span style="color:#89DDFF;">     </span><span style="color:#676E95;">// \u683C\u5F0F\u4E00\u822C\u4E3A: \`plugin:\${pluginName}/\${configName}\`</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">plugin:react/recommended</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">plugin:@typescript-eslint/recommended</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">   ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u6709\u4E86 extends \u7684\u914D\u7F6E\uFF0C\u5BF9\u4E8E\u4E4B\u524D\u6240\u8BF4\u7684 ESLint \u63D2\u4EF6\u4E2D\u7684\u7E41\u591A\u914D\u7F6E\uFF0C\u6211\u4EEC\u5C31<strong>\u4E0D\u9700\u8981\u624B\u52A8\u4E00\u4E00\u5F00\u542F</strong>\u4E86\uFF0C\u901A\u8FC7 extends \u5B57\u6BB5\u5373\u53EF\u81EA\u52A8\u5F00\u542F\u63D2\u4EF6\u4E2D\u7684\u63A8\u8350\u89C4\u5219:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#FFCB6B;">extends</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">plugin:@typescript-eslint/recommended</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"></span></code></pre></div><h5 id="env-\u548C-globals" tabindex="-1">env \u548C globals <a class="header-anchor" href="#env-\u548C-globals" aria-hidden="true">#</a></h5><p>\u8FD9\u4E24\u4E2A\u914D\u7F6E\u5206\u522B\u8868\u793A <code>\u8FD0\u884C\u73AF\u5883</code> \u548C <code>\u5168\u5C40\u53D8\u91CF</code>\uFF0C\u5728\u6307\u5B9A\u7684\u8FD0\u884C\u73AF\u5883\u4E2D\u4F1A\u9884\u8BBE\u4E00\u4E9B\u5168\u5C40\u53D8\u91CF\uFF0C\u6BD4\u5982:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// .eslint.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.</span><span style="color:#A6ACCD;">export </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">env</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">browser</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">node</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u6307\u5B9A\u4E0A\u8FF0\u7684 <code>env</code> \u914D\u7F6E\u540E\u4FBF\u4F1A\u542F\u7528\u6D4F\u89C8\u5668\u548C Node.js \u73AF\u5883\uFF0C\u8FD9\u4E24\u4E2A\u73AF\u5883\u4E2D\u7684\u4E00\u4E9B\u5168\u5C40\u53D8\u91CF(\u5982 <code>window</code>\u3001<code>global</code> \u7B49)\u4F1A\u540C\u65F6\u542F\u7528\u3002</p><p>\u6709\u4E9B\u5168\u5C40\u53D8\u91CF\u662F\u4E1A\u52A1\u4EE3\u7801\u5F15\u5165\u7684\u7B2C\u4E09\u65B9\u5E93\u6240\u58F0\u660E\uFF0C\u8FD9\u91CC\u5C31\u9700\u8981\u5728<code>globals</code>\u914D\u7F6E\u4E2D\u58F0\u660E\u5168\u5C40\u53D8\u91CF\u4E86\u3002\u6BCF\u4E2A\u5168\u5C40\u53D8\u91CF\u7684\u914D\u7F6E\u503C\u6709 3 \u79CD\u60C5\u51B5:</p><ol><li><code>&quot;writable&quot;</code>\u6216\u8005 <code>true</code>\uFF0C\u8868\u793A\u53D8\u91CF\u53EF\u91CD\u5199\uFF1B</li><li><code>&quot;readonly&quot;</code>\u6216\u8005<code>false</code>\uFF0C\u8868\u793A\u53D8\u91CF\u4E0D\u53EF\u91CD\u5199\uFF1B</li><li><code>&quot;off&quot;</code>\uFF0C\u8868\u793A\u7981\u7528\u8BE5\u5168\u5C40\u53D8\u91CF\u3002</li></ol><p>\u4EE5 <code>jquery</code> \u4E3E\u4F8B\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5728\u914D\u7F6E\u6587\u4EF6\u4E2D\u58F0\u660E\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// .eslintrc.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">globals</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u4E0D\u53EF\u91CD\u5199</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">$</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">jQuery</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="prettier" tabindex="-1">Prettier <a class="header-anchor" href="#prettier" aria-hidden="true">#</a></h3><p>\u867D\u7136 ESLint \u672C\u8EAB\u5177\u5907\u81EA\u52A8\u683C\u5F0F\u5316\u4EE3\u7801\u7684\u529F\u80FD(<code>eslint --fix</code>)\uFF0C\u4F46\u672F\u4E1A\u6709\u4E13\u653B\uFF0CESLint \u7684\u4E3B\u8981\u4F18\u52BF\u5728\u4E8E<code>\u4EE3\u7801\u7684\u98CE\u683C\u68C0\u67E5\u5E76\u7ED9\u51FA\u63D0\u793A</code>\uFF0C\u800C\u5728\u4EE3\u7801\u683C\u5F0F\u5316\u8FD9\u4E00\u5757 Prettier \u505A\u7684\u66F4\u52A0\u4E13\u4E1A\uFF0C\u56E0\u6B64\u6211\u4EEC\u7ECF\u5E38\u5C06 ESLint \u7ED3\u5408 Prettier \u4E00\u8D77\u4F7F\u7528\u3002</p><p>\u9996\u5148\u6211\u4EEC\u6765\u5B89\u88C5\u4E00\u4E0B Prettier:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i prettier </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"></span></code></pre></div><p>\u5728\u9879\u76EE\u6839\u76EE\u5F55\u65B0\u5EFA <code>.prettierrc.js</code> \u914D\u7F6E\u6587\u4EF6\uFF0C\u586B\u5199\u5982\u4E0B\u7684\u914D\u7F6E\u5185\u5BB9:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// .prettierrc.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">printWidth</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">//\u4E00\u884C\u7684\u5B57\u7B26\u6570\uFF0C\u5982\u679C\u8D85\u8FC7\u4F1A\u8FDB\u884C\u6362\u884C\uFF0C\u9ED8\u8BA4\u4E3A80</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">tabWidth</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u4E00\u4E2A tab \u4EE3\u8868\u51E0\u4E2A\u7A7A\u683C\u6570\uFF0C\u9ED8\u8BA4\u4E3A 2 \u4E2A</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">useTabs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">//\u662F\u5426\u4F7F\u7528 tab \u8FDB\u884C\u7F29\u8FDB\uFF0C\u9ED8\u8BA4\u4E3Afalse\uFF0C\u8868\u793A\u7528\u7A7A\u683C\u8FDB\u884C\u7F29\u51CF</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">singleQuote</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u5B57\u7B26\u4E32\u662F\u5426\u4F7F\u7528\u5355\u5F15\u53F7\uFF0C\u9ED8\u8BA4\u4E3A false\uFF0C\u4F7F\u7528\u53CC\u5F15\u53F7</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">semi</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u884C\u5C3E\u662F\u5426\u4F7F\u7528\u5206\u53F7\uFF0C\u9ED8\u8BA4\u4E3Atrue</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">trailingComma</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">none</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u662F\u5426\u4F7F\u7528\u5C3E\u9017\u53F7</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">bracketSpacing</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u5BF9\u8C61\u5927\u62EC\u53F7\u76F4\u63A5\u662F\u5426\u6709\u7A7A\u683C\uFF0C\u9ED8\u8BA4\u4E3A true\uFF0C\u6548\u679C\uFF1A{ a: 1 }</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u5C06 <code>Prettier</code> \u96C6\u6210\u5230\u73B0\u6709\u7684 <code>ESLint</code> \u5DE5\u5177\u4E2D\uFF0C\u9996\u5148\u5B89\u88C5\u4E24\u4E2A\u5DE5\u5177\u5305:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i eslint</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">prettier eslint</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">prettier </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"></span></code></pre></div><p>\u5176\u4E2D <code>eslint-config-prettier</code> \u7528\u6765\u8986\u76D6 ESLint \u672C\u8EAB\u7684\u89C4\u5219\u914D\u7F6E\uFF0C\u800C <code>eslint-plugin-prettier</code> \u5219\u662F\u7528\u4E8E\u8BA9 Prettier \u6765\u63A5\u7BA1<code>eslint --fix</code> \u5373\u4FEE\u590D\u4EE3\u7801\u7684\u80FD\u529B\u3002</p><p>\u5728 <code>.eslintrc.js</code> \u914D\u7F6E\u6587\u4EF6\u4E2D\u63A5\u5165 prettier \u7684\u76F8\u5173\u5DE5\u5177\u94FE\uFF0C\u6700\u7EC8\u7684\u914D\u7F6E\u4EE3\u7801\u5982\u4E0B\u6240\u793A\uFF0C\u4F60\u53EF\u4EE5\u76F4\u63A5\u7C98\u8D34\u8FC7\u53BB:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// .eslintrc.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">env</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">browser</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">es2021</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">extends</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">eslint:recommended</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">plugin:react/recommended</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">plugin:@typescript-eslint/recommended</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// 1. \u63A5\u5165 prettier \u7684\u89C4\u5219</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">prettier</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">plugin:prettier/recommended</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">parser</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@typescript-eslint/parser</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">parserOptions</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ecmaFeatures</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">jsx</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ecmaVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">latest</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">sourceType</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// 2. \u52A0\u5165 prettier \u7684 eslint \u63D2\u4EF6</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@typescript-eslint</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">prettier</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// 3. \u6CE8\u610F\u8981\u52A0\u4E0A\u8FD9\u4E00\u53E5\uFF0C\u5F00\u542F prettier \u81EA\u52A8\u4FEE\u590D\u7684\u529F\u80FD</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">prettier/prettier</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">quotes</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">single</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">semi</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">always</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">react/react-in-jsx-scope</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">off</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>\u6211\u4EEC\u53EF\u4EE5\u5728 <code>package.json</code> \u4E2D\u5B9A\u4E49\u4E00\u4E2A\u811A\u672C:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">   	</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">lint</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">eslint --ext .js,.jsx,.ts,.tsx --fix --quiet ./</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u4E0B\u6765\u5728\u547D\u4EE4\u884C\u7EC8\u7AEF\u6267\u884C:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm run lint</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u6837\u6211\u4EEC\u5C31\u5B8C\u6210\u4E86 <code>ESLint \u7684\u89C4\u5219\u68C0\u67E5</code>\u4EE5\u53CA <code>Prettier \u7684\u81EA\u52A8\u4FEE\u590D</code>\u3002</p><p>\u4E0D\u8FC7\u6BCF\u6B21\u6267\u884C\u8FD9\u4E2A\u547D\u4EE4\u672A\u514D\u4F1A\u6709\u4E9B\u7E41\u7410\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5728 <code>VSCode</code>\u4E2D\u5B89\u88C5<code>ESLint</code>\u548C<code>Prettier</code>\u8FD9\u4E24\u4E2A\u63D2\u4EF6\uFF0C\u5E76\u4E14\u505A\u5982\u4E0B\u914D\u7F6E\u3002</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">editor.codeActionsOnSave</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">source.fixAll.stylelint</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">stylelint.validate</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">css</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">less</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scss</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u4E0B\u6765\u5728\u4F60\u6309 <code>Ctrl + S</code> \u4FDD\u5B58\u4EE3\u7801\u7684\u65F6\u5019\uFF0CPrettier \u4FBF\u4F1A\u81EA\u52A8\u5E2E\u5FD9\u4FEE\u590D\u4EE3\u7801\u683C\u5F0F\u3002</p><h3 id="vite-\u63A5\u5165-eslint" tabindex="-1">Vite \u63A5\u5165 ESLint <a class="header-anchor" href="#vite-\u63A5\u5165-eslint" aria-hidden="true">#</a></h3><p>\u9664\u4E86\u5B89\u88C5\u7F16\u8F91\u5668\u63D2\u4EF6\uFF0C\u6211\u4EEC\u4E5F\u53EF\u4EE5\u901A\u8FC7 Vite \u63D2\u4EF6\u7684\u65B9\u5F0F\u5728\u5F00\u53D1\u9636\u6BB5\u8FDB\u884C ESLint \u626B\u63CF\uFF0C\u4EE5\u547D\u4EE4\u884C\u7684\u65B9\u5F0F\u5C55\u793A\u51FA\u4EE3\u7801\u4E2D\u7684\u89C4\u8303\u95EE\u9898\uFF0C\u5E76\u80FD\u591F\u76F4\u63A5\u5B9A\u4F4D\u5230\u539F\u6587\u4EF6\u3002</p><p>\u9996\u5148\u6211\u4EEC\u5B89\u88C5 Vite \u4E2D\u7684 ESLint \u63D2\u4EF6:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">eslint </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\u5728 <code>vite.config.ts</code> \u4E2D\u63A5\u5165:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defineConfig</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> react </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@vitejs/plugin-react</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> viteEslint </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-eslint</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// https://vitejs.dev/config/</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">react</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">viteEslint</span><span style="color:#A6ACCD;">()]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u73B0\u5728\u4F60\u53EF\u4EE5\u8BD5\u7740\u91CD\u65B0\u542F\u52A8\u9879\u76EE\uFF0C ESLint \u7684\u9519\u8BEF\u5DF2\u7ECF\u80FD\u591F\u53CA\u65F6\u663E\u793A\u5230\u547D\u4EE4\u884C\u7A97\u53E3\u4E2D\u4E86\u3002</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// \u9700\u8981\u5728\u9875\u9762\u9884\u89C8\u624D\u53EF\u4EE5\u770B\u5230\u6548\u679C</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">[vite] </span><span style="color:#FFCB6B;">warning</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#FFCB6B;">D</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">\\workspace\\notes\\vite\\vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">lint\\src\\App</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tsx</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">7</span><span style="color:#A6ACCD;">  warning  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> is assigned a value but never used  </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">typescript</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">eslint</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">no</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">unused</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">vars</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">7</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">7</span><span style="color:#A6ACCD;">  warning  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">c</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> is assigned a value but never used  </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">typescript</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">eslint</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">no</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">unused</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">vars</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">\u2716 </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">problems</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> errors</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> warnings)</span></span>
<span class="line"></span></code></pre></div><p><strong>\u7531\u4E8E\u8FD9\u4E2A\u63D2\u4EF6\u91C7\u7528\u53E6\u4E00\u4E2A\u8FDB\u7A0B\u6765\u8FD0\u884C ESLint \u7684\u626B\u63CF\u5DE5\u4F5C\uFF0C\u56E0\u6B64\u4E0D\u4F1A\u5F71\u54CD Vite \u9879\u76EE\u7684\u542F\u52A8\u901F\u5EA6\uFF0C\u8FD9\u4E2A\u5927\u5BB6\u4E0D\u7528\u62C5\u5FC3\u3002</strong></p><h3 id="\u6837\u5F0F\u89C4\u8303\u5DE5\u5177\uFF1Astylelint" tabindex="-1">\u6837\u5F0F\u89C4\u8303\u5DE5\u5177\uFF1AStylelint <a class="header-anchor" href="#\u6837\u5F0F\u89C4\u8303\u5DE5\u5177\uFF1Astylelint" aria-hidden="true">#</a></h3><blockquote><p>Stylelint\uFF0C\u4E00\u4E2A\u5F3A\u5927\u7684\u73B0\u4EE3\u5316\u6837\u5F0F Lint \u5DE5\u5177\uFF0C\u7528\u6765\u5E2E\u52A9\u4F60\u907F\u514D\u8BED\u6CD5\u9519\u8BEF\u548C\u7EDF\u4E00\u4EE3\u7801\u98CE\u683C\u3002</p></blockquote><p>Stylelint \u4E3B\u8981\u4E13\u6CE8\u4E8E\u6837\u5F0F\u4EE3\u7801\u7684\u89C4\u8303\u68C0\u67E5\uFF0C\u5185\u7F6E\u4E86 <strong>170 \u591A\u4E2A CSS \u4E66\u5199\u89C4\u5219</strong>\uFF0C\u652F\u6301 <strong>CSS \u9884\u5904\u7406\u5668</strong>(\u5982 Sass\u3001Less)\uFF0C\u63D0\u4F9B<strong>\u63D2\u4EF6\u5316\u673A\u5236</strong>\u4EE5\u4F9B\u5F00\u53D1\u8005\u6269\u5C55\u89C4\u5219\uFF0C\u5DF2\u7ECF\u88AB Google\u3001Github \u7B49<strong>\u5927\u578B\u56E2\u961F</strong>\u6295\u5165\u4F7F\u7528\u3002\u4E0E ESLint \u7C7B\u4F3C\uFF0C\u5728\u89C4\u8303\u68C0\u67E5\u65B9\u9762\uFF0CStylelint \u5DF2\u7ECF\u505A\u7684\u8DB3\u591F\u4E13\u4E1A\uFF0C\u800C\u5728\u4EE3\u7801\u683C\u5F0F\u5316\u65B9\u9762\uFF0C\u6211\u4EEC\u4ECD\u7136\u9700\u8981\u7ED3\u5408 Prettier \u4E00\u8D77\u6765\u4F7F\u7528\u3002</p><p>\u9996\u5148\u8BA9\u6211\u4EEC\u6765\u5B89\u88C5 Stylelint \u4EE5\u53CA\u76F8\u5E94\u7684\u5DE5\u5177\u5957\u4EF6\uFF1A</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i stylelint stylelint</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">prettier stylelint</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">prettier stylelint</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">recess</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">order stylelint</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">standard stylelint</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">standard</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">scss </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\uFF0C\u6211\u4EEC\u5728 Stylelint \u7684\u914D\u7F6E\u6587\u4EF6<code>.stylelintrc.js</code>\u4E2D\u4E00\u4E00\u4F7F\u7528\u8FD9\u4E9B\u5DE5\u5177\u5957\u4EF6:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// .stylelintrc.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u6CE8\u518C stylelint \u7684 prettier \u63D2\u4EF6</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">stylelint-prettier</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u7EE7\u627F\u4E00\u7CFB\u5217\u89C4\u5219\u96C6\u5408</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">extends</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// standard \u89C4\u5219\u96C6\u5408</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">stylelint-config-standard</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// standard \u89C4\u5219\u96C6\u5408\u7684 scss \u7248\u672C</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">stylelint-config-standard-scss</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u6837\u5F0F\u5C5E\u6027\u987A\u5E8F\u89C4\u5219</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">stylelint-config-recess-order</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u63A5\u5165 Prettier \u89C4\u5219</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">stylelint-config-prettier</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">stylelint-prettier/recommended</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u914D\u7F6E rules</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u5F00\u542F Prettier \u81EA\u52A8\u683C\u5F0F\u5316\u529F\u80FD</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">prettier/prettier</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>\u53EF\u4EE5\u53D1\u73B0 Stylelint \u7684\u914D\u7F6E\u6587\u4EF6\u548C ESLint \u8FD8\u662F\u975E\u5E38\u76F8\u4F3C\u7684\uFF0C\u5E38\u7528\u7684 <code>plugins</code>\u3001<code>extends</code> \u548C <code>rules</code> \u5C5E\u6027\u5728 ESLint \u540C\u6837\u5B58\u5728\uFF0C\u5E76\u4E14\u4E0E ESLint \u4E2D\u8FD9\u4E09\u4E2A\u5C5E\u6027\u7684\u529F\u80FD\u4E5F\u57FA\u672C\u76F8\u540C\u3002\u4E0D\u8FC7\u9700\u8981\u5F3A\u8C03\u7684\u662F\u5728 Stylelint \u4E2D rules \u7684\u914D\u7F6E\u4F1A\u548C ESLint \u6709\u4E9B\u533A\u522B\uFF0C\u5BF9\u4E8E\u6BCF\u4E2A\u5177\u4F53\u7684 rule \u4F1A\u6709\u4E09\u79CD\u914D\u7F6E\u65B9\u5F0F:</p><ul><li><code>null</code>\uFF0C\u8868\u793A\u5173\u95ED\u89C4\u5219\u3002</li><li>\u4E00\u4E2A\u7B80\u5355\u503C(\u5982 true\uFF0C\u5B57\u7B26\u4E32\uFF0C\u6839\u636E\u4E0D\u540C\u89C4\u5219\u6709\u6240\u4E0D\u540C)\uFF0C\u8868\u793A\u5F00\u542F\u89C4\u5219\uFF0C\u4F46\u5E76\u4E0D\u505A\u8FC7\u591A\u7684\u5B9A\u5236\u3002</li><li>\u4E00\u4E2A\u6570\u7EC4\uFF0C\u5305\u542B\u4E24\u4E2A\u5143\u7D20\uFF0C\u5373<code>[\u7B80\u5355\u503C\uFF0C\u81EA\u5B9A\u4E49\u914D\u7F6E]</code>\uFF0C\u7B2C\u4E00\u4E2A\u5143\u7D20\u901A\u5E38\u4E3A\u4E00\u4E2A\u7B80\u5355\u503C\uFF0C\u7B2C\u4E8C\u4E2A\u5143\u7D20\u7528\u6765\u8FDB\u884C\u66F4\u7CBE\u7EC6\u5316\u7684\u89C4\u5219\u914D\u7F6E\u3002</li></ul><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u5C06 Stylelint \u96C6\u6210\u5230\u9879\u76EE\u4E2D\uFF0C\u56DE\u5230 <code>package.json</code> \u4E2D\uFF0C\u589E\u52A0\u5982\u4E0B\u7684 <code>scripts</code> \u914D\u7F6E:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u6574\u5408 lint \u547D\u4EE4</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">lint</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">npm run lint:script &amp;&amp; npm run lint:style</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// eslint \u547D\u4EE4</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">lint:script</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">eslint --ext .js,.jsx,.ts,.tsx --fix --quiet ./</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// stylelint \u547D\u4EE4</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">lint:style</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">stylelint --fix </span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#C3E88D;">src/**/*.{css,scss}</span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u6267\u884C <code>pnpm run lint:style</code> \u5373\u53EF\u5B8C\u6210\u6837\u5F0F\u4EE3\u7801\u7684\u89C4\u8303\u68C0\u67E5\u548C\u81EA\u52A8\u683C\u5F0F\u5316\u3002\u5F53\u7136\uFF0C\u4F60\u4E5F\u53EF\u4EE5\u5728 VSCode \u4E2D\u5B89\u88C5 <code>Stylelint</code> \u63D2\u4EF6\uFF0C\u8FD9\u6837\u80FD\u591F\u5728\u5F00\u53D1\u9636\u6BB5\u5373\u65F6\u611F\u77E5\u5230\u4EE3\u7801\u683C\u5F0F\u95EE\u9898\uFF0C\u63D0\u524D\u8FDB\u884C\u4FEE\u590D\u3002</p><p>\u5F53\u7136\uFF0C\u6211\u4EEC\u4E5F\u53EF\u4EE5\u76F4\u63A5\u5728 Vite \u4E2D\u96C6\u6210 Stylelint\u3002\u793E\u533A\u4E2D\u63D0\u4F9B\u4E86 Stylelint \u7684 Vite \u63D2\u4EF6\uFF0C\u5B9E\u73B0\u5728\u9879\u76EE\u5F00\u53D1\u9636\u6BB5\u63D0\u524D\u66B4\u9732\u51FA\u6837\u5F0F\u4EE3\u7801\u7684\u89C4\u8303\u95EE\u9898\u3002\u6211\u4EEC\u6765\u5B89\u88C5\u4E00\u4E0B\u8FD9\u4E2A\u63D2\u4EF6:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">amatlash</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">stylelint </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\u5728 Vite \u914D\u7F6E\u6587\u4EF6\u4E2D\u6DFB\u52A0\u5982\u4E0B\u7684\u5185\u5BB9:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> viteEslint </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-eslint</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> viteStylelint </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@amatlash/vite-plugin-stylelint</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// https://vitejs.dev/config/</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">react</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">viteEslint</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u7701\u7565\u5176\u5B83\u63D2\u4EF6</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">viteStylelint</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u5BF9\u67D0\u4E9B\u6587\u4EF6\u6392\u9664\u68C0\u67E5</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">exclude</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">windicss</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">node_modules</span><span style="color:#89DDFF;">/</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u4E0B\u6765\uFF0C\u4F60\u5C31\u53EF\u4EE5\u5728\u547D\u4EE4\u884C\u754C\u9762\u770B\u5230\u5BF9\u5E94\u7684 Stylelint \u63D0\u793A\u4E86\u3002</p><h3 id="husky-lint-staged" tabindex="-1">Husky + lint-staged <a class="header-anchor" href="#husky-lint-staged" aria-hidden="true">#</a></h3><blockquote><p>Husky + lint-staged \u7684 Git \u63D0\u4EA4\u5DE5\u4F5C\u6D41\u96C6\u6210</p></blockquote><h4 id="\u63D0\u524D\u4EA4\u4EE3\u7801-lint-\u68C0\u67E5" tabindex="-1">\u63D0\u524D\u4EA4\u4EE3\u7801 Lint \u68C0\u67E5 <a class="header-anchor" href="#\u63D0\u524D\u4EA4\u4EE3\u7801-lint-\u68C0\u67E5" aria-hidden="true">#</a></h4><p>\u5728\u4E0A\u6587\u4E2D\u6211\u4EEC\u63D0\u5230\u4E86\u5B89\u88C5 <code>ESLint</code>\u3001<code>Prettier</code>\u548C<code>Stylelint</code>\u7684\u6D4F\u89C8\u5668\u63D2\u4EF6\u6216\u8005 Vite \u63D2\u4EF6\uFF0C\u5728\u5F00\u53D1\u9636\u6BB5\u63D0\u524D\u89C4\u907F\u6389\u4EE3\u7801\u683C\u5F0F\u7684\u95EE\u9898\uFF0C\u4F46\u5B9E\u9645\u4E0A\u8FD9\u4E5F\u53EA\u662F\u5C06\u95EE\u9898\u63D0\u524D\u66B4\u9732\uFF0C\u5E76\u4E0D\u80FD\u4FDD\u8BC1\u89C4\u8303\u95EE\u9898\u80FD\u5B8C\u5168\u88AB\u89E3\u51B3\uFF0C\u8FD8\u662F\u53EF\u80FD\u5BFC\u81F4\u7EBF\u4E0A\u7684\u4EE3\u7801\u51FA\u73B0\u4E0D\u7B26\u5408\u89C4\u8303\u7684\u60C5\u51B5\u3002\u90A3\u4E48\u5982\u4F55\u6765\u907F\u514D\u8FD9\u7C7B\u95EE\u9898\u5462\uFF1F</p><p>\u6211\u4EEC\u53EF\u4EE5\u5728\u4EE3\u7801\u63D0\u4EA4\u7684\u65F6\u5019\u8FDB\u884C\u5361\u70B9\u68C0\u67E5\uFF0C\u4E5F\u5C31\u662F\u62E6\u622A <code>git commit</code> \u547D\u4EE4\uFF0C\u8FDB\u884C\u4EE3\u7801\u683C\u5F0F\u68C0\u67E5\uFF0C\u53EA\u6709\u786E\u4FDD\u901A\u8FC7\u683C\u5F0F\u68C0\u67E5\u624D\u5141\u8BB8\u6B63\u5E38\u63D0\u4EA4\u4EE3\u7801\u3002\u793E\u533A\u4E2D\u5DF2\u7ECF\u6709\u4E86\u5BF9\u5E94\u7684\u5DE5\u5177\u2014\u2014 <code>Husky</code> \u6765\u5B8C\u6210\u8FD9\u4EF6\u4E8B\u60C5\uFF0C\u8BA9\u6211\u4EEC\u6765\u5B89\u88C5\u4E00\u4E0B\u8FD9\u4E2A\u5DE5\u5177:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i husky </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"></span></code></pre></div><p>\u6709\u5F88\u591A\u4EBA\u63A8\u8350\u5728 <code>package.json</code> \u4E2D\u914D\u7F6E husky \u7684\u94A9\u5B50:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// package.json</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">husky</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">pre-commit</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">npm run lint</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u79CD\u505A\u6CD5\u5728 Husky <code>4.x</code> \u53CA\u4EE5\u4E0B\u7248\u672C\u6CA1\u95EE\u9898\uFF0C\u800C\u5728\u6700\u65B0\u7248\u672C(7.x \u7248\u672C)\u4E2D\u662F\u65E0\u6548\u7684\uFF01\u5728\u65B0\u7248 Husky \u7248\u672C\u4E2D\uFF0C\u6211\u4EEC\u9700\u8981\u505A\u5982\u4E0B\u7684\u4E8B\u60C5:</p><ol><li>\u521D\u59CB\u5316 Husky: <code>npx husky install</code>\uFF0C\u5E76\u5C06 <code>husky install</code> \u4F5C\u4E3A\u9879\u76EE\u542F\u52A8\u524D\u811A\u672C\uFF0C\u5982:</li></ol><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u4F1A\u5728\u5B89\u88C5 npm \u4F9D\u8D56\u540E\u81EA\u52A8\u6267\u884C</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">postinstall</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">husky install</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><ol start="2"><li>\u6DFB\u52A0 Husky \u94A9\u5B50\uFF0C\u5728\u7EC8\u7AEF\u6267\u884C\u5982\u4E0B\u547D\u4EE4:</li></ol><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">npx husky add </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">husky</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">pre</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">commit </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">npm run lint</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u7740\u4F60\u5C06\u4F1A\u5728\u9879\u76EE\u6839\u76EE\u5F55\u7684 <code>.husky</code> \u76EE\u5F55\u4E2D\u770B\u5230\u540D\u4E3A <code>pre-commit</code> \u7684\u6587\u4EF6\uFF0C\u91CC\u9762\u5305\u542B\u4E86 <code>git commit </code>\u524D\u8981\u6267\u884C\u7684\u811A\u672C\u3002\u73B0\u5728\uFF0C\u5F53\u4F60\u6267\u884C <code>git commit</code> \u7684\u65F6\u5019\uFF0C\u4F1A\u9996\u5148\u6267\u884C <code>npm run lint</code>\u811A\u672C\uFF0C\u901A\u8FC7 Lint \u68C0\u67E5\u540E\u624D\u4F1A\u6B63\u5F0F\u63D0\u4EA4\u4EE3\u7801\u8BB0\u5F55\u3002</p><p>\u4E0D\u8FC7\uFF0C\u521A\u624D\u6211\u4EEC\u76F4\u63A5\u5728 Husky \u7684\u94A9\u5B50\u4E2D\u6267\u884C <code>npm run lint</code>\uFF0C\u8FD9\u4F1A\u4EA7\u751F\u4E00\u4E2A\u989D\u5916\u7684\u95EE\u9898: Husky \u4E2D\u6BCF\u6B21\u6267\u884C<code>npm run lint</code> \u90FD\u5BF9\u4ED3\u5E93\u4E2D\u7684\u4EE3\u7801\u8FDB\u884C\u5168\u91CF\u68C0\u67E5\uFF0C\u4E5F\u5C31\u662F\u8BF4\uFF0C\u5373\u4F7F\u67D0\u4E9B\u6587\u4EF6\u5E76\u6CA1\u6709\u6539\u52A8\uFF0C\u4E5F\u4F1A\u8D70\u4E00\u6B21 Lint \u68C0\u67E5\uFF0C\u5F53\u9879\u76EE\u4EE3\u7801\u8D8A\u6765\u8D8A\u591A\u7684\u65F6\u5019\uFF0C\u63D0\u4EA4\u7684\u8FC7\u7A0B\u4F1A\u8D8A\u6765\u8D8A\u6162\uFF0C\u5F71\u54CD\u5F00\u53D1\u4F53\u9A8C\u3002</p><p>\u800C <code>lint-staged </code>\u5C31\u662F\u7528\u6765\u89E3\u51B3\u4E0A\u8FF0\u5168\u91CF\u626B\u63CF\u95EE\u9898\u7684\uFF0C\u53EF\u4EE5\u5B9E\u73B0\u53EA\u5BF9\u5B58\u5165 <code>\u6682\u5B58\u533A</code> \u7684\u6587\u4EF6\u8FDB\u884C Lint \u68C0\u67E5\uFF0C\u5927\u5927\u63D0\u9AD8\u4E86\u63D0\u4EA4\u4EE3\u7801\u7684\u6548\u7387\u3002\u9996\u5148\uFF0C\u8BA9\u6211\u4EEC\u5B89\u88C5\u4E00\u4E0B\u5BF9\u5E94\u7684 npm \u5305:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D lint</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">staged</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\u5728 <code>package.json</code> \u4E2D\u6DFB\u52A0\u5982\u4E0B\u7684\u914D\u7F6E:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">lint-staged</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">**/*.{js,jsx,tsx,ts,json}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">npm run lint:script</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">git add --force</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">    ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">**/*.{scss}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">npm run lint:style</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">git add --force</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">    ]</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u9700\u8981\u5728 Husky \u4E2D\u5E94\u7528 <code>lint-stage</code>\uFF0C\u56DE\u5230 <code>.husky/pre-commit</code> \u811A\u672C\u4E2D\uFF0C\u5C06\u539F\u6765\u7684<code>npm run lint</code>\u6362\u6210\u5982\u4E0B\u811A\u672C:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">npx </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">no </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;"> lint</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">staged</span></span>
<span class="line"></span></code></pre></div><p>\u5982\u6B64\u4E00\u6765\uFF0C\u6211\u4EEC\u4FBF\u5B9E\u73B0\u4E86\u63D0\u4EA4\u4EE3\u7801\u65F6\u7684 <code>\u589E\u91CF Lint \u68C0\u67E5</code>\u3002</p><h4 id="\u63D0\u4EA4\u65F6\u7684-commit-\u4FE1\u606F\u89C4\u8303" tabindex="-1">\u63D0\u4EA4\u65F6\u7684 commit \u4FE1\u606F\u89C4\u8303 <a class="header-anchor" href="#\u63D0\u4EA4\u65F6\u7684-commit-\u4FE1\u606F\u89C4\u8303" aria-hidden="true">#</a></h4><p>\u9664\u4E86\u4EE3\u7801\u89C4\u8303\u68C0\u67E5\u4E4B\u540E\uFF0CGit \u63D0\u4EA4\u4FE1\u606F\u7684\u89C4\u8303\u4E5F\u662F\u4E0D\u5BB9\u5FFD\u89C6\u7684\u4E00\u4E2A\u73AF\u8282\uFF0C\u89C4\u8303\u7684 commit \u4FE1\u606F\u80FD\u591F\u65B9\u4FBF\u56E2\u961F\u534F\u4F5C\u548C\u95EE\u9898\u5B9A\u4F4D\u3002 \u9996\u5148\u6211\u4EEC\u6765\u5B89\u88C5\u4E00\u4E0B\u9700\u8981\u7684\u5DE5\u5177\u5E93\uFF0C\u6267\u884C\u5982\u4E0B\u7684\u547D\u4EE4:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i commitlint </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">commitlint</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">cli </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">commitlint</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">conventional </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u4E0B\u6765\u65B0\u5EFA<code>.commitlintrc.js</code>\uFF1A</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// .commitlintrc.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">extends</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@commitlint/config-conventional</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>\u4E00\u822C\u6211\u4EEC\u76F4\u63A5\u4F7F\u7528<code>@commitlint/config-conventional</code>\u89C4\u8303\u96C6\u5C31\u53EF\u4EE5\u4E86\uFF0C\u5B83\u6240\u89C4\u5B9A\u7684 commit \u4FE1\u606F\u4E00\u822C\u7531\u4E24\u4E2A\u90E8\u5206: <code>type</code> \u548C <code>subject</code> \u7EC4\u6210\uFF0C\u7ED3\u6784\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// type \u6307\u63D0\u4EA4\u7684\u7C7B\u578B</span></span>
<span class="line"><span style="color:#676E95;">// subject \u6307\u63D0\u4EA4\u7684\u6458\u8981\u4FE1\u606F</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">subject</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u5E38\u7528\u7684 <code>type</code> \u503C\u5305\u62EC\u5982\u4E0B:</p><ul><li><code>feat</code>: \u6DFB\u52A0\u65B0\u529F\u80FD\u3002</li><li><code>fix</code>: \u4FEE\u590D Bug\u3002</li></ul><ul><li><code>chore</code>: \u4E00\u4E9B\u4E0D\u5F71\u54CD\u529F\u80FD\u7684\u66F4\u6539\u3002</li><li><code>docs</code>: \u4E13\u6307\u6587\u6863\u7684\u4FEE\u6539\u3002</li><li><code>perf</code>: \u6027\u80FD\u65B9\u9762\u7684\u4F18\u5316\u3002</li><li><code>refactor</code>: \u4EE3\u7801\u91CD\u6784\u3002</li><li><code>test</code>: \u6DFB\u52A0\u4E00\u4E9B\u6D4B\u8BD5\u4EE3\u7801\u7B49\u7B49\u3002</li></ul><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u5C06<code>commitlint</code>\u7684\u529F\u80FD\u96C6\u6210\u5230 Husky \u7684\u94A9\u5B50\u5F53\u4E2D\uFF0C\u5728\u7EC8\u7AEF\u6267\u884C\u5982\u4E0B\u547D\u4EE4\u5373\u53EF:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">npx husky add </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">husky</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">commit</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">msg </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">npx --no-install commitlint -e $HUSKY_GIT_PARAMS</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><p>\u4F60\u53EF\u4EE5\u53D1\u73B0\u5728<code>.husky</code>\u76EE\u5F55\u4E0B\u591A\u51FA\u4E86<code>commit-msg</code>\u811A\u672C\u6587\u4EF6\uFF0C\u8868\u793A<code>commitlint</code>\u547D\u4EE4\u5DF2\u7ECF\u6210\u529F\u63A5\u5165\u5230 husky \u7684\u94A9\u5B50\u5F53\u4E2D\u3002\u73B0\u5728\u6211\u4EEC\u53EF\u4EE5\u5C1D\u8BD5\u5BF9\u4EE3\u7801\u8FDB\u884C\u63D0\u4EA4\uFF0C\u5047\u5982\u8F93\u5165\u4E00\u4E2A\u9519\u8BEF\u7684 commit \u4FE1\u606F\uFF0Ccommitlint \u4F1A\u81EA\u52A8\u629B\u51FA\u9519\u8BEF\u5E76\u9000\u51FA\u3002</p><p>\u81F3\u6B64\uFF0C\u6211\u4EEC\u4FBF\u5B8C\u6210\u4E86 Git \u63D0\u4EA4\u4FE1\u606F\u7684\u5361\u70B9\u626B\u63CF\u548C\u89C4\u8303\u68C0\u67E5\u3002</p><h3 id="\u603B\u7ED3-2" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3-2" aria-hidden="true">#</a></h3><p>\u73B0\u5728\u4F60\u5E94\u8BE5\u4E86\u89E3\u4E86\u524D\u7AEF\u7684<strong>\u81EA\u52A8\u5316\u4EE3\u7801\u89C4\u8303\u5DE5\u5177\u7684\u4F7F\u7528</strong>\u4EE5\u53CA<strong>\u5728 Vite \u4E2D\u7684\u63A5\u5165\u65B9\u6CD5</strong>\u3002</p><p>\u672C\u7BC7\u6587\u7AE0\u4E3B\u8981\u4ECB\u7ECD\u4E86 3 \u4E2A\u65B9\u9762\u7684\u81EA\u52A8\u5316\u4EE3\u7801\u89C4\u8303\u5DE5\u5177:</p><ol><li>JavaScript/TypeScript \u89C4\u8303\u3002\u4E3B\u6D41\u7684 Lint \u5DE5\u5177\u5305\u62EC <code>Eslint</code>\u3001<code>Prettier</code>\uFF1B</li><li>\u6837\u5F0F\u5F00\u53D1\u89C4\u8303\u3002\u4E3B\u6D41\u7684 Lint \u5DE5\u5177\u5305\u62EC<code>Stylelint</code>\u3001<code>Prettier</code>\uFF1B</li><li>Git \u63D0\u4EA4\u89C4\u8303\u3002\u4E3B\u6D41\u7684 Lint \u5DE5\u5177\u5305\u62EC<code>Commitlint</code>\u3002</li></ol><p>\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u7F16\u8F91\u5668\u7684\u63D2\u4EF6\u6216\u8005 Vite \u63D2\u4EF6\u5728\u5F00\u53D1\u9636\u6BB5\u66B4\u9732\u51FA\u89C4\u8303\u95EE\u9898\uFF0C\u4F46\u4E5F\u65E0\u6CD5\u4FDD\u8BC1\u8FD9\u7C7B\u95EE\u9898\u5728\u5F00\u53D1\u65F6\u5B8C\u5168\u88AB\u89E3\u51B3\u6389\uFF0C\u56E0\u6B64\u6211\u4EEC\u5C1D\u8BD5\u5728\u4EE3\u7801\u63D0\u4EA4\u9636\u6BB5\u6765\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\uFF0C\u901A\u8FC7 <code>Husky</code>+<code>lint-staged </code>\u6210\u529F\u5730\u62E6\u622A <code>git commit</code> \u8FC7\u7A0B\uFF0C\u53EA\u6709\u5728\u5404\u9879 Lint \u68C0\u67E5\u901A\u8FC7\u540E\u624D\u80FD\u6B63\u5E38\u63D0\u4EA4\u4EE3\u7801\uFF0C\u8FD9\u6837\u5C31\u6709\u6548\u63D0\u9AD8\u4E86\u7EBF\u4E0A\u4EE3\u7801\u548C Git \u63D0\u4EA4\u4FE1\u606F\u7684\u8D28\u91CF\u3002</p><h2 id="\u9759\u6001\u8D44\u6E90\u5904\u7406" tabindex="-1">\u9759\u6001\u8D44\u6E90\u5904\u7406 <a class="header-anchor" href="#\u9759\u6001\u8D44\u6E90\u5904\u7406" aria-hidden="true">#</a></h2><p>\u9759\u6001\u8D44\u6E90\u5904\u7406\u662F\u524D\u7AEF\u5DE5\u7A0B\u7ECF\u5E38\u9047\u5230\u7684\u95EE\u9898\uFF0C\u5728\u771F\u5B9E\u7684\u5DE5\u7A0B\u4E2D\u4E0D\u4EC5\u4EC5\u5305\u542B\u4E86\u52A8\u6001\u6267\u884C\u7684\u4EE3\u7801\uFF0C\u4E5F\u4E0D\u53EF\u907F\u514D\u5730\u8981\u5F15\u5165\u5404\u79CD\u9759\u6001\u8D44\u6E90\uFF0C\u5982<code>\u56FE\u7247</code>\u3001<code>JSON</code>\u3001<code>Worker \u6587\u4EF6</code>\u3001<code>Web Assembly \u6587\u4EF6</code>\u7B49\u7B49\u3002</p><p>\u800C\u9759\u6001\u8D44\u6E90\u672C\u8EAB\u5E76\u4E0D\u662F\u6807\u51C6\u610F\u4E49\u4E0A\u7684\u6A21\u5757\uFF0C\u56E0\u6B64\u5BF9\u5B83\u4EEC\u7684\u5904\u7406\u548C\u666E\u901A\u7684\u4EE3\u7801\u662F\u9700\u8981\u533A\u522B\u5BF9\u5F85\u7684\u3002\u4E00\u65B9\u9762\u6211\u4EEC\u9700\u8981\u89E3\u51B3<strong>\u8D44\u6E90\u52A0\u8F7D</strong>\u7684\u95EE\u9898\uFF0C\u5BF9 Vite \u6765\u8BF4\u5C31\u662F\u5982\u4F55\u5C06\u9759\u6001\u8D44\u6E90\u89E3\u6790\u5E76\u52A0\u8F7D\u4E3A\u4E00\u4E2A ES \u6A21\u5757\u7684\u95EE\u9898\uFF1B\u53E6\u4E00\u65B9\u9762\u5728<strong>\u751F\u4EA7\u73AF\u5883</strong>\u4E0B\u6211\u4EEC\u8FD8\u9700\u8981\u8003\u8651\u9759\u6001\u8D44\u6E90\u7684\u90E8\u7F72\u95EE\u9898\u3001\u4F53\u79EF\u95EE\u9898\u3001\u7F51\u7EDC\u6027\u80FD\u95EE\u9898\uFF0C\u5E76\u91C7\u53D6\u76F8\u5E94\u7684\u65B9\u6848\u6765\u8FDB\u884C\u4F18\u5316\u3002</p><h3 id="\u56FE\u7247\u52A0\u8F7D" tabindex="-1">\u56FE\u7247\u52A0\u8F7D <a class="header-anchor" href="#\u56FE\u7247\u52A0\u8F7D" aria-hidden="true">#</a></h3><p>\u56FE\u7247\u662F\u9879\u76EE\u4E2D\u6700\u5E38\u7528\u7684\u9759\u6001\u8D44\u6E90\u4E4B\u4E00\uFF0C\u672C\u8EAB\u5305\u62EC\u4E86\u975E\u5E38\u591A\u7684\u683C\u5F0F\uFF0C\u8BF8\u5982 png\u3001jpeg\u3001webp\u3001avif\u3001gif\uFF0C\u5F53\u7136\uFF0C\u4E5F\u5305\u62EC\u7ECF\u5E38\u7528\u4F5C\u56FE\u6807\u7684 svg \u683C\u5F0F\u3002\u8FD9\u4E00\u90E8\u5206\u6211\u4EEC\u4E3B\u8981\u8BA8\u8BBA\u7684\u662F\u5982\u4F55\u52A0\u8F7D\u56FE\u7247\uFF0C\u4E5F\u5C31\u662F\u8BF4\u600E\u4E48\u8BA9\u56FE\u7247\u5728\u9875\u9762\u4E2D<strong>\u6B63\u5E38\u663E\u793A</strong>\u3002</p><h4 id="\u4F7F\u7528\u573A\u666F" tabindex="-1">\u4F7F\u7528\u573A\u666F <a class="header-anchor" href="#\u4F7F\u7528\u573A\u666F" aria-hidden="true">#</a></h4><p>\u5728\u65E5\u5E38\u7684\u9879\u76EE\u5F00\u53D1\u8FC7\u7A0B\u4E2D\uFF0C\u6211\u4EEC\u4E00\u822C\u4F1A\u9047\u5230\u4E09\u79CD\u52A0\u8F7D\u56FE\u7247\u7684\u573A\u666F:</p><ol><li>\u5728 HTML \u6216\u8005 JSX \u4E2D\uFF0C\u901A\u8FC7 img \u6807\u7B7E\u6765\u52A0\u8F7D\u56FE\u7247\uFF0C\u5982:</li></ol><div class="language-html"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">img</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../../assets/a.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">img</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><ol><li>\u5728 CSS \u4E2D\u901A\u8FC7 background \u5C5E\u6027\u52A0\u8F7D\u56FE\u7247\uFF0C\u5982:</li></ol><div class="language-css"><button class="copy"></button><span class="lang">css</span><pre><code><span class="line"><span style="color:#A6ACCD;">background: url(&#39;.</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">/.</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">/assets/</span><span style="color:#FFCB6B;">b</span><span style="color:#A6ACCD;">.png&#39;) norepeat;</span></span>
<span class="line"></span></code></pre></div><ol><li>\u5728 JavaScript \u4E2D\uFF0C\u901A\u8FC7\u811A\u672C\u7684\u65B9\u5F0F\u52A8\u6001\u6307\u5B9A\u56FE\u7247\u7684<code>src</code>\u5C5E\u6027\uFF0C\u5982:</li></ol><div class="language-ts"><button class="copy"></button><span class="lang">ts</span><pre><code><span class="line"><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hero-img</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../../assets/c.png</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><p>\u5F53\u7136\uFF0C\u5927\u5BB6\u4E00\u822C\u8FD8\u4F1A\u6709\u522B\u540D\u8DEF\u5F84\u7684\u9700\u6C42\uFF0C\u6BD4\u5982\u5730\u5740\u524D\u7F00\u76F4\u63A5\u6362\u6210<code>@assets</code>\uFF0C\u8FD9\u6837\u5C31\u4E0D\u7528\u5F00\u53D1\u4EBA\u5458\u624B\u52A8\u5BFB\u5740\uFF0C\u964D\u4F4E\u5F00\u53D1\u65F6\u7684\u5FC3\u667A\u8D1F\u62C5\u3002</p><h4 id="vite-\u4E2D\u4F7F\u7528" tabindex="-1">Vite \u4E2D\u4F7F\u7528 <a class="header-anchor" href="#vite-\u4E2D\u4F7F\u7528" aria-hidden="true">#</a></h4><p>\u4F60\u53EF\u4EE5\u5728 Vite \u7684\u914D\u7F6E\u6587\u4EF6\u4E2D\u914D\u7F6E\u4E00\u4E0B\u522B\u540D\uFF0C\u65B9\u4FBF\u540E\u7EED\u7684\u56FE\u7247\u5F15\u5165:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> vite</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ts</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> path </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">path</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">resolve</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u522B\u540D\u914D\u7F6E</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">alias</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@assets</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">__dirname</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src/assets</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u6837 Vite \u5728\u9047\u5230<code>@assets</code>\u8DEF\u5F84\u7684\u65F6\u5019\uFF0C\u4F1A\u81EA\u52A8\u5E2E\u6211\u4EEC\u5B9A\u4F4D\u81F3\u6839\u76EE\u5F55\u4E0B\u7684<code>src/assets</code>\u76EE\u5F55\u3002 \u503C\u5F97\u6CE8\u610F\u7684\u662F\uFF0Calias \u522B\u540D\u914D\u7F6E\u4E0D\u4EC5\u5728 JavaScript \u7684 import \u8BED\u53E5\u4E2D\u751F\u6548\uFF0C\u5728 CSS \u4EE3\u7801\u7684 <code>@import</code> \u548C <code>url</code>\u5BFC\u5165\u8BED\u53E5\u4E2D\u4E5F\u540C\u6837\u751F\u6548\u3002</p><p>\u73B0\u5728 <code>src/assets</code> \u76EE\u5F55\u7684\u5185\u5BB9\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">.</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 icons</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u251C\u2500\u2500 favicon</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u251C\u2500\u2500 logo</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u251C\u2500\u2500 logo</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">2</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u251C\u2500\u2500 logo</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">3</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u251C\u2500\u2500 logo</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">4</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u251C\u2500\u2500 logo</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">5</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u2514\u2500\u2500 logo</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">6</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2514\u2500\u2500 imgs</span></span>
<span class="line"><span style="color:#A6ACCD;">    \u251C\u2500\u2500 background</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">png</span></span>
<span class="line"><span style="color:#A6ACCD;">    \u2514\u2500\u2500 vite</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">png</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u5728 App \u7EC4\u4EF6\u4E2D\u5F15\u5165 <code>vite.png</code>\u8FD9\u5F20\u56FE\u7247:</p><div class="language-jsx"><button class="copy"></button><span class="lang">jsx</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">\u3000</span><span style="color:#A6ACCD;">useEffect</span><span style="color:#F07178;">\u3000</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./App.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// 1. \u65B9\u5F0F\u4E00\uFF1A\u5BFC\u5165\u56FE\u7247</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> logo </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@assets/imgs/vite.png</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">App</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// 2. \u65B9\u5F0F\u4E8C\uFF1A\u52A8\u6001\u52A0\u8F7D\u56FE\u7247</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">useEffect</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">img</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">logo</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">HTMLImageElement</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">img</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">logo</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> [])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">App</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">header</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">App-header</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">img</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">={</span><span style="color:#A6ACCD;">logo</span><span style="color:#89DDFF;">} </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">App-logo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">alt</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">logo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">img</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">logo</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">alt</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">logo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">header</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> App</span></span>
<span class="line"></span></code></pre></div><p>\u53EF\u4EE5\u53D1\u73B0\u56FE\u7247\u80FD\u591F\u6B63\u5E38\u663E\u793A\uFF0C\u56FE\u7247\u8DEF\u5F84\u4E5F\u88AB\u89E3\u6790\u4E3A\u4E86\u6B63\u786E\u7684\u683C\u5F0F(<code>/</code>\u8868\u793A\u9879\u76EE\u6839\u8DEF\u5F84)\u3002</p><img src="`+e+`" style="zoom:80%;"><div class="language-html"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">img</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/assets/imgs/vite.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">alt</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">logo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">App-logo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">img</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">logo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">alt</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">logo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/assets/imgs/vite.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u73B0\u5728\u8BA9\u6211\u4EEC App \u6DFB\u52A0 <code>background</code> \u5C5E\u6027:</p><div class="language-css"><button class="copy"></button><span class="lang">css</span><pre><code><span class="line"><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">App</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">text-align</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> center</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">background</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">url</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@assets/imgs/background.png</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> no-repeat</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u518D\u6B21\u56DE\u5230\u6D4F\u89C8\u5668\uFF0C\u53EF\u4EE5\u770B\u5230\u751F\u6548\u540E\u7684\u80CC\u666F\u5982\u4E0B:</p><img src="`+c+`" style="zoom:80%;"><h4 id="svg-\u7EC4\u4EF6\u65B9\u5F0F\u52A0\u8F7D" tabindex="-1">Svg \u7EC4\u4EF6\u65B9\u5F0F\u52A0\u8F7D <a class="header-anchor" href="#svg-\u7EC4\u4EF6\u65B9\u5F0F\u52A0\u8F7D" aria-hidden="true">#</a></h4><p>\u521A\u624D\u6211\u4EEC\u6210\u529F\u5730\u5728 Vite \u4E2D\u5B9E\u73B0\u4E86\u56FE\u7247\u7684\u52A0\u8F7D\uFF0C\u4E0A\u8FF0\u8FD9\u4E9B\u52A0\u8F7D\u7684\u65B9\u5F0F\u5BF9\u4E8E svg \u683C\u5F0F\u6765\u8BF4\u4F9D\u7136\u662F\u9002\u7528\u7684\u3002\u4E0D\u8FC7\uFF0C\u6211\u4EEC\u901A\u5E38\u4E5F\u5E0C\u671B\u80FD\u5C06 svg \u5F53\u505A\u4E00\u4E2A\u7EC4\u4EF6\u6765\u5F15\u5165\uFF0C\u8FD9\u6837\u6211\u4EEC\u53EF\u4EE5\u5F88\u65B9\u4FBF\u5730\u4FEE\u6539 svg \u7684\u5404\u79CD\u5C5E\u6027\uFF0C\u800C\u4E14\u6BD4 img \u6807\u7B7E\u7684\u5F15\u5165\u65B9\u5F0F\u66F4\u52A0\u4F18\u96C5\u3002</p><p>SVG \u7EC4\u4EF6\u52A0\u8F7D\u5728\u4E0D\u540C\u7684\u524D\u7AEF\u6846\u67B6\u4E2D\u7684\u5B9E\u73B0\u4E0D\u592A\u76F8\u540C\uFF0C\u793E\u533A\u4E2D\u4E5F\u5DF2\u7ECF\u4E86\u6709\u4E86\u5BF9\u5E94\u7684\u63D2\u4EF6\u652F\u6301:</p><ul><li>Vue2 \u9879\u76EE\u4E2D\u53EF\u4EE5\u4F7F\u7528 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fpakholeung37%2Fvite-plugin-vue2-svg" target="_blank" rel="noreferrer">vite-plugin-vue2-svg</a>\u63D2\u4EF6\u3002</li><li>Vue3 \u9879\u76EE\u4E2D\u53EF\u4EE5\u5F15\u5165 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fjpkleemans%2Fvite-svg-loader" target="_blank" rel="noreferrer">vite-svg-loader</a>\u3002</li><li>React \u9879\u76EE\u4F7F\u7528 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fpd4d10%2Fvite-plugin-svgr" target="_blank" rel="noreferrer">vite-plugin-svgr</a>\u63D2\u4EF6\u3002</li></ul><p>\u73B0\u5728\u8BA9\u6211\u4EEC\u5728 React \u811A\u624B\u67B6\u9879\u76EE\u4E2D\u5B89\u88C5\u5BF9\u5E94\u7684\u4F9D\u8D56:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">svgr </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\u9700\u8981\u5728 vite \u914D\u7F6E\u6587\u4EF6\u6DFB\u52A0\u8FD9\u4E2A\u63D2\u4EF6:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> svgr </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-svgr</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u5176\u5B83\u63D2\u4EF6\u7701\u7565</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">svgr</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u968F\u540E\u6CE8\u610F\u8981\u5728 <code>tsconfig.json</code> \u6DFB\u52A0\u5982\u4E0B\u914D\u7F6E\uFF0C\u5426\u5219\u4F1A\u6709\u7C7B\u578B\u9519\u8BEF:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">compilerOptions</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u7701\u7565\u5176\u5B83\u914D\u7F6E</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">types</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite-plugin-svgr/client</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u4E0B\u6765\u8BA9\u6211\u4EEC\u5728\u9879\u76EE\u4E2D\u4F7F\u7528 svg \u7EC4\u4EF6:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ReactComponent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ReactLogo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@assets/icons/logo.svg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Header</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u5176\u4ED6\u7EC4\u4EF6\u5185\u5BB9\u7701\u7565</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">ReactLogo</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">width</span><span style="color:#89DDFF;">={</span><span style="color:#F78C6C;">400</span><span style="color:#89DDFF;">} </span><span style="color:#C792EA;">height</span><span style="color:#89DDFF;">={</span><span style="color:#F78C6C;">400</span><span style="color:#89DDFF;">} /&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u56DE\u5230\u6D4F\u89C8\u5668\u4E2D\uFF0C\u4F60\u53EF\u4EE5\u770B\u5230 svg \u5DF2\u7ECF\u6210\u529F\u6E32\u67D3:</p><img src="`+t+`" style="zoom:80%;"><h3 id="json-\u52A0\u8F7D" tabindex="-1">JSON \u52A0\u8F7D <a class="header-anchor" href="#json-\u52A0\u8F7D" aria-hidden="true">#</a></h3><p>Vite \u4E2D\u5DF2\u7ECF\u5185\u7F6E\u4E86\u5BF9\u4E8E JSON \u6587\u4EF6\u7684\u89E3\u6790\uFF0C\u5E95\u5C42\u4F7F\u7528 <code>@rollup/pluginutils</code> \u7684 <code>dataToEsm</code> \u65B9\u6CD5\u5C06 JSON \u5BF9\u8C61\u8F6C\u6362\u4E3A\u4E00\u4E2A\u5305\u542B\u5404\u79CD\u5177\u540D\u5BFC\u51FA\u7684 ES \u6A21\u5757\u3002</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">version</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../../../package.json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u4E0D\u8FC7\u4F60\u4E5F\u53EF\u4EE5\u5728\u914D\u7F6E\u6587\u4EF6\u7981\u7528\u6309\u540D\u5BFC\u5165\u7684\u65B9\u5F0F:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">json</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">stringify</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u6837\u4F1A\u5C06 JSON \u7684\u5185\u5BB9\u89E3\u6790\u4E3A <code>export default JSON.parse(&quot;xxx&quot;)</code>\uFF0C\u8FD9\u6837\u4F1A\u5931\u53BB <code>\u6309\u540D\u5BFC\u51FA</code> \u7684\u80FD\u529B\uFF0C\u4E0D\u8FC7\u5728 JSON \u6570\u636E\u91CF\u6BD4\u8F83\u5927\u7684\u65F6\u5019\uFF0C\u53EF\u4EE5\u4F18\u5316\u89E3\u6790\u6027\u80FD\u3002</p><h3 id="webworker-\u811A\u672C" tabindex="-1">WebWorker \u811A\u672C <a class="header-anchor" href="#webworker-\u811A\u672C" aria-hidden="true">#</a></h3><p>Vite \u4E2D\u4F7F\u7528 Web Worker \u4E5F\u975E\u5E38\u7B80\u5355\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5728\u65B0\u5EFA <code>workers/example.js</code> \u6587\u4EF6:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> start </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">count</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">setInterval</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u7ED9\u4E3B\u7EBF\u7A0B\u4F20\u503C</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">postMessage</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">++</span><span style="color:#A6ACCD;">count</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">2000</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">start</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\u5728 App \u7EC4\u4EF6\u4E2D\u5F15\u5165\uFF0C\u5F15\u5165\u7684\u65F6\u5019\u6CE8\u610F\u52A0\u4E0A<code>?worker</code>\u540E\u7F00\uFF0C\u76F8\u5F53\u4E8E\u544A\u8BC9 Vite \u8FD9\u662F\u4E00\u4E2A Web Worker \u811A\u672C\u6587\u4EF6:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> Worker </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./works/example.js?worker</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// 1. \u521D\u59CB\u5316 Worker \u5B9E\u4F8B</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> worker </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Worker</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">// 2. \u4E3B\u7EBF\u7A0B\u76D1\u542C worker \u7684\u4FE1\u606F</span></span>
<span class="line"><span style="color:#A6ACCD;">worker</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">message</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u6253\u5F00\u6D4F\u89C8\u5668\u7684\u63A7\u5236\u9762\u677F\uFF0C\u4F60\u53EF\u4EE5\u770B\u5230 Worker \u4F20\u7ED9\u4E3B\u7EBF\u7A0B\u7684\u4FE1\u606F\u5DF2\u7ECF\u6210\u529F\u6253\u5370:</p><img src="`+r+`" style="zoom:70%;"><p>\u8BF4\u660E Web Worker \u811A\u672C\u5DF2\u7ECF\u6210\u529F\u6267\u884C\uFF0C\u4E5F\u80FD\u4E0E\u4E3B\u7EBF\u7A0B\u6B63\u5E38\u901A\u4FE1\u3002</p><h3 id="web-assembly-\u6587\u4EF6" tabindex="-1">Web Assembly \u6587\u4EF6 <a class="header-anchor" href="#web-assembly-\u6587\u4EF6" aria-hidden="true">#</a></h3><p>Vite \u5BF9\u4E8E <code>.wasm</code> \u6587\u4EF6\u4E5F\u63D0\u4F9B\u4E86\u5F00\u7BB1\u5373\u7528\u7684\u652F\u6301\uFF0C\u6211\u4EEC\u62FF\u4E00\u4E2A\u6590\u6CE2\u62C9\u5951\u7684 <code>.wasm</code> \u6587\u4EF6\u6765\u8FDB\u884C\u4E00\u4E0B\u5B9E\u9645\u64CD\u4F5C\uFF0C\u5BF9\u5E94\u7684 JavaScript \u539F\u6587\u4EF6\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fib</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">n</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    	</span><span style="color:#A6ACCD;">b</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">while</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">t</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">b</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u6211\u4EEC\u5728\u7EC4\u4EF6\u4E2D\u5BFC\u5165 <code>fib.wasm</code> \u6587\u4EF6:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> init </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./fib.wasm</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">type</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">FibFunc</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">num</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">init</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fibFunc</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">exports.</span><span style="color:#A6ACCD;">fib</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">FibFunc</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Fib result:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fibFunc</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">10</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>Vite \u4F1A\u5BF9<code>.wasm</code>\u6587\u4EF6\u7684\u5185\u5BB9\u8FDB\u884C\u5C01\u88C5\uFF0C\u9ED8\u8BA4\u5BFC\u51FA\u4E3A init \u51FD\u6570\uFF0C\u8FD9\u4E2A\u51FD\u6570\u8FD4\u56DE\u4E00\u4E2A Promise\uFF0C\u56E0\u6B64\u6211\u4EEC\u53EF\u4EE5\u5728\u5176 then \u65B9\u6CD5\u4E2D\u62FF\u5230\u5176\u5BFC\u51FA\u7684\u6210\u5458\u2014\u2014<code>fib</code>\u65B9\u6CD5\u3002</p><p>\u56DE\u5230\u6D4F\u89C8\u5668\uFF0C\u6211\u4EEC\u53EF\u4EE5\u67E5\u770B\u5230\u8BA1\u7B97\u7ED3\u679C\uFF0C\u8BF4\u660E .wasm \u6587\u4EF6\u5DF2\u7ECF\u88AB\u6210\u529F\u6267\u884C:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">[vite] connecting</span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">App</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tsx:</span><span style="color:#F78C6C;">26</span><span style="color:#A6ACCD;"> Fib </span><span style="color:#FFCB6B;">result</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">55</span></span>
<span class="line"><span style="color:#A6ACCD;">client</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ts:</span><span style="color:#F78C6C;">53</span><span style="color:#A6ACCD;"> [vite] connected</span><span style="color:#89DDFF;">.</span></span>
<span class="line"></span></code></pre></div><h3 id="\u5176\u4ED6\u9759\u6001\u8D44\u6E90" tabindex="-1">\u5176\u4ED6\u9759\u6001\u8D44\u6E90 <a class="header-anchor" href="#\u5176\u4ED6\u9759\u6001\u8D44\u6E90" aria-hidden="true">#</a></h3><p>\u9664\u4E86\u4E0A\u8FF0\u7684\u4E00\u4E9B\u8D44\u6E90\u683C\u5F0F\uFF0CVite \u4E5F\u5BF9\u4E0B\u9762\u51E0\u7C7B\u683C\u5F0F\u63D0\u4F9B\u4E86\u5185\u7F6E\u7684\u652F\u6301:</p><ul><li>\u5A92\u4F53\u7C7B\u6587\u4EF6\uFF0C\u5305\u62EC<code>mp4</code>\u3001<code>webm</code>\u3001<code>ogg</code>\u3001<code>mp3</code>\u3001<code>wav</code>\u3001<code>flac</code>\u548C<code>aac</code>\u3002</li><li>\u5B57\u4F53\u7C7B\u6587\u4EF6\u3002\u5305\u62EC<code>woff</code>\u3001<code>woff2</code>\u3001<code>eot</code>\u3001<code>ttf</code> \u548C <code>otf</code>\u3002</li><li>\u6587\u672C\u7C7B\u3002\u5305\u62EC<code>webmanifest</code>\u3001<code>pdf</code>\u548C<code>txt</code>\u3002</li></ul><p>\u4E5F\u5C31\u662F\u8BF4\uFF0C\u4F60\u53EF\u4EE5\u5728 Vite \u5C06\u8FD9\u4E9B\u7C7B\u578B\u7684\u6587\u4EF6\u5F53\u505A\u4E00\u4E2A ES \u6A21\u5757\u6765\u5BFC\u5165\u4F7F\u7528\u3002 \u5982\u679C\u4F60\u7684\u9879\u76EE\u4E2D\u8FD8\u5B58\u5728\u5176\u5B83\u683C\u5F0F\u7684\u9759\u6001\u8D44\u6E90\uFF0C\u4F60\u53EF\u4EE5\u901A\u8FC7 <code>assetsInclude</code> \u914D\u7F6E\u8BA9 Vite \u6765\u652F\u6301\u52A0\u8F7D:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">assetsInclude</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.gltf</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="\u7279\u6B8A\u8D44\u6E90\u540E\u7F00" tabindex="-1">\u7279\u6B8A\u8D44\u6E90\u540E\u7F00 <a class="header-anchor" href="#\u7279\u6B8A\u8D44\u6E90\u540E\u7F00" aria-hidden="true">#</a></h3><p>Vite \u4E2D\u5F15\u5165\u9759\u6001\u8D44\u6E90\u65F6\uFF0C\u4E5F\u652F\u6301\u5728\u8DEF\u5F84\u6700\u540E\u52A0\u4E0A\u4E00\u4E9B\u7279\u6B8A\u7684 query \u540E\u7F00\uFF0C\u5305\u62EC:</p><ul><li><code>?url</code>: \u8868\u793A\u83B7\u53D6\u8D44\u6E90\u7684\u8DEF\u5F84\uFF0C\u8FD9\u5728\u53EA\u60F3\u83B7\u53D6\u6587\u4EF6\u8DEF\u5F84\u800C\u4E0D\u662F\u5185\u5BB9\u7684\u573A\u666F\u5C06\u4F1A\u5F88\u6709\u7528\u3002</li><li><code>?raw</code>: \u8868\u793A\u83B7\u53D6\u8D44\u6E90\u7684\u5B57\u7B26\u4E32\u5185\u5BB9\uFF0C\u5982\u679C\u4F60\u53EA\u60F3\u62FF\u5230\u8D44\u6E90\u7684\u539F\u59CB\u5185\u5BB9\uFF0C\u53EF\u4EE5\u4F7F\u7528\u8FD9\u4E2A\u540E\u7F00\u3002</li><li><code>?inline</code>: \u8868\u793A\u8D44\u6E90\u5F3A\u5236\u5185\u8054\uFF0C\u800C\u4E0D\u662F\u6253\u5305\u6210\u5355\u72EC\u7684\u6587\u4EF6\u3002</li></ul><h3 id="\u751F\u4EA7\u73AF\u5883\u5904\u7406" tabindex="-1">\u751F\u4EA7\u73AF\u5883\u5904\u7406 <a class="header-anchor" href="#\u751F\u4EA7\u73AF\u5883\u5904\u7406" aria-hidden="true">#</a></h3><p>\u5728\u524D\u9762\u7684\u5185\u5BB9\u4E2D\uFF0C\u6211\u4EEC\u56F4\u7ED5\u7740\u5982\u4F55\u52A0\u8F7D\u9759\u6001\u8D44\u6E90\u8FD9\u4E2A\u95EE\u9898\uFF0C\u5728 Vite \u4E2D\u8FDB\u884C\u5177\u4F53\u7684\u7F16\u7801\u5B9E\u8DF5\uFF0C\u76F8\u4FE1\u5BF9\u4E8E Vite \u4E2D\u5404\u79CD\u9759\u6001\u8D44\u6E90\u7684\u4F7F\u7528\u4F60\u5DF2\u7ECF\u6BD4\u8F83\u719F\u6089\u4E86\u3002\u4F46\u53E6\u4E00\u65B9\u9762\uFF0C\u5728\u751F\u4EA7\u73AF\u5883\u4E0B\uFF0C\u6211\u4EEC\u53C8\u9762\u4E34\u7740\u4E00\u4E9B\u65B0\u7684\u95EE\u9898\u3002</p><ul><li>\u90E8\u7F72\u57DF\u540D\u600E\u4E48\u914D\u7F6E\uFF1F</li><li>\u8D44\u6E90\u6253\u5305\u6210\u5355\u6587\u4EF6\u8FD8\u662F\u4F5C\u4E3A Base64 \u683C\u5F0F\u5185\u8054?</li><li>\u56FE\u7247\u592A\u5927\u4E86\u600E\u4E48\u538B\u7F29\uFF1F</li><li>svg \u8BF7\u6C42\u6570\u91CF\u592A\u591A\u4E86\u600E\u4E48\u4F18\u5316\uFF1F</li></ul><h4 id="\u81EA\u5B9A\u4E49\u90E8\u7F72\u57DF\u540D" tabindex="-1">\u81EA\u5B9A\u4E49\u90E8\u7F72\u57DF\u540D <a class="header-anchor" href="#\u81EA\u5B9A\u4E49\u90E8\u7F72\u57DF\u540D" aria-hidden="true">#</a></h4><p>\u4E00\u822C\u5728\u6211\u4EEC\u8BBF\u95EE\u7EBF\u4E0A\u7684\u7AD9\u70B9\u65F6\uFF0C\u7AD9\u70B9\u91CC\u9762\u4E00\u4E9B\u9759\u6001\u8D44\u6E90\u7684\u5730\u5740\u90FD\u5305\u542B\u4E86\u76F8\u5E94\u57DF\u540D\u7684\u524D\u7F00\uFF0C\u5982:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">img</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://sanyuan.cos.ap-beijing.myqcloud.com/logo.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u4EE5\u4E0A\u9762\u8FD9\u4E2A\u5730\u5740\u4F8B\u5B50\uFF0C<code>https://sanyuan.cos.ap-beijing.myqcloud.com</code>\u662F CDN \u5730\u5740\u524D\u7F00\uFF0C<code>/logo.png</code> \u5219\u662F\u6211\u4EEC\u5F00\u53D1\u9636\u6BB5\u4F7F\u7528\u7684\u8DEF\u5F84\u3002\u90A3\u4E48\uFF0C\u6211\u4EEC\u662F\u4E0D\u662F\u9700\u8981\u5728\u4E0A\u7EBF\u524D\u628A\u56FE\u7247\u5148\u4E0A\u4F20\u5230 CDN\uFF0C\u7136\u540E\u5C06\u4EE3\u7801\u4E2D\u7684\u5730\u5740\u624B\u52A8\u66FF\u6362\u6210\u7EBF\u4E0A\u5730\u5740\u5462\uFF1F\u8FD9\u6837\u5C31\u592A\u9EBB\u70E6\u4E86\uFF01</p><p>\u5728 Vite \u4E2D\u6211\u4EEC\u53EF\u4EE5\u6709\u66F4\u52A0\u81EA\u52A8\u5316\u7684\u65B9\u5F0F\u6765\u5B9E\u73B0\u5730\u5740\u7684\u66FF\u6362\uFF0C\u53EA\u9700\u8981\u5728\u914D\u7F6E\u6587\u4EF6\u4E2D\u6307\u5B9A<code>base</code>\u53C2\u6570\u5373\u53EF:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#676E95;">// \u662F\u5426\u4E3A\u751F\u4EA7\u73AF\u5883\uFF0C\u5728\u751F\u4EA7\u73AF\u5883\u4E00\u822C\u4F1A\u6CE8\u5165 NODE_ENV \u8FD9\u4E2A\u73AF\u5883\u53D8\u91CF\uFF0C\u89C1\u4E0B\u9762\u7684\u73AF\u5883\u53D8\u91CF\u6587\u4EF6\u914D\u7F6E</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> isProduction </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> process</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">env</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">NODE_ENV </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">production</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">// \u586B\u5165\u9879\u76EE\u7684 CDN \u57DF\u540D\u5730\u5740</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> CDN_URL </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">xxxxxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u5177\u4F53\u914D\u7F6E</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">base</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isProduction</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CDN_URL</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// .env.development</span></span>
<span class="line"><span style="color:#A6ACCD;">NODE_ENV</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">development</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// .env.production</span></span>
<span class="line"><span style="color:#A6ACCD;">NODE_ENV</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">production</span></span>
<span class="line"></span></code></pre></div><p>\u6CE8\u610F\u5728\u9879\u76EE\u6839\u76EE\u5F55\u65B0\u589E\u7684\u4E24\u4E2A\u73AF\u5883\u53D8\u91CF\u6587\u4EF6<code>.env.development</code>\u548C<code>.env.production</code>\uFF0C\u987E\u540D\u601D\u4E49\uFF0C\u5373\u5206\u522B\u5728\u5F00\u53D1\u73AF\u5883\u548C\u751F\u4EA7\u73AF\u5883\u6CE8\u5165\u4E00\u4E9B\u73AF\u5883\u53D8\u91CF\uFF0C\u8FD9\u91CC\u4E3A\u4E86\u533A\u5206\u4E0D\u540C\u73AF\u5883\u6211\u4EEC\u52A0\u4E0A\u4E86<code>NODE_ENV</code>\uFF0C\u4F60\u4E5F\u53EF\u4EE5\u6839\u636E\u9700\u8981\u6DFB\u52A0\u522B\u7684\u73AF\u5883\u53D8\u91CF\u3002</p><blockquote><p>\u6253\u5305\u7684\u65F6\u5019 Vite \u4F1A\u81EA\u52A8\u5C06\u8FD9\u4E9B\u73AF\u5883\u53D8\u91CF\u66FF\u6362\u4E3A\u76F8\u5E94\u7684\u5B57\u7B26\u4E32\u3002</p></blockquote><p>\u63A5\u7740\u6267\u884C <code>pnpm run build</code>\uFF0C\u53EF\u4EE5\u53D1\u73B0\u4EA7\u7269\u4E2D\u7684\u9759\u6001\u8D44\u6E90\u5730\u5740\u5DF2\u7ECF\u81EA\u52A8\u52A0\u4E0A\u4E86 CDN \u5730\u5740\u524D\u7F00:</p><div class="language-html"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F07178;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">lang</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">en</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">charset</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UTF-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">link</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">rel</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">icon</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">image/svg+xml</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">href</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/favicon.svg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">viewport</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">content</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width=device-width, initial-scale=1.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">Vite App</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">    &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">crossorigin</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://img.yueluo.club/assets/index.f2f294a4.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">link</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">rel</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">stylesheet</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">href</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://img.yueluo.club/assets/index.65178a92.css</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>\u5F53\u7136\uFF0C\u6709\u65F6\u5019\u53EF\u80FD\u9879\u76EE\u4E2D\u7684\u67D0\u4E9B\u56FE\u7247\u9700\u8981\u5B58\u653E\u5230\u53E6\u5916\u7684\u5B58\u50A8\u670D\u52A1\uFF0C\u4E00\u79CD\u76F4\u63A5\u7684\u65B9\u6848\u662F\u5C06\u5B8C\u6574\u5730\u5740\u5199\u6B7B\u5230 src \u5C5E\u6027\u4E2D\uFF0C\u5982:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">img</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://my-image-cdn.com/logo.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u6837\u505A\u663E\u7136\u662F\u4E0D\u592A\u4F18\u96C5\u7684\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u5B9A\u4E49\u73AF\u5883\u53D8\u91CF\u7684\u65B9\u5F0F\u6765\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\uFF0C\u5728\u9879\u76EE\u6839\u76EE\u5F55\u65B0\u589E<code>.env</code>\u6587\u4EF6:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// \u5F00\u53D1\u73AF\u5883\u4F18\u5148\u7EA7: .env.development &gt; .env</span></span>
<span class="line"><span style="color:#676E95;">// \u751F\u4EA7\u73AF\u5883\u4F18\u5148\u7EA7: .env.production &gt; .env</span></span>
<span class="line"><span style="color:#676E95;">// .env \u6587\u4EF6</span></span>
<span class="line"><span style="color:#A6ACCD;">VITE_IMG_BASE_URL</span><span style="color:#89DDFF;">=</span><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;">//my-image-cdn.com</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\u8FDB\u5165 <code>src/vite-env.d.ts</code>\u589E\u52A0\u7C7B\u578B\u58F0\u660E:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">/// </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">reference</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">types</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite/client</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">interface</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ImportMetaEnv</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">readonly</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">VITE_APP_TITLE</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u81EA\u5B9A\u4E49\u7684\u73AF\u5883\u53D8\u91CF</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">readonly</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">VITE_IMG_BASE_URL</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">interface</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ImportMeta</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">readonly</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">env</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ImportMetaEnv</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u503C\u5F97\u6CE8\u610F\u7684\u662F\uFF0C\u5982\u679C\u67D0\u4E2A\u73AF\u5883\u53D8\u91CF\u8981\u5728 Vite \u4E2D\u901A\u8FC7 <code>i<wbr>mport.meta.env</code> \u8BBF\u95EE\uFF0C\u90A3\u4E48\u5B83\u5FC5\u987B\u4EE5<code>VITE_</code>\u5F00\u5934\uFF0C\u5982<code>VITE_IMG_BASE_URL</code>\u3002\u63A5\u4E0B\u6765\u6211\u4EEC\u5728\u7EC4\u4EF6\u4E2D\u6765\u4F7F\u7528\u8FD9\u4E2A\u73AF\u5883\u53D8\u91CF:</p><div class="language-html"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">img</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">{new</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">URL(</span><span style="color:#89DDFF;">&#39;./logo.png&#39;, </span><span style="color:#C792EA;">i<wbr>mport.meta.env.VITE_IMG_BASE_URL).href}</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u4E0B\u6765\u5728 <code>\u5F00\u53D1\u73AF\u5883</code> \u542F\u52A8\u9879\u76EE\u6216\u8005 <code>\u751F\u4EA7\u73AF\u5883</code> \u6253\u5305\u540E\u53EF\u4EE5\u770B\u5230\u73AF\u5883\u53D8\u91CF\u5DF2\u7ECF\u88AB\u66FF\u6362\uFF0C\u5730\u5740\u80FD\u591F\u6B63\u5E38\u663E\u793A:</p><div class="language-html"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">img</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://my-image-cdn.com/logo.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u81F3\u6B64\uFF0C\u6211\u4EEC\u5C31\u5F7B\u5E95\u89E3\u51B3\u4E86\u56FE\u7247\u8D44\u6E90\u751F\u4EA7\u73AF\u5883\u57DF\u540D\u66FF\u6362\u7684\u95EE\u9898\u3002</p><h4 id="\u5355\u6587\u4EF6-or-\u5185\u8054" tabindex="-1">\u5355\u6587\u4EF6 or \u5185\u8054 <a class="header-anchor" href="#\u5355\u6587\u4EF6-or-\u5185\u8054" aria-hidden="true">#</a></h4><p>\u5728 Vite \u4E2D\uFF0C\u6240\u6709\u7684\u9759\u6001\u8D44\u6E90\u90FD\u6709\u4E24\u79CD\u6784\u5EFA\u65B9\u5F0F\uFF0C\u4E00\u79CD\u662F\u6253\u5305\u6210\u4E00\u4E2A\u5355\u6587\u4EF6\uFF0C\u53E6\u4E00\u79CD\u662F\u901A\u8FC7 base64 \u7F16\u7801\u7684\u683C\u5F0F\u5185\u5D4C\u5230\u4EE3\u7801\u4E2D\u3002</p><p>\u8FD9\u4E24\u79CD\u65B9\u6848\u5230\u5E95\u5E94\u8BE5\u5982\u4F55\u6765\u9009\u62E9\u5462\uFF1F</p><p>\u5BF9\u4E8E\u6BD4\u8F83\u5C0F\u7684\u8D44\u6E90\uFF0C\u9002\u5408\u5185\u8054\u5230\u4EE3\u7801\u4E2D\uFF0C\u4E00\u65B9\u9762\u5BF9<code>\u4EE3\u7801\u4F53\u79EF</code>\u7684\u5F71\u54CD\u5F88\u5C0F\uFF0C\u53E6\u4E00\u65B9\u9762\u53EF\u4EE5\u51CF\u5C11\u4E0D\u5FC5\u8981\u7684\u7F51\u7EDC\u8BF7\u6C42\uFF0C<code>\u4F18\u5316\u7F51\u7EDC\u6027\u80FD</code>\u3002\u800C\u5BF9\u4E8E\u6BD4\u8F83\u5927\u7684\u8D44\u6E90\uFF0C\u5C31\u63A8\u8350\u5355\u72EC\u6253\u5305\u6210\u4E00\u4E2A\u6587\u4EF6\uFF0C\u800C\u4E0D\u662F\u5185\u8054\u4E86\uFF0C\u5426\u5219\u53EF\u80FD\u5BFC\u81F4\u4E0A MB \u7684 base64 \u5B57\u7B26\u4E32\u5185\u5D4C\u5230\u4EE3\u7801\u4E2D\uFF0C\u5BFC\u81F4\u4EE3\u7801\u4F53\u79EF\u77AC\u95F4\u5E9E\u5927\uFF0C\u9875\u9762\u52A0\u8F7D\u6027\u80FD\u76F4\u7EBF\u4E0B\u964D\u3002</p><p>Vite \u4E2D\u5185\u7F6E\u7684\u4F18\u5316\u65B9\u6848\u662F\u4E0B\u9762\u8FD9\u6837\u7684:</p><ul><li>\u5982\u679C\u9759\u6001\u8D44\u6E90\u4F53\u79EF &gt;= 4KB\uFF0C\u5219\u63D0\u53D6\u6210\u5355\u72EC\u7684\u6587\u4EF6</li><li>\u5982\u679C\u9759\u6001\u8D44\u6E90\u4F53\u79EF &lt; 4KB\uFF0C\u5219\u4F5C\u4E3A base64 \u683C\u5F0F\u7684\u5B57\u7B26\u4E32\u5185\u8054</li></ul><p>\u4E0A\u8FF0\u7684<code>4 KB</code>\u5373\u4E3A\u63D0\u53D6\u6210\u5355\u6587\u4EF6\u7684\u4E34\u754C\u503C\uFF0C\u5F53\u7136\uFF0C\u8FD9\u4E2A\u4E34\u754C\u503C\u4F60\u53EF\u4EE5\u901A\u8FC7 <code>build.assetsInlineLimit</code> \u81EA\u884C\u914D\u7F6E\uFF0C\u5982\u4E0B\u4EE3\u7801\u6240\u793A:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">build</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// 8 KB</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">assetsInlineLimit</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">8</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1024</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><blockquote><p>svg \u683C\u5F0F\u7684\u6587\u4EF6\u4E0D\u53D7\u8FD9\u4E2A\u4E34\u65F6\u503C\u7684\u5F71\u54CD\uFF0C\u59CB\u7EC8\u4F1A\u6253\u5305\u6210\u5355\u72EC\u7684\u6587\u4EF6\uFF0C\u56E0\u4E3A\u5B83\u548C\u666E\u901A\u683C\u5F0F\u7684\u56FE\u7247\u4E0D\u4E00\u6837\uFF0C\u9700\u8981\u52A8\u6001\u8BBE\u7F6E\u4E00\u4E9B\u5C5E\u6027</p></blockquote><h4 id="\u56FE\u7247\u538B\u7F29" tabindex="-1">\u56FE\u7247\u538B\u7F29 <a class="header-anchor" href="#\u56FE\u7247\u538B\u7F29" aria-hidden="true">#</a></h4><p>\u56FE\u7247\u8D44\u6E90\u7684\u4F53\u79EF\u5F80\u5F80\u662F\u9879\u76EE\u4EA7\u7269\u4F53\u79EF\u7684\u5927\u5934\uFF0C\u5982\u679C\u80FD\u5C3D\u53EF\u80FD\u7CBE\u7B80\u56FE\u7247\u7684\u4F53\u79EF\uFF0C\u90A3\u4E48\u5BF9\u9879\u76EE\u6574\u4F53\u6253\u5305\u4EA7\u7269\u4F53\u79EF\u7684\u4F18\u5316\u5C06\u4F1A\u662F\u975E\u5E38\u660E\u663E\u7684\u3002\u5728 JavaScript \u9886\u57DF\u6709\u4E00\u4E2A\u975E\u5E38\u77E5\u540D\u7684\u56FE\u7247\u538B\u7F29\u5E93 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fimagemin" target="_blank" rel="noreferrer">imagemin</a>\uFF0C\u4F5C\u4E3A\u4E00\u4E2A\u5E95\u5C42\u7684\u538B\u7F29\u5DE5\u5177\uFF0C\u524D\u7AEF\u7684\u9879\u76EE\u4E2D\u7ECF\u5E38\u57FA\u4E8E\u5B83\u6765\u8FDB\u884C\u56FE\u7247\u538B\u7F29\uFF0C\u6BD4\u5982 Webpack \u4E2D\u5927\u540D\u9F0E\u9F0E\u7684<code>image-webpack-loader</code>\u3002\u793E\u533A\u5F53\u4E2D\u4E5F\u5DF2\u7ECF\u6709\u4E86\u5F00\u7BB1\u5373\u7528\u7684 Vite \u63D2\u4EF6\u2014\u2014 <code>vite-plugin-imagemin</code>\uFF0C\u9996\u5148\u8BA9\u6211\u4EEC\u6765\u5B89\u88C5\u5B83:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">imagemin </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">ignore</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">scripts </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u6B63\u5E38\u4E0D\u9700\u8981\u4F7F\u7528 --ignore-scripts \u53C2\u6570\uFF0C\u8BE5\u53C2\u6570\u4F1A\u5FFD\u7565\u90E8\u5206\u4F9D\u8D56\u5B89\u88C5</span></span>
<span class="line"></span></code></pre></div><p>\u968F\u540E\u5728 Vite \u914D\u7F6E\u6587\u4EF6\u4E2D\u5F15\u5165:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">//vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> viteImagemin </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-imagemin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u5FFD\u7565\u524D\u9762\u7684\u63D2\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">viteImagemin</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u65E0\u635F\u538B\u7F29\u914D\u7F6E\uFF0C\u65E0\u635F\u538B\u7F29\u4E0B\u56FE\u7247\u8D28\u91CF\u4E0D\u4F1A\u53D8\u5DEE</span></span>
<span class="line"><span style="color:#F07178;">      optipng</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        optimizationLevel</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">7</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u6709\u635F\u538B\u7F29\u914D\u7F6E\uFF0C\u6709\u635F\u538B\u7F29\u4E0B\u56FE\u7247\u8D28\u91CF\u53EF\u80FD\u4F1A\u53D8\u5DEE</span></span>
<span class="line"><span style="color:#F07178;">      pngquant</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        quality</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#F78C6C;">0.8</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0.9</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// svg \u4F18\u5316</span></span>
<span class="line"><span style="color:#F07178;">      svgo</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">removeViewBox</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">removeEmptyAttrs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            active</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        ]</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u53EF\u4EE5\u5C1D\u8BD5\u6267\u884C<code>pnpm run build</code>\u8FDB\u884C\u6253\u5305\uFF0CVite \u63D2\u4EF6\u4F1A\u81EA\u52A8\u5E2E\u52A9\u6211\u4EEC\u8C03\u7528 <code>imagemin</code> \u8FDB\u884C\u9879\u76EE\u56FE\u7247\u7684\u538B\u7F29\u3002</p><img src="`+F+`" style="zoom:80%;"><h4 id="\u96EA\u78A7\u56FE\u4F18\u5316" tabindex="-1">\u96EA\u78A7\u56FE\u4F18\u5316 <a class="header-anchor" href="#\u96EA\u78A7\u56FE\u4F18\u5316" aria-hidden="true">#</a></h4><p>\u5728\u5B9E\u9645\u7684\u9879\u76EE\u4E2D\u6211\u4EEC\u8FD8\u4F1A\u7ECF\u5E38\u7528\u5230\u5404\u79CD\u5404\u6837\u7684 svg \u56FE\u6807\uFF0C\u867D\u7136 svg \u6587\u4EF6\u4E00\u822C\u4F53\u79EF\u4E0D\u5927\uFF0C\u4F46 Vite \u4E2D\u5BF9\u4E8E svg \u6587\u4EF6\u4F1A\u59CB\u7EC8\u6253\u5305\u6210\u5355\u6587\u4EF6\uFF0C\u5927\u91CF\u7684\u56FE\u6807\u5F15\u5165\u4E4B\u540E\u4F1A\u5BFC\u81F4\u7F51\u7EDC\u8BF7\u6C42\u589E\u52A0\uFF0C\u5927\u91CF\u7684 HTTP \u8BF7\u6C42\u4F1A\u5BFC\u81F4\u7F51\u7EDC\u89E3\u6790\u8017\u65F6\u53D8\u957F\uFF0C\u9875\u9762\u52A0\u8F7D\u6027\u80FD\u76F4\u63A5\u53D7\u5230\u5F71\u54CD\u3002\u8FD9\u4E2A\u95EE\u9898\u600E\u4E48\u89E3\u51B3\u5462\uFF1F</p><blockquote><p>HTTP2 \u7684\u591A\u8DEF\u590D\u7528\u8BBE\u8BA1\u53EF\u4EE5\u89E3\u51B3\u5927\u91CF HTTP \u7684\u8BF7\u6C42\u5BFC\u81F4\u7684\u7F51\u7EDC\u52A0\u8F7D\u6027\u80FD\u95EE\u9898\uFF0C\u56E0\u6B64\u96EA\u78A7\u56FE\u6280\u672F\u5728 HTTP2 \u5E76\u6CA1\u6709\u660E\u663E\u7684\u4F18\u5316\u6548\u679C\uFF0C\u8FD9\u4E2A\u6280\u672F\u66F4\u9002\u5408\u5728\u4F20\u7EDF\u7684 HTTP 1.1 \u573A\u666F\u4E0B\u4F7F\u7528(\u6BD4\u5982\u672C\u5730\u7684 Dev Server)\u3002</p></blockquote><p>\u6BD4\u5982\u5728 Header \u4E2D\u5206\u522B\u5F15\u5165 5 \u4E2A svg \u6587\u4EF6:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> Logo2 </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@assets/icons/logo-2.svg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> Logo3 </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@assets/icons/logo-3.svg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> Logo4 </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@assets/icons/logo-4.svg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> Logo5 </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@assets/icons/logo-5.svg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> Logo6 </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@assets/icons/logo-6.svg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u91CC\u987A\u4FBF\u8BF4\u4E00\u53E5\uFF0CVite \u4E2D\u63D0\u4F9B\u4E86 <code>i<wbr>mport.meta.glob</code> \u7684\u8BED\u6CD5\u7CD6\u6765\u89E3\u51B3\u8FD9\u79CD<strong>\u6279\u91CF\u5BFC\u5165</strong>\u7684\u95EE\u9898\uFF0C\u5982\u4E0A\u8FF0\u7684 import \u8BED\u53E5\u53EF\u4EE5\u5199\u6210\u4E0B\u9762\u8FD9\u6837:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> icons </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">glob</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./assets/icon/logo-*.svg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u7ED3\u679C\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">./</span><span style="color:#A6ACCD;">assets</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">icon</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">logo</span><span style="color:#89DDFF;">-</span><span style="color:#F07178;">1</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">import</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/assets/icon/logo-1.svg?import</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">./</span><span style="color:#A6ACCD;">assets</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">icon</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">logo</span><span style="color:#89DDFF;">-</span><span style="color:#F07178;">2</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">import</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/assets/icon/logo-2.svg?import</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">./</span><span style="color:#A6ACCD;">assets</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">icon</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">logo</span><span style="color:#89DDFF;">-</span><span style="color:#F07178;">3</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">import</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/assets/icon/logo-3.svg?import</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">./</span><span style="color:#A6ACCD;">assets</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">icon</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">logo</span><span style="color:#89DDFF;">-</span><span style="color:#F07178;">4</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">import</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/assets/icon/logo-4.svg?import</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">./</span><span style="color:#A6ACCD;">assets</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">icon</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">logo</span><span style="color:#89DDFF;">-</span><span style="color:#F07178;">5</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">import</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/assets/icon/logo-5.svg?import</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">./</span><span style="color:#A6ACCD;">assets</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">icon</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">logo</span><span style="color:#89DDFF;">-</span><span style="color:#F07178;">6</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">import</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/assets/icon/logo-6.svg?import</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u53EF\u4EE5\u770B\u5230\u5BF9\u8C61\u7684 value \u90FD\u662F\u52A8\u6001 import\uFF0C\u9002\u5408\u6309\u9700\u52A0\u8F7D\u7684\u573A\u666F\u3002 \u5728\u8FD9\u91CC\u6211\u4EEC\u53EA\u9700\u8981\u540C\u6B65\u52A0\u8F7D\u5373\u53EF\uFF0C\u53EF\u4EE5\u4F7F\u7528 <code>i<wbr>mport.meta.globEager</code>\u6765\u5B8C\u6210:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> icons </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">globEager</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./assets/icon/logo-*.svg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p><code>icons </code> \u7684\u7ED3\u679C\u6253\u5370\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">./</span><span style="color:#A6ACCD;">assets</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">icon</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">logo</span><span style="color:#89DDFF;">-</span><span style="color:#F07178;">1</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">Module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#82AAFF;">Symbol</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">Symbol</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">toStringTag</span><span style="color:#F07178;">): </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Module</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">./</span><span style="color:#A6ACCD;">assets</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">icon</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">logo</span><span style="color:#89DDFF;">-</span><span style="color:#F07178;">2</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">Module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#82AAFF;">Symbol</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">Symbol</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">toStringTag</span><span style="color:#F07178;">): </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Module</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">./</span><span style="color:#A6ACCD;">assets</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">icon</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">logo</span><span style="color:#89DDFF;">-</span><span style="color:#F07178;">3</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">Module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#82AAFF;">Symbol</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">Symbol</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">toStringTag</span><span style="color:#F07178;">): </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Module</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">./</span><span style="color:#A6ACCD;">assets</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">icon</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">logo</span><span style="color:#89DDFF;">-</span><span style="color:#F07178;">4</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">Module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#82AAFF;">Symbol</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">Symbol</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">toStringTag</span><span style="color:#F07178;">): </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Module</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">./</span><span style="color:#A6ACCD;">assets</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">icon</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">logo</span><span style="color:#89DDFF;">-</span><span style="color:#F07178;">5</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">Module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#82AAFF;">Symbol</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">Symbol</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">toStringTag</span><span style="color:#F07178;">): </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Module</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">./</span><span style="color:#A6ACCD;">assets</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">icon</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">logo</span><span style="color:#89DDFF;">-</span><span style="color:#F07178;">6</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">Module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#82AAFF;">Symbol</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">Symbol</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">toStringTag</span><span style="color:#F07178;">): </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Module</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u7A0D\u4F5C\u89E3\u6790\uFF0C\u7136\u540E\u5C06 svg \u5E94\u7528\u5230\u7EC4\u4EF6\u5F53\u4E2D:</p><div class="language-jsx"><button class="copy"></button><span class="lang">jsx</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">\u3000</span><span style="color:#A6ACCD;">useEffect</span><span style="color:#F07178;">\u3000</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./App.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// const icons = i<wbr>mport.meta.glob(&#39;./assets/icon/logo-*.svg&#39;);</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> icons </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">globEager</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./assets/icon/logo-*.svg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> urls </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">values</span><span style="color:#A6ACCD;">(icons)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;">mod</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> mod</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">default)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">App</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">App</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        urls</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">item</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">img</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">={</span><span style="color:#A6ACCD;">item</span><span style="color:#89DDFF;">} </span><span style="color:#C792EA;">key</span><span style="color:#89DDFF;">={</span><span style="color:#A6ACCD;">item</span><span style="color:#89DDFF;">} </span><span style="color:#C792EA;">width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">50</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">alt</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        ))</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> App</span></span>
<span class="line"></span></code></pre></div><p>\u56DE\u5230\u9875\u9762\u4E2D\uFF0C\u6211\u4EEC\u53D1\u73B0\u6D4F\u89C8\u5668\u5206\u522B\u53D1\u51FA\u4E86 6 \u4E2A svg \u7684\u8BF7\u6C42:</p><img src="`+D+`" style="zoom:60%;"><p>\u5047\u8BBE\u9875\u9762\u6709 100 \u4E2A svg \u56FE\u6807\uFF0C\u5C06\u4F1A\u591A\u51FA 100 \u4E2A HTTP \u8BF7\u6C42\uFF0C\u4F9D\u6B64\u7C7B\u63A8\u3002\u6211\u4EEC\u80FD\u4E0D\u80FD\u628A\u8FD9\u4E9B svg \u5408\u5E76\u5230\u4E00\u8D77\uFF0C\u4ECE\u800C\u5927\u5E45\u51CF\u5C11\u7F51\u7EDC\u8BF7\u6C42\u5462\uFF1F</p><p>\u7B54\u6848\u662F\u53EF\u4EE5\u7684\u3002\u8FD9\u79CD\u5408\u5E76\u56FE\u6807\u7684\u65B9\u6848\u4E5F\u53EB<code>\u96EA\u78A7\u56FE</code>\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7<code>vite-plugin-svg-icons</code>\u6765\u5B9E\u73B0\u8FD9\u4E2A\u65B9\u6848\uFF0C\u9996\u5148\u5B89\u88C5\u4E00\u4E0B\u8FD9\u4E2A\u63D2\u4EF6:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">svg</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">icons </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u7740\u5728 Vite \u914D\u7F6E\u6587\u4EF6\u4E2D\u589E\u52A0\u5982\u4E0B\u5185\u5BB9:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createSvgIconsPlugin</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-svg-icons</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u7701\u7565\u5176\u5B83\u63D2\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">createSvgIconsPlugin</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      iconDirs</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">__dirname</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src/assets/icon</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5728 <code>src/components</code>\u76EE\u5F55\u4E0B\u65B0\u5EFA<code>SvgIcon</code>\u7EC4\u4EF6:</p><div class="language-jsx"><button class="copy"></button><span class="lang">jsx</span><pre><code><span class="line"><span style="color:#676E95;">// SvgIcon/index.tsx</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">interface</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SvgIconProps</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">prefix</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">color</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  [</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SvgIcon</span><span style="color:#89DDFF;">({</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;">prefix</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">icon</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;">color</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#333</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">props</span></span>
<span class="line"><span style="color:#89DDFF;">}:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SvgIconProps</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">symbolId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">#</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">prefix</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">-</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">}\`</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">svg</span><span style="color:#89DDFF;"> {...</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">} </span><span style="color:#C792EA;">aria-hidden</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">use</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">href</span><span style="color:#89DDFF;">={</span><span style="color:#A6ACCD;">symbolId</span><span style="color:#89DDFF;">} </span><span style="color:#C792EA;">fill</span><span style="color:#89DDFF;">={</span><span style="color:#A6ACCD;">color</span><span style="color:#89DDFF;">} /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">svg</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u73B0\u5728\u6211\u4EEC\u56DE\u5230 App \u7EC4\u4EF6\u4E2D\uFF0C\u7A0D\u4F5C\u4FEE\u6539:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// TODO\uFF1A\u6682\u4E0D\u52A8\u6001\u5BFC\u5165\uFF0C\u4E0D\u8D77\u4F5C\u7528</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// App.tsx</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> icons </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">globEager</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./assets/icon/logo-*.svg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> iconUrls </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">values</span><span style="color:#A6ACCD;">(icons)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">mod</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5982 ./assets/icons/logo-1.svg -&gt; logo-1</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fileName</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mod</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">default</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">split</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pop</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">svgName</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fileName</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">split</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">svgName</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u6E32\u67D3 svg \u7EC4\u4EF6</span></span>
<span class="line"><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">iconUrls</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">item</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">SvgIcon</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">={</span><span style="color:#A6ACCD;">item</span><span style="color:#89DDFF;">} </span><span style="color:#C792EA;">key</span><span style="color:#89DDFF;">={</span><span style="color:#A6ACCD;">item</span><span style="color:#89DDFF;">} </span><span style="color:#C792EA;">width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">50</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">height</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">50</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#F07178;">))</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-jsx"><button class="copy"></button><span class="lang">jsx</span><pre><code><span class="line"><span style="color:#676E95;">// TODO\uFF1A\u4F7F\u7528\u9759\u6001\u5BFC\u5165\u53EF\u4EE5\u6709\u6548\u5408\u6210 Svg \u96EA\u78A7\u56FE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">SvgIcon</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">logo-1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">50</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">height</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">50</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">  /&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">SvgIcon</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">logo-2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">50</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">height</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">50</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">  /&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">SvgIcon</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">logo-3</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">50</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">height</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">50</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">  /&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">SvgIcon</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">logo-4</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">50</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">height</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">50</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">  /&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">SvgIcon</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">logo-5</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">50</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">height</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">50</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">  /&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">SvgIcon</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">logo-6</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">50</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">height</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">50</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">  /&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u6700\u540E\u5728 <code>src/main.tsx</code> \u6587\u4EF6\u4E2D\u6DFB\u52A0\u4E00\u884C\u4EE3\u7801:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">virtual:svg-icons-register</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><blockquote><p>virtual \u5F00\u5934\u7684\u8FD9\u4E00\u6BB5 ID \u4EE3\u8868\u4E00\u4E2A\u865A\u62DF\u6A21\u5757\uFF0C\u63D2\u4EF6\u5185\u90E8\u4F1A\u901A\u8FC7\u8FD9\u4E2A\u865A\u62DF\u6A21\u5757\u52A0\u8F7D\u6210\u4E00\u6BB5\u811A\u672C\uFF0C\u628A svg \u63D2\u5165\u5230 dom \u6811\u3002</p></blockquote><p>\u73B0\u5728\u56DE\u5230\u6D4F\u89C8\u5668\u7684\u9875\u9762\u4E2D\uFF0C\u53D1\u73B0\u96EA\u78A7\u56FE\u5DF2\u7ECF\u751F\u6210\uFF0C\u89C2\u5BDF\u7F51\u7EDC\u8BF7\u6C42\uFF0C\u4E5F\u4E0D\u4F1A\u51FA\u73B0\u8BF7\u6C42\u591A\u4E2A svg \u7684\u60C5\u51B5\u3002</p><img src="`+y+`" style="zoom:70%;"><p>\u96EA\u78A7\u56FE\u5305\u542B\u4E86\u6240\u6709\u56FE\u6807\u7684\u5177\u4F53\u5185\u5BB9\uFF0C\u800C\u5BF9\u4E8E\u9875\u9762\u6BCF\u4E2A\u5177\u4F53\u7684\u56FE\u6807\uFF0C\u5219\u901A\u8FC7 <code>use</code> \u5C5E\u6027\u6765\u5F15\u7528\u96EA\u78A7\u56FE\u7684\u5BF9\u5E94\u5185\u5BB9:</p><div class="language-html"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">svg</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">50</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">height</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">50</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">aria-hidden</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">use</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">href</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">#icon-logo-2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">fill</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">#333</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">use</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">svg</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u5982\u6B64\u4E00\u6765\uFF0C\u6211\u4EEC\u5C31\u80FD\u5C06\u6240\u6709\u7684 svg \u5185\u5BB9\u90FD\u5185\u8054\u5230 HTML \u4E2D\uFF0C\u7701\u53BB\u4E86\u5927\u91CF svg \u7684\u7F51\u7EDC\u8BF7\u6C42\u3002</p><h3 id="\u603B\u7ED3-3" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3-3" aria-hidden="true">#</a></h3><p>\u4F60\u9700\u8981\u91CD\u70B9\u638C\u63E1\u5728<strong>Vite \u5982\u4F55\u52A0\u8F7D\u9759\u6001\u8D44\u6E90</strong>\u548C<strong>\u5982\u4F55\u5728\u751F\u4EA7\u73AF\u5883\u4E2D\u5BF9\u9759\u6001\u8D44\u6E90\u8FDB\u884C\u4F18\u5316</strong>\u3002</p><p>\u9996\u5148\u662F\u5982\u4F55\u52A0\u8F7D\u5404\u79CD\u9759\u6001\u8D44\u6E90\uFF0C\u5982\u56FE\u7247\u3001svg(\u7EC4\u4EF6\u5F62\u5F0F)\u3001JSON\u3001Web Worker \u811A\u672C\u3001Web Asssembly \u6587\u4EF6\u7B49\u7B49\u683C\u5F0F\uFF0C\u5E76\u901A\u8FC7\u4E00\u4E9B\u793A\u4F8B\u5E26\u5927\u5BB6\u8FDB\u884C\u5B9E\u9645\u7684\u64CD\u4F5C\u3002</p><p>\u5176\u6B21\uFF0C\u6211\u4EEC\u4F1A\u628A\u5173\u6CE8\u70B9\u653E\u5230<strong>\u751F\u4EA7\u73AF\u5883</strong>\uFF0C\u5BF9 <code>\u81EA\u5B9A\u4E49\u90E8\u7F72\u57DF\u540D</code>\u3001<code>\u662F\u5426\u5E94\u8BE5\u5185\u8054</code>\u3001<code>\u56FE\u7247\u538B\u7F29</code>\u3001<code>svg \u96EA\u78A7\u56FE</code> \u7B49\u95EE\u9898\u8FDB\u884C\u4E86\u8BE6\u7EC6\u7684\u63A2\u8BA8\u548C\u5B9E\u8DF5\uFF0C\u5BF9\u4E8E\u5982\u4F55\u89E3\u51B3\u8FD9\u4E9B\u95EE\u9898\uFF0C\u76F8\u4FE1\u4F60\u4E5F\u6709\u4E86\u81EA\u5DF1\u7684\u7B54\u6848\u3002</p><p>\u5F53\u7136\uFF0C\u5728\u7F16\u7801\u5B9E\u64CD\u7684\u8FC7\u7A0B\u5F53\u4E2D\uFF0C\u6211\u4E5F\u7ED9\u4F60\u7A7F\u63D2\u4E86\u4E00\u4E9B Vite \u5176\u4ED6\u7684\u77E5\u8BC6\u70B9\uFF0C\u6BD4\u5982\u5982\u4F55 <code>\u5B9A\u4E49\u73AF\u5883\u53D8\u91CF\u6587\u4EF6</code>\u3001<code>\u5982\u4F55\u4F7F\u7528 Glob \u5BFC\u5165</code> \u7684\u8BED\u6CD5\u7CD6\u3002\u76F8\u4FE1\u4F60\u5728\u5B66\u4E60\u8FC7\u7A0B\u4E2D\u80FD\u66F4\u52A0\u4F53\u4F1A\u5230 Vite \u7ED9\u9879\u76EE\u5F00\u53D1\u5E26\u6765\u7684\u4FBF\u5229\uFF0C\u540C\u65F6\u4E5F\u5BF9 Vite \u7684\u638C\u63E1\u66F4\u6DF1\u5165\u4E86\u4E00\u6B65\u3002</p><h2 id="\u79D2\u7EA7\u4F9D\u8D56\u9884\u6784\u5EFA" tabindex="-1">\u79D2\u7EA7\u4F9D\u8D56\u9884\u6784\u5EFA <a class="header-anchor" href="#\u79D2\u7EA7\u4F9D\u8D56\u9884\u6784\u5EFA" aria-hidden="true">#</a></h2><p>Vite \u662F\u4E00\u4E2A\u63D0\u5021 <code>no-bundle</code> \u7684\u6784\u5EFA\u5DE5\u5177\uFF0C\u76F8\u6BD4\u4E8E\u4F20\u7EDF\u7684 Webpack\uFF0C\u80FD\u505A\u5230\u5F00\u53D1\u65F6\u7684\u6A21\u5757\u6309\u9700\u7F16\u8BD1\uFF0C\u800C\u4E0D\u7528\u5148\u6253\u5305\u5B8C\u518D\u52A0\u8F7D\u3002</p><p>\u6211\u4EEC\u6240\u8BF4\u7684\u6A21\u5757\u4EE3\u7801\u5176\u5B9E\u5206\u4E3A\u4E24\u90E8\u5206\uFF0C\u4E00\u90E8\u5206\u662F\u6E90\u4EE3\u7801\uFF0C\u4E5F\u5C31\u662F\u4E1A\u52A1\u4EE3\u7801\uFF0C\u53E6\u4E00\u90E8\u5206\u662F\u7B2C\u4E09\u65B9\u4F9D\u8D56\u7684\u4EE3\u7801\uFF0C\u5373 <code>node_modules</code> \u4E2D\u7684\u4EE3\u7801\u3002\u6240\u8C13\u7684 <code>no-bundle</code> <strong>\u53EA\u662F\u5BF9\u4E8E\u6E90\u4EE3\u7801\u800C\u8A00</strong>\uFF0C\u5BF9\u4E8E\u7B2C\u4E09\u65B9\u4F9D\u8D56\u800C\u8A00\uFF0CVite \u8FD8\u662F\u9009\u62E9 bundle(\u6253\u5305)\uFF0C\u5E76\u4E14\u4F7F\u7528\u901F\u5EA6\u6781\u5FEB\u7684\u6253\u5305\u5668 Esbuild \u6765\u5B8C\u6210\u8FD9\u4E00\u8FC7\u7A0B\uFF0C\u8FBE\u5230\u79D2\u7EA7\u7684\u4F9D\u8D56\u7F16\u8BD1\u901F\u5EA6\u3002</p><h3 id="\u4E3A\u4EC0\u4E48\u9700\u8981\u9884\u6784\u5EFA" tabindex="-1">\u4E3A\u4EC0\u4E48\u9700\u8981\u9884\u6784\u5EFA <a class="header-anchor" href="#\u4E3A\u4EC0\u4E48\u9700\u8981\u9884\u6784\u5EFA" aria-hidden="true">#</a></h3><p>\u4E3A\u4EC0\u4E48\u5728\u5F00\u53D1\u9636\u6BB5\u6211\u4EEC\u8981\u5BF9\u7B2C\u4E09\u65B9\u4F9D\u8D56\u8FDB\u884C\u9884\u6784\u5EFA? \u5982\u679C\u4E0D\u8FDB\u884C\u9884\u6784\u5EFA\u4F1A\u600E\u4E48\u6837\uFF1F</p><p>\u9996\u5148 Vite \u662F\u57FA\u4E8E\u6D4F\u89C8\u5668\u539F\u751F ES \u6A21\u5757\u89C4\u8303\u5B9E\u73B0\u7684 Dev Server\uFF0C\u4E0D\u8BBA\u662F\u5E94\u7528\u4EE3\u7801\uFF0C\u8FD8\u662F\u7B2C\u4E09\u65B9\u4F9D\u8D56\u7684\u4EE3\u7801\uFF0C\u7406\u5E94\u7B26\u5408 ESM \u89C4\u8303\u624D\u80FD\u591F\u6B63\u5E38\u8FD0\u884C\u3002\u4F46\u6211\u4EEC\u6CA1\u6709\u529E\u6CD5\u63A7\u5236\u7B2C\u4E09\u65B9\u7684\u6253\u5305\u89C4\u8303\u3002\u5C31\u76EE\u524D\u6765\u770B\uFF0C\u8FD8\u6709\u76F8\u5F53\u591A\u7684\u7B2C\u4E09\u65B9\u5E93\u4ECD\u7136\u6CA1\u6709 ES \u7248\u672C\u7684\u4EA7\u7269\uFF0C\u6BD4\u5982\u5927\u540D\u9F0E\u9F0E\u7684 <code>react</code>:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// react \u5165\u53E3\u6587\u4EF6</span></span>
<span class="line"><span style="color:#676E95;">// \u53EA\u6709 CommonJS \u683C\u5F0F</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (process</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">env</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">NODE_ENV </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">production</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">module.exports</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">require</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./cjs/react.production.min.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">module.exports</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">require</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./cjs/react.development.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u79CD CommonJS \u683C\u5F0F\u7684\u4EE3\u7801\u5728 Vite \u5F53\u4E2D\u65E0\u6CD5\u76F4\u63A5\u8FD0\u884C\uFF0C\u6211\u4EEC\u9700\u8981\u5C06\u5B83\u8F6C\u6362\u6210 ESM \u683C\u5F0F\u7684\u4EA7\u7269\u3002</p><p>\u6B64\u5916\uFF0C\u8FD8\u6709\u4E00\u4E2A\u6BD4\u8F83\u91CD\u8981\u7684\u95EE\u9898\u2014\u2014<strong>\u8BF7\u6C42\u7011\u5E03\u6D41\u95EE\u9898</strong>\u3002\u6BD4\u5982\u8BF4\uFF0C\u77E5\u540D\u7684<code>loadsh-es</code>\u5E93\u672C\u8EAB\u662F\u6709 ES \u7248\u672C\u4EA7\u7269\u7684\uFF0C\u53EF\u4EE5\u5728 Vite \u4E2D\u76F4\u63A5\u8FD0\u884C\u3002\u4F46\u5B9E\u9645\u4E0A\uFF0C\u5B83\u5728\u52A0\u8F7D\u65F6\u4F1A\u53D1\u51FA\u7279\u522B\u591A\u7684\u8BF7\u6C42\uFF0C\u5BFC\u81F4\u9875\u9762\u52A0\u8F7D\u7684\u524D\u51E0\u79D2\u51E0\u90FD\u4E4E\u5904\u4E8E\u5361\u987F\u72B6\u6001\uFF0C\u62FF\u4E00\u4E2A\u7B80\u5355\u7684 demo \u9879\u76EE\u4E3E\u4F8B\uFF0C\u8BF7\u6C42\u60C5\u51B5\u5982\u4E0B\u56FE\u6240\u793A:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> debounce </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../node_modules/lodash-es/debounce</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> handlebtnClick </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">debounce</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">setCount</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">count</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">600</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u6211\u4EEC\u5728\u5E94\u7528\u4EE3\u7801\u4E2D\u8C03\u7528\u4E86<code>debounce</code>\u65B9\u6CD5\uFF0C\u8FD9\u4E2A\u65B9\u6CD5\u4F1A\u4F9D\u8D56\u5F88\u591A\u5DE5\u5177\u51FD\u6570\u3002</p><p>\u6BCF\u4E2A<code>import</code>\u90FD\u4F1A\u89E6\u53D1\u4E00\u6B21\u65B0\u7684\u6587\u4EF6\u8BF7\u6C42\uFF0C\u56E0\u6B64\u5728\u8FD9\u79CD <code>\u4F9D\u8D56\u5C42\u7EA7\u6DF1</code>\u3001<code>\u6D89\u53CA\u6A21\u5757\u6570\u91CF\u591A </code>\u7684\u60C5\u51B5\u4E0B\uFF0C\u4F1A\u89E6\u53D1\u6210\u767E\u4E0A\u5343\u4E2A\u7F51\u7EDC\u8BF7\u6C42\uFF0C\u5DE8\u5927\u7684\u8BF7\u6C42\u91CF\u52A0\u4E0A Chrome \u5BF9\u540C\u4E00\u4E2A\u57DF\u540D\u4E0B\u53EA\u80FD\u540C\u65F6\u652F\u6301 <code>6</code> \u4E2A HTTP \u5E76\u53D1\u8BF7\u6C42\u7684\u9650\u5236\uFF0C\u5BFC\u81F4\u9875\u9762\u52A0\u8F7D\u5341\u5206\u7F13\u6162\uFF0C\u4E0E Vite \u4E3B\u5BFC\u6027\u80FD\u4F18\u52BF\u7684\u521D\u8877\u80CC\u9053\u800C\u9A70\u3002\u4E0D\u8FC7\uFF0C\u5728\u8FDB\u884C<strong>\u4F9D\u8D56\u7684\u9884\u6784\u5EFA</strong>\u4E4B\u540E\uFF0C<code>lodash-es </code>\u8FD9\u4E2A\u5E93\u7684\u4EE3\u7801\u88AB\u6253\u5305\u6210\u4E86\u4E00\u4E2A\u6587\u4EF6\uFF0C\u8FD9\u6837\u8BF7\u6C42\u7684\u6570\u91CF\u4F1A\u9AA4\u7136\u51CF\u5C11\uFF0C\u9875\u9762\u52A0\u8F7D\u4E5F\u5FEB\u4E86\u8BB8\u591A\u3002\u4E0B\u56FE\u662F\u8FDB\u884C\u9884\u6784\u5EFA\u4E4B\u540E\u7684\u8BF7\u6C42\u60C5\u51B5\uFF0C\u4F60\u53EF\u4EE5\u5BF9\u7167\u770B\u770B:</p><p>// TODO</p><p>\u4F9D\u8D56\u9884\u6784\u5EFA\u4E3B\u8981\u505A\u4E86\u4E24\u4EF6\u4E8B\u60C5\uFF1A</p><p>\u4E00\u662F\u5C06\u5176\u4ED6\u683C\u5F0F(\u5982 UMD \u548C CommonJS)\u7684\u4EA7\u7269\u8F6C\u6362\u4E3A ESM \u683C\u5F0F\uFF0C\u4F7F\u5176\u5728\u6D4F\u89C8\u5668\u901A\u8FC7 <code>&lt;script type=&quot;module&quot;&gt;&lt;script&gt;</code>\u7684\u65B9\u5F0F\u6B63\u5E38\u52A0\u8F7D\u3002</p><p>\u4E8C\u662F\u6253\u5305\u7B2C\u4E09\u65B9\u5E93\u7684\u4EE3\u7801\uFF0C\u5C06\u5404\u4E2A\u7B2C\u4E09\u65B9\u5E93\u5206\u6563\u7684\u6587\u4EF6\u5408\u5E76\u5230\u4E00\u8D77\uFF0C\u51CF\u5C11 HTTP \u8BF7\u6C42\u6570\u91CF\uFF0C\u907F\u514D\u9875\u9762\u52A0\u8F7D\u6027\u80FD\u52A3\u5316\u3002</p><p>\u800C\u8FD9\u4E24\u4EF6\u4E8B\u60C5\u5168\u90E8\u7531\u6027\u80FD\u4F18\u5F02\u7684 <code>Esbuild</code> (\u57FA\u4E8E Golang \u5F00\u53D1)\u5B8C\u6210\uFF0C\u800C\u4E0D\u662F\u4F20\u7EDF\u7684 Webpack/Rollup\uFF0C\u6240\u4EE5\u4E5F\u4E0D\u4F1A\u6709\u660E\u663E\u7684\u6253\u5305\u6027\u80FD\u95EE\u9898\uFF0C\u53CD\u800C\u662F Vite \u9879\u76EE\u542F\u52A8\u98DE\u5FEB(\u79D2\u7EA7\u542F\u52A8)\u7684\u4E00\u4E2A\u6838\u5FC3\u539F\u56E0\u3002</p><blockquote><p>Vite 1.x \u4F7F\u7528\u4E86 Rollup \u6765\u8FDB\u884C\u4F9D\u8D56\u9884\u6784\u5EFA\uFF0C\u5728 2.x \u7248\u672C\u5C06 Rollup \u6362\u6210\u4E86 Esbuild\uFF0C\u7F16\u8BD1\u901F\u5EA6\u63D0\u5347\u4E86 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fesbuild.github.io%2F" target="_blank" rel="noreferrer">\u8FD1 100 \u500D</a>\uFF01</p></blockquote><h3 id="\u5982\u4F55\u5F00\u542F\u9884\u6784\u5EFA" tabindex="-1">\u5982\u4F55\u5F00\u542F\u9884\u6784\u5EFA <a class="header-anchor" href="#\u5982\u4F55\u5F00\u542F\u9884\u6784\u5EFA" aria-hidden="true">#</a></h3><p>\u5728 Vite \u4E2D\u6709\u4E24\u79CD\u5F00\u542F\u9884\u6784\u5EFA\u7684\u65B9\u5F0F\uFF0C\u5206\u522B\u662F <code>\u81EA\u52A8\u5F00\u542F</code> \u548C <code>\u624B\u52A8\u5F00\u542F</code>\u3002</p><h4 id="\u81EA\u52A8\u5F00\u542F" tabindex="-1">\u81EA\u52A8\u5F00\u542F <a class="header-anchor" href="#\u81EA\u52A8\u5F00\u542F" aria-hidden="true">#</a></h4><p>\u9884\u6784\u5EFA\u9ED8\u8BA4\u662F\u662F <code>\u81EA\u52A8\u5F00\u542F</code>\u3002\u9879\u76EE\u542F\u52A8\u6210\u529F\u540E\uFF0C\u4F60\u53EF\u4EE5\u5728\u6839\u76EE\u5F55\u4E0B\u7684<code>node_modules</code>\u4E2D\u53D1\u73B0<code>.vite</code>\u76EE\u5F55\uFF0C\u8FD9\u5C31\u662F\u9884\u6784\u5EFA\u4EA7\u7269\u6587\u4EF6\u5B58\u653E\u7684\u76EE\u5F55\uFF0C\u5185\u5BB9\u5982\u4E0B:</p><img src="`+i+`"><p>\u5728\u6D4F\u89C8\u5668\u8BBF\u95EE\u9875\u9762\u540E\uFF0C\u6253\u5F00 <code>Dev Tools</code> \u4E2D\u7684\u7F51\u7EDC\u8C03\u8BD5\u9762\u677F\uFF0C\u4F60\u53EF\u4EE5\u53D1\u73B0\u7B2C\u4E09\u65B9\u5305\u7684\u5F15\u5165\u8DEF\u5F84\u5DF2\u7ECF\u88AB\u91CD\u5199:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">require_react</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/node_modules/.vite/deps/chunk-QJZGAYR5.js?v=2dc7d6a2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// dep:react</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> react_default </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require_react</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">react_default</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">default</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#676E95;">//# sourceMappingURL=react.js.map</span></span>
<span class="line"></span></code></pre></div><p>\u5E76\u4E14\u5BF9\u4E8E\u4F9D\u8D56\u7684\u8BF7\u6C42\u7ED3\u679C\uFF0CVite \u7684 Dev Server \u4F1A\u8BBE\u7F6E\u5F3A\u7F13\u5B58:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">Access</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">Control</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">Allow</span><span style="color:#89DDFF;">-</span><span style="color:#FFCB6B;">Origin</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span></span>
<span class="line"><span style="color:#A6ACCD;">Cache</span><span style="color:#89DDFF;">-</span><span style="color:#FFCB6B;">Control</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> max</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">age</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">31536000</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">immutable</span></span>
<span class="line"><span style="color:#FFCB6B;">Connection</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> keep</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">alive</span></span>
<span class="line"><span style="color:#A6ACCD;">Content</span><span style="color:#89DDFF;">-</span><span style="color:#FFCB6B;">Length</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">213</span></span>
<span class="line"><span style="color:#A6ACCD;">Content</span><span style="color:#89DDFF;">-</span><span style="color:#FFCB6B;">Type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> application</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">javascript</span></span>
<span class="line"><span style="color:#FFCB6B;">Date</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Sun</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">24</span><span style="color:#A6ACCD;"> Apr </span><span style="color:#F78C6C;">2022</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">13</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">11</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">01</span><span style="color:#A6ACCD;"> GMT</span></span>
<span class="line"><span style="color:#FFCB6B;">Etag</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> W</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">d5-B0da628485UVtIrlUkYdZltKfa4</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Keep</span><span style="color:#89DDFF;">-</span><span style="color:#FFCB6B;">Alive</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> timeout</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">5</span></span>
<span class="line"></span></code></pre></div><p>\u7F13\u5B58\u8FC7\u671F\u65F6\u95F4\u88AB\u8BBE\u7F6E\u4E3A\u4E00\u5E74\uFF0C\u8868\u793A\u7F13\u5B58\u8FC7\u671F\u524D\u6D4F\u89C8\u5668\u5BF9 react \u9884\u6784\u5EFA\u4EA7\u7269\u7684\u8BF7\u6C42\u4E0D\u4F1A\u518D\u7ECF\u8FC7 Vite Dev Server\uFF0C\u76F4\u63A5\u7528\u7F13\u5B58\u7ED3\u679C\u3002</p><p>\u5F53\u7136\uFF0C\u9664\u4E86 HTTP \u7F13\u5B58\uFF0CVite \u8FD8\u8BBE\u7F6E\u4E86\u672C\u5730\u6587\u4EF6\u7CFB\u7EDF\u7684\u7F13\u5B58\uFF0C\u6240\u6709\u7684\u9884\u6784\u5EFA\u4EA7\u7269\u9ED8\u8BA4\u7F13\u5B58\u5728 <code>node_modules/.vite</code>\u76EE\u5F55\u4E2D\u3002\u5982\u679C\u4EE5\u4E0B 3 \u4E2A\u5730\u65B9\u90FD\u6CA1\u6709\u6539\u52A8\uFF0CVite \u5C06\u4E00\u76F4\u4F7F\u7528\u7F13\u5B58\u6587\u4EF6:</p><ol><li>package.json \u7684 <code>dependencies</code> \u5B57\u6BB5</li><li>\u5404\u79CD\u5305\u7BA1\u7406\u5668\u7684 lock \u6587\u4EF6</li><li><code>optimizeDeps</code> \u914D\u7F6E\u5185\u5BB9</li></ol><h4 id="\u624B\u52A8\u5F00\u542F" tabindex="-1">\u624B\u52A8\u5F00\u542F <a class="header-anchor" href="#\u624B\u52A8\u5F00\u542F" aria-hidden="true">#</a></h4><p>\u4E0A\u9762\u63D0\u5230\u4E86\u9884\u6784\u5EFA\u4E2D\u672C\u5730\u6587\u4EF6\u7CFB\u7EDF\u7684\u4EA7\u7269\u7F13\u5B58\u673A\u5236\uFF0C\u800C\u5C11\u6570\u573A\u666F\u4E0B\u6211\u4EEC\u4E0D\u5E0C\u671B\u7528\u672C\u5730\u7684\u7F13\u5B58\u6587\u4EF6\uFF0C\u6BD4\u5982\u9700\u8981\u8C03\u8BD5\u67D0\u4E2A\u5305\u7684\u9884\u6784\u5EFA\u7ED3\u679C\uFF0C\u6211\u63A8\u8350\u4F7F\u7528\u4E0B\u9762\u4EFB\u610F\u4E00\u79CD\u65B9\u6CD5\u6E05\u9664\u7F13\u5B58\uFF0C\u8FD8\u6709\u624B\u52A8\u5F00\u542F\u9884\u6784\u5EFA:</p><ol><li>\u5220\u9664 <code>node_modules/.vite</code> \u76EE\u5F55\u3002</li><li>\u5728 Vite \u914D\u7F6E\u6587\u4EF6\u4E2D\uFF0C\u5C06 <code>server.force</code> \u8BBE\u4E3A <code>true</code>\u3002</li><li>\u547D\u4EE4\u884C\u6267\u884C <code>npx vite --force</code> \u6216\u8005 <code>npx vite optimize</code>\u3002</li></ol><blockquote><p>Vite \u9879\u76EE\u7684\u542F\u52A8\u53EF\u4EE5\u5206\u4E3A\u4E24\u6B65\uFF0C\u7B2C\u4E00\u6B65\u662F\u4F9D\u8D56\u9884\u6784\u5EFA\uFF0C\u7B2C\u4E8C\u6B65\u624D\u662F Dev Server \u7684\u542F\u52A8\uFF0C<code>npx vite optimize</code>\u76F8\u6BD4\u4E8E\u5176\u5B83\u7684\u65B9\u6848\uFF0C\u4EC5\u4EC5\u5B8C\u6210\u7B2C\u4E00\u6B65\u7684\u529F\u80FD\u3002</p></blockquote><h3 id="\u81EA\u5B9A\u4E49\u914D\u7F6E\u8BE6\u89E3" tabindex="-1">\u81EA\u5B9A\u4E49\u914D\u7F6E\u8BE6\u89E3 <a class="header-anchor" href="#\u81EA\u5B9A\u4E49\u914D\u7F6E\u8BE6\u89E3" aria-hidden="true">#</a></h3><p>\u524D\u9762\u8BF4\u5230\u4E86\u5982\u4F55\u542F\u52A8\u9884\u6784\u5EFA\u7684\u95EE\u9898\uFF0C\u73B0\u5728\u6211\u4EEC\u6765\u8C08\u8C08\u600E\u6837\u901A\u8FC7 Vite \u63D0\u4F9B\u7684\u914D\u7F6E\u9879\u6765\u5B9A\u5236\u9884\u6784\u5EFA\u7684\u8FC7\u7A0B\u3002 Vite \u5C06\u9884\u6784\u5EFA\u76F8\u5173\u7684\u914D\u7F6E\u9879\u90FD\u96C6\u4E2D\u5728 <code>optimizeDeps</code> \u5C5E\u6027\u4E0A\uFF0C\u6211\u4EEC\u6765\u4E00\u4E00\u62C6\u89E3\u8FD9\u4E9B\u5B50\u914D\u7F6E\u9879\u80CC\u540E\u7684\u542B\u4E49\u548C\u5E94\u7528\u573A\u666F\u3002</p><h4 id="\u5165\u53E3\u6587\u4EF6-entries" tabindex="-1">\u5165\u53E3\u6587\u4EF6 - entries <a class="header-anchor" href="#\u5165\u53E3\u6587\u4EF6-entries" aria-hidden="true">#</a></h4><p>\u7B2C\u4E00\u4E2A\u662F\u53C2\u6570\u662F <code>optimizeDeps.entries</code>\uFF0C\u901A\u8FC7\u8FD9\u4E2A\u53C2\u6570\u4F60\u53EF\u4EE5\u81EA\u5B9A\u4E49\u9884\u6784\u5EFA\u7684\u5165\u53E3\u6587\u4EF6\u3002</p><p>\u5B9E\u9645\u4E0A\uFF0C\u5728\u9879\u76EE\u7B2C\u4E00\u6B21\u542F\u52A8\u65F6\uFF0CVite \u4F1A\u9ED8\u8BA4\u6293\u53D6\u9879\u76EE\u4E2D\u6240\u6709\u7684 HTML \u6587\u4EF6\uFF08\u5982\u5F53\u524D\u811A\u624B\u67B6\u9879\u76EE\u4E2D\u7684 <code>index.html</code>\uFF09\uFF0C\u5C06 HTML \u6587\u4EF6\u4F5C\u4E3A\u5E94\u7528\u5165\u53E3\uFF0C\u7136\u540E\u6839\u636E\u5165\u53E3\u6587\u4EF6\u626B\u63CF\u51FA\u9879\u76EE\u4E2D\u7528\u5230\u7684\u7B2C\u4E09\u65B9\u4F9D\u8D56\uFF0C\u6700\u540E\u5BF9\u8FD9\u4E9B\u4F9D\u8D56\u9010\u4E2A\u8FDB\u884C\u7F16\u8BD1\u3002</p><p>\u90A3\u4E48\uFF0C\u5F53\u9ED8\u8BA4\u626B\u63CF HTML \u6587\u4EF6\u7684\u884C\u4E3A\u65E0\u6CD5\u6EE1\u8DB3\u9700\u6C42\u7684\u65F6\u5019\uFF0C\u6BD4\u5982\u9879\u76EE\u5165\u53E3\u4E3A <code>vue</code> \u683C\u5F0F\u6587\u4EF6\u65F6\uFF0C\u4F60\u53EF\u4EE5\u901A\u8FC7 entries \u53C2\u6570\u6765\u914D\u7F6E:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">optimizeDeps</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u4E3A\u4E00\u4E2A\u5B57\u7B26\u4E32\u6570\u7EC4</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">entries</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./src/main.vue</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5F53\u7136\uFF0Centries \u914D\u7F6E\u4E5F\u652F\u6301 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fmrmlnc%2Ffast-glob" target="_blank" rel="noreferrer">glob \u8BED\u6CD5</a>\uFF0C\u975E\u5E38\u7075\u6D3B\uFF0C\u5982:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// \u5C06\u6240\u6709\u7684 .vue \u6587\u4EF6\u4F5C\u4E3A\u626B\u63CF\u5165\u53E3</span></span>
<span class="line"><span style="color:#FFCB6B;">entries</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">**/*.vue</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u4E0D\u5149\u662F <code>.vue</code> \u6587\u4EF6\uFF0CVite \u540C\u65F6\u8FD8\u652F\u6301\u5404\u79CD\u683C\u5F0F\u7684\u5165\u53E3\uFF0C\u5305\u62EC: <code>html</code>\u3001<code>svelte</code>\u3001<code>astro</code>\u3001<code>js</code>\u3001<code>jsx</code>\u3001<code>ts</code> \u548C <code>tsx</code>\u3002\u53EF\u4EE5\u770B\u5230\uFF0C\u53EA\u8981\u53EF\u80FD\u5B58\u5728 <code>import</code> \u8BED\u53E5\u7684\u5730\u65B9\uFF0CVite \u90FD\u53EF\u4EE5\u89E3\u6790\uFF0C\u5E76\u901A\u8FC7\u5185\u7F6E\u7684\u626B\u63CF\u673A\u5236\u641C\u96C6\u5230\u9879\u76EE\u4E2D\u7528\u5230\u7684\u4F9D\u8D56\uFF0C\u901A\u7528\u6027\u5F88\u5F3A\u3002</p><h4 id="\u6DFB\u52A0\u4F9D\u8D56-include" tabindex="-1">\u6DFB\u52A0\u4F9D\u8D56 - include <a class="header-anchor" href="#\u6DFB\u52A0\u4F9D\u8D56-include" aria-hidden="true">#</a></h4><p>\u9664\u4E86 <code>entries</code>\uFF0C<code>include</code> \u4E5F\u662F\u4E00\u4E2A\u5F88\u5E38\u7528\u7684\u914D\u7F6E\uFF0C\u5B83\u51B3\u5B9A\u4E86\u53EF\u4EE5\u5F3A\u5236\u9884\u6784\u5EFA\u7684\u4F9D\u8D56\u9879\uFF0C\u4F7F\u7528\u65B9\u5F0F\u5F88\u7B80\u5355:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#FFCB6B;">optimizeDeps</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u914D\u7F6E\u4E3A\u4E00\u4E2A\u5B57\u7B26\u4E32\u6570\u7EC4\uFF0C\u5C06 \`lodash-es\` \u548C \`vue\`\u4E24\u4E2A\u5305\u5F3A\u5236\u8FDB\u884C\u9884\u6784\u5EFA</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">include</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">lodash-es</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5B83\u5728\u4F7F\u7528\u4E0A\u5E76\u4E0D\u96BE\uFF0C\u771F\u6B63\u96BE\u7684\u5730\u65B9\u5728\u4E8E\uFF0C\u5982\u4F55\u627E\u5230\u5408\u9002\u5B83\u7684\u4F7F\u7528\u573A\u666F\u3002\u524D\u6587\u4E2D\u6211\u4EEC\u63D0\u5230\uFF0CVite \u4F1A\u6839\u636E\u5E94\u7528\u5165\u53E3(<code>entries</code>)\u81EA\u52A8\u641C\u96C6\u4F9D\u8D56\uFF0C\u7136\u540E\u8FDB\u884C\u9884\u6784\u5EFA\uFF0C\u8FD9\u662F\u4E0D\u662F\u8BF4\u660E Vite \u53EF\u4EE5\u767E\u5206\u767E\u51C6\u786E\u5730\u641C\u96C6\u5230\u6240\u6709\u7684\u4F9D\u8D56\u5462\uFF1F\u4E8B\u5B9E\u4E0A\u5E76\u4E0D\u662F\uFF0C\u67D0\u4E9B\u60C5\u51B5\u4E0B Vite \u9ED8\u8BA4\u7684\u626B\u63CF\u884C\u4E3A\u5E76\u4E0D\u5B8C\u5168\u53EF\u9760\uFF0C\u8FD9\u5C31\u9700\u8981\u8054\u5408\u914D\u7F6E <code>include</code> \u6765\u8FBE\u5230\u5B8C\u7F8E\u7684\u9884\u6784\u5EFA\u6548\u679C\u4E86\u3002\u63A5\u4E0B\u6765\uFF0C\u6211\u4EEC\u597D\u597D\u68B3\u7406\u4E00\u4E0B\u5230\u5E95\u6709\u54EA\u4E9B\u9700\u8981\u914D\u7F6E <code>include</code> \u7684\u573A\u666F\u3002</p><h4 id="\u52A8\u6001-import" tabindex="-1">\u52A8\u6001 import <a class="header-anchor" href="#\u52A8\u6001-import" aria-hidden="true">#</a></h4><p>\u5728\u67D0\u4E9B\u52A8\u6001 import \u7684\u573A\u666F\u4E0B\uFF0C\u7531\u4E8E Vite \u5929\u7136\u6309\u9700\u52A0\u8F7D\u7684\u7279\u6027\uFF0C\u7ECF\u5E38\u4F1A\u5BFC\u81F4\u67D0\u4E9B\u4F9D\u8D56\u53EA\u80FD\u5728\u8FD0\u884C\u65F6\u88AB\u8BC6\u522B\u51FA\u6765\u3002</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// src/locales/zh_CN.js</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> objectAssign </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">object-assign</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(objectAssign)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// main.tsx</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> importModule </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">m</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">./locales/</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">m</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">.ts</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">importModule</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">zh_CN</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u5728\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\uFF0C\u52A8\u6001 import \u7684\u8DEF\u5F84\u53EA\u6709\u8FD0\u884C\u65F6\u624D\u80FD\u786E\u5B9A\uFF0C\u65E0\u6CD5\u5728\u9884\u6784\u5EFA\u9636\u6BB5\u88AB\u626B\u63CF\u51FA\u6765\u3002</p><p>Vite \u8FD0\u884C\u65F6\u53D1\u73B0\u4E86\u65B0\u7684\u4F9D\u8D56\uFF0C\u968F\u4E4B\u91CD\u65B0\u8FDB\u884C\u4F9D\u8D56\u9884\u6784\u5EFA\uFF0C\u5E76\u5237\u65B0\u9875\u9762\u3002\u8FD9\u4E2A\u8FC7\u7A0B\u4E5F\u53EB<strong>\u4E8C\u6B21\u9884\u6784\u5EFA</strong>\u3002 \u5728\u4E00\u4E9B\u6BD4\u8F83\u590D\u6742\u7684\u9879\u76EE\u4E2D\uFF0C\u8FD9\u4E2A\u8FC7\u7A0B\u4F1A\u6267\u884C\u5F88\u591A\u6B21\uFF0C\u5982\u4E0B\u9762\u7684\u65E5\u5FD7\u4FE1\u606F\u6240\u793A:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">[vite] </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> dependencies found: </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">material</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">ui</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">icons</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">Dehaze</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">material</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">ui</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">core</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">Box</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">material</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">ui</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">core</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">Checkbox</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> updating</span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">[vite] \u2728 dependencies updated</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> reloading page</span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">[vite] </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> dependencies found: </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">material</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">ui</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">core</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">Dialog</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">material</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">ui</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">core</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">DialogActions</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> updating</span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">[vite] \u2728 dependencies updated</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> reloading page</span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">[vite] </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> dependencies found: </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">material</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">ui</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">core</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">Accordion</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">material</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">ui</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">core</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">AccordionSummary</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> updating</span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">[vite] \u2728 dependencies updated</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> reloading page</span><span style="color:#89DDFF;">...</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u800C\uFF0C\u4E8C\u6B21\u9884\u6784\u5EFA\u7684\u6210\u672C\u4E5F\u6BD4\u8F83\u5927\u3002\u6211\u4EEC\u4E0D\u4EC5\u9700\u8981\u628A\u9884\u6784\u5EFA\u7684\u6D41\u7A0B\u91CD\u65B0\u8FD0\u884C\u4E00\u904D\uFF0C\u8FD8\u5F97\u91CD\u65B0\u5237\u65B0\u9875\u9762\uFF0C\u5E76\u4E14\u9700\u8981\u91CD\u65B0\u8BF7\u6C42\u6240\u6709\u7684\u6A21\u5757\u3002\u5C24\u5176\u662F\u5728\u5927\u578B\u9879\u76EE\u4E2D\uFF0C\u8FD9\u4E2A\u8FC7\u7A0B\u4F1A\u4E25\u91CD\u62D6\u6162\u5E94\u7528\u7684\u52A0\u8F7D\u901F\u5EA6\uFF01\u56E0\u6B64\uFF0C\u6211\u4EEC\u8981\u5C3D\u529B\u907F\u514D\u8FD0\u884C\u65F6\u7684 <strong>\u4E8C\u6B21\u9884\u6784\u5EFA</strong> \u3002\u5177\u4F53\u600E\u4E48\u505A\u5462\uFF1F\u4F60\u53EF\u4EE5\u901A\u8FC7<code>include</code> \u53C2\u6570\u63D0\u524D\u58F0\u660E\u9700\u8981\u6309\u9700\u52A0\u8F7D\u7684\u4F9D\u8D56:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">optimizeDeps</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">include</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u6309\u9700\u52A0\u8F7D\u7684\u4F9D\u8D56\u90FD\u53EF\u4EE5\u58F0\u660E\u5230\u8FD9\u4E2A\u6570\u7EC4\u91CC</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">object-assign</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    ]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="\u624B\u52A8-exclude" tabindex="-1">\u624B\u52A8 exclude <a class="header-anchor" href="#\u624B\u52A8-exclude" aria-hidden="true">#</a></h4><p><code>exclude</code> \u662F<code>optimizeDeps</code>\u4E2D\u7684\u53E6\u4E00\u4E2A\u914D\u7F6E\u9879\uFF0C\u4E0E<code>include </code>\u76F8\u5BF9\uFF0C\u7528\u4E8E\u5C06\u67D0\u4E9B\u4F9D\u8D56\u4ECE\u9884\u6784\u5EFA\u7684\u8FC7\u7A0B\u4E2D\u6392\u9664\u3002\u4E0D\u8FC7\u8FD9\u4E2A\u914D\u7F6E\u5E76\u4E0D\u5E38\u7528\uFF0C\u4E5F\u4E0D\u63A8\u8350\u5927\u5BB6\u4F7F\u7528\u3002\u5982\u679C\u771F\u9047\u5230\u4E86\u8981\u5728\u9884\u6784\u5EFA\u4E2D\u6392\u9664\u67D0\u4E2A\u5305\u7684\u60C5\u51B5\uFF0C\u9700\u8981\u6CE8\u610F <code>\u5B83\u6240\u4F9D\u8D56\u7684\u5305</code> \u662F\u5426\u5177\u6709 ESM \u683C\u5F0F\uFF0C\u5982\u4E0B\u9762\u8FD9\u4E2A\u4F8B\u5B50:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">optimizeDeps</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">exclude</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@loadable/component</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5237\u65B0\u6D4F\u89C8\u5668h\u63A7\u5236\u53F0\u4F1A\u51FA\u73B0\u62A5\u9519\u3002\u6211\u4EEC\u521A\u521A\u624B\u52A8 exclude \u7684\u5305 <code>@loadable/component</code> \u672C\u8EAB\u5177\u6709 ESM \u683C\u5F0F\u7684\u4EA7\u7269\uFF0C\u4F46\u5B83\u7684\u67D0\u4E2A\u4F9D\u8D56<code>hoist-non-react-statics</code>\u7684\u4EA7\u7269\u5E76\u6CA1\u6709\u63D0\u4F9B ESM \u683C\u5F0F\uFF0C\u5BFC\u81F4\u8FD0\u884C\u65F6\u52A0\u8F7D\u5931\u8D25\u3002</p><p>\u8FD9\u4E2A\u65F6\u5019 <code>include</code> \u914D\u7F6E\u5C31\u6D3E\u4E0A\u7528\u573A\u4E86\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5F3A\u5236\u5BF9 <code>hoist-non-react-statics</code> \u8FD9\u4E2A\u95F4\u63A5\u4F9D\u8D56\u8FDB\u884C\u9884\u6784\u5EFA:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">optimizeDeps</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">include</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u95F4\u63A5\u4F9D\u8D56\u7684\u58F0\u660E\u8BED\u6CD5\uFF0C\u901A\u8FC7\`&gt;\`\u5206\u5F00, \u5982\`a &gt; b\`\u8868\u793A a \u4E2D\u4F9D\u8D56\u7684 b</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@loadable/component &gt; hoist-non-react-statics</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    ]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5728 <code>include</code> \u53C2\u6570\u4E2D\uFF0C\u6211\u4EEC\u5C06\u6240\u6709\u4E0D\u5177\u5907 ESM \u683C\u5F0F\u4EA7\u7269\u5305\u90FD\u58F0\u660E\u4E00\u904D\uFF0C\u8FD9\u6837\u518D\u6B21\u542F\u52A8\u9879\u76EE\u5C31\u6CA1\u6709\u95EE\u9898\u4E86\u3002</p><h4 id="\u81EA\u5B9A\u4E49-esbuild-\u884C\u4E3A" tabindex="-1">\u81EA\u5B9A\u4E49 ESBuild \u884C\u4E3A <a class="header-anchor" href="#\u81EA\u5B9A\u4E49-esbuild-\u884C\u4E3A" aria-hidden="true">#</a></h4><p>Vite \u63D0\u4F9B\u4E86 <code>esbuildOptions</code> \u53C2\u6570\u6765\u8BA9\u6211\u4EEC\u81EA\u5B9A\u4E49 Esbuild \u672C\u8EAB\u7684\u914D\u7F6E\uFF0C\u5E38\u7528\u7684\u573A\u666F\u662F\u52A0\u5165\u4E00\u4E9B Esbuild \u63D2\u4EF6:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">optimizeDeps</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">esbuildOptions</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">       </span><span style="color:#FFCB6B;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u52A0\u5165 Esbuild \u63D2\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">      ]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u4E2A\u914D\u7F6E\u4E3B\u8981\u662F\u5904\u7406\u4E00\u4E9B\u7279\u6B8A\u60C5\u51B5\uFF0C\u5982\u67D0\u4E2A\u7B2C\u4E09\u65B9\u5305\u672C\u8EAB\u7684\u4EE3\u7801\u51FA\u73B0\u95EE\u9898\u4E86\u3002\u63A5\u4E0B\u6765\uFF0C\u6211\u4EEC\u5C31\u6765\u8BA8\u8BBA\u4E00\u4E0B\u3002</p><p>\u7531\u4E8E\u6211\u4EEC\u65E0\u6CD5\u4FDD\u8BC1\u7B2C\u4E09\u65B9\u5305\u7684\u4EE3\u7801\u8D28\u91CF\uFF0C\u5728\u67D0\u4E9B\u60C5\u51B5\u4E0B\u6211\u4EEC\u4F1A\u9047\u5230\u83AB\u540D\u7684\u7B2C\u4E09\u65B9\u5E93\u62A5\u9519\u3002\u6211\u4E3E\u4E00\u4E2A\u5E38\u89C1\u7684\u6848\u4F8B \u2014\u2014 <code>react-virtualized</code>\u5E93\u3002\u8FD9\u4E2A\u5E93\u88AB\u8BB8\u591A\u7EC4\u4EF6\u5E93\u7528\u5230\uFF0C\u4F46\u5B83\u7684 ESM \u683C\u5F0F\u4EA7\u7269\u6709\u660E\u663E\u7684\u95EE\u9898\uFF0C\u5728 Vite \u8FDB\u884C\u9884\u6784\u5EFA\u7684\u65F6\u5019\u4F1A\u76F4\u63A5\u629B\u51FA\u8FD9\u4E2A\u9519\u8BEF\uFF1A</p><img src="`+C+`" style="zoom:60%;"><p>\u539F\u56E0\u662F\u8FD9\u4E2A\u5E93\u7684 ES \u4EA7\u7269\u83AB\u540D\u5176\u5999\u591A\u51FA\u4E86\u4E00\u884C\u65E0\u7528\u7684\u4EE3\u7801:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// WindowScroller.js \u5E76\u6CA1\u6709\u5BFC\u51FA\u8FD9\u4E2A\u6A21\u5757</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bpfrpt_proptype_WindowScroller</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../WindowScroller.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u5176\u5B9E\u6211\u4EEC\u5E76\u4E0D\u9700\u8981\u8FD9\u884C\u4EE3\u7801\uFF0C\u4F46\u5B83\u5374\u5BFC\u81F4 Esbuild \u9884\u6784\u5EFA\u7684\u65F6\u5019\u76F4\u63A5\u62A5\u9519\u9000\u51FA\u4E86\u3002\u90A3\u8FD9\u4E00\u7C7B\u7684\u95EE\u9898\u5982\u4F55\u89E3\u51B3\u5462\uFF1F</p><h5 id="_1-\u4FEE\u6539\u7B2C\u4E09\u65B9\u5E93\u4EE3\u7801" tabindex="-1">1. \u4FEE\u6539\u7B2C\u4E09\u65B9\u5E93\u4EE3\u7801 <a class="header-anchor" href="#_1-\u4FEE\u6539\u7B2C\u4E09\u65B9\u5E93\u4EE3\u7801" aria-hidden="true">#</a></h5><p>\u9996\u5148\uFF0C\u6211\u4EEC\u80FD\u60F3\u5230\u7684\u601D\u8DEF\u662F<strong>\u76F4\u63A5\u4FEE\u6539\u7B2C\u4E09\u65B9\u5E93\u7684\u4EE3\u7801</strong>\uFF0C\u4E0D\u8FC7\u8FD9\u4F1A\u5E26\u6765\u56E2\u961F\u534F\u4F5C\u7684\u95EE\u9898\uFF0C\u4F60\u7684\u6539\u52A8\u9700\u8981\u540C\u6B65\u5230\u56E2\u961F\u6240\u6709\u6210\u5458\uFF0C\u6BD4\u8F83\u9EBB\u70E6\u3002</p><p>\u597D\u5728\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528 <code>patch-package</code> \u8FD9\u4E2A\u5E93\u6765\u89E3\u51B3\u8FD9\u7C7B\u95EE\u9898\u3002\u4E00\u65B9\u9762\uFF0C\u5B83\u80FD\u8BB0\u5F55\u7B2C\u4E09\u65B9\u5E93\u4EE3\u7801\u7684\u6539\u52A8\uFF0C\u53E6\u4E00\u65B9\u9762\u4E5F\u80FD\u5C06\u6539\u52A8\u540C\u6B65\u5230\u56E2\u961F\u6BCF\u4E2A\u6210\u5458\u3002</p><p><code>patch-package</code> \u5B98\u65B9\u53EA\u652F\u6301 npm \u548C yarn\uFF0C\u800C\u4E0D\u652F\u6301 pnpm\uFF0C\u4E0D\u8FC7\u793E\u533A\u4E2D\u5DF2\u7ECF\u63D0\u4F9B\u4E86\u652F\u6301<code>pnpm</code>\u7684\u7248\u672C\uFF0C\u8FD9\u91CC\u6211\u4EEC\u6765\u5B89\u88C5\u4E00\u4E0B\u76F8\u5E94\u7684\u5305:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">milahu</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">patch</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">package</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">with</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">pnpm</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">support </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"></span></code></pre></div><blockquote><p>\u6CE8\u610F: \u8981\u6539\u52A8\u7684\u5305\u5728 package.json \u4E2D\u5FC5\u987B\u58F0\u660E\u786E\u5B9A\u7684\u7248\u672C\uFF0C\u4E0D\u80FD\u6709<code>~</code>\u6216\u8005<code>^</code>\u7684\u524D\u7F00\u3002</p></blockquote><p>\u63A5\u7740\uFF0C\u6211\u4EEC\u8FDB\u5165\u7B2C\u4E09\u65B9\u5E93\u7684\u4EE3\u7801\u4E2D\u8FDB\u884C\u4FEE\u6539\uFF0C\u5148\u5220\u6389\u65E0\u7528\u7684 import \u8BED\u53E5\uFF0C\u518D\u5728\u547D\u4EE4\u884C\u8F93\u5165:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">npx patch</span><span style="color:#89DDFF;">-</span><span style="color:#89DDFF;">package</span><span style="color:#A6ACCD;"> react</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">virtualized</span></span>
<span class="line"></span></code></pre></div><p>\u73B0\u5728\u6839\u76EE\u5F55\u4F1A\u591A\u51FA <code>patches</code> \u76EE\u5F55\u8BB0\u5F55\u7B2C\u4E09\u65B9\u5305\u5185\u5BB9\u7684\u66F4\u6539\uFF0C\u968F\u540E\u6211\u4EEC\u5728 <code>package.json</code> \u7684 <code>scripts</code> \u4E2D\u589E\u52A0\u5982\u4E0B\u5185\u5BB9\uFF1A</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// ...</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">postinstall</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">patch-package</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u6837\u4E00\u6765\uFF0C\u6BCF\u6B21\u5B89\u88C5\u4F9D\u8D56\u7684\u65F6\u5019\u90FD\u4F1A\u901A\u8FC7 <code>postinstall</code> \u811A\u672C\u81EA\u52A8\u5E94\u7528 patches \u7684\u4FEE\u6539\uFF0C\u89E3\u51B3\u4E86\u56E2\u961F\u534F\u4F5C\u7684\u95EE\u9898\u3002</p><h5 id="_2-\u52A0\u5165-esbuild-\u63D2\u4EF6" tabindex="-1">2. \u52A0\u5165 ESBuild \u63D2\u4EF6 <a class="header-anchor" href="#_2-\u52A0\u5165-esbuild-\u63D2\u4EF6" aria-hidden="true">#</a></h5><p>\u7B2C\u4E8C\u79CD\u65B9\u5F0F\u662F\u901A\u8FC7 Esbuild \u63D2\u4EF6\u4FEE\u6539\u6307\u5B9A\u6A21\u5757\u7684\u5185\u5BB9\uFF0C\u8FD9\u91CC\u7ED9\u5927\u5BB6\u5C55\u793A\u4E00\u4E0B\u65B0\u589E\u7684\u914D\u7F6E\u5185\u5BB9:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> esbuildPatchPlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">react-virtualized-patch</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">setup</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onLoad</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        filter</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">react-virtualized</span><span style="color:#A6ACCD;">\\/</span><span style="color:#C3E88D;">dist</span><span style="color:#A6ACCD;">\\/</span><span style="color:#C3E88D;">es</span><span style="color:#A6ACCD;">\\/</span><span style="color:#C3E88D;">WindowScroller</span><span style="color:#A6ACCD;">\\/</span><span style="color:#C3E88D;">utils</span><span style="color:#A6ACCD;">\\/</span><span style="color:#C3E88D;">onScroll.js</span><span style="color:#89DDFF;">$</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">text</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">promises</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFile</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          contents</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">text</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">import { bpfrpt_proptype_WindowScroller } from &quot;../WindowScroller.js&quot;;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#F07178;">          )</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u63D2\u4EF6\u52A0\u5165 Vite \u9884\u6784\u5EFA\u914D\u7F6E</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">optimizeDeps</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">esbuildOptions</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#FFCB6B;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">esbuildPatchPlugin</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="\u603B\u7ED3-4" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3-4" aria-hidden="true">#</a></h3><p>\u5728\u8FD9\u4E00\u8282\uFF0C\u4F60\u9700\u8981\u91CD\u70B9\u638C\u63E1 <strong>Vite \u9884\u6784\u5EFA\u6280\u672F\u7684\u4F5C\u7528</strong>\u548C<strong>\u9884\u6784\u5EFA\u76F8\u5173\u914D\u7F6E\u7684\u4F7F\u7528</strong>\u3002</p><p>Vite \u4E2D\u7684\u4F9D\u8D56\u9884\u6784\u5EFA\u6280\u672F\u4E3B\u8981\u89E3\u51B3\u4E86 2 \u4E2A\u95EE\u9898\uFF0C\u5373\u6A21\u5757\u683C\u5F0F\u517C\u5BB9\u95EE\u9898\u548C\u6D77\u91CF\u6A21\u5757\u8BF7\u6C42\u7684\u95EE\u9898\u3002 Vite \u4E2D\u5F00\u542F\u9884\u6784\u5EFA\u6709 2 \u79CD\u65B9\u5F0F\uFF0C\u5E76\u68B3\u7406\u4E86\u9884\u6784\u5EFA\u4EA7\u7269\u7684\u7F13\u5B58\u7B56\u7565\uFF0C\u63A8\u8350\u4E86\u4E00\u4E9B\u624B\u52A8\u6E05\u9664\u7F13\u5B58\u7684\u65B9\u6CD5\u3002</p><p>\u63A5\u7740\uFF0C\u6211\u4EEC\u6B63\u5F0F\u5B66\u4E60\u4E86\u9884\u6784\u5EFA\u7684\u76F8\u5173\u914D\u7F6E\u2014\u2014<code>entries</code>\u3001<code>include</code>\u3001<code>exclude</code>\u548C<code>esbuldOptions</code>\uFF0C\u5E76\u4E14\u91CD\u70B9\u4ECB\u7ECD\u4E86 <code>include</code> \u914D\u7F6E\u7684\u5404\u79CD\u4F7F\u7528\u573A\u666F\u548C\u4F7F\u7528\u59FF\u52BF\u3002\u6700\u540E\uFF0C\u6211\u4EEC\u8BA8\u8BBA\u4E86\u4E00\u7C7B\u7279\u6B8A\u60C5\u51B5\uFF0C\u5373\u7B2C\u4E09\u65B9\u5305\u51FA\u73B0\u4E86\u95EE\u9898\u8BE5\u600E\u4E48\u529E\uFF0C\u5206\u522B\u7ED9\u4F60\u4ECB\u7ECD\u4E86\u4E24\u4E2A\u89E3\u51B3\u601D\u8DEF: \u901A\u8FC7 <code>patch-package</code> \u4FEE\u6539\u5E93\u4EE3\u7801\u548C\u7F16\u5199 <code>Esbuild \u63D2\u4EF6 </code> \u4FEE\u6539\u6A21\u5757\u52A0\u8F7D\u7684\u5185\u5BB9\u3002</p><h2 id="\u53CC\u5F15\u64CE\u67B6\u6784" tabindex="-1">\u53CC\u5F15\u64CE\u67B6\u6784 <a class="header-anchor" href="#\u53CC\u5F15\u64CE\u67B6\u6784" aria-hidden="true">#</a></h2><p>\u4E4B\u524D\uFF0C\u6211\u4EEC\u5B66\u4E60\u4E86\u5F88\u591A Vite \u4F7F\u7528\u548C\u9879\u76EE\u642D\u5EFA\u7684\u5185\u5BB9\u3002\u63A5\u4E0B\u6765\u8BA9\u6211\u4EEC\u5C06\u76EE\u5149\u96C6\u4E2D\u5230 Vite \u672C\u8EAB\u7684\u67B6\u6784\u4E0A\uFF0C\u4E00\u8D77\u804A\u804A\u5B83\u662F\u5982\u4F55\u7AD9\u5728\u5DE8\u4EBA\u7684\u80A9\u8180\u4E0A\u5B9E\u73B0\u51FA\u6765\u7684\u3002\u6240\u8C13\u7684 <code>\u5DE8\u4EBA</code>\uFF0C\u6307\u7684\u5C31\u662F Vite \u5E95\u5C42\u6240\u6DF1\u5EA6\u4F7F\u7528\u7684\u4E24\u4E2A\u6784\u5EFA\u5F15\u64CE\u2014\u2014 <code>Esbuild</code> \u548C <code>Rollup</code>\u3002</p><h3 id="vite-\u67B6\u6784\u56FE" tabindex="-1">Vite \u67B6\u6784\u56FE <a class="header-anchor" href="#vite-\u67B6\u6784\u56FE" aria-hidden="true">#</a></h3><p>\u5F88\u591A\u4EBA\u5BF9 Vite \u7684\u53CC\u5F15\u64CE\u67B6\u6784\u4EC5\u4EC5\u505C\u7559\u5728 <code>\u5F00\u53D1\u9636\u6BB5\u4F7F\u7528 Esbuild\uFF0C\u751F\u4EA7\u73AF\u5883\u7528 Rollup</code> \u7684\u9636\u6BB5\uFF0C\u6B8A\u4E0D\u77E5\uFF0CVite \u771F\u6B63\u7684\u67B6\u6784\u8FDC\u6CA1\u6709\u8FD9\u4E48\u7B80\u5355\u3002\u4E00\u56FE\u80DC\u5343\u8A00\uFF0C\u8FD9\u91CC\u653E\u4E00\u5F20 Vite \u67B6\u6784\u56FE\uFF1A</p><img src="`+s+'" style="zoom:60%;"><h3 id="esbuild" tabindex="-1">ESBuild <a class="header-anchor" href="#esbuild" aria-hidden="true">#</a></h3><p>\u5FC5\u987B\u8981\u627F\u8BA4\u7684\u662F\uFF0C<code>Esbuild</code>\u7684\u786E\u662F Vite \u9AD8\u6027\u80FD\u7684\u5F97\u529B\u52A9\u624B\uFF0C\u5728\u5F88\u591A <code>\u5173\u952E\u7684\u6784\u5EFA\u9636\u6BB5</code> \u8BA9 Vite \u83B7\u5F97\u4E86\u76F8\u5F53\u4F18\u5F02\u7684\u6027\u80FD\uFF0C\u5982\u679C\u8FD9\u4E9B\u9636\u6BB5\u7528\u4F20\u7EDF\u7684\u6253\u5305\u5668/\u7F16\u8BD1\u5668\u6765\u5B8C\u6210\u7684\u8BDD\uFF0C\u5F00\u53D1\u4F53\u9A8C\u8981\u4E0B\u964D\u4E00\u5927\u622A\u3002</p><p>\u90A3\u4E48\uFF0CEsbuild \u5230\u5E95\u5728 Vite \u7684\u6784\u5EFA\u4F53\u7CFB\u4E2D\u53D1\u6325\u4E86\u54EA\u4E9B\u4F5C\u7528\uFF1F</p><h4 id="\u4F9D\u8D56\u6784\u5EFA-bundle-\u5DE5\u5177" tabindex="-1">\u4F9D\u8D56\u6784\u5EFA - Bundle \u5DE5\u5177 <a class="header-anchor" href="#\u4F9D\u8D56\u6784\u5EFA-bundle-\u5DE5\u5177" aria-hidden="true">#</a></h4><p>\u9996\u5148\u662F<strong>\u5F00\u53D1\u9636\u6BB5\u7684\u4F9D\u8D56\u9884\u6784\u5EFA</strong>\u9636\u6BB5\u3002</p><img src="'+A+'" style="zoom:70%;"><p>\u4E00\u822C\u6765\u8BF4\uFF0C<code>node_modules</code> \u4F9D\u8D56\u7684\u5927\u5C0F\u52A8\u8F84\u51E0\u767E MB \u751A\u81F3\u4E0A GB \uFF0C\u4F1A\u8FDC\u8D85\u9879\u76EE\u6E90\u4EE3\u7801\uFF0C\u76F8\u4FE1\u5927\u5BB6\u90FD\u6DF1\u6709\u4F53\u4F1A\u3002\u5982\u679C\u8FD9\u4E9B\u4F9D\u8D56\u76F4\u63A5\u5728 Vite \u4E2D\u4F7F\u7528\uFF0C\u4F1A\u51FA\u73B0\u4E00\u7CFB\u5217\u7684\u95EE\u9898\uFF0C\u4E3B\u8981\u662F ESM \u683C\u5F0F\u7684\u517C\u5BB9\u6027\u95EE\u9898\u548C\u6D77\u91CF\u8BF7\u6C42\u7684\u95EE\u9898\u3002\u603B\u800C\u8A00\u4E4B\uFF0C\u5BF9\u4E8E\u7B2C\u4E09\u65B9\u4F9D\u8D56\uFF0C\u9700\u8981\u5728\u5E94\u7528\u542F\u52A8\u524D\u8FDB\u884C<strong>\u6253\u5305</strong>\u5E76\u4E14<strong>\u8F6C\u6362\u4E3A ESM \u683C\u5F0F</strong>\u3002</p><p>Vite 1.x \u7248\u672C\u4E2D\u4F7F\u7528 Rollup \u6765\u505A\u8FD9\u4EF6\u4E8B\u60C5\uFF0C\u4F46 Esbuild \u7684\u6027\u80FD\u5B9E\u5728\u662F\u592A\u6050\u6016\u4E86\uFF0CVite 2.x \u679C\u65AD\u91C7\u7528 Esbuild \u6765\u5B8C\u6210\u7B2C\u4E09\u65B9\u4F9D\u8D56\u7684\u9884\u6784\u5EFA\uFF0C\u81F3\u4E8E\u6027\u80FD\u5230\u5E95\u6709\u591A\u5F3A\uFF0C\u5927\u5BB6\u53EF\u4EE5\u53C2\u7167\u5B83\u4E0E\u4F20\u7EDF\u6253\u5305\u5DE5\u5177\u7684\u6027\u80FD\u5BF9\u6BD4\u56FE:</p><img src="'+d+'"><p>\u5F53\u7136\uFF0CEsbuild \u4F5C\u4E3A\u6253\u5305\u5DE5\u5177\u4E5F\u6709\u4E00\u4E9B\u7F3A\u70B9\u3002</p><ul><li>\u4E0D\u652F\u6301\u964D\u7EA7\u5230 <code>ES5</code> \u7684\u4EE3\u7801\u3002\u8FD9\u610F\u5473\u7740\u5728\u4F4E\u7AEF\u6D4F\u89C8\u5668\u4EE3\u7801\u4F1A\u8DD1\u4E0D\u8D77\u6765\u3002</li><li>\u4E0D\u652F\u6301 <code>const enum</code> \u7B49\u8BED\u6CD5\u3002\u8FD9\u610F\u5473\u7740\u5355\u72EC\u4F7F\u7528\u8FD9\u4E9B\u8BED\u6CD5\u5728 esbuild \u4E2D\u4F1A\u76F4\u63A5\u629B\u9519\u3002</li><li>\u4E0D\u63D0\u4F9B\u64CD\u4F5C\u6253\u5305\u4EA7\u7269\u7684\u63A5\u53E3\uFF0C\u50CF Rollup \u4E2D\u7075\u6D3B\u5904\u7406\u6253\u5305\u4EA7\u7269\u7684\u80FD\u529B(\u5982<code>renderChunk</code>\u94A9\u5B50)\u5728 Esbuild \u5F53\u4E2D\u5B8C\u5168\u6CA1\u6709\u3002</li><li>\u4E0D\u652F\u6301\u81EA\u5B9A\u4E49 Code Splitting \u7B56\u7565\u3002\u4F20\u7EDF\u7684 Webpack \u548C Rollup \u90FD\u63D0\u4F9B\u4E86\u81EA\u5B9A\u4E49\u62C6\u5305\u7B56\u7565\u7684 API\uFF0C\u800C Esbuild \u5E76\u672A\u63D0\u4F9B\uFF0C\u4ECE\u800C\u964D\u7EA7\u4E86\u62C6\u5305\u4F18\u5316\u7684\u7075\u6D3B\u6027\u3002</li></ul><p>\u5C3D\u7BA1 Esbuild \u4F5C\u4E3A\u4E00\u4E2A\u793E\u533A\u65B0\u5174\u7684\u660E\u661F\u9879\u76EE\uFF0C\u6709\u5982\u6B64\u591A\u7684\u5C40\u9650\u6027\uFF0C\u4F46\u4F9D\u7136\u4E0D\u59A8\u788D Vite \u5728<strong>\u5F00\u53D1\u9636\u6BB5</strong>\u4F7F\u7528\u5B83\u6210\u529F\u542F\u52A8\u9879\u76EE\u5E76\u83B7\u5F97\u6781\u81F4\u7684<strong>\u6027\u80FD\u63D0\u5347</strong>\uFF0C\u751F\u4EA7\u73AF\u5883\u5904\u4E8E\u7A33\u5B9A\u6027\u8003\u8651\u5F53\u7136\u662F\u91C7\u7528\u529F\u80FD\u66F4\u52A0\u4E30\u5BCC\u3001\u751F\u6001\u66F4\u52A0\u6210\u719F\u7684 Rollup \u4F5C\u4E3A\u4F9D\u8D56\u6253\u5305\u5DE5\u5177\u4E86\u3002</p><h4 id="\u5355\u6587\u4EF6\u7F16\u8BD1-\u7F16\u8BD1\u5DE5\u5177" tabindex="-1">\u5355\u6587\u4EF6\u7F16\u8BD1 - \u7F16\u8BD1\u5DE5\u5177 <a class="header-anchor" href="#\u5355\u6587\u4EF6\u7F16\u8BD1-\u7F16\u8BD1\u5DE5\u5177" aria-hidden="true">#</a></h4><p>\u5728\u4F9D\u8D56\u9884\u6784\u5EFA\u9636\u6BB5\uFF0C Esbuild \u4F5C\u4E3A Bundler \u7684\u89D2\u8272\u5B58\u5728\u3002\u800C\u5728 TS(X)/JS(X) \u5355\u6587\u4EF6\u7F16\u8BD1\u4E0A\u9762\uFF0CVite \u4E5F\u4F7F\u7528 Esbuild \u8FDB\u884C\u8BED\u6CD5\u8F6C\u8BD1\uFF0C\u4E5F\u5C31\u662F\u5C06 Esbuild \u4F5C\u4E3A Transformer \u6765\u7528\u3002\u5927\u5BB6\u53EF\u4EE5\u5728\u67B6\u6784\u56FE\u4E2D <code>Vite Plugin Pipeline</code> \u90E8\u5206\u6CE8\u610F\u5230:</p><img src="'+u+'" style="zoom:70%;"><p>\u4E5F\u5C31\u662F\u8BF4\uFF0CEsbuild \u8F6C\u8BD1 TS \u6216\u8005 JSX \u7684\u80FD\u529B\u901A\u8FC7 Vite \u63D2\u4EF6\u63D0\u4F9B\uFF0C\u8FD9\u4E2A Vite \u63D2\u4EF6\u5728\u5F00\u53D1\u73AF\u5883\u548C\u751F\u4EA7\u73AF\u5883\u90FD\u4F1A\u6267\u884C\uFF0C\u56E0\u6B64\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5F97\u51FA\u4E0B\u9762\u8FD9\u4E2A\u7ED3\u8BBA:</p><blockquote><p>Vite \u5DF2\u7ECF\u5C06 Esbuild \u7684 Transformer \u80FD\u529B\u7528\u5230\u4E86\u751F\u4EA7\u73AF\u5883\u3002\u5BF9\u4E8E\u4F4E\u7AEF\u6D4F\u89C8\u5668\u573A\u666F\uFF0CVite \u4ECD\u7136\u53EF\u4EE5\u505A\u5230\u8BED\u6CD5\u548C Polyfill \u5B89\u5168\u3002</p></blockquote><p>\u8FD9\u90E8\u5206\u80FD\u529B\u7528\u6765\u66FF\u6362\u539F\u5148 Babel \u6216\u8005 TSC \u7684\u529F\u80FD\uFF0C\u56E0\u4E3A\u65E0\u8BBA\u662F Babel \u8FD8\u662F TSC\u90FD\u6709\u6027\u80FD\u95EE\u9898\uFF0C\u5927\u5BB6\u5BF9\u8FD9\u4E24\u4E2A\u5DE5\u5177\u666E\u904D\u7684\u8BA4\u77E5\u90FD\u662F: <strong>\u6162\uFF0C\u592A\u6162\u4E86</strong>\u3002</p><p>\u5F53 Vite \u4F7F\u7528 Esbuild \u505A\u5355\u6587\u4EF6\u7F16\u8BD1\u4E4B\u540E\uFF0C\u63D0\u5347\u53EF\u4EE5\u8BF4<strong>\u76F8\u5F53\u5927</strong>\u4E86\uFF0C\u6211\u4EEC\u4EE5\u4E00\u4E2A\u5DE8\u5927\u7684\u300150 \u591A MB \u7684\u7EAF\u4EE3\u7801\u6587\u4EF6\u4E3A\u4F8B\uFF0C\u6765<a href="https://link.juejin.cn/?target=https%3A%2F%2Fdatastation.multiprocess.io%2Fblog%2F2021-11-13-benchmarking-esbuild-swc-typescript-babel.html" target="_blank" rel="noreferrer">\u5BF9\u6BD4</a><code>Esbuild</code>\u3001<code>Babel</code>\u3001<code>TSC</code> \u5305\u62EC <code>SWC</code> \u7684\u7F16\u8BD1\u6027\u80FD:</p><img src="'+g+'" style="zoom:70%;"><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u867D\u7136 Esbuild Transfomer \u80FD\u5E26\u6765\u5DE8\u5927\u7684\u6027\u80FD\u63D0\u5347\uFF0C\u4F46\u5176\u81EA\u8EAB\u4E5F\u6709\u5C40\u9650\u6027\uFF0C\u6700\u5927\u7684\u5C40\u9650\u6027\u5C31\u5728\u4E8E TS \u4E2D\u7684\u7C7B\u578B\u68C0\u67E5\u95EE\u9898\u3002\u8FD9\u662F\u56E0\u4E3A Esbuild \u5E76\u6CA1\u6709\u5B9E\u73B0 TS \u7684\u7C7B\u578B\u7CFB\u7EDF\uFF0C\u5728\u7F16\u8BD1 <code>TS</code>(\u6216\u8005 <code>TSX</code>) \u6587\u4EF6\u65F6\u4EC5\u4EC5\u62B9\u6389\u4E86\u7C7B\u578B\u76F8\u5173\u7684\u4EE3\u7801\uFF0C\u6682\u65F6\u6CA1\u6709\u80FD\u529B\u5B9E\u73B0\u7C7B\u578B\u68C0\u67E5\u3002</p><p>\u4E5F\u56E0\u6B64\uFF0C<code>vite build</code>\u4E4B\u524D\u4F1A\u5148\u6267\u884C<code>tsc</code>\u547D\u4EE4\uFF0C\u4E5F\u5C31\u662F\u501F\u52A9 TS \u5B98\u65B9\u7684\u7F16\u8BD1\u5668\u8FDB\u884C\u7C7B\u578B\u68C0\u67E5\u3002</p><p>\u5F53\u7136\uFF0C\u8981\u89E3\u51B3\u7C7B\u578B\u95EE\u9898\uFF0C\u6211\u66F4\u63A8\u8350\u5927\u5BB6\u4F7F\u7528 TS \u7684\u7F16\u8F91\u5668\u63D2\u4EF6\u3002\u5728\u5F00\u53D1\u9636\u6BB5\u5C31\u80FD\u65E9\u65E9\u628A\u95EE\u9898\u66B4\u9732\u51FA\u6765\u5E76\u89E3\u51B3\uFF0C\u4E0D\u81F3\u4E8E\u7B49\u5230\u9879\u76EE\u8981\u6253\u5305\u4E0A\u7EBF\u7684\u65F6\u5019\u3002</p><h4 id="\u4EE3\u7801\u538B\u7F29-\u538B\u7F29\u5DE5\u5177" tabindex="-1">\u4EE3\u7801\u538B\u7F29 - \u538B\u7F29\u5DE5\u5177 <a class="header-anchor" href="#\u4EE3\u7801\u538B\u7F29-\u538B\u7F29\u5DE5\u5177" aria-hidden="true">#</a></h4><blockquote><p>Vite \u4ECE 2.6 \u7248\u672C\u5F00\u59CB\uFF0C\u5C31\u5B98\u5BA3\u9ED8\u8BA4\u4F7F\u7528 Esbuild \u6765\u8FDB\u884C\u751F\u4EA7\u73AF\u5883\u7684\u4EE3\u7801\u538B\u7F29\uFF0C\u5305\u62EC JS \u4EE3\u7801\u548C CSS \u4EE3\u7801\u3002</p></blockquote><p>\u4ECE\u67B6\u6784\u56FE\u4E2D\u53EF\u4EE5\u770B\u5230\uFF0C\u5728\u751F\u4EA7\u73AF\u5883\u4E2D Esbuild \u538B\u7F29\u5668\u901A\u8FC7\u63D2\u4EF6\u7684\u5F62\u5F0F\u878D\u5165\u5230\u4E86 Rollup \u7684\u6253\u5305\u6D41\u7A0B\u4E2D:</p><img src="'+m+'" style="zoom:80%;"><p>\u4E3A\u4EC0\u4E48 Vite \u8981\u5C06 Esbuild \u4F5C\u4E3A\u751F\u4EA7\u73AF\u5883\u4E0B\u9ED8\u8BA4\u7684\u538B\u7F29\u5DE5\u5177\u5462\uFF1F</p><p>\u4F20\u7EDF\u7684\u65B9\u5F0F\u90FD\u662F\u4F7F\u7528 Terser \u8FD9\u79CD JS \u5F00\u53D1\u7684\u538B\u7F29\u5668\u6765\u5B9E\u73B0\uFF0C\u5728 Webpack \u6216\u8005 Rollup \u4E2D\u4F5C\u4E3A\u4E00\u4E2A Plugin \u6765\u5B8C\u6210\u4EE3\u7801\u6253\u5305\u540E\u7684\u538B\u7F29\u6DF7\u6DC6\u7684\u5DE5\u4F5C\u3002\u4F46 Terser \u5176\u5B9E\u5F88\u6162\uFF0C\u4E3B\u8981\u6709 2 \u4E2A\u539F\u56E0\u3002</p><ol><li>\u538B\u7F29\u8FD9\u9879\u5DE5\u4F5C\u6D89\u53CA\u5927\u91CF AST \u64CD\u4F5C\uFF0C\u5E76\u4E14\u5728\u4F20\u7EDF\u7684\u6784\u5EFA\u6D41\u7A0B\u4E2D\uFF0CAST \u5728\u5404\u4E2A\u5DE5\u5177\u4E4B\u95F4\u65E0\u6CD5\u5171\u4EAB\uFF0C\u6BD4\u5982 Terser \u5C31\u65E0\u6CD5\u4E0E Babel \u5171\u4EAB\u540C\u4E00\u4E2A AST\uFF0C\u9020\u6210\u4E86\u5F88\u591A\u91CD\u590D\u89E3\u6790\u7684\u8FC7\u7A0B\u3002</li><li>JS \u672C\u8EAB\u5C5E\u4E8E\u89E3\u91CA\u6027 + JIT\uFF08\u5373\u65F6\u7F16\u8BD1\uFF09 \u7684\u8BED\u8A00\uFF0C\u5BF9\u4E8E\u538B\u7F29\u8FD9\u79CD CPU \u5BC6\u96C6\u578B\u7684\u5DE5\u4F5C\uFF0C\u5176\u6027\u80FD\u8FDC\u8FDC\u6BD4\u4E0D\u4E0A Golang \u8FD9\u79CD\u539F\u751F\u8BED\u8A00\u3002</li></ol><p>\u56E0\u6B64\uFF0CEsbuild \u8FD9\u79CD\u4ECE\u5934\u5230\u5C3E<strong>\u5171\u4EAB AST</strong> \u4EE5\u53CA<strong>\u539F\u751F\u8BED\u8A00\u7F16\u5199</strong>\u7684 Minifier \u5728\u6027\u80FD\u4E0A\u80FD\u591F\u7529\u5F00\u4F20\u7EDF\u5DE5\u5177\u7684\u597D\u51E0\u5341\u500D\u3002</p><p>\u4E3E\u4E2A\u4F8B\u5B50\uFF0C\u6211\u4EEC\u53EF\u4EE5\u770B\u4E0B\u9762\u8FD9\u4E2A\u5B9E\u9645\u5927\u578B\u5E93(<code>echarts</code>)\u7684\u538B\u7F29\u6027\u80FD<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fprivatenumber%2Fminification-benchmarks" target="_blank" rel="noreferrer">\u6D4B\u8BD5\u9879\u76EE</a>:</p><img src="'+E+`"><p>\u538B\u7F29\u4E00\u4E2A\u5927\u5C0F\u4E3A<code>3.2 MB</code>\u7684\u5E93\uFF0CTerser \u9700\u8981\u8017\u8D39<code>8798 ms</code>\uFF0C\u800C Esbuild \u4EC5\u4EC5\u9700\u8981<code>361 ms</code>\uFF0C\u538B\u7F29\u6548\u7387\u8F83 Terser \u63D0\u5347\u4E86\u4E8C\u4E09\u5341\u500D\uFF0C\u5E76\u4E14\u4EA7\u7269\u7684\u4F53\u79EF\u51E0\u4E4E\u6CA1\u6709\u52A3\u5316\u3002</p><p>\u603B\u7684\u6765\u8BF4\uFF0CVite \u5C06 Esbuild \u4F5C\u4E3A\u81EA\u5DF1\u7684\u6027\u80FD\u5229\u5668\uFF0C\u5C06 Esbuild \u5404\u4E2A\u5782\u76F4\u65B9\u5411\u7684\u80FD\u529B(<code>Bundler</code>\u3001<code>Transformer</code>\u3001<code>Minifier</code>)\u5229\u7528\u7684\u6DCB\u6F13\u5C3D\u81F4\uFF0C\u7ED9 Vite \u7684\u9AD8\u6027\u80FD\u63D0\u4F9B\u4E86\u6709\u5229\u7684\u4FDD\u8BC1\u3002</p><h3 id="rollup" tabindex="-1">Rollup <a class="header-anchor" href="#rollup" aria-hidden="true">#</a></h3><p>Rollup \u5728 Vite \u4E2D\u7684\u91CD\u8981\u6027\u4E00\u70B9\u4E5F\u4E0D\u4E9A\u4E8E Esbuild\uFF0C\u5B83\u65E2\u662F Vite \u7528\u4F5C\u751F\u4EA7\u73AF\u5883\u6253\u5305\u7684\u6838\u5FC3\u5DE5\u5177\uFF0C\u4E5F\u76F4\u63A5\u51B3\u5B9A\u4E86 Vite \u63D2\u4EF6\u673A\u5236\u7684\u8BBE\u8BA1\u3002\u90A3\u4E48\uFF0CVite \u5230\u5E95\u57FA\u4E8E Rollup \u505A\u4E86\u54EA\u4E9B\u4E8B\u60C5\uFF1F</p><h4 id="\u751F\u4EA7\u73AF\u5883-bundle" tabindex="-1">\u751F\u4EA7\u73AF\u5883 Bundle <a class="header-anchor" href="#\u751F\u4EA7\u73AF\u5883-bundle" aria-hidden="true">#</a></h4><p>\u867D\u7136 ESM \u5DF2\u7ECF\u5F97\u5230\u4F17\u591A\u6D4F\u89C8\u5668\u7684\u539F\u751F\u652F\u6301\uFF0C\u4F46\u751F\u4EA7\u73AF\u5883\u505A\u5230\u5B8C\u5168 <code>no-bundle</code> \u4E5F\u4E0D\u884C\uFF0C\u4F1A\u6709\u7F51\u7EDC\u6027\u80FD\u95EE\u9898\u3002\u4E3A\u4E86\u5728\u751F\u4EA7\u73AF\u5883\u4E2D\u4E5F\u80FD\u53D6\u5F97\u4F18\u79C0\u7684\u4EA7\u7269\u6027\u80FD\uFF0CVite \u9ED8\u8BA4\u9009\u62E9\u5728\u751F\u4EA7\u73AF\u5883\u4E2D\u5229\u7528 <code>Rollup</code> \u6253\u5305\uFF0C\u5E76\u57FA\u4E8E Rollup \u672C\u8EAB\u6210\u719F\u7684\u6253\u5305\u80FD\u529B\u8FDB\u884C\u6269\u5C55\u548C\u4F18\u5316\uFF0C\u4E3B\u8981\u5305\u542B 3 \u4E2A\u65B9\u9762:</p><ul><li><p>CSS \u4EE3\u7801\u5206\u5272\u3002\u5982\u679C\u67D0\u4E2A\u5F02\u6B65\u6A21\u5757\u4E2D\u5F15\u5165\u4E86\u4E00\u4E9B CSS \u4EE3\u7801\uFF0CVite \u5C31\u4F1A\u81EA\u52A8\u5C06\u8FD9\u4E9B CSS \u62BD\u53D6\u51FA\u6765\u751F\u6210\u5355\u72EC\u7684\u6587\u4EF6\uFF0C\u63D0\u9AD8\u7EBF\u4E0A\u4EA7\u7269\u7684<code>\u7F13\u5B58\u590D\u7528\u7387</code>\u3002</p></li><li><p>\u81EA\u52A8\u9884\u52A0\u8F7D\u3002Vite \u4F1A\u81EA\u52A8\u4E3A\u5165\u53E3 chunk \u7684\u4F9D\u8D56\u81EA\u52A8\u751F\u6210\u9884\u52A0\u8F7D\u6807\u7B7E <code>&lt;link rel=&quot;moduelpreload&quot;&gt;</code> \uFF0C\u5982:</p></li></ul><div class="language-html"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">&lt;!-- \u7701\u7565\u5176\u5B83\u5185\u5BB9 --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">&lt;!-- \u5165\u53E3 chunk --&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">  &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">crossorigin</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/assets/index.250e0340.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">&lt;!--  \u81EA\u52A8\u9884\u52A0\u8F7D\u5165\u53E3 chunk \u6240\u4F9D\u8D56\u7684 chunk--&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">link</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">rel</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">modulepreload</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">href</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/assets/vendor.293dca09.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u79CD\u9002\u5F53\u9884\u52A0\u8F7D\u7684\u505A\u6CD5\u4F1A\u8BA9\u6D4F\u89C8\u5668\u63D0\u524D\u4E0B\u8F7D\u597D\u8D44\u6E90\uFF0C\u4F18\u5316\u9875\u9762\u6027\u80FD\u3002</p><ul><li>\u5F02\u6B65 Chunk \u52A0\u8F7D\u4F18\u5316\u3002\u5728\u5F02\u6B65\u5F15\u5165\u7684 Chunk \u4E2D\uFF0C\u901A\u5E38\u4F1A\u6709\u4E00\u4E9B\u516C\u7528\u7684\u6A21\u5757\uFF0C\u5982\u73B0\u6709\u4E24\u4E2A\u5F02\u6B65\u5F15\u5165\u7684 Chunk: <code>A</code> \u548C <code>B</code>\uFF0C\u800C\u4E14\u4E24\u8005\u6709\u4E00\u4E2A\u516C\u5171\u4F9D\u8D56 C\uFF0C\u5982\u4E0B\u56FE:</li></ul><img src="`+h+'" style="zoom:70%;"><p>\u4E00\u822C\u60C5\u51B5\u4E0B\uFF0CRollup \u6253\u5305\u4E4B\u540E\uFF0C\u4F1A\u5148\u8BF7\u6C42 A\uFF0C\u7136\u540E\u6D4F\u89C8\u5668\u5728\u52A0\u8F7D A \u7684\u8FC7\u7A0B\u4E2D\u624D\u51B3\u5B9A\u8BF7\u6C42\u548C\u52A0\u8F7D C\uFF0C\u4F46 Vite \u8FDB\u884C\u4F18\u5316\u4E4B\u540E\uFF0C\u8BF7\u6C42 A \u7684\u540C\u65F6\u4F1A\u81EA\u52A8\u9884\u52A0\u8F7D C\uFF0C\u901A\u8FC7\u4F18\u5316 Rollup \u4EA7\u7269\u4F9D\u8D56\u52A0\u8F7D\u65B9\u5F0F\u8282\u7701\u4E86\u4E0D\u5FC5\u8981\u7684\u7F51\u7EDC\u5F00\u9500\u3002</p><h4 id="\u63D2\u4EF6\u517C\u5BB9\u673A\u5236" tabindex="-1">\u63D2\u4EF6\u517C\u5BB9\u673A\u5236 <a class="header-anchor" href="#\u63D2\u4EF6\u517C\u5BB9\u673A\u5236" aria-hidden="true">#</a></h4><p>\u65E0\u8BBA\u662F\u5F00\u53D1\u9636\u6BB5\u8FD8\u662F\u751F\u4EA7\u73AF\u5883\uFF0CVite \u90FD\u6839\u690D\u4E8E Rollup \u7684\u63D2\u4EF6\u673A\u5236\u548C\u751F\u6001\uFF0C\u5982\u4E0B\u9762\u7684\u67B6\u6784\u56FE\u6240\u793A:</p><img src="'+b+`"><p>\u5728\u5F00\u53D1\u9636\u6BB5\uFF0CVite \u501F\u9274\u4E86 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fpreactjs%2Fwmr" target="_blank" rel="noreferrer">WMR</a> \u7684\u601D\u8DEF\uFF0C\u81EA\u5DF1\u5B9E\u73B0\u4E86\u4E00\u4E2A <code>Plugin Container</code>\uFF0C\u7528\u6765\u6A21\u62DF Rollup \u8C03\u5EA6\u5404\u4E2A Vite \u63D2\u4EF6\u7684\u6267\u884C\u903B\u8F91\uFF0C\u800C Vite \u7684\u63D2\u4EF6\u5199\u6CD5\u5B8C\u5168\u517C\u5BB9 Rollup\uFF0C\u56E0\u6B64\u5728\u751F\u4EA7\u73AF\u5883\u4E2D\u5C06\u6240\u6709\u7684 Vite \u63D2\u4EF6\u4F20\u5165 Rollup \u4E5F\u6CA1\u6709\u95EE\u9898\u3002</p><p>\u53CD\u8FC7\u6765\u8BF4\uFF0CRollup \u63D2\u4EF6\u5374\u4E0D\u4E00\u5B9A\u80FD\u5B8C\u5168\u517C\u5BB9 Vite\u3002\u4E0D\u8FC7\uFF0C\u76EE\u524D\u4ECD\u7136\u6709\u4E0D\u5C11 Rollup \u63D2\u4EF6\u53EF\u4EE5\u76F4\u63A5\u590D\u7528\u5230 Vite \u4E2D\uFF0C\u4F60\u53EF\u4EE5\u901A\u8FC7\u8FD9\u4E2A\u7AD9\u70B9\u67E5\u770B\u6240\u6709\u517C\u5BB9 Vite \u7684 Rollup \u63D2\u4EF6: <a href="https://link.juejin.cn/?target=https%3A%2F%2Fvite-rollup-plugins.patak.dev%2F" target="_blank" rel="noreferrer">vite-rollup-plugins.patak.dev/</a> \u3002</p><p>\u72FC\u53D4\u5728<a href="https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fmt2Uyh-lpHqHAHqjsen7zw" target="_blank" rel="noreferrer">\u300A\u4EE5\u6846\u67B6\u5B9A\u4F4D\u8BBA\u524D\u7AEF\u7684\u5148\u8FDB\u6027\u300B</a> \u63D0\u5230\u73B0\u4EE3\u524D\u7AEF\u6846\u67B6\u7684\u51E0\u5927\u5206\u7C7B\uFF0CVite \u5C5E\u4E8E<code>\u4EBA\u6709\u6211\u4F18</code>\u7684\u7C7B\u578B\uFF0C\u56E0\u4E3A\u7C7B\u4F3C\u7684\u5DE5\u5177\u4E4B\u524D\u6709 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.snowpack.dev%2F" target="_blank" rel="noreferrer">Snowpack</a>\uFF0CVite \u8BDE\u751F\u4E4B\u540E\u8865\u9F50\u4E86\u4F5C\u4E3A\u4E00\u4E2A no-bundle \u6784\u5EFA\u5DE5\u5177\u7684 Dev Server \u80FD\u529B(\u5982 HMR)\uFF0C\u786E\u5B9E\u6BD4\u73B0\u6709\u7684\u5DE5\u5177\u80FD\u529B\u66F4\u4F18\u3002\u4F46\u66F4\u91CD\u8981\u7684\u662F\uFF0CVite \u5728<strong>\u793E\u533A\u751F\u6001</strong>\u65B9\u9762\u6BD4 Snowpack \u66F4\u5360\u5148\u5929\u4F18\u52BF\u3002</p><p>Snowpack \u81EA\u7814\u4E86\u4E00\u5957\u63D2\u4EF6\u673A\u5236\uFF0C\u7C7B\u4F3C Rollup \u7684 Hook \u673A\u5236\uFF0C\u53EF\u4EE5\u770B\u51FA\u501F\u9274\u4E86 Rollup \u7684\u63D2\u4EF6\u673A\u5236\uFF0C\u4F46\u5E76\u4E0D\u80FD\u517C\u5BB9\u4EFB\u4F55\u73B0\u6709\u7684\u6253\u5305\u5DE5\u5177\u3002\u5982\u679C\u9700\u8981\u6253\u5305\uFF0C\u53EA\u80FD\u8C03\u7528\u5176\u5B83\u6253\u5305\u5DE5\u5177\u7684 API\uFF0C\u81EA\u8EAB\u4E0D\u63D0\u4F9B\u6253\u5305\u80FD\u529B\u3002</p><p>\u800C Vite \u7684\u505A\u6CD5\u662F\u4ECE\u5934\u5230\u5C3E\u6839\u690D\u4E8E\u7684 Rollup \u7684\u751F\u6001\uFF0C\u8BBE\u8BA1\u4E86\u548C Rollup \u975E\u5E38\u543B\u5408\u7684\u63D2\u4EF6\u673A\u5236\uFF0C\u800C Rollup \u4F5C\u4E3A\u4E00\u4E2A\u975E\u5E38\u6210\u719F\u7684\u6253\u5305\u65B9\u6848\uFF0C\u4ECE\u8BDE\u751F\u81F3\u4ECA\u5DF2\u7ECF\u8FED\u4EE3\u4E86<code>\u516D\u5E74\u591A</code>\u7684\u65F6\u95F4\uFF0Cnpm \u5E74\u4E0B\u8F7D\u91CF\u8FBE\u5230<code>\u4E0A\u4EBF\u6B21</code>\uFF0C\u4EA7\u7269\u8D28\u91CF\u548C\u7A33\u5B9A\u6027\u90FD\u7ECF\u5386\u8FC7\u5927\u89C4\u6A21\u7684\u9A8C\u8BC1\u3002\u67D0\u79CD\u7A0B\u5EA6\u4E0A\u8BF4\uFF0C\u8FD9\u79CD\u6839\u690D\u4E8E\u5DF2\u6709\u6210\u719F\u5DE5\u5177\u7684\u601D\u8DEF\u4E5F\u80FD\u6253\u6D88\u6216\u8005\u964D\u4F4E\u7528\u6237\u5185\u5FC3\u7684\u7591\u8651\uFF0C\u66F4\u6709\u5229\u4E8E\u5DE5\u5177\u7684\u63A8\u5E7F\u548C\u53D1\u5C55\u3002</p><h3 id="\u603B\u7ED3-5" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3-5" aria-hidden="true">#</a></h3><p>\u672C\u7BC7\u6587\u7AE0\u62C6\u89E3\u4E86 Vite \u5E95\u5C42\u53CC\u5F15\u64CE\u7684\u67B6\u6784\uFF0C\u5206\u522B\u4ECB\u7ECD\u4E86 Esbuild \u548C Rollup \u7A76\u7ADF\u5728 Vite \u4E2D\u505A\u4E9B\u4E86\u4EC0\u4E48\uFF0C\u4F60\u9700\u8981\u91CD\u70B9\u638C\u63E1 <strong>Vite \u7684\u6574\u4F53\u67B6\u6784</strong>\u4EE5\u53CA <strong>Esbuild \u548C Rollup \u5728 Vite \u4E2D\u7684\u4F5C\u7528</strong>\u3002</p><p>\u9996\u5148\uFF0CEsbuild \u4F5C\u4E3A\u6784\u5EFA\u7684\u6027\u80FD\u5229\u5668\uFF0CVite \u5229\u7528\u5176 Bundler \u7684\u529F\u80FD\u8FDB\u884C\u4F9D\u8D56\u9884\u6784\u5EFA\uFF0C\u7528\u5176 Transformer \u7684\u80FD\u529B\u8FDB\u884C TS \u548C JSX \u6587\u4EF6\u7684\u8F6C\u8BD1\uFF0C\u4E5F\u7528\u5230\u5B83\u7684\u538B\u7F29\u80FD\u529B\u8FDB\u884C JS \u548C CSS \u4EE3\u7801\u7684\u538B\u7F29\u3002</p><p>\u63A5\u7740\uFF0C\u4ECB\u7ECD\u4E86 Vite \u548C Rollup \u7684\u5173\u7CFB\u3002\u5728 Vite \u5F53\u4E2D\uFF0C\u65E0\u8BBA\u662F\u63D2\u4EF6\u673A\u5236\u3001\u8FD8\u662F\u5E95\u5C42\u7684\u6253\u5305\u624B\u6BB5\uFF0C\u90FD\u57FA\u4E8E Rollup \u6765\u5B9E\u73B0\uFF0C\u53EF\u4EE5\u8BF4 Vite \u662F\u5BF9\u4E8E Rollup \u4E00\u79CD\u573A\u666F\u5316\u7684\u6DF1\u5EA6\u6269\u5C55\uFF0C\u5C06 Rollup \u4ECE\u4F20\u7EDF\u7684 JS \u5E93\u6253\u5305\u573A\u666F\u6269\u5C55\u81F3\u5B8C\u6574 Web \u5E94\u7528\u6253\u5305\uFF0C\u7136\u540E\u7ED3\u5408\u5F00\u53D1\u9636\u6BB5 <code>no-bundle</code> \u7684\u6838\u5FC3\u7ADE\u4E89\u529B\uFF0C\u6253\u9020\u51FA\u4E86\u81EA\u5DF1\u72EC\u5177\u4E00\u683C\u7684\u6280\u672F\u54C1\u724C\u3002</p><p>\u56E0\u6B64\uFF0C\u4F60\u53EF\u4EE5\u770B\u51FA\u53CC\u5F15\u64CE\u5BF9\u4E8E Vite \u7684\u91CD\u8981\u6027\uFF0C\u5982\u679C\u8981\u6DF1\u5165\u5B66\u4E60\u548C\u5E94\u7528 Vite\uFF0C\u90A3\u4E48\u638C\u63E1 Esbuild \u548C Rollup \u7684\u57FA\u7840\u4F7F\u7528\u548C\u63D2\u4EF6\u5F00\u53D1\u662F\u975E\u5E38\u6709\u5FC5\u8981\u7684\u3002</p><h2 id="esbuild-\u63D2\u4EF6\u5F00\u53D1\u5B9E\u6218" tabindex="-1">ESBuild \u63D2\u4EF6\u5F00\u53D1\u5B9E\u6218 <a class="header-anchor" href="#esbuild-\u63D2\u4EF6\u5F00\u53D1\u5B9E\u6218" aria-hidden="true">#</a></h2><p>\u672C\u7BC7\u6587\u7AE0\u5C06\u4E13\u6CE8\u4E8E Esbuild \u672C\u8EAB\uFF0C\u8BA9\u6211\u4EEC\u4E00\u8D77\u5B66\u4E60\u5B83\u7684\u57FA\u672C\u6982\u5FF5\u548C\u529F\u80FD\u4F7F\u7528\uFF0C\u540C\u65F6\u5F00\u53D1\u4E00\u4E2A\u5B8C\u6574\u7684 Esbuild \u63D2\u4EF6\u3002</p><h3 id="\u4E3A\u4EC0\u4E48-esbuild-\u6027\u80FD\u6781\u9AD8" tabindex="-1">\u4E3A\u4EC0\u4E48 ESBuild \u6027\u80FD\u6781\u9AD8 <a class="header-anchor" href="#\u4E3A\u4EC0\u4E48-esbuild-\u6027\u80FD\u6781\u9AD8" aria-hidden="true">#</a></h3><p>Esbuild \u662F\u7531 Figma \u7684 CTO \u300CEvan Wallace\u300D\u57FA\u4E8E Golang \u5F00\u53D1\u7684\u4E00\u6B3E\u6253\u5305\u5DE5\u5177\uFF0C\u76F8\u6BD4\u4F20\u7EDF\u7684\u6253\u5305\u5DE5\u5177\uFF0C\u4E3B\u6253\u6027\u80FD\u4F18\u52BF\uFF0C\u5728\u6784\u5EFA\u901F\u5EA6\u4E0A\u53EF\u4EE5\u6BD4\u4F20\u7EDF\u5DE5\u5177\u5FEB <code>10~100</code> \u500D\u3002\u90A3\u4E48\uFF0C\u5B83\u662F\u5982\u4F55\u8FBE\u5230\u8FD9\u6837\u8D85\u9AD8\u7684\u6784\u5EFA\u6027\u80FD\u7684\u5462\uFF1F\u4E3B\u8981\u539F\u56E0\u53EF\u4EE5\u6982\u62EC\u4E3A 4 \u70B9\u3002</p><ol><li><strong>\u4F7F\u7528 Golang \u5F00\u53D1</strong>\uFF0C\u6784\u5EFA\u903B\u8F91\u4EE3\u7801\u76F4\u63A5\u88AB\u7F16\u8BD1\u4E3A\u539F\u751F\u673A\u5668\u7801\uFF0C\u800C\u4E0D\u7528\u50CF JS \u4E00\u6837\u5148\u4EE3\u7801\u89E3\u6790\u4E3A\u5B57\u8282\u7801\uFF0C\u7136\u540E\u8F6C\u6362\u4E3A\u673A\u5668\u7801\uFF0C\u5927\u5927\u8282\u7701\u4E86\u7A0B\u5E8F\u8FD0\u884C\u65F6\u95F4\u3002</li><li><strong>\u591A\u6838\u5E76\u884C</strong>\u3002\u5185\u90E8\u6253\u5305\u7B97\u6CD5\u5145\u5206\u5229\u7528\u591A\u6838 CPU \u4F18\u52BF\uFF0C\u6240\u6709\u7684\u6B65\u9AA4\u5C3D\u53EF\u80FD\u5E76\u884C\uFF0C\u8FD9\u4E5F\u662F\u5F97\u76CA\u4E8E Go \u5F53\u4E2D\u591A\u7EBF\u7A0B\u5171\u4EAB\u5185\u5B58\u7684\u4F18\u52BF\u3002</li><li><strong>\u4ECE\u96F6\u9020\u8F6E\u5B50</strong>\u3002 \u51E0\u4E4E\u6CA1\u6709\u4F7F\u7528\u4EFB\u4F55\u7B2C\u4E09\u65B9\u5E93\uFF0C\u6240\u6709\u903B\u8F91\u81EA\u5DF1\u7F16\u5199\uFF0C\u5927\u5230 AST \u89E3\u6790\uFF0C\u5C0F\u5230\u5B57\u7B26\u4E32\u7684\u64CD\u4F5C\uFF0C\u4FDD\u8BC1\u6781\u81F4\u7684\u4EE3\u7801\u6027\u80FD\u3002</li><li><strong>\u9AD8\u6548\u7684\u5185\u5B58\u5229\u7528</strong>\u3002Esbuild \u4E2D\u4ECE\u5934\u5230\u5C3E\u5C3D\u53EF\u80FD\u5730\u590D\u7528\u4E00\u4EFD AST \u8282\u70B9\u6570\u636E\uFF0C\u800C\u4E0D\u7528\u50CF JS \u6253\u5305\u5DE5\u5177\u4E2D\u9891\u7E41\u5730\u89E3\u6790\u548C\u4F20\u9012 AST \u6570\u636E\uFF08\u5982 string -&gt; TS -&gt; JS -&gt; string)\uFF0C\u9020\u6210\u5185\u5B58\u7684\u5927\u91CF\u6D6A\u8D39\u3002</li></ol><h3 id="esbuild-\u529F\u80FD\u4F7F\u7528" tabindex="-1">ESBuild \u529F\u80FD\u4F7F\u7528 <a class="header-anchor" href="#esbuild-\u529F\u80FD\u4F7F\u7528" aria-hidden="true">#</a></h3><p>\u9996\u5148\u6211\u4EEC\u6267\u884C <code>pnpm init -y</code> \u65B0\u5EFA\u4E00\u4E2A\u9879\u76EE, \u7136\u540E\u901A\u8FC7\u5982\u4E0B\u7684\u547D\u4EE4\u5B8C\u6210 Esbuild \u7684\u5B89\u88C5:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i esbuild</span></span>
<span class="line"></span></code></pre></div><p>\u4F7F\u7528 Esbuild \u6709 2 \u79CD\u65B9\u5F0F\uFF0C\u5206\u522B\u662F <strong>\u547D\u4EE4\u884C\u8C03\u7528</strong>\u548C<strong>\u4EE3\u7801\u8C03\u7528</strong>\u3002</p><h4 id="\u547D\u4EE4\u884C\u8C03\u7528" tabindex="-1">\u547D\u4EE4\u884C\u8C03\u7528 <a class="header-anchor" href="#\u547D\u4EE4\u884C\u8C03\u7528" aria-hidden="true">#</a></h4><p>\u547D\u4EE4\u884C\u65B9\u5F0F\u8C03\u7528\u4E5F\u662F\u6700\u7B80\u5355\u7684\u4F7F\u7528\u65B9\u5F0F\u3002\u6211\u4EEC\u5148\u6765\u5199\u4E00\u4E9B\u793A\u4F8B\u4EE3\u7801\uFF0C\u65B0\u5EFA<code>src/index.jsx</code>\u6587\u4EF6\uFF0C\u5185\u5BB9\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// src/index.jsx</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> Server </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">react-dom/server</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> Greet </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">Hello, juejin!</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(Server</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">renderToString</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Greet</span><span style="color:#89DDFF;"> /&gt;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u5B89\u88C5\u6240\u9700\u7684\u4F9D\u8D56\uFF0C\u5728\u7EC8\u7AEF\u6267\u884C\u5982\u4E0B\u7684\u547D\u4EE4:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm install react react</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">dom</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u7740\u5230<code>package.json</code>\u4E2D\u6DFB\u52A0<code>build</code>\u811A\u672C:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">build</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./node_modules/.bin/esbuild src/index.jsx --bundle --outfile=dist/out.js</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"></span></code></pre></div><blockquote><p>\u5982\u679C\u63D0\u793A &#39;.&#39; is not recognized as an internal or external command\uFF0C\u53EF\u4EE5\u5728\u547D\u4EE4\u884C\u76F4\u63A5\u8FD0\u884C build \u547D\u4EE4\u3002</p></blockquote><p>\u73B0\u5728\uFF0C\u4F60\u53EF\u4EE5\u5728\u7EC8\u7AEF\u6267\u884C<code>pnpm run build</code>\uFF0C\u53EF\u4EE5\u53D1\u73B0\u5982\u4E0B\u7684\u65E5\u5FD7\u4FE1\u606F:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">PS </span><span style="color:#FFCB6B;">D</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">\\workspace\\notes\\vite\\esbuild</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">demo</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">\\node_modules\\</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">bin\\esbuild src</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">jsx </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">bundle </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">outfile</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">dist</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  dist\\out</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js  507</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">7kb</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Done </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> 72ms</span></span>
<span class="line"></span></code></pre></div><p>\u8BF4\u660E\u6211\u4EEC\u5DF2\u7ECF\u6210\u529F\u901A\u8FC7\u547D\u4EE4\u884C\u5B8C\u6210\u4E86 Esbuild \u6253\u5305\uFF01\u4F46\u547D\u4EE4\u884C\u7684\u4F7F\u7528\u65B9\u5F0F\u4E0D\u591F\u7075\u6D3B\uFF0C\u53EA\u80FD\u4F20\u5165\u4E00\u4E9B\u7B80\u5355\u7684\u547D\u4EE4\u884C\u53C2\u6570\uFF0C\u7A0D\u5FAE\u590D\u6742\u7684\u573A\u666F\u5C31\u4E0D\u9002\u7528\u4E86\uFF0C\u6240\u4EE5\u4E00\u822C\u60C5\u51B5\u4E0B\u6211\u4EEC\u8FD8\u662F\u4F1A\u7528\u4EE3\u7801\u8C03\u7528\u7684\u65B9\u5F0F\u3002</p><h4 id="\u4EE3\u7801\u8C03\u7528" tabindex="-1">\u4EE3\u7801\u8C03\u7528 <a class="header-anchor" href="#\u4EE3\u7801\u8C03\u7528" aria-hidden="true">#</a></h4><p>Esbuild \u5BF9\u5916\u66B4\u9732\u4E86\u4E00\u7CFB\u5217\u7684 API\uFF0C\u4E3B\u8981\u5305\u62EC\u4E24\u7C7B: <code>Build API</code>\u548C<code>Transform API</code>\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5728 Nodejs \u4EE3\u7801\u4E2D\u901A\u8FC7\u8C03\u7528\u8FD9\u4E9B API \u6765\u4F7F\u7528 Esbuild \u7684\u5404\u79CD\u529F\u80FD\u3002</p><h5 id="\u9879\u76EE\u6253\u5305\uFF1Abuild-api" tabindex="-1">\u9879\u76EE\u6253\u5305\uFF1ABuild API <a class="header-anchor" href="#\u9879\u76EE\u6253\u5305\uFF1Abuild-api" aria-hidden="true">#</a></h5><p><code>Build API</code> \u4E3B\u8981\u7528\u6765\u8FDB\u884C\u9879\u76EE\u6253\u5305\uFF0C\u5305\u62EC <code>build</code>\u3001<code>buildSync</code> \u548C <code>serve</code> \u4E09\u4E2A\u65B9\u6CD5\u3002</p><p>\u9996\u5148\u6211\u4EEC\u6765\u8BD5\u7740\u5728 Node.js \u4E2D\u4F7F\u7528 <code>build</code> \u65B9\u6CD5\u3002\u4F60\u53EF\u4EE5\u5728\u9879\u76EE\u6839\u76EE\u5F55\u65B0\u5EFA <code>build.js</code> \u6587\u4EF6\uFF0C\u5185\u5BB9\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">onst </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buildSync</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">serve</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esbuild</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">runBuild</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5F02\u6B65\u65B9\u6CD5\uFF0C\u8FD4\u56DE\u4E00\u4E2A Promise</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">build</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// ----  \u5982\u4E0B\u662F\u4E00\u4E9B\u5E38\u89C1\u7684\u914D\u7F6E  --- </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u5F53\u524D\u9879\u76EE\u6839\u76EE\u5F55</span></span>
<span class="line"><span style="color:#F07178;">    absWorkingDir</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cwd</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u5165\u53E3\u6587\u4EF6\u5217\u8868\uFF0C\u4E3A\u4E00\u4E2A\u6570\u7EC4</span></span>
<span class="line"><span style="color:#F07178;">    entryPoints</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./src/index.jsx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u6253\u5305\u4EA7\u7269\u76EE\u5F55</span></span>
<span class="line"><span style="color:#F07178;">    outdir</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u662F\u5426\u9700\u8981\u6253\u5305\uFF0C\u4E00\u822C\u8BBE\u4E3A true</span></span>
<span class="line"><span style="color:#F07178;">    bundle</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u6A21\u5757\u683C\u5F0F\uFF0C\u5305\u62EC\`esm\`\u3001\`commonjs\`\u548C\`iife\`</span></span>
<span class="line"><span style="color:#F07178;">    format</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u9700\u8981\u6392\u9664\u6253\u5305\u7684\u4F9D\u8D56\u5217\u8868</span></span>
<span class="line"><span style="color:#F07178;">    external</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u662F\u5426\u5F00\u542F\u81EA\u52A8\u62C6\u5305</span></span>
<span class="line"><span style="color:#F07178;">    splitting</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u662F\u5426\u751F\u6210 SourceMap \u6587\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">    sourcemap</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u662F\u5426\u751F\u6210\u6253\u5305\u7684\u5143\u4FE1\u606F\u6587\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">    metafile</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u662F\u5426\u8FDB\u884C\u4EE3\u7801\u538B\u7F29</span></span>
<span class="line"><span style="color:#F07178;">    minify</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u662F\u5426\u5F00\u542F watch \u6A21\u5F0F\uFF0C\u5728 watch \u6A21\u5F0F\u4E0B\u4EE3\u7801\u53D8\u52A8\u5219\u4F1A\u89E6\u53D1\u91CD\u65B0\u6253\u5305</span></span>
<span class="line"><span style="color:#F07178;">    watch</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u662F\u5426\u5C06\u4EA7\u7269\u5199\u5165\u78C1\u76D8</span></span>
<span class="line"><span style="color:#F07178;">    write</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// Esbuild \u5185\u7F6E\u4E86\u4E00\u7CFB\u5217\u7684 loader\uFF0C\u5305\u62EC base64\u3001binary\u3001css\u3001dataurl\u3001file\u3001js(x)\u3001ts(x)\u3001text\u3001json</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u9488\u5BF9\u4E00\u4E9B\u7279\u6B8A\u7684\u6587\u4EF6\uFF0C\u8C03\u7528\u4E0D\u540C\u7684 loader \u8FDB\u884C\u52A0\u8F7D</span></span>
<span class="line"><span style="color:#F07178;">    loader</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">.png</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">base64</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">runBuild</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u968F\u540E\uFF0C\u4F60\u5728\u547D\u4EE4\u884C\u6267\u884C <code>node build.js</code>\uFF0C\u5C31\u80FD\u5728\u63A7\u5236\u53F0\u53D1\u73B0\u5982\u4E0B\u65E5\u5FD7\u4FE1\u606F:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// node .\\build.js</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">errors</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">warnings</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">metafile</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">inputs</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">node_modules/.pnpm/react@18.0.0/node_modules/react/cjs/react.development.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">: [</span><span style="color:#A6ACCD;">Object</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">node_modules/.pnpm/react@18.0.0/node_modules/react/index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">: [</span><span style="color:#A6ACCD;">Object</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">node_modules/.pnpm/react-dom@18.0.0_react@18.0.0/node_modules/react-dom/cjs/react-dom-server-legacy.browser.development.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">: [</span><span style="color:#A6ACCD;">Object</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">node_modules/.pnpm/react-dom@18.0.0_react@18.0.0/node_modules/react-dom/cjs/react-dom-server.browser.development.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">: [</span><span style="color:#A6ACCD;">Object</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">node_modules/.pnpm/react-dom@18.0.0_react@18.0.0/node_modules/react-dom/server.browser.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">: [</span><span style="color:#A6ACCD;">Object</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src/index.jsx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">: [</span><span style="color:#A6ACCD;">Object</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">outputs</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dist/index.js.map</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">: [</span><span style="color:#A6ACCD;">Object</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dist/index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">: [</span><span style="color:#A6ACCD;">Object</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u4EE5\u4E0A\u5C31\u662F Esbuild \u6253\u5305\u7684\u5143\u4FE1\u606F\uFF0C\u8FD9\u5BF9\u6211\u4EEC\u7F16\u5199\u63D2\u4EF6\u6269\u5C55 Esbuild \u80FD\u529B\u975E\u5E38\u6709\u7528\u3002</p><p>\u63A5\u7740\uFF0C\u6211\u4EEC\u518D\u89C2\u5BDF\u4E00\u4E0B dist \u76EE\u5F55\uFF0C\u53D1\u73B0\u6253\u5305\u4EA7\u7269\u548C\u76F8\u5E94\u7684 SourceMap \u6587\u4EF6\u4E5F\u5DF2\u7ECF\u6210\u529F\u5199\u5165\u78C1\u76D8:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">dist</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">map</span></span>
<span class="line"></span></code></pre></div><p>\u5176\u5B9E <code>buildSync</code> \u65B9\u6CD5\u7684\u4F7F\u7528\u51E0\u4E4E\u76F8\u540C\uFF0C\u5982\u4E0B\u4EE3\u7801\u6240\u793A:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">runBuild</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u540C\u6B65\u65B9\u6CD5</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">buildSync</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u7701\u7565\u4E00\u7CFB\u5217\u7684\u914D\u7F6E</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">runBuild</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u4F46\u6211\u5E76\u4E0D\u63A8\u8350\u5927\u5BB6\u4F7F\u7528 <code>buildSync</code> \u8FD9\u79CD\u540C\u6B65\u7684 API\uFF0C\u5B83\u4EEC\u4F1A\u5BFC\u81F4\u4E24\u65B9\u9762\u4E0D\u826F\u540E\u679C\u3002\u4E00\u65B9\u9762\u5BB9\u6613\u4F7F Esbuild \u5728\u5F53\u524D\u7EBF\u7A0B\u963B\u585E\uFF0C\u4E27\u5931 <code>\u5E76\u53D1\u4EFB\u52A1\u5904\u7406</code> \u7684\u4F18\u52BF\u3002\u53E6\u4E00\u65B9\u9762\uFF0CEsbuild \u6240\u6709\u63D2\u4EF6\u4E2D\u90FD\u4E0D\u80FD\u4F7F\u7528\u4EFB\u4F55\u5F02\u6B65\u64CD\u4F5C\uFF0C\u8FD9\u7ED9 <code>\u63D2\u4EF6\u5F00\u53D1</code> \u589E\u52A0\u4E86\u9650\u5236\u3002</p><p>\u56E0\u6B64\u6211\u66F4\u63A8\u8350\u5927\u5BB6\u4F7F\u7528 <code>build</code> \u8FD9\u4E2A\u5F02\u6B65 API\uFF0C\u5B83\u53EF\u4EE5\u5F88\u597D\u5730\u907F\u514D\u4E0A\u8FF0\u95EE\u9898\u3002</p><p>\u5728\u9879\u76EE\u6253\u5305\u65B9\u9762\uFF0C\u9664\u4E86 <code>build</code> \u548C <code>buildSync</code>\uFF0CEsbuild \u8FD8\u63D0\u4F9B\u4E86\u53E6\u5916\u4E00\u4E2A\u6BD4\u8F83\u5F3A\u5927\u7684 API\u2014\u2014<code>serve</code>\u3002\u8FD9\u4E2A API \u6709 3 \u4E2A\u7279\u70B9\u3002</p><ol><li>\u5F00\u542F serve \u6A21\u5F0F\u540E\uFF0C\u5C06\u5728\u6307\u5B9A\u7684\u7AEF\u53E3\u548C\u76EE\u5F55\u4E0A\u642D\u5EFA\u4E00\u4E2A<code>\u9759\u6001\u6587\u4EF6\u670D\u52A1</code>\uFF0C\u8FD9\u4E2A\u670D\u52A1\u5668\u7528\u539F\u751F Go \u8BED\u8A00\u5B9E\u73B0\uFF0C\u6027\u80FD\u6BD4 Nodejs \u66F4\u9AD8\u3002</li><li>\u7C7B\u4F3C webpack-dev-server\uFF0C\u6240\u6709\u7684\u4EA7\u7269\u6587\u4EF6\u90FD\u9ED8\u8BA4\u4E0D\u4F1A\u5199\u5230\u78C1\u76D8\uFF0C\u800C\u662F\u653E\u5728\u5185\u5B58\u4E2D\uFF0C\u901A\u8FC7\u8BF7\u6C42\u670D\u52A1\u6765\u8BBF\u95EE\u3002</li><li><strong>\u6BCF\u6B21\u8BF7\u6C42</strong>\u5230\u6765\u65F6\uFF0C\u90FD\u4F1A\u8FDB\u884C\u91CD\u65B0\u6784\u5EFA(<code>rebuild</code>)\uFF0C\u6C38\u8FDC\u8FD4\u56DE\u65B0\u7684\u4EA7\u7269\u3002</li></ol><blockquote><p>\u503C\u5F97\u6CE8\u610F\u7684\u662F\uFF0C\u89E6\u53D1 rebuild \u7684\u6761\u4EF6\u5E76\u4E0D\u662F\u4EE3\u7801\u6539\u52A8\uFF0C\u800C\u662F\u65B0\u7684\u8BF7\u6C42\u5230\u6765\u3002</p></blockquote><p>\u4E0B\u9762\uFF0C\u6211\u4EEC\u901A\u8FC7\u4E00\u4E2A\u5177\u4F53\u4F8B\u5B50\u6765\u611F\u53D7\u4E00\u4E0B\u3002</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// build.js</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> build</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> buildSync</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> serve </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esbuild</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">runBuild</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">serve</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      port</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">8000</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u9759\u6001\u8D44\u6E90\u76EE\u5F55</span></span>
<span class="line"><span style="color:#F07178;">      servedir</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./dist</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      absWorkingDir</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cwd</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      entryPoints</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./src/index.jsx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      bundle</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      format</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      splitting</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      sourcemap</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      ignoreAnnotations</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      metafile</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  )</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">HTTP Server starts at port</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">port</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">runBuild</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u6211\u4EEC\u5728\u6D4F\u89C8\u5668\u8BBF\u95EE <code>localhost:8000</code> \u53EF\u4EE5\u770B\u5230 Esbuild \u670D\u52A1\u5668\u8FD4\u56DE\u7684\u7F16\u8BD1\u4EA7\u7269\u5982\u4E0B\u6240\u793A\uFF1A</p><img src="`+v+`"><p>\u540E\u7EED\u6BCF\u6B21\u5728\u6D4F\u89C8\u5668\u8BF7\u6C42\u90FD\u4F1A\u89E6\u53D1 Esbuild \u91CD\u65B0\u6784\u5EFA\uFF0C\u800C\u6BCF\u6B21\u91CD\u65B0\u6784\u5EFA\u90FD\u662F\u4E00\u4E2A\u589E\u91CF\u6784\u5EFA\u7684\u8FC7\u7A0B\uFF0C\u8017\u65F6\u4E5F\u4F1A\u6BD4\u9996\u6B21\u6784\u5EFA\u5C11\u5F88\u591A(\u4E00\u822C\u80FD\u51CF\u5C11 70% \u5DE6\u53F3)\u3002</p><blockquote><p>Serve API \u53EA\u9002\u5408\u5728\u5F00\u53D1\u9636\u6BB5\u4F7F\u7528\uFF0C\u4E0D\u9002\u7528\u4E8E\u751F\u4EA7\u73AF\u5883\u3002</p></blockquote><h5 id="\u5355\u6587\u4EF6\u8F6C\u79FB\uFF1Atransform-api" tabindex="-1">\u5355\u6587\u4EF6\u8F6C\u79FB\uFF1ATransform API <a class="header-anchor" href="#\u5355\u6587\u4EF6\u8F6C\u79FB\uFF1Atransform-api" aria-hidden="true">#</a></h5><p>\u9664\u4E86\u9879\u76EE\u7684\u6253\u5305\u529F\u80FD\u4E4B\u540E\uFF0CEsbuild \u8FD8\u4E13\u95E8\u63D0\u4F9B\u4E86\u5355\u6587\u4EF6\u7F16\u8BD1\u7684\u80FD\u529B\uFF0C\u5373 <code>Transform API</code>\uFF0C\u4E0E <code>Build API</code> \u7C7B\u4F3C\uFF0C\u5B83\u4E5F\u5305\u542B\u4E86\u540C\u6B65\u548C\u5F02\u6B65\u7684\u4E24\u4E2A\u65B9\u6CD5\uFF0C\u5206\u522B\u662F <code>transformSync</code> \u548C <code>transform</code>\u3002\u4E0B\u9762\uFF0C\u6211\u4EEC\u5177\u4F53\u4F7F\u7528\u4E0B\u8FD9\u4E9B\u65B9\u6CD5\u3002</p><p>\u9996\u5148\uFF0C\u5728\u9879\u76EE\u6839\u76EE\u5F55\u65B0\u5EFA <code>transform.js</code>\uFF0C\u5185\u5BB9\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// transform.js</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> transform</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> transformSync </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esbuild</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">runTransform</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u7B2C\u4E00\u4E2A\u53C2\u6570\u662F\u4EE3\u7801\u5B57\u7B26\u4E32\uFF0C\u7B2C\u4E8C\u4E2A\u53C2\u6570\u4E3A\u7F16\u8BD1\u914D\u7F6E</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">transform</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">const isNull = (str: string): boolean =&gt; str.length &gt; 0;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      sourcemap</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      loader</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tsx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">runTransform</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p><code>transformSync</code> \u7684\u7528\u6CD5\u7C7B\u4F3C\uFF0C\u6362\u6210\u540C\u6B65\u7684\u8C03\u7528\u65B9\u5F0F\u5373\u53EF\u3002</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">runTransform</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">transformSync</span><span style="color:#F07178;">(</span><span style="color:#676E95;">/* \u53C2\u6570\u548C transform \u76F8\u540C */</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u4E0D\u8FC7\u7531\u4E8E\u540C\u6B65\u7684 API \u4F1A\u4F7F Esbuild \u4E27\u5931 <code>\u5E76\u53D1\u4EFB\u52A1\u5904\u7406</code> \u7684\u4F18\u52BF\uFF08<code>Build API</code>\u7684\u90E8\u5206\u5DF2\u7ECF\u5206\u6790\u8FC7\uFF09\uFF0C\u6211\u540C\u6837\u4E5F\u4E0D\u63A8\u8350\u5927\u5BB6\u4F7F\u7528<code>transformSync</code>\u3002\u51FA\u4E8E\u6027\u80FD\u8003\u8651\uFF0CVite \u7684\u5E95\u5C42\u5B9E\u73B0\u4E5F\u662F\u91C7\u7528 <code>transform</code>\u8FD9\u4E2A\u5F02\u6B65\u7684 API \u8FDB\u884C TS \u53CA JSX \u7684\u5355\u6587\u4EF6\u8F6C\u8BD1\u7684\u3002</p><h3 id="esbuild-\u63D2\u4EF6\u5F00\u53D1" tabindex="-1">ESBuild \u63D2\u4EF6\u5F00\u53D1 <a class="header-anchor" href="#esbuild-\u63D2\u4EF6\u5F00\u53D1" aria-hidden="true">#</a></h3><p>\u6211\u4EEC\u5728\u4F7F\u7528 Esbuild \u7684\u65F6\u5019\u96BE\u514D\u4F1A\u9047\u5230\u4E00\u4E9B\u9700\u8981\u52A0\u4E0A\u81EA\u5B9A\u4E49\u63D2\u4EF6\u7684\u573A\u666F\uFF0C\u5E76\u4E14 Vite \u4F9D\u8D56\u9884\u7F16\u8BD1\u7684\u5B9E\u73B0\u4E2D\u5927\u91CF\u5E94\u7528\u4E86 Esbuild \u63D2\u4EF6\u7684\u903B\u8F91\u3002\u56E0\u6B64\uFF0C\u63D2\u4EF6\u5F00\u53D1\u662F Esbuild \u4E2D\u975E\u5E38\u91CD\u8981\u7684\u5185\u5BB9\uFF0C</p><p>\u63A5\u4E0B\u6765\uFF0C\u6211\u4EEC\u5C31\u4E00\u8D77\u6765\u5B8C\u6210 Esbuild \u7684\u63D2\u4EF6\u5F00\u53D1\uFF0C\u5E26\u4F60\u638C\u63E1\u82E5\u5E72\u4E2A\u5173\u952E\u7684\u94A9\u5B50\u4F7F\u7528\u3002</p><h4 id="\u57FA\u672C\u6982\u5FF5" tabindex="-1">\u57FA\u672C\u6982\u5FF5 <a class="header-anchor" href="#\u57FA\u672C\u6982\u5FF5" aria-hidden="true">#</a></h4><p>\u63D2\u4EF6\u5F00\u53D1\u5176\u5B9E\u5C31\u662F\u57FA\u4E8E\u539F\u6709\u7684\u4F53\u7CFB\u7ED3\u6784\u4E2D\u8FDB\u884C<code>\u6269\u5C55</code>\u548C<code>\u81EA\u5B9A\u4E49</code>\u3002 Esbuild \u63D2\u4EF6\u4E5F\u4E0D\u4F8B\u5916\uFF0C\u901A\u8FC7 Esbuild \u63D2\u4EF6\u6211\u4EEC\u53EF\u4EE5\u6269\u5C55 Esbuild \u539F\u6709\u7684\u8DEF\u5F84\u89E3\u6790\u3001\u6A21\u5757\u52A0\u8F7D\u7B49\u65B9\u9762\u7684\u80FD\u529B\uFF0C\u5E76\u5728 Esbuild \u7684\u6784\u5EFA\u8FC7\u7A0B\u4E2D\u6267\u884C\u4E00\u7CFB\u5217\u81EA\u5B9A\u4E49\u7684\u903B\u8F91\u3002</p><p><code>Esbuild</code> \u63D2\u4EF6\u7ED3\u6784\u88AB\u8BBE\u8BA1\u4E3A\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u91CC\u9762\u6709 <code>name</code> \u548C <code>setup</code> \u4E24\u4E2A\u5C5E\u6027\uFF0C<code>name</code> \u662F\u63D2\u4EF6\u7684\u540D\u79F0\uFF0C<code>setup</code> \u662F\u4E00\u4E2A\u51FD\u6570\uFF0C\u5176\u4E2D\u5165\u53C2\u662F\u4E00\u4E2A <code>build</code> \u5BF9\u8C61\uFF0C\u8FD9\u4E2A\u5BF9\u8C61\u4E0A\u6302\u8F7D\u4E86\u4E00\u4E9B\u94A9\u5B50\u53EF\u4F9B\u6211\u4EEC\u81EA\u5B9A\u4E49\u4E00\u4E9B\u94A9\u5B50\u51FD\u6570\u903B\u8F91\u3002\u4EE5\u4E0B\u662F\u4E00\u4E2A\u7B80\u5355\u7684<code>Esbuild</code>\u63D2\u4EF6\u793A\u4F8B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> envPlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">env</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">setup</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onResolve</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">^</span><span style="color:#C3E88D;">env</span><span style="color:#89DDFF;">$</span><span style="color:#89DDFF;">/</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      namespace</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">env-ns</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onLoad</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">*/</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> namespace</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">env-ns</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      contents</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">env</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      loader</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">esbuild</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">build</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">entryPoints</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src/index.jsx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">bundle</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">outfile</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">out.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5E94\u7528\u63D2\u4EF6</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [envPlugin]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exit</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">))</span></span>
<span class="line"></span></code></pre></div><p>\u4F7F\u7528\u63D2\u4EF6\u540E\u6548\u679C\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// \u5E94\u7528\u4E86 env \u63D2\u4EF6\u540E\uFF0C\u6784\u5EFA\u65F6\u5C06\u4F1A\u88AB\u66FF\u6362\u6210 p<wbr>rocess.env \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">PATH</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">env</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">PATH is </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">PATH</span><span style="color:#89DDFF;">}\`</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>\u90A3\u4E48\uFF0C<code>build</code>\u5BF9\u8C61\u4E0A\u7684\u5404\u79CD\u94A9\u5B50\u51FD\u6570\u662F\u5982\u4F55\u4F7F\u7528\u7684\u5462\uFF1F</p><h4 id="\u94A9\u5B50\u51FD\u6570\u7684\u4F7F\u7528" tabindex="-1">\u94A9\u5B50\u51FD\u6570\u7684\u4F7F\u7528 <a class="header-anchor" href="#\u94A9\u5B50\u51FD\u6570\u7684\u4F7F\u7528" aria-hidden="true">#</a></h4><h5 id="onresolve\u3001onload-\u94A9\u5B50" tabindex="-1">onResolve\u3001onLoad \u94A9\u5B50 <a class="header-anchor" href="#onresolve\u3001onload-\u94A9\u5B50" aria-hidden="true">#</a></h5><p>\u5728 Esbuild \u63D2\u4EF6\u4E2D\uFF0C<code>onResolve</code> \u548C <code>onload </code>\u662F\u4E24\u4E2A\u975E\u5E38\u91CD\u8981\u7684\u94A9\u5B50\uFF0C\u5206\u522B\u63A7\u5236\u8DEF\u5F84\u89E3\u6790\u548C\u6A21\u5757\u5185\u5BB9\u52A0\u8F7D\u7684\u8FC7\u7A0B\u3002</p><p>\u9996\u5148\uFF0C\u6211\u4EEC\u6765\u8BF4\u8BF4\u4E0A\u9762\u63D2\u4EF6\u793A\u4F8B\u4E2D\u7684\u4E24\u4E2A\u94A9\u5B50\u8BE5\u5982\u4F55\u4F7F\u7528\u3002</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onResolve</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">^</span><span style="color:#C3E88D;">env</span><span style="color:#89DDFF;">$</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">env-ns</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onLoad</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">*/</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">env-ns</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">contents</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#A6ACCD;">(process</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">env)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">loader</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u53EF\u4EE5\u53D1\u73B0\u8FD9\u4E24\u4E2A\u94A9\u5B50\u51FD\u6570\u4E2D\u90FD\u9700\u8981\u4F20\u5165\u4E24\u4E2A\u53C2\u6570: <code>Options</code> \u548C <code>Callback</code>\u3002</p><p>\u5148\u8BF4\u8BF4 <code>Options</code>\u3002\u5B83\u662F\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u5BF9\u4E8E <code>onResolve</code> \u548C <code>onload</code> \u90FD\u4E00\u6837\uFF0C\u5305\u542B <code>filter</code> \u548C <code>namespace</code> \u4E24\u4E2A\u5C5E\u6027\uFF0C\u7C7B\u578B\u5B9A\u4E49\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">interface</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Options</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">RegExp</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>filter</code> \u4E3A\u5FC5\u4F20\u53C2\u6570\uFF0C\u662F\u4E00\u4E2A\u6B63\u5219\u8868\u8FBE\u5F0F\uFF0C\u5B83\u51B3\u5B9A\u4E86\u8981\u8FC7\u6EE4\u51FA\u7684\u7279\u5F81\u6587\u4EF6\u3002</p><blockquote><p>\u6CE8\u610F: \u63D2\u4EF6\u4E2D\u7684 <code>filter</code> \u6B63\u5219\u662F\u4F7F\u7528 Go \u539F\u751F\u6B63\u5219\u5B9E\u73B0\u7684\uFF0C\u4E3A\u4E86\u4E0D\u4F7F\u6027\u80FD\u8FC7\u4E8E\u52A3\u5316\uFF0C\u89C4\u5219\u5E94\u8BE5\u5C3D\u53EF\u80FD\u4E25\u683C\u3002\u540C\u65F6\u5B83\u672C\u8EAB\u548C JS \u7684\u6B63\u5219\u4E5F\u6709\u6240\u533A\u522B\uFF0C\u4E0D\u652F\u6301\u524D\u77BB(?&lt;=)\u3001\u540E\u987E(?=)\u548C\u53CD\u5411\u5F15\u7528(\\1)\u8FD9\u4E09\u79CD\u89C4\u5219\u3002</p></blockquote><p><code>namespace</code> \u4E3A\u9009\u586B\u53C2\u6570\uFF0C\u4E00\u822C\u5728 <code>onResolve</code> \u94A9\u5B50\u4E2D\u7684\u56DE\u8C03\u53C2\u6570\u8FD4\u56DE <code>namespace</code> \u5C5E\u6027\u4F5C\u4E3A\u6807\u8BC6\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5728 <code>onLoad</code> \u94A9\u5B50\u4E2D\u901A\u8FC7 <code>namespace</code> \u5C06\u6A21\u5757\u8FC7\u6EE4\u51FA\u6765\u3002\u5982\u4E0A\u8FF0\u63D2\u4EF6\u793A\u4F8B\u5C31\u5728 <code>onLoad</code> \u94A9\u5B50\u901A\u8FC7 <code>env-ns</code> \u8FD9\u4E2A namespace \u6807\u8BC6\u8FC7\u6EE4\u51FA\u4E86\u8981\u5904\u7406\u7684 <code>env</code> \u6A21\u5757\u3002</p><p>\u9664\u4E86 Options \u53C2\u6570\uFF0C\u8FD8\u6709\u4E00\u4E2A\u56DE\u8C03\u53C2\u6570 <code>Callback</code>\uFF0C\u5B83\u7684\u7C7B\u578B\u6839\u636E\u4E0D\u540C\u7684\u94A9\u5B50\u4F1A\u6709\u6240\u4E0D\u540C\u3002\u76F8\u6BD4\u4E8E Options\uFF0CCallback \u51FD\u6570\u5165\u53C2\u548C\u8FD4\u56DE\u503C\u7684\u7ED3\u6784\u590D\u6742\u5F97\u591A\uFF0C\u6D89\u53CA\u5F88\u591A\u5C5E\u6027\u3002\u4E0D\u8FC7\uFF0C\u6211\u4EEC\u4E5F\u4E0D\u9700\u8981\u770B\u61C2\u6BCF\u4E2A\u5C5E\u6027\u7684\u7EC6\u8282\uFF0C\u5148\u4E86\u89E3\u4E00\u904D\u5373\u53EF\uFF0C\u5E38\u7528\u7684\u4E00\u4E9B\u5C5E\u6027\u4F1A\u5728\u63D2\u4EF6\u5B9E\u6218\u90E8\u5206\u8BB2\u89E3\u6765\u8BB2\u3002</p><p>\u5728 onResolve \u94A9\u5B50\u4E2D\u51FD\u6570\u53C2\u6570\u548C\u8FD4\u56DE\u503C\u68B3\u7406\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onResolve</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">^</span><span style="color:#C3E88D;">env</span><span style="color:#89DDFF;">$</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">onResolveArgs</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">onResolveResult</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u6A21\u5757\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u7236\u6A21\u5757\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">importer</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// namespace \u6807\u8BC6</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">namespace</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u57FA\u51C6\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">resolveDir</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5BFC\u5165\u65B9\u5F0F\uFF0C\u5982 import\u3001require</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">kind</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u989D\u5916\u7ED1\u5B9A\u7684\u63D2\u4EF6\u6570\u636E</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">pluginData</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u9519\u8BEF\u4FE1\u606F</span></span>
<span class="line"><span style="color:#F07178;">      errors</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u662F\u5426\u9700\u8981 external</span></span>
<span class="line"><span style="color:#F07178;">      external</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// namespace \u6807\u8BC6</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">namespace</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">env-ns</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u6A21\u5757\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">path</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u989D\u5916\u7ED1\u5B9A\u7684\u63D2\u4EF6\u6570\u636E</span></span>
<span class="line"><span style="color:#F07178;">      pluginData</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u63D2\u4EF6\u540D\u79F0</span></span>
<span class="line"><span style="color:#F07178;">      pluginName</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">xxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u8BBE\u7F6E\u4E3A false\uFF0C\u5982\u679C\u6A21\u5757\u6CA1\u6709\u88AB\u7528\u5230\uFF0C\u6A21\u5757\u4EE3\u7801\u5C06\u4F1A\u5728\u4EA7\u7269\u4E2D\u4F1A\u5220\u9664\u3002\u5426\u5219\u4E0D\u4F1A\u8FD9\u4E48\u505A</span></span>
<span class="line"><span style="color:#F07178;">      sideEffects</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u6DFB\u52A0\u4E00\u4E9B\u8DEF\u5F84\u540E\u7F00\uFF0C\u5982\`?xxx\`</span></span>
<span class="line"><span style="color:#F07178;">      suffix</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">?xxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u8B66\u544A\u4FE1\u606F</span></span>
<span class="line"><span style="color:#F07178;">      warnings</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u4EC5\u4EC5\u5728 Esbuild \u5F00\u542F watch \u6A21\u5F0F\u4E0B\u751F\u6548</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u544A\u8BC9 Esbuild \u9700\u8981\u989D\u5916\u76D1\u542C\u54EA\u4E9B\u6587\u4EF6/\u76EE\u5F55\u7684\u53D8\u5316</span></span>
<span class="line"><span style="color:#F07178;">      watchDirs</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      watchFiles</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5728 onLoad \u94A9\u5B50\u4E2D\u51FD\u6570\u53C2\u6570\u548C\u8FD4\u56DE\u503C\u68B3\u7406\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onLoad</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">*/</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">env-ns</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">OnLoadArgs</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">OnLoadResult</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u6A21\u5757\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// namespace \u6807\u8BC6</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">namespace</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u540E\u7F00\u4FE1\u606F</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">suffix</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u989D\u5916\u7684\u63D2\u4EF6\u6570\u636E</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">pluginData</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u6A21\u5757\u5177\u4F53\u5185\u5BB9</span></span>
<span class="line"><span style="color:#F07178;">      contents</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">\u7701\u7565\u5185\u5BB9</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u9519\u8BEF\u4FE1\u606F</span></span>
<span class="line"><span style="color:#F07178;">      errors</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u6307\u5B9A loader\uFF0C\u5982\`js\`\u3001\`ts\`\u3001\`jsx\`\u3001\`tsx\`\u3001\`json\`\u7B49\u7B49</span></span>
<span class="line"><span style="color:#F07178;">      loader</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u989D\u5916\u7684\u63D2\u4EF6\u6570\u636E</span></span>
<span class="line"><span style="color:#F07178;">      pluginData</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u63D2\u4EF6\u540D\u79F0</span></span>
<span class="line"><span style="color:#F07178;">      pluginName</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">xxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u57FA\u51C6\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#F07178;">      resolveDir</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./dir</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u8B66\u544A\u4FE1\u606F</span></span>
<span class="line"><span style="color:#F07178;">      warnings</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u540C\u4E0A</span></span>
<span class="line"><span style="color:#F07178;">      watchDirs</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      watchFiles</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h5 id="\u5176\u4ED6\u94A9\u5B50" tabindex="-1">\u5176\u4ED6\u94A9\u5B50 <a class="header-anchor" href="#\u5176\u4ED6\u94A9\u5B50" aria-hidden="true">#</a></h5><p>\u5728 build \u5BF9\u8C61\u4E2D\uFF0C\u9664\u4E86<code>onResolve</code>\u548C<code>onLoad</code>\uFF0C\u8FD8\u6709 <code>onStart</code> \u548C <code>onEnd</code> \u4E24\u4E2A\u94A9\u5B50\u7528\u6765\u5728\u6784\u5EFA\u5F00\u542F\u548C\u7ED3\u675F\u65F6\u6267\u884C\u4E00\u4E9B\u81EA\u5B9A\u4E49\u7684\u903B\u8F91\uFF0C\u4F7F\u7528\u4E0A\u6BD4\u8F83\u7B80\u5355\uFF0C\u5982\u4E0B\u9762\u7684\u4F8B\u5B50\u6240\u793A:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> examplePlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">example</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">setup</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onStart</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">build started</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onEnd</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">buildResult</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">buildResult</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">errors</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u6784\u5EFA\u5143\u4FE1\u606F</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u83B7\u53D6\u5143\u4FE1\u606F\u540E\u505A\u4E00\u4E9B\u81EA\u5B9A\u4E49\u7684\u4E8B\u60C5\uFF0C\u6BD4\u5982\u751F\u6210 HTML</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">buildResult</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">metafile</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5728\u4F7F\u7528\u8FD9\u4E9B\u94A9\u5B50\u7684\u65F6\u5019\uFF0C\u6709 2 \u70B9\u9700\u8981\u6CE8\u610F\u3002</p><ol><li>onStart \u7684\u6267\u884C\u65F6\u673A\u662F\u5728\u6BCF\u6B21 build \u7684\u65F6\u5019\uFF0C\u5305\u62EC\u89E6\u53D1 <code>watch</code> \u6216\u8005 <code>serve</code> \u6A21\u5F0F\u4E0B\u7684\u91CD\u65B0\u6784\u5EFA\u3002</li><li>onEnd \u94A9\u5B50\u4E2D\u5982\u679C\u8981\u62FF\u5230 <code>metafile</code>\uFF0C\u5FC5\u987B\u5C06 Esbuild \u7684\u6784\u5EFA\u914D\u7F6E\u4E2D <code>metafile</code> \u5C5E\u6027\u8BBE\u4E3A <code>true</code>\u3002</li></ol><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u8FDB\u5165\u63D2\u4EF6\u5B9E\u6218\uFF0C\u901A\u8FC7\u7F16\u5199\u4E00\u4E9B\u7279\u5B9A\u529F\u80FD\u7684\u63D2\u4EF6\u6765\u719F\u6089 Esbuild \u63D2\u4EF6\u7684\u5F00\u53D1\u6D41\u7A0B\u548C\u6280\u5DE7\u3002</p><h4 id="cdn-\u4F9D\u8D56\u62C9\u53D6\u63D2\u4EF6" tabindex="-1">CDN \u4F9D\u8D56\u62C9\u53D6\u63D2\u4EF6 <a class="header-anchor" href="#cdn-\u4F9D\u8D56\u62C9\u53D6\u63D2\u4EF6" aria-hidden="true">#</a></h4><p>Esbuild \u539F\u751F\u4E0D\u652F\u6301\u901A\u8FC7 HTTP \u4ECE CDN \u670D\u52A1\u4E0A\u62C9\u53D6\u5BF9\u5E94\u7684\u7B2C\u4E09\u65B9\u4F9D\u8D56\u8D44\u6E90\uFF0C\u5982\u4E0B\u4EE3\u7801\u6240\u793A:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// src/index.jsx</span></span>
<span class="line"><span style="color:#676E95;">// react-dom \u7684\u5185\u5BB9\u5168\u90E8\u4ECE CDN \u62C9\u53D6</span></span>
<span class="line"><span style="color:#676E95;">// \u8FD9\u6BB5\u4EE3\u7801\u76EE\u524D\u662F\u65E0\u6CD5\u8FD0\u884C\u7684</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">render</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://cdn.skypack.dev/react-dom</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> Greet </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">Hello, ESBuild!</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Greet</span><span style="color:#89DDFF;"> /&gt;,</span><span style="color:#A6ACCD;"> document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u793A\u4F8B\u4EE3\u7801\u4E2D\u6211\u4EEC\u7528\u5230\u4E86 <code>Skypack</code> \u8FD9\u4E2A\u63D0\u4F9B npm \u7B2C\u4E09\u65B9\u5305 ESM \u4EA7\u7269\u7684 <code>CDN \u670D\u52A1</code>\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7 url \u8BBF\u95EE\u7B2C\u4E09\u65B9\u5305\u7684\u8D44\u6E90\uFF0C\u5982\u4E0B\u56FE\u6240\u793A:</p><img src="`+f+`" style="zoom:70%;"><p>\u73B0\u5728\u6211\u4EEC\u9700\u8981\u901A\u8FC7 Esbuild \u63D2\u4EF6\u6765\u8BC6\u522B\u8FD9\u6837\u7684 url \u8DEF\u5F84\uFF0C\u7136\u540E\u4ECE\u7F51\u7EDC\u83B7\u53D6\u6A21\u5757\u5185\u5BB9\u5E76\u8BA9 Esbuild \u8FDB\u884C\u52A0\u8F7D\uFF0C\u751A\u81F3\u4E0D\u518D\u9700\u8981<code>npm install</code>\u5B89\u88C5\u4F9D\u8D56\u4E86\u3002</p><blockquote><p>ESM CDN \u4F5C\u4E3A\u9762\u5411\u672A\u6765\u7684\u524D\u7AEF\u57FA\u7840\u8BBE\u65BD\uFF0C\u5BF9 Vite \u7684\u5F71\u54CD\u4E5F\u81F3\u5173\u91CD\u5927\uFF0C\u53EF\u4EE5\u6781\u5927\u63D0\u5347 Vite \u5728\u751F\u4EA7\u73AF\u5883\u4E0B\u7684\u6784\u5EFA\u6027\u80FD\u3002</p></blockquote><p>\u6211\u4EEC\u5148\u4ECE\u6700\u7B80\u5355\u7684\u7248\u672C\u5F00\u59CB\u5199\u8D77:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// http-import-plugin.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esbuild:http</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">setup</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">https</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">require</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">http</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">require</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// 1. \u62E6\u622A CDN \u8BF7\u6C42</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onResolve</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">^</span><span style="color:#C3E88D;">https</span><span style="color:#89DDFF;">?</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;">\\/\\/</span><span style="color:#89DDFF;">/</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      namespace</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http-url</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// 2. \u901A\u8FC7 fetch \u8BF7\u6C42\u52A0\u8F7D CDN \u8D44\u6E90</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onLoad</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">*/</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> namespace</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http-url</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">contents</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Downloading: </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lib</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">startsWith</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">https</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">http</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lib</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> ([</span><span style="color:#F78C6C;">301</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">302</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">307</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">includes</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">statusCode</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;">// \u91CD\u5B9A\u5411</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#82AAFF;">fetch</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">URL</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">headers</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">location</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">abort</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">statusCode</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;">// \u54CD\u5E94\u6210\u529F</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">chunks</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">data</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">chunk</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">chunks</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">chunk</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">end</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">Buffer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">concat</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">chunks</span><span style="color:#F07178;">)))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">                  </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Error</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">GET </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> failed: status </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">statusCode</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">                )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">fetch</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">contents</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\u6211\u4EEC\u65B0\u5EFA <code>build.js</code> \u6587\u4EF6\uFF0C\u5185\u5BB9\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> build </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esbuild</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> httpImport </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./http-import-plugin</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">runBuild</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">build</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    absWorkingDir</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cwd</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    entryPoints</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./src/index.jsx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    outdir</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    bundle</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    format</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    splitting</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    sourcemap</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    metafile</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#82AAFF;">httpImport</span><span style="color:#F07178;">()]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\u{1F680} Build Finished!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">runBuild</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u901A\u8FC7 <code>node build.js</code> \u6267\u884C\u6253\u5305\u811A\u672C\uFF0C\u53D1\u73B0\u63D2\u4EF6\u4E0D\u80FD work\uFF0C\u629B\u51FA\u4E86\u8FD9\u6837\u4E00\u4E2A\u9519\u8BEF:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#FFCB6B;">errors</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">detail</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">length</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">91</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">line</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">lineText</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">export * from &#39;/-/react-dom@v17.0.1-oZ1BXZ5opQ1DbTh7nu9r/dist=es2019,mode=imports/optimized/react-dom.js&#39;;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">suggestion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">      notes: [</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">location</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null,</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">text</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">The plugin &quot;esbuild:http&quot; didn&#39;t set a resolve directory for the file &quot;http-url:https://cdn.skypack.dev/react-dom&quot;, so esbuild did not search for &quot;/-/react-dom@v17.0.1-oZ1BXZ5opQ1DbTh7nu9r/dist=es2019,mode=imports/optimized/react-dom.js&quot; on the file system.</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">      ]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">      pluginName: </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      text: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Could not resolve &quot;/-/react-dom@v17.0.1-oZ1BXZ5opQ1DbTh7nu9r/dist=es2019,mode=imports/optimized/react-dom.js&quot;</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u662F\u4E3A\u4EC0\u4E48\u5462\uFF1F\u4F60\u53EF\u4EE5\u56DE\u8FC7\u5934\u89C2\u5BDF\u4E00\u4E0B\u7B2C\u4E09\u65B9\u5305\u7684\u54CD\u5E94\u5185\u5BB9:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/-/react-dom@v17.0.1-oZ1BXZ5opQ1DbTh7nu9r/dist=es2019,mode=raw/optimized/react-dom.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">default</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/-/react-dom@v17.0.1-oZ1BXZ5opQ1DbTh7nu9r/dist=es2019,mode=raw/optimized/react-dom.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u9664\u4E86\u8981\u89E3\u6790 react-dom \u8FD9\u79CD\u76F4\u63A5\u4F9D\u8D56\u7684\u8DEF\u5F84\uFF0C\u8FD8\u8981\u89E3\u6790\u5B83\u4F9D\u8D56\u7684\u8DEF\u5F84\uFF0C\u4E5F\u5C31\u662F\u95F4\u63A5\u4F9D\u8D56\u7684\u8DEF\u5F84\u3002</p><p>\u90A3\u5982\u4F55\u6765\u5B9E\u73B0\u8FD9\u4E2A\u6548\u679C\u5462\uFF1F\u6211\u4EEC\u53EF\u4EE5\u52A0\u5165\u8FD9\u6837\u4E00\u6BB5 <code>onResolve</code> \u94A9\u5B50\u903B\u8F91:</p><img src="`+j+'"><p>\u73B0\u5728\u6211\u4EEC\u518D\u6B21\u6267\u884C<code>node build.js</code>\uFF0C\u53D1\u73B0\u4F9D\u8D56\u5DF2\u7ECF\u6210\u529F\u4E0B\u8F7D\u5E76\u6253\u5305\u4E86\u3002</p><img src="'+q+`"><h4 id="html-\u6784\u5EFA\u63D2\u4EF6" tabindex="-1">HTML \u6784\u5EFA\u63D2\u4EF6 <a class="header-anchor" href="#html-\u6784\u5EFA\u63D2\u4EF6" aria-hidden="true">#</a></h4><p>Esbuild \u4F5C\u4E3A\u4E00\u4E2A\u524D\u7AEF\u6253\u5305\u5DE5\u5177\uFF0C\u672C\u8EAB\u5E76\u4E0D\u5177\u5907 HTML \u7684\u6784\u5EFA\u80FD\u529B\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C\u5F53\u5B83\u628A js/css \u4EA7\u7269\u6253\u5305\u51FA\u6765\u7684\u65F6\u5019\uFF0C\u5E76\u4E0D\u610F\u5473\u7740\u524D\u7AEF\u7684\u9879\u76EE\u53EF\u4EE5\u76F4\u63A5\u8FD0\u884C\u4E86\uFF0C\u6211\u4EEC\u8FD8\u9700\u8981\u4E00\u4EFD\u5BF9\u5E94\u7684\u5165\u53E3 HTML \u6587\u4EF6\u3002\u800C\u8FD9\u4EFD HTML \u6587\u4EF6\u5F53\u7136\u53EF\u4EE5\u624B\u5199\u4E00\u4E2A\uFF0C\u4F46\u624B\u5199\u663E\u5F97\u6BD4\u8F83\u9EBB\u70E6\uFF0C\u5C24\u5176\u662F\u4EA7\u7269\u540D\u79F0\u5E26\u54C8\u5E0C\u503C\u7684\u65F6\u5019\uFF0C\u6BCF\u6B21\u6253\u5305\u5B8C\u90FD\u8981\u66FF\u6362\u8DEF\u5F84\u3002\u90A3\u4E48\uFF0C\u6211\u4EEC\u80FD\u4E0D\u80FD\u901A\u8FC7 Esbuild \u63D2\u4EF6\u7684\u65B9\u5F0F\u6765\u81EA\u52A8\u5316\u5730\u751F\u6210 HTML \u5462\uFF1F</p><p>\u5728 Esbuild \u63D2\u4EF6\u7684 <code>onEnd</code> \u94A9\u5B50\u4E2D\u53EF\u4EE5\u62FF\u5230 <code>metafile</code> \u5BF9\u8C61\u7684\u4FE1\u606F\u3002\u90A3\u4E48\uFF0C\u8FD9\u4E2A\u5BF9\u8C61\u7A76\u7ADF\u4EC0\u4E48\u6837\u5462\uFF1F</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">inputs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">/* \u7701\u7565\u5185\u5BB9 */</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">output</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">dist/index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      imports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      exports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      entryPoint</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src/index.jsx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      inputs</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">http-url:https://cdn.skypack.dev/-/object-assign@v4.1.1-LbCnB3r2y2yFmhmiCfPn/dist=es2019,mode=imports/optimized/object-assign.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> bytesInOutput</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1792</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">http-url:https://cdn.skypack.dev/-/react@v17.0.1-yH0aYV1FOvoIPeKBbHxg/dist=es2019,mode=imports/optimized/react.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> bytesInOutput</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">10396</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">http-url:https://cdn.skypack.dev/-/scheduler@v0.20.2-PAU9F1YosUNPKr7V4s0j/dist=es2019,mode=imports/optimized/scheduler.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> bytesInOutput</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">9084</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">http-url:https://cdn.skypack.dev/-/react-dom@v17.0.1-oZ1BXZ5opQ1DbTh7nu9r/dist=es2019,mode=imports/optimized/react-dom.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> bytesInOutput</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">183229</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">http-url:https://cdn.skypack.dev/react-dom</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> bytesInOutput</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">src/index.jsx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> bytesInOutput</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">178</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">      bytes</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">205284</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">dist/index.js.map</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">/* \u7701\u7565\u5185\u5BB9 */</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u4ECE<code>outputs</code>\u5C5E\u6027\u4E2D\u6211\u4EEC\u53EF\u4EE5\u770B\u5230\u4EA7\u7269\u7684\u8DEF\u5F84\uFF0C\u8FD9\u610F\u5473\u7740\u6211\u4EEC\u53EF\u4EE5\u5728\u63D2\u4EF6\u4E2D\u62FF\u5230\u6240\u6709 js \u548C css \u4EA7\u7269\uFF0C\u7136\u540E\u81EA\u5DF1\u7EC4\u88C5\u3001\u751F\u6210\u4E00\u4E2A HTML\uFF0C\u5B9E\u73B0\u81EA\u52A8\u5316\u751F\u6210 HTML \u7684\u6548\u679C\u3002</p><p>\u6211\u4EEC\u63A5\u7740\u6765\u5B9E\u73B0\u4E00\u4E0B\u8FD9\u4E2A\u63D2\u4EF6\u7684\u903B\u8F91\uFF0C\u9996\u5148\u65B0\u5EFA <code>html-plugin.js</code>\uFF0C\u5185\u5BB9\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> fs </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">fs/promises</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> path </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">path</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> createScript</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> createLink</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> generateHTML </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./util</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esbuild:html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    setup</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onEnd</span><span style="color:#F07178;">(</span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">buildResult</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">buildResult</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">errors</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">metafile</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buildResult</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// 1. \u62FF\u5230 metafile \u540E\u83B7\u53D6\u6240\u6709\u7684 js \u548C css \u4EA7\u7269\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">scripts</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">links</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">metafile</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">outputs</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">metafile</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">assets</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">keys</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">outputs</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">assets</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">asset</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">asset</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">endsWith</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#A6ACCD;">scripts</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">createScript</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">asset</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">asset</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">endsWith</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.css</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#A6ACCD;">links</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">createLink</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">asset</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// 2. \u62FC\u63A5 HTML \u5185\u5BB9</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">templateContent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">generateHTML</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">scripts</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">links</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// 3. HTML \u5199\u5165\u78C1\u76D8</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">templatePath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cwd</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">index.html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">writeFile</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">templatePath</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">templateContent</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#676E95;">// util.js</span></span>
<span class="line"><span style="color:#676E95;">// \u4E00\u4E9B\u5DE5\u5177\u51FD\u6570\u7684\u5B9E\u73B0</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createScript</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">&lt;script type=&quot;module&quot; src=&quot;</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&quot;&gt;&lt;/script&gt;</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createLink</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">&lt;link rel=&quot;stylesheet&quot; href=&quot;</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&quot;&gt;&lt;/link&gt;</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">generateHTML</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">scripts</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">links</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">  &lt;!DOCTYPE html&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">  &lt;html lang=&quot;en&quot;&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">  &lt;head&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">    &lt;meta charset=&quot;UTF-8&quot; /&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">    &lt;title&gt;Esbuild App&lt;/title&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">    </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">links</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C3E88D;">  &lt;/head&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">  &lt;body&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">    &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">    </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">scripts</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C3E88D;">  &lt;/body&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">  &lt;/html&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createLink</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createScript</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">generateHTML</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>\u73B0\u5728\u6211\u4EEC\u5728 <code>build.js</code> \u4E2D\u5F15\u5165 html \u63D2\u4EF6:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> build </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esbuild</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> httpImport </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./http-import-plugin</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> html </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./html-plugin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">runBuild</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">build</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    absWorkingDir</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cwd</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    entryPoints</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./src/index.jsx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    outdir</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    bundle</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    format</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    splitting</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    sourcemap</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    metafile</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#82AAFF;">httpImport</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">html</span><span style="color:#F07178;">()]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\u{1F680} Build Finished!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">runBuild</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\u6267\u884C<code>node build.js</code>\u5BF9\u9879\u76EE\u8FDB\u884C\u6253\u5305\uFF0C\u4F60\u5C31\u53EF\u4EE5\u770B\u5230 <code>index.html</code> \u5DF2\u7ECF\u6210\u529F\u8F93\u51FA\u5230\u6839\u76EE\u5F55\u3002</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// index.jsx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> React </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://cdn.skypack.dev/react</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">render</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://cdn.skypack.dev/react-dom</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> Greet </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">Hello, ESBuild!</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Greet</span><span style="color:#89DDFF;"> /&gt;,</span><span style="color:#A6ACCD;"> document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u7740\uFF0C\u6211\u4EEC\u901A\u8FC7 <code>serve</code> \u8D77\u4E00\u4E2A\u672C\u5730\u9759\u6001\u6587\u4EF6\u670D\u52A1\u5668:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// 1. \u5168\u5C40\u5B89\u88C5 serve</span></span>
<span class="line"><span style="color:#A6ACCD;">pnpm i </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">g serve</span></span>
<span class="line"><span style="color:#676E95;">// 2. \u5728\u9879\u76EE\u6839\u76EE\u5F55\u6267\u884C</span></span>
<span class="line"><span style="color:#A6ACCD;">serve </span><span style="color:#89DDFF;">.</span></span>
<span class="line"></span></code></pre></div><p>\u53EF\u4EE5\u770B\u5230\u5982\u4E0B\u7684\u754C\u9762:</p><img src="`+B+'" style="zoom:80%;"><p>\u518D\u8BBF\u95EE <code>localhost:3000</code>\uFF0C\u4F1A\u9ED8\u8BA4\u8BBF\u95EE\u5230 index.html \u7684\u5185\u5BB9\uFF1A</p><img src="'+S+`"><p>\u8FD9\u6837\u4E00\u6765\uFF0C\u5E94\u7528\u7684\u5185\u5BB9\u5C31\u6210\u529F\u663E\u793A\u4E86\uFF0C\u4E5F\u8BF4\u660E HTML \u63D2\u4EF6\u6B63\u5E38\u751F\u6548\u4E86\u3002\u5F53\u7136\uFF0C\u5982\u679C\u8981\u505A\u4E00\u4E2A\u8DB3\u591F\u901A\u7528\u7684 HTML \u63D2\u4EF6\uFF0C\u8FD8\u9700\u8981\u8003\u8651\u8BF8\u591A\u7684\u56E0\u7D20\uFF0C\u6BD4\u5982<code>\u81EA\u5B9A\u4E49 HTML \u5185\u5BB9</code>\u3001<code>\u81EA\u5B9A\u4E49\u516C\u5171\u524D\u7F00(publicPath)</code>\u3001<code>\u81EA\u5B9A\u4E49 script \u6807\u7B7E\u7C7B\u578B</code>\u4EE5\u53CA <code>\u591A\u5165\u53E3\u6253\u5305</code>\u7B49\u7B49\uFF0C\u5927\u5BB6\u611F\u5174\u8DA3\u7684\u8BDD\u53EF\u4EE5\u81EA\u884C\u6269\u5C55\uFF0C\u53EF\u4EE5\u53C2\u8003\u8FD9\u4E2A <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsanyuan0704%2Fewas%2Fblob%2Fmain%2Fpackages%2Fesbuild-plugin-html%2Fsrc%2Findex.ts" target="_blank" rel="noreferrer">\u5F00\u6E90\u63D2\u4EF6</a>\u3002</p><h3 id="\u603B\u7ED3-6" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3-6" aria-hidden="true">#</a></h3><p>\u6211\u4EEC\u8981\u91CD\u70B9\u638C\u63E1 Esbuild \u7684\u57FA\u7840\u4F7F\u7528\u548C\u63D2\u4EF6\u5F00\u53D1\u3002</p><p>\u9996\u5148\u4F60\u53EF\u4EE5\u901A\u8FC7<code>\u547D\u4EE4\u884C\u65B9\u5F0F</code>\u548C<code>\u4EE3\u7801\u8C03\u7528\u65B9\u5F0F</code>\u4E24\u79CD\u65B9\u5F0F\u6765\u4F7F\u7528 Esbuild\u3002\u5BF9\u540E\u8005\u800C\u8A00\uFF0C\u6211\u4EEC\u9700\u8981\u4F7F\u7528\u5230 Esbuild \u4E2D\u4E24\u4E2A\u91CD\u8981\u7684 API\uFF0C\u5206\u522B\u662F<code>Build API</code>\u548C<code>Transform API</code>\uFF0C\u4E3A\u4E86\u907F\u514D\u540C\u6B65\u65B9\u6CD5\u6240\u5BFC\u81F4\u7684\u6027\u80FD\u95EE\u9898\uFF0C\u63A8\u8350\u4F7F\u7528\u5F02\u6B65\u65B9\u5F0F\u8FDB\u884C\u8C03\u7528\u3002</p><p>\u5176\u6B21\uFF0C\u6211\u4EEC\u7528\u4E00\u4E2A\u7B80\u5355\u7684<code>env</code>\u63D2\u4EF6\u793A\u4F8B\u5E26\u4F60\u5B66\u4E60\u4E86 Esbuild \u63D2\u4EF6\u7684\u4EE3\u7801\u7ED3\u6784\u548C\u57FA\u672C\u6982\u5FF5\uFF0C\u5E76\u8FDB\u884C\u4E86\u63D2\u4EF6\u5F00\u53D1\u5B9E\u6218\uFF0C\u5F00\u53D1\u4E86\u4E24\u4E2A\u590D\u6742\u5EA6\u6BD4\u8F83\u9AD8\u7684\u63D2\u4EF6\uFF0C\u5206\u522B\u662F <code>CDN \u4F9D\u8D56\u62C9\u53D6\u63D2\u4EF6</code>\u548C<code>HTML \u6784\u5EFA\u63D2\u4EF6</code>\u3002\u5E0C\u671B\u4F60\u80FD\u901A\u8FC7\u8FD9\u4E9B\u7ECF\u5178\u7684\u4F8B\u5B50\u597D\u597D\u4F53\u4F1A\u63D2\u4EF6\u7684\u7F16\u5199\u65B9\u5F0F\uFF0C\u5E76\u591A\u591A\u5B9E\u8DF5\uFF0C\u63D0\u5347\u81EA\u5DF1\u5BF9 Esbuild \u7684\u7406\u89E3\u3002</p><h2 id="rollup-\u57FA\u672C\u6982\u5FF5\u53CA\u4F7F\u7528" tabindex="-1">Rollup \u57FA\u672C\u6982\u5FF5\u53CA\u4F7F\u7528 <a class="header-anchor" href="#rollup-\u57FA\u672C\u6982\u5FF5\u53CA\u4F7F\u7528" aria-hidden="true">#</a></h2><p>Rollup \u662F\u4E00\u6B3E\u57FA\u4E8E ES Module \u6A21\u5757\u89C4\u8303\u5B9E\u73B0\u7684 JavaScript \u6253\u5305\u5DE5\u5177\uFF0C\u5728\u524D\u7AEF\u793E\u533A\u4E2D\u8D6B\u8D6B\u6709\u540D\uFF0C\u540C\u65F6\u4E5F\u5728 Vite \u7684\u67B6\u6784\u4F53\u7CFB\u4E2D\u53D1\u6325\u7740\u91CD\u8981\u4F5C\u7528\u3002\u4E0D\u4EC5\u662F Vite \u751F\u4EA7\u73AF\u5883\u4E0B\u7684\u6253\u5305\u5DE5\u5177\uFF0C\u5176\u63D2\u4EF6\u673A\u5236\u4E5F\u88AB Vite \u6240\u517C\u5BB9\uFF0C\u53EF\u4EE5\u8BF4\u662F Vite \u7684\u6784\u5EFA\u57FA\u77F3\u3002\u56E0\u6B64\uFF0C\u638C\u63E1 Rollup \u4E5F\u662F\u6DF1\u5165\u5B66\u4E60 Vite \u7684\u5FC5\u7ECF\u4E4B\u8DEF\u3002</p><p>\u672C\u7BC7\u6587\u7AE0\u4E3B\u8981\u56F4\u7ED5 Rollup \u7684\u57FA\u672C\u6982\u5FF5\u548C\u6838\u5FC3\u7279\u6027\u5C55\u5F00\uFF0C\u4F60\u4E0D\u4EC5\u80FD\u77E5\u9053 Rollup \u662F\u5982\u4F55\u6253\u5305\u9879\u76EE\u7684\uFF0C\u8FD8\u80FD\u5B66\u4F1A Rollup \u66F4\u9AD8\u9636\u7684\u4F7F\u7528\u65B9\u5F0F\uFF0C\u751A\u81F3\u80FD\u591F\u901A\u8FC7 JavaScript API \u4E8C\u6B21\u5F00\u53D1 Rollup\u3002</p><h3 id="\u5FEB\u901F\u4E0A\u624B" tabindex="-1">\u5FEB\u901F\u4E0A\u624B <a class="header-anchor" href="#\u5FEB\u901F\u4E0A\u624B" aria-hidden="true">#</a></h3><p>\u9996\u5148\u8BA9\u6211\u4EEC\u7528 <code>pnpm init -y</code> \u65B0\u5EFA\u4E00\u4E2A\u9879\u76EE\uFF0C\u7136\u540E\u5B89\u88C5 <code>rollup</code> \u4F9D\u8D56:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i rollup</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u7740\u65B0\u589E <code>src/index.js</code> \u548C <code>src/util.js</code> \u548C <code>rollup.config.js</code> \u4E09\u4E2A\u6587\u4EF6\uFF0C\u76EE\u5F55\u7ED3\u6784\u5982\u4E0B\u6240\u793A:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">.</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 package</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">json</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 pnpm</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">lock</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">yaml</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 rollup</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2514\u2500\u2500 src</span></span>
<span class="line"><span style="color:#A6ACCD;">    \u251C\u2500\u2500 index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js</span></span>
<span class="line"><span style="color:#A6ACCD;">    \u2514\u2500\u2500 util</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js</span></span>
<span class="line"></span></code></pre></div><p>\u6587\u4EF6\u7684\u5185\u5BB9\u5206\u522B\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// src/index.js</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">add</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./util</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">add</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// src/util.js</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> add </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> b</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> multi </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> b</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">// rollup.config.js</span></span>
<span class="line"><span style="color:#676E95;">// \u4EE5\u4E0B\u6CE8\u91CA\u662F\u4E3A\u4E86\u80FD\u4F7F\u7528 VSCode \u7684\u7C7B\u578B\u63D0\u793A</span></span>
<span class="line"><span style="color:#676E95;">/**</span></span>
<span class="line"><span style="color:#676E95;"> * </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">type</span><span style="color:#676E95;"> </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;"> import(&#39;rollup&#39;).RollupOptions </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;"> */</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> buildOptions </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">input</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src/index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">output</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u4EA7\u7269\u8F93\u51FA\u76EE\u5F55</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">dir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist/es</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u4EA7\u7269\u683C\u5F0F</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">format</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> buildOptions</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u4F60\u53EF\u4EE5\u5728 <code>package.json</code> \u4E2D\u52A0\u5165\u5982\u4E0B\u7684\u6784\u5EFA\u811A\u672C:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// rollup \u6253\u5305\u547D\u4EE4\uFF0C\`-c\` \u8868\u793A\u4F7F\u7528\u914D\u7F6E\u6587\u4EF6\u4E2D\u7684\u914D\u7F6E</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">build</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">rollup -c</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u7740\u5728\u7EC8\u7AEF\u6267\u884C\u4E00\u4E0B <code>pnpm run build</code>\uFF0C\u53EF\u4EE5\u770B\u5230\u5982\u4E0B\u7684\u547D\u4EE4\u884C\u4FE1\u606F:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">PS </span><span style="color:#FFCB6B;">D</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">\\workspace\\notes\\vite\\rollup</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">demo</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> pnpm run build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> rollup</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">demo@</span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> build </span><span style="color:#FFCB6B;">D</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">\\workspace\\notes\\vite\\rollup</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">demo</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> rollup </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">c</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js \u2192 dist</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">es</span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">created dist</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">es </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> 15ms</span></span>
<span class="line"></span></code></pre></div><p>\u73B0\u5728\u4F60\u5DF2\u7ECF\u6210\u529F\u4F7F\u7528 Rollup \u6253\u51FA\u4E86\u7B2C\u4E00\u4EFD\u4EA7\u7269! \u6211\u4EEC\u53EF\u4EE5\u53BB <code>dist/es</code> \u76EE\u5F55\u67E5\u770B\u4E00\u4E0B\u4EA7\u7269\u7684\u5185\u5BB9:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> add </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> b</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">add</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u540C\u65F6\u4F60\u4E5F\u53EF\u4EE5\u53D1\u73B0\uFF0C<code>util.js</code> \u4E2D\u7684 <code>multi</code> \u65B9\u6CD5\u5E76\u6CA1\u6709\u88AB\u6253\u5305\u5230\u4EA7\u7269\u4E2D\uFF0C\u8FD9\u662F\u56E0\u4E3A Rollup \u5177\u6709\u5929\u7136\u7684 <code>Tree Shaking</code> \u529F\u80FD\uFF0C\u53EF\u4EE5\u5206\u6790\u51FA\u672A\u4F7F\u7528\u5230\u7684\u6A21\u5757\u5E76\u81EA\u52A8\u64E6\u9664\u3002</p><p>\u6240\u8C13 <code>Tree Shaking</code>(\u6447\u6811)\uFF0C\u4E5F\u662F\u8BA1\u7B97\u673A\u7F16\u8BD1\u539F\u7406\u4E2D<code>DCE</code> (Dead Code Elimination\uFF0C\u5373\u6D88\u9664\u65E0\u7528\u4EE3\u7801) \u6280\u672F\u7684\u4E00\u79CD\u5B9E\u73B0\u3002\u7531\u4E8E ES \u6A21\u5757\u4F9D\u8D56\u5173\u7CFB\u662F\u786E\u5B9A\u7684\uFF0C\u548C\u8FD0\u884C\u65F6\u72B6\u6001\u65E0\u5173\u3002\u56E0\u6B64 Rollup \u53EF\u4EE5\u5728\u7F16\u8BD1\u9636\u6BB5\u5206\u6790\u51FA\u4F9D\u8D56\u5173\u7CFB\uFF0C\u5BF9 AST \u8BED\u6CD5\u6811\u4E2D\u6CA1\u6709\u4F7F\u7528\u5230\u7684\u8282\u70B9\u8FDB\u884C\u5220\u9664\uFF0C\u4ECE\u800C\u5B9E\u73B0 Tree Shaking\u3002</p><h3 id="\u5E38\u7528\u914D\u7F6E\u89E3\u8BFB" tabindex="-1">\u5E38\u7528\u914D\u7F6E\u89E3\u8BFB <a class="header-anchor" href="#\u5E38\u7528\u914D\u7F6E\u89E3\u8BFB" aria-hidden="true">#</a></h3><h4 id="\u591A\u4EA7\u7269\u914D\u7F6E" tabindex="-1">\u591A\u4EA7\u7269\u914D\u7F6E <a class="header-anchor" href="#\u591A\u4EA7\u7269\u914D\u7F6E" aria-hidden="true">#</a></h4><p>\u5728\u6253\u5305 JavaScript \u7C7B\u5E93\u7684\u573A\u666F\u4E2D\uFF0C\u6211\u4EEC\u901A\u5E38\u9700\u8981\u5BF9\u5916\u66B4\u9732\u51FA\u4E0D\u540C\u683C\u5F0F\u7684\u4EA7\u7269\u4F9B\u4ED6\u4EBA\u4F7F\u7528\uFF0C\u4E0D\u4EC5\u5305\u62EC <code>ESM</code>\uFF0C\u4E5F\u9700\u8981\u5305\u62EC\u8BF8\u5982<code>CommonJS</code>\u3001<code>UMD</code>\u7B49\u683C\u5F0F\uFF0C\u4FDD\u8BC1\u826F\u597D\u7684\u517C\u5BB9\u6027\u3002\u90A3\u4E48\uFF0C\u540C\u4E00\u4EFD\u5165\u53E3\u6587\u4EF6\uFF0C\u5982\u4F55\u8BA9 Rollup \u7ED9\u6211\u4EEC\u6253\u5305\u51FA\u4E0D\u4E00\u6837\u683C\u5F0F\u7684\u4EA7\u7269\u5462\uFF1F\u6211\u4EEC\u57FA\u4E8E\u4E0A\u8FF0\u7684\u914D\u7F6E\u6587\u4EF6\u6765\u8FDB\u884C\u4FEE\u6539:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// rollup.config.js</span></span>
<span class="line"><span style="color:#676E95;">/**</span></span>
<span class="line"><span style="color:#676E95;"> * </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">type</span><span style="color:#676E95;"> </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;"> import(&#39;rollup&#39;).RollupOptions </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;"> */</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> buildOptions </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">input</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src/index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5C06 output \u6539\u9020\u6210\u4E00\u4E2A\u6570\u7EC4</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">output</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">dir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist/es</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">format</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">dir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist/cjs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">format</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cjs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> buildOptions</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u4ECE\u4EE3\u7801\u4E2D\u53EF\u4EE5\u770B\u5230\uFF0C\u6211\u4EEC\u5C06 <code>output</code> \u5C5E\u6027\u914D\u7F6E\u6210\u4E00\u4E2A\u6570\u7EC4\uFF0C\u6570\u7EC4\u4E2D\u6BCF\u4E2A\u5143\u7D20\u90FD\u662F\u4E00\u4E2A\u63CF\u8FF0\u5BF9\u8C61\uFF0C\u51B3\u5B9A\u4E86\u4E0D\u540C\u4EA7\u7269\u7684\u8F93\u51FA\u884C\u4E3A\u3002</p><h4 id="\u591A\u5165\u53E3\u914D\u7F6E" tabindex="-1">\u591A\u5165\u53E3\u914D\u7F6E <a class="header-anchor" href="#\u591A\u5165\u53E3\u914D\u7F6E" aria-hidden="true">#</a></h4><p>\u9664\u4E86\u591A\u4EA7\u7269\u914D\u7F6E\uFF0CRollup \u4E2D\u4E5F\u652F\u6301\u591A\u5165\u53E3\u914D\u7F6E\uFF0C\u800C\u4E14\u901A\u5E38\u60C5\u51B5\u4E0B\u4E24\u8005\u4F1A\u88AB\u7ED3\u5408\u8D77\u6765\u4F7F\u7528\u3002\u63A5\u4E0B\u6765\uFF0C\u5C31\u8BA9\u6211\u4EEC\u7EE7\u7EED\u6539\u9020\u4E4B\u524D\u7684\u914D\u7F6E\u6587\u4EF6\uFF0C\u5C06 <code>input</code> \u8BBE\u7F6E\u4E3A\u4E00\u4E2A\u6570\u7EC4\u6216\u8005\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u5982\u4E0B\u6240\u793A:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">input</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src/index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src/util.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">// \u6216\u8005</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">input</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">index</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src/index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">util</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src/util.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u901A\u8FC7\u6267\u884C <code>npm run build</code> \u53EF\u4EE5\u53D1\u73B0\uFF0C\u6240\u6709\u5165\u53E3\u7684\u4E0D\u540C\u683C\u5F0F\u4EA7\u7269\u5DF2\u7ECF\u6210\u529F\u8F93\u51FA:</p><img src="`+x+`"><p>\u5982\u679C\u4E0D\u540C\u5165\u53E3\u5BF9\u5E94\u7684\u6253\u5305\u914D\u7F6E\u4E0D\u4E00\u6837\uFF0C\u6211\u4EEC\u4E5F\u53EF\u4EE5\u9ED8\u8BA4\u5BFC\u51FA\u4E00\u4E2A <code>\u914D\u7F6E\u6570\u7EC4</code>\uFF0C\u5982\u4E0B\u6240\u793A:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// rollup.config.js</span></span>
<span class="line"><span style="color:#676E95;">/**</span></span>
<span class="line"><span style="color:#676E95;"> * </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">type</span><span style="color:#676E95;"> </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;"> import(&#39;rollup&#39;).RollupOptions </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;"> */</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> buildIndexOptions </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">input</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src/index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">output</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u7701\u7565 output \u914D\u7F6E</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">/**</span></span>
<span class="line"><span style="color:#676E95;"> * </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">type</span><span style="color:#676E95;"> </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;"> import(&#39;rollup&#39;).RollupOptions </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;"> */</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> buildUtilOptions </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">input</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src/util.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">output</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u7701\u7565 output \u914D\u7F6E</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> [buildIndexOptions</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> buildUtilOptions]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u5982\u679C\u662F\u6BD4\u8F83\u590D\u6742\u7684\u6253\u5305\u573A\u666F(\u5982 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fvitejs%2Fvite%2Fblob%2Fmain%2Fpackages%2Fvite%2Frollup.config.js" target="_blank" rel="noreferrer">Vite \u6E90\u7801\u672C\u8EAB\u7684\u6253\u5305</a>)\uFF0C\u6211\u4EEC\u9700\u8981\u5C06\u9879\u76EE\u7684\u4EE3\u7801\u5206\u6210\u51E0\u4E2A\u90E8\u5206\uFF0C\u7528\u4E0D\u540C\u7684 Rollup \u914D\u7F6E\u5206\u522B\u6253\u5305\uFF0C\u8FD9\u79CD\u914D\u7F6E\u5C31\u5F88\u6709\u7528\u4E86\u3002</p><h4 id="\u81EA\u5B9A\u4E49-ouput-\u914D\u7F6E" tabindex="-1">\u81EA\u5B9A\u4E49 ouput \u914D\u7F6E <a class="header-anchor" href="#\u81EA\u5B9A\u4E49-ouput-\u914D\u7F6E" aria-hidden="true">#</a></h4><p>\u521A\u624D\u6211\u4EEC\u63D0\u5230\u4E86 <code>input</code> \u7684\u4F7F\u7528\uFF0C\u4E3B\u8981\u7528\u6765\u58F0\u660E\u5165\u53E3\uFF0C\u53EF\u4EE5\u914D\u7F6E\u6210\u5B57\u7B26\u4E32\u3001\u6570\u7EC4\u6216\u8005\u5BF9\u8C61\uFF0C\u4F7F\u7528\u6BD4\u8F83\u7B80\u5355\u3002\u800C <code>output</code> \u4E0E\u4E4B\u76F8\u5BF9\uFF0C\u7528\u6765\u914D\u7F6E\u8F93\u51FA\u7684\u76F8\u5173\u4FE1\u606F\uFF0C\u5E38\u7528\u7684\u914D\u7F6E\u9879\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#FFCB6B;">output</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u4EA7\u7269\u8F93\u51FA\u76EE\u5F55</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">dir</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">__dirname</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dist</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u4EE5\u4E0B\u4E09\u4E2A\u914D\u7F6E\u9879\u90FD\u53EF\u4EE5\u4F7F\u7528\u8FD9\u4E9B\u5360\u4F4D\u7B26:</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// 1. [name]: \u53BB\u9664\u6587\u4EF6\u540E\u7F00\u540E\u7684\u6587\u4EF6\u540D</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// 2. [hash]: \u6839\u636E\u6587\u4EF6\u540D\u548C\u6587\u4EF6\u5185\u5BB9\u751F\u6210\u7684 hash \u503C</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// 3. [format]: \u4EA7\u7269\u6A21\u5757\u683C\u5F0F\uFF0C\u5982 es\u3001cjs</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// 4. [extname]: \u4EA7\u7269\u540E\u7F00\u540D(\u5E26\`.\`)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5165\u53E3\u6A21\u5757\u7684\u8F93\u51FA\u6587\u4EF6\u540D</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">entryFileNames</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">[name].js</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u975E\u5165\u53E3\u6A21\u5757(\u5982\u52A8\u6001 import)\u7684\u8F93\u51FA\u6587\u4EF6\u540D</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">chunkFileNames</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">chunk-[hash].js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u9759\u6001\u8D44\u6E90\u6587\u4EF6\u8F93\u51FA\u6587\u4EF6\u540D</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">assetFileNames</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">assets/[name]-[hash][extname]</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u4EA7\u7269\u8F93\u51FA\u683C\u5F0F\uFF0C\u5305\u62EC\`amd\`\u3001\`cjs\`\u3001\`es\`\u3001\`iife\`\u3001\`umd\`\u3001\`system\`</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">format</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cjs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u662F\u5426\u751F\u6210 sourcemap \u6587\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">sourcemap</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5982\u679C\u662F\u6253\u5305\u51FA iife/umd \u683C\u5F0F\uFF0C\u9700\u8981\u5BF9\u5916\u66B4\u9732\u51FA\u4E00\u4E2A\u5168\u5C40\u53D8\u91CF\uFF0C\u901A\u8FC7 name \u914D\u7F6E\u53D8\u91CF\u540D</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">MyBundle</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5168\u5C40\u53D8\u91CF\u58F0\u660E</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">globals</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u9879\u76EE\u4E2D\u53EF\u4EE5\u76F4\u63A5\u7528\`$\`\u4EE3\u66FF\`jquery\`</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">jquery</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">$</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="\u4F9D\u8D56-external" tabindex="-1">\u4F9D\u8D56 external <a class="header-anchor" href="#\u4F9D\u8D56-external" aria-hidden="true">#</a></h4><p>\u5BF9\u4E8E\u67D0\u4E9B\u7B2C\u4E09\u65B9\u5305\uFF0C\u6709\u65F6\u5019\u6211\u4EEC\u4E0D\u60F3\u8BA9 Rollup \u8FDB\u884C\u6253\u5305\uFF0C\u4E5F\u53EF\u4EE5\u901A\u8FC7 external \u8FDB\u884C\u5916\u90E8\u5316:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">external</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react-dom</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5728 SSR \u6784\u5EFA\u6216\u8005\u4F7F\u7528 ESM CDN \u7684\u573A\u666F\u4E2D\uFF0C\u8FD9\u4E2A\u914D\u7F6E\u5C06\u975E\u5E38\u6709\u7528\u3002</p><h4 id="\u63A5\u5165\u63D2\u4EF6\u80FD\u529B" tabindex="-1">\u63A5\u5165\u63D2\u4EF6\u80FD\u529B <a class="header-anchor" href="#\u63A5\u5165\u63D2\u4EF6\u80FD\u529B" aria-hidden="true">#</a></h4><p>\u5728 Rollup \u7684\u65E5\u5E38\u4F7F\u7528\u4E2D\uFF0C\u6211\u4EEC\u96BE\u514D\u4F1A\u9047\u5230\u4E00\u4E9B Rollup \u672C\u8EAB\u4E0D\u652F\u6301\u7684\u573A\u666F\uFF0C\u6BD4\u5982<code>\u517C\u5BB9 CommonJS \u6253\u5305</code>\u3001<code>\u6CE8\u5165\u73AF\u5883\u53D8\u91CF</code>\u3001<code>\u914D\u7F6E\u8DEF\u5F84\u522B\u540D</code>\u3001<code>\u538B\u7F29\u4EA7\u7269\u4EE3\u7801</code> \u7B49\u7B49\u3002\u8FD9\u4E2A\u65F6\u5019\u5C31\u9700\u8981\u6211\u4EEC\u5F15\u5165\u76F8\u5E94\u7684 Rollup \u63D2\u4EF6\u4E86\u3002</p><p>\u867D\u7136 Rollup \u80FD\u591F\u6253\u5305<code>\u8F93\u51FA</code>\u51FA <code>CommonJS</code> \u683C\u5F0F\u7684\u4EA7\u7269\uFF0C\u4F46\u5BF9\u4E8E<code>\u8F93\u5165</code>\u7ED9 Rollup \u7684\u4EE3\u7801\u5E76\u4E0D\u652F\u6301 CommonJS\uFF0C\u4EC5\u4EC5\u652F\u6301 ESM\u3002\u4F60\u53EF\u80FD\u4F1A\u8BF4\uFF0C\u90A3\u6211\u4EEC\u76F4\u63A5\u5728\u9879\u76EE\u4E2D\u7EDF\u4E00\u4F7F\u7528 ESM \u89C4\u8303\u5C31\u53EF\u4EE5\u4E86\u554A\uFF0C\u8FD9\u6709\u4EC0\u4E48\u95EE\u9898\u5462\uFF1F\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u6211\u4EEC\u4E0D\u5149\u8981\u8003\u8651\u9879\u76EE\u672C\u8EAB\u7684\u4EE3\u7801\uFF0C\u8FD8\u8981\u8003\u8651\u7B2C\u4E09\u65B9\u4F9D\u8D56\u3002\u76EE\u524D\u4E3A\u6B62\uFF0C\u8FD8\u662F\u6709\u4E0D\u5C11\u7B2C\u4E09\u65B9\u4F9D\u8D56\u53EA\u6709 CommonJS \u683C\u5F0F\u4EA7\u7269\u800C\u5E76\u672A\u63D0\u4F9B ESM \u4EA7\u7269\uFF0C\u6BD4\u5982\u9879\u76EE\u4E2D\u7528\u5230 <code>lodash</code> \u65F6\uFF0C\u6253\u5305\u9879\u76EE\u4F1A\u51FA\u73B0\u8FD9\u6837\u7684\u8B66\u544A\uFF1A</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">) Unresolved dependencies</span></span>
<span class="line"><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;">//rollupjs.org/guide/en/#warning-treating-module-as-external-dependency</span></span>
<span class="line"></span></code></pre></div><p>\u6211\u4EEC\u9700\u8981\u5F15\u5165\u989D\u5916\u7684\u63D2\u4EF6\u53BB\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\u3002\u9996\u5148\u9700\u8981\u5B89\u88C5\u4E24\u4E2A\u6838\u5FC3\u7684\u63D2\u4EF6\u5305:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">rollup</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">resolve </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">rollup</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">commonjs</span></span>
<span class="line"></span></code></pre></div><ul><li><code>@rollup/plugin-node-resolve</code>\u662F\u4E3A\u4E86\u5141\u8BB8\u6211\u4EEC\u52A0\u8F7D\u7B2C\u4E09\u65B9\u4F9D\u8D56\uFF0C\u5426\u5219\u50CF<code>import React from &#39;react&#39;</code> \u7684\u4F9D\u8D56\u5BFC\u5165\u8BED\u53E5\u5C06\u4E0D\u4F1A\u88AB Rollup \u8BC6\u522B\u3002</li><li><code>@rollup/plugin-commonjs</code> \u7684\u4F5C\u7528\u662F\u5C06 CommonJS \u683C\u5F0F\u7684\u4EE3\u7801\u8F6C\u6362\u4E3A ESM \u683C\u5F0F</li></ul><p>\u7136\u540E\u8BA9\u6211\u4EEC\u5728\u914D\u7F6E\u6587\u4EF6\u4E2D\u5BFC\u5165\u8FD9\u4E9B\u63D2\u4EF6:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// rollup.config.js</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> resolve </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@rollup/plugin-node-resolve</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> commonjs </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@rollup/plugin-commonjs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">/**</span></span>
<span class="line"><span style="color:#676E95;"> * </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">type</span><span style="color:#676E95;"> </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;"> import(&#39;rollup&#39;).RollupOptions </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;"> */</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">input</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src/index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">output</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">dir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist/es</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">format</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">dir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist/cjs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">format</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cjs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u901A\u8FC7 plugins \u53C2\u6570\u6DFB\u52A0\u63D2\u4EF6</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">commonjs</span><span style="color:#A6ACCD;">()]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>\u91CD\u65B0\u6267\u884C <code>npm run build</code>\uFF0C\u4F60\u53EF\u4EE5\u53D1\u73B0\u4EA7\u7269\u5DF2\u7ECF\u6B63\u5E38\u751F\u6210\u4E86:</p><img src="`+k+`" style="zoom:70%;"><p>\u5728 Rollup \u914D\u7F6E\u6587\u4EF6\u4E2D\uFF0C<code>plugins</code> \u9664\u4E86\u53EF\u4EE5\u4E0E <code>output</code> \u914D\u7F6E\u5728\u540C\u4E00\u7EA7\uFF0C\u4E5F\u53EF\u4EE5\u914D\u7F6E\u5728 output \u53C2\u6570\u91CC\u9762\uFF0C\u5982:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// rollup.config.js</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">terser</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rollup-plugin-terser</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> resolve </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@rollup/plugin-node-resolve</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> commonjs </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@rollup/plugin-commonjs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">output</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u52A0\u5165 terser \u63D2\u4EF6\uFF0C\u7528\u6765\u538B\u7F29\u4EE3\u7801</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">terser</span><span style="color:#A6ACCD;">()]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">commonjs</span><span style="color:#A6ACCD;">()]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><blockquote><p>\u5F53\u7136\uFF0C\u4F60\u53EF\u4EE5\u5C06\u4E0A\u8FF0\u7684 terser \u63D2\u4EF6\u653E\u5230\u6700\u5916\u5C42\u7684 <code>plugins</code> \u914D\u7F6E\u4E2D\u3002</p></blockquote><p>\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C<code>output.plugins</code>\u4E2D\u914D\u7F6E\u7684\u63D2\u4EF6\u662F\u6709\u4E00\u5B9A\u9650\u5236\u7684\uFF0C\u53EA\u6709\u4F7F\u7528 <code>Output \u9636\u6BB5</code> \u76F8\u5173\u94A9\u5B50\u7684\u63D2\u4EF6\u624D\u80FD\u591F\u653E\u5230\u8FD9\u4E2A\u914D\u7F6E\u4E2D\uFF0C\u5927\u5BB6\u53EF\u4EE5\u53BB <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Frollup%2Fawesome%23output" target="_blank" rel="noreferrer">\u8FD9\u4E2A\u7AD9\u70B9</a> \u67E5\u770B Rollup \u7684 Output \u63D2\u4EF6\u5217\u8868\u3002</p><p>\u53E6\u5916\uFF0C\u8FD9\u91CC\u4E5F\u7ED9\u5927\u5BB6\u5206\u4EAB\u5176\u5B83\u4E00\u4E9B\u6BD4\u8F83\u5E38\u7528\u7684 Rollup \u63D2\u4EF6\u5E93:</p><ul><li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Frollup%2Fplugins%2Ftree%2Fmaster%2Fpackages%2Fjson" target="_blank" rel="noreferrer">@rollup/plugin-json</a>\uFF1A \u652F\u6301<code>.json</code>\u7684\u52A0\u8F7D\uFF0C\u5E76\u914D\u5408<code>rollup</code>\u7684<code>Tree Shaking</code>\u673A\u5236\u53BB\u6389\u672A\u4F7F\u7528\u7684\u90E8\u5206\uFF0C\u8FDB\u884C\u6309\u9700\u6253\u5305\u3002</li><li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Frollup%2Fplugins%2Ftree%2Fmaster%2Fpackages%2Fbabel" target="_blank" rel="noreferrer">@rollup/plugin-babel</a>\uFF1A\u5728 Rollup \u4E2D\u4F7F\u7528 Babel \u8FDB\u884C JS \u4EE3\u7801\u7684\u8BED\u6CD5\u8F6C\u8BD1\u3002</li><li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Frollup%2Fplugins%2Ftree%2Fmaster%2Fpackages%2Ftypescript" target="_blank" rel="noreferrer">@rollup/plugin-typescript</a>: \u652F\u6301\u4F7F\u7528 TypeScript \u5F00\u53D1\u3002</li><li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Frollup%2Fplugins%2Ftree%2Fmaster%2Fpackages%2Falias" target="_blank" rel="noreferrer">@rollup/plugin-alias</a>\uFF1A\u652F\u6301\u522B\u540D\u914D\u7F6E\u3002</li><li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Frollup%2Fplugins%2Ftree%2Fmaster%2Fpackages%2Freplace" target="_blank" rel="noreferrer">@rollup/plugin-replace</a>\uFF1A\u5728 Rollup \u8FDB\u884C\u53D8\u91CF\u5B57\u7B26\u4E32\u7684\u66FF\u6362\u3002</li><li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fbtd%2Frollup-plugin-visualizer" target="_blank" rel="noreferrer">rollup-plugin-visualizer</a>: \u5BF9 Rollup \u6253\u5305\u4EA7\u7269\u8FDB\u884C\u5206\u6790\uFF0C\u81EA\u52A8\u751F\u6210\u4EA7\u7269\u4F53\u79EF\u53EF\u89C6\u5316\u5206\u6790\u56FE\u3002</li></ul><h4 id="javascript-api-\u65B9\u5F0F\u8C03\u7528" tabindex="-1">JavaScript API \u65B9\u5F0F\u8C03\u7528 <a class="header-anchor" href="#javascript-api-\u65B9\u5F0F\u8C03\u7528" aria-hidden="true">#</a></h4><p>\u4EE5\u4E0A\u6211\u4EEC\u901A\u8FC7 <code>Rollup</code> \u7684\u914D\u7F6E\u6587\u4EF6\u7ED3\u5408 <code>rollup -c</code> \u5B8C\u6210\u4E86 Rollup \u7684\u6253\u5305\u8FC7\u7A0B\uFF0C\u4F46\u6709\u4E9B\u573A\u666F\u4E0B\u6211\u4EEC\u9700\u8981\u57FA\u4E8E Rollup \u5B9A\u5236\u4E00\u4E9B\u6253\u5305\u8FC7\u7A0B\uFF0C\u914D\u7F6E\u6587\u4EF6\u5C31\u4E0D\u591F\u7075\u6D3B\u4E86\uFF0C\u8FD9\u65F6\u5019\u6211\u4EEC\u9700\u8981\u7528\u5230\u5BF9\u5E94 JavaScript API \u6765\u8C03\u7528 Rollup\uFF0C\u4E3B\u8981\u5206\u4E3A <code>rollup.rollup</code> \u548C <code>rollup.watch</code> \u4E24\u4E2A API\uFF0C\u63A5\u4E0B\u6765\u6211\u4EEC\u4EE5\u5177\u4F53\u7684\u4F8B\u5B50\u6765\u5B66\u4E60\u4E00\u4E0B\u3002</p><p>\u9996\u5148\u662F <code>rollup.rollup</code>\uFF0C\u7528\u6765\u4E00\u6B21\u6027\u5730\u8FDB\u884C Rollup \u6253\u5305\uFF0C\u4F60\u53EF\u4EE5\u65B0\u5EFA <code>build.js</code>\uFF0C\u5185\u5BB9\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// build.js</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> rollup </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">rollup</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u5E38\u7528 inputOptions \u914D\u7F6E</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> inputOptions </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">input</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./src/index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">external</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> []</span></span>
<span class="line"><span style="color:#A6ACCD;">  plugins:[]</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> outputOptionsList </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5E38\u7528 outputOptions \u914D\u7F6E</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">dir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dist/es</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">entryFileNames</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">[name].[hash].js</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">chunkFileNames</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">chunk-[hash].js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">assetFileNames</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">assets/[name]-[hash][extname]</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    format: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">es</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">sourcemap</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">globals</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">lodash</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">_</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u7701\u7565\u5176\u5B83\u7684\u8F93\u51FA\u914D\u7F6E</span></span>
<span class="line"><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">build</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bundle</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buildFailed</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// 1. \u8C03\u7528 rollup.rollup \u751F\u6210 bundle \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bundle</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rollup</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">rollup</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">inputOptions</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">outputOptions</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">of</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">outputOptionsList</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// 2. \u62FF\u5230 bundle \u5BF9\u8C61\uFF0C\u6839\u636E\u6BCF\u4E00\u4EFD\u8F93\u51FA\u914D\u7F6E\uFF0C\u8C03\u7528 generate \u548C write \u65B9\u6CD5\u5206\u522B\u751F\u6210\u548C\u5199\u5165\u4EA7\u7269</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">output</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bundle</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">generate</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">outputOptions</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bundle</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">write</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">outputOptions</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">catch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">buildFailed</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">error</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">bundle</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u6700\u540E\u8C03\u7528 bundle.close \u65B9\u6CD5\u7ED3\u675F\u6253\u5305</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bundle</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">close</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exit</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">buildFailed</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">build</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u4E3B\u8981\u7684\u6267\u884C\u6B65\u9AA4\u5982\u4E0B:</p><ul><li><ol><li>\u901A\u8FC7 <code>rollup.rollup</code>\u65B9\u6CD5\uFF0C\u4F20\u5165 <code>inputOptions</code>\uFF0C\u751F\u6210 bundle \u5BF9\u8C61\uFF1B</li></ol></li><li><ol><li>\u8C03\u7528 bundle \u5BF9\u8C61\u7684 generate \u548C write \u65B9\u6CD5\uFF0C\u4F20\u5165<code>outputOptions</code>\uFF0C\u5206\u522B\u5B8C\u6210\u4EA7\u7269\u548C\u751F\u6210\u548C\u78C1\u76D8\u5199\u5165\u3002</li></ol></li><li><ol><li>\u8C03\u7528 bundle \u5BF9\u8C61\u7684 close \u65B9\u6CD5\u6765\u7ED3\u675F\u6253\u5305\u3002</li></ol></li></ul><p>\u63A5\u7740\u4F60\u53EF\u4EE5\u6267\u884C <code>node build.js</code>\uFF0C\u8FD9\u6837\uFF0C\u6211\u4EEC\u5C31\u53EF\u4EE5\u5B8C\u6210\u4E86\u4EE5\u7F16\u7A0B\u7684\u65B9\u5F0F\u6765\u8C03\u7528 Rollup \u6253\u5305\u7684\u8FC7\u7A0B\u3002</p><p>\u9664\u4E86\u901A\u8FC7 <code>rollup.rollup</code> \u5B8C\u6210\u4E00\u6B21\u6027\u6253\u5305\uFF0C\u6211\u4EEC\u4E5F\u53EF\u4EE5\u901A\u8FC7 <code>rollup.watch</code> \u6765\u5B8C\u6210<code>watch</code>\u6A21\u5F0F\u4E0B\u7684\u6253\u5305\uFF0C\u5373\u6BCF\u6B21\u6E90\u6587\u4EF6\u53D8\u52A8\u540E\u81EA\u52A8\u8FDB\u884C\u91CD\u65B0\u6253\u5305\u3002\u4F60\u53EF\u4EE5\u65B0\u5EFA <code>watch.js</code> \u6587\u4EF6\uFF0C\u5185\u5BB9\u5165\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// watch.js</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> rollup </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">rollup</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> watcher </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> rollup</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">watch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u548C rollup \u914D\u7F6E\u6587\u4EF6\u4E2D\u7684\u5C5E\u6027\u57FA\u672C\u4E00\u81F4\uFF0C\u53EA\u4E0D\u8FC7\u591A\u4E86\`watch\`\u914D\u7F6E</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">input</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./src/index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">output</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">dir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist/es</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">format</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">dir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist/cjs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">format</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cjs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">watch</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">exclude</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">node_modules/**</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">include</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src/**</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u76D1\u542C watch \u5404\u79CD\u4E8B\u4EF6</span></span>
<span class="line"><span style="color:#A6ACCD;">watcher</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">restart</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\u91CD\u65B0\u6784\u5EFA...</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">watcher</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">change</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\u53D1\u751F\u53D8\u52A8\u7684\u6A21\u5757id: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">watcher</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">event</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">BUNDLE_END</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\u6253\u5305\u4FE1\u606F:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u73B0\u5728\u4F60\u53EF\u4EE5\u901A\u8FC7\u6267\u884C <code>node watch.js</code> \u5F00\u542F Rollup \u7684 watch \u6253\u5305\u6A21\u5F0F\uFF0C\u5F53\u4F60\u6539\u52A8\u4E00\u4E2A\u6587\u4EF6\u540E\u53EF\u4EE5\u770B\u5230\u5982\u4E0B\u7684\u65E5\u5FD7\uFF0C\u8BF4\u660E Rollup \u81EA\u52A8\u8FDB\u884C\u4E86\u91CD\u65B0\u6253\u5305\uFF0C\u5E76\u89E6\u53D1\u76F8\u5E94\u7684\u4E8B\u4EF6\u56DE\u8C03\u51FD\u6570:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#FFCB6B;">\u53D1\u751F\u751F\u53D8\u52A8\u7684\u6A21\u5757id</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">xxx</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js</span></span>
<span class="line"><span style="color:#A6ACCD;">\u91CD\u65B0\u6784\u5EFA</span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#FFCB6B;">\u6253\u5305\u4FE1\u606F</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">BUNDLE_END</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">duration</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">input</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./src/index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">output</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u8F93\u51FA\u4EA7\u7269\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#F07178;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">result</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">cache</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">/* \u4EA7\u7269\u5177\u4F53\u4FE1\u606F */</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">close</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">AsyncFunction</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">close</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">closed</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">generate</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">AsyncFunction</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">generate</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">watchFiles</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u76D1\u542C\u6587\u4EF6\u5217\u8868</span></span>
<span class="line"><span style="color:#F07178;">    ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">write</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">AsyncFunction</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">write</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u57FA\u4E8E\u5982\u4E0A\u7684\u4E24\u4E2A JavaScript API \u6211\u4EEC\u53EF\u4EE5\u5F88\u65B9\u4FBF\u5730\u5728\u4EE3\u7801\u4E2D\u8C03\u7528 Rollup \u7684\u6253\u5305\u6D41\u7A0B\uFF0C\u76F8\u6BD4\u4E8E\u914D\u7F6E\u6587\u4EF6\u6709\u4E86\u66F4\u591A\u7684\u64CD\u4F5C\u7A7A\u95F4\uFF0C\u4F60\u53EF\u4EE5\u5728\u4EE3\u7801\u4E2D\u901A\u8FC7\u8FD9\u4E9B API \u5BF9 Rollup \u6253\u5305\u8FC7\u7A0B\u8FDB\u884C\u5B9A\u5236\uFF0C\u751A\u81F3\u662F\u4E8C\u6B21\u5F00\u53D1\u3002</p><h3 id="\u603B\u7ED3-7" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3-7" aria-hidden="true">#</a></h3><p>\u5B66\u4E60\u4E86\u5B8C\u4E86 Rollup \u57FA\u7840\u4F7F\u7528\u7BC7\u7684\u5185\u5BB9\uFF0C\u4F60\u9700\u8981\u91CD\u70B9\u638C\u63E1 <strong>Rollup \u57FA\u672C\u914D\u7F6E\u9879\u7684\u542B\u4E49</strong>\u548C <strong>JavaScript API \u7684\u4F7F\u7528</strong>\u3002</p><p>\u9996\u5148\uFF0C\u6211\u4EEC\u901A\u8FC7\u4E00\u4E2A\u7B80\u5355\u7684\u793A\u4F8B\u5B66\u4E60\u4E86 Rollup \u4E00\u822C\u7684\u4F7F\u7528\u65B9\u6CD5\uFF0C\u7528 Rollup \u6253\u5305\u51FA\u4E86\u7B2C\u4E00\u4EFD\u4EA7\u7269\uFF0C\u7136\u540E\u6211\u4EEC\u9488\u5BF9 Rollup \u4E2D\u5E38\u7528\u7684\u914D\u7F6E\u9879\u8FDB\u884C\u4ECB\u7ECD\uFF0C\u5305\u62EC <code>input</code>\u3001<code>output</code>\u3001<code>external</code>\u3001<code>plugins </code>\u7B49\u6838\u5FC3\u914D\u7F6E\uFF0C\u5E76\u4EE5\u4E00\u4E2A\u5B9E\u9645\u7684\u6253\u5305\u573A\u666F\u4E3A\u4F8B\u5E26\u4F60\u5728 Rollup \u4E2D\u63A5\u5165\u63D2\u4EF6\u529F\u80FD\u3002\u63A5\u7740\uFF0C\u6211\u7ED9\u4F60\u4ECB\u7ECD\u4E86 Rollup \u66F4\u9AD8\u7EA7\u7684\u4F7F\u7528\u59FF\u52BF\u2014\u2014\u901A\u8FC7 JavaScript API \u4F7F\u7528\uFF0C\u5206\u522B\u4ECB\u7ECD\u4E86\u4E24\u4E2A\u7ECF\u5178\u7684 API: <code>rollup.rollup</code> \u548C<code>rollup.watch</code>\uFF0C\u5E76\u5E26\u4F60\u5728\u5B9E\u6218\u4E2D\u4F7F\u7528\u8FD9\u4E9B API\uFF0C\u5B8C\u6210\u4E86\u66F4\u4E3A\u590D\u6742\u7684\u6253\u5305\u64CD\u4F5C\u3002</p><h2 id="rollup-\u63D2\u4EF6\u673A\u5236" tabindex="-1">Rollup \u63D2\u4EF6\u673A\u5236 <a class="header-anchor" href="#rollup-\u63D2\u4EF6\u673A\u5236" aria-hidden="true">#</a></h2><p>\u6211\u4EEC\u77E5\u9053\uFF0C\u4EC5\u4EC5\u4F7F\u7528 Rollup \u5185\u7F6E\u7684\u6253\u5305\u80FD\u529B\u5F88\u96BE\u6EE1\u8DB3\u9879\u76EE\u65E5\u76CA\u590D\u6742\u7684\u6784\u5EFA\u9700\u6C42\u3002\u5BF9\u4E8E\u4E00\u4E2A\u771F\u5B9E\u7684\u9879\u76EE\u6784\u5EFA\u573A\u666F\u6765\u8BF4\uFF0C\u6211\u4EEC\u8FD8\u9700\u8981\u8003\u8651\u5230<code>\u6A21\u5757\u6253\u5305</code>\u4E4B\u5916\u7684\u95EE\u9898\uFF0C\u6BD4\u5982<strong>\u8DEF\u5F84\u522B\u540D(alias)</strong> \u3001<strong>\u5168\u5C40\u53D8\u91CF\u6CE8\u5165</strong>\u548C<strong>\u4EE3\u7801\u538B\u7F29</strong>\u7B49\u7B49\u3002</p><p>\u53EF\u8981\u662F\u628A\u8FD9\u4E9B\u573A\u666F\u7684\u5904\u7406\u903B\u8F91\u4E0E\u6838\u5FC3\u7684\u6253\u5305\u903B\u8F91\u90FD\u5199\u5230\u4E00\u8D77\uFF0C\u4E00\u6765\u6253\u5305\u5668\u672C\u8EAB\u7684\u4EE3\u7801\u4F1A\u53D8\u5F97\u5341\u5206\u81C3\u80BF\uFF0C\u4E8C\u6765\u4E5F\u4F1A\u5BF9\u539F\u6709\u7684\u6838\u5FC3\u4EE3\u7801\u4EA7\u751F\u4E00\u5B9A\u7684\u4FB5\u5165\u6027\uFF0C\u6DF7\u5165\u5F88\u591A\u4E0E\u6838\u5FC3\u6D41\u7A0B\u65E0\u5173\u7684\u4EE3\u7801\uFF0C\u4E0D\u6613\u4E8E\u540E\u671F\u7684\u7EF4\u62A4\u3002\u56E0\u6B64 \uFF0CRollup \u8BBE\u8BA1\u51FA\u4E86\u4E00\u5957\u5B8C\u6574\u7684<strong>\u63D2\u4EF6\u673A\u5236</strong>\uFF0C\u5C06\u81EA\u8EAB\u7684\u6838\u5FC3\u903B\u8F91\u4E0E\u63D2\u4EF6\u903B\u8F91\u5206\u79BB\uFF0C\u8BA9\u4F60\u80FD\u6309\u9700\u5F15\u5165\u63D2\u4EF6\u529F\u80FD\uFF0C\u63D0\u9AD8\u4E86 Rollup \u81EA\u8EAB\u7684\u53EF\u6269\u5C55\u6027\u3002</p><p>Rollup \u7684\u6253\u5305\u8FC7\u7A0B\u4E2D\uFF0C\u4F1A\u5B9A\u4E49\u4E00\u5957\u5B8C\u6574\u7684\u6784\u5EFA\u751F\u547D\u5468\u671F\uFF0C\u4ECE\u5F00\u59CB\u6253\u5305\u5230\u4EA7\u7269\u8F93\u51FA\uFF0C\u4E2D\u9014\u4F1A\u7ECF\u5386\u4E00\u4E9B<strong>\u6807\u5FD7\u6027\u7684\u9636\u6BB5</strong>\uFF0C\u5E76\u4E14\u5728\u4E0D\u540C\u9636\u6BB5\u4F1A\u81EA\u52A8\u6267\u884C\u5BF9\u5E94\u7684\u63D2\u4EF6\u94A9\u5B50\u51FD\u6570(Hook)\u3002\u5BF9 Rollup \u63D2\u4EF6\u6765\u8BB2\uFF0C\u6700\u91CD\u8981\u7684\u90E8\u5206\u662F\u94A9\u5B50\u51FD\u6570\uFF0C\u4E00\u65B9\u9762\u5B83\u5B9A\u4E49\u4E86\u63D2\u4EF6\u7684\u6267\u884C\u903B\u8F91\uFF0C\u4E5F\u5C31\u662F&quot;\u505A\u4EC0\u4E48&quot;\uFF1B\u53E6\u4E00\u65B9\u9762\u4E5F\u58F0\u660E\u4E86\u63D2\u4EF6\u7684\u4F5C\u7528\u9636\u6BB5\uFF0C\u5373&quot;\u4EC0\u4E48\u65F6\u5019\u505A&quot;\uFF0C\u8FD9\u4E0E Rollup \u672C\u8EAB\u7684\u6784\u5EFA\u751F\u547D\u5468\u671F\u606F\u606F\u76F8\u5173\u3002</p><p>\u56E0\u6B64\uFF0C\u8981\u771F\u6B63\u7406\u89E3\u63D2\u4EF6\u7684\u4F5C\u7528\u8303\u56F4\u548C\u9636\u6BB5\uFF0C\u9996\u5148\u9700\u8981\u4E86\u89E3 Rollup \u6574\u4F53\u7684\u6784\u5EFA\u8FC7\u7A0B\u4E2D\u5230\u5E95\u505A\u4E86\u4E9B\u4EC0\u4E48\u3002</p><h3 id="rollup-\u6574\u4F53\u6784\u5EFA\u9636\u6BB5" tabindex="-1">Rollup \u6574\u4F53\u6784\u5EFA\u9636\u6BB5 <a class="header-anchor" href="#rollup-\u6574\u4F53\u6784\u5EFA\u9636\u6BB5" aria-hidden="true">#</a></h3><p>\u5728\u6267\u884C <code>rollup</code> \u547D\u4EE4\u4E4B\u540E\uFF0C\u5728 cli \u5185\u90E8\u7684\u4E3B\u8981\u903B\u8F91\u7B80\u5316\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// Build \u9636\u6BB5</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> bundle </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> rollup</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">rollup</span><span style="color:#A6ACCD;">(inputOptions)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// Output \u9636\u6BB5</span></span>
<span class="line"><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#A6ACCD;">(outputOptions</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#A6ACCD;">(bundle</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">write))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u6784\u5EFA\u7ED3\u675F</span></span>
<span class="line"><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> bundle</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">close</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>Rollup \u5185\u90E8\u4E3B\u8981\u7ECF\u5386\u4E86 <code>Build</code> \u548C <code>Output</code> \u4E24\u5927\u9636\u6BB5\uFF1A</p><img src="`+_+`"><p>\u9996\u5148\uFF0CBuild \u9636\u6BB5\u4E3B\u8981\u8D1F\u8D23\u521B\u5EFA\u6A21\u5757\u4F9D\u8D56\u56FE\uFF0C\u521D\u59CB\u5316\u5404\u4E2A\u6A21\u5757\u7684 AST \u4EE5\u53CA\u6A21\u5757\u4E4B\u95F4\u7684\u4F9D\u8D56\u5173\u7CFB\u3002\u4E0B\u9762\u6211\u4EEC\u7528\u4E00\u4E2A\u7B80\u5355\u7684\u4F8B\u5B50\u6765\u611F\u53D7\u4E00\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// src/index.js</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./module-a</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(a)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// src/module-a.js</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\u6267\u884C\u5982\u4E0B\u7684\u6784\u5EFA\u811A\u672C:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> rollup </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rollup</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> util </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">util</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">build</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bundle</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rollup</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">rollup</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    input</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./src/index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">util</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">inspect</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">bundle</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">build</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u53EF\u4EE5\u770B\u5230\u8FD9\u6837\u7684 <code>bundle</code> \u5BF9\u8C61\u4FE1\u606F:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">cache</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">modules</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        ast</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">AST \u8282\u70B9\u4FE1\u606F\uFF0C\u5177\u4F53\u5185\u5BB9\u7701\u7565</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">export const a = 1;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        dependencies</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/Users/code/rollup-demo/src/data.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u5176\u5B83\u5C5E\u6027\u7701\u7565</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        ast</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">AST \u8282\u70B9\u4FE1\u606F\uFF0C\u5177\u4F53\u5185\u5BB9\u7701\u7565</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">import { a } from &#39;./data&#39;;</span><span style="color:#A6ACCD;">\\n\\n</span><span style="color:#C3E88D;">console.log(a);</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        dependencies</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/Users/code/rollup-demo/src/data.js</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">        ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/Users/code/rollup-demo/src/index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u5176\u5B83\u5C5E\u6027\u7701\u7565</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">closed</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u6302\u8F7D\u540E\u7EED\u9636\u6BB5\u4F1A\u6267\u884C\u7684\u65B9\u6CD5</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">close</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">AsyncFunction</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">close</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">generate</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">AsyncFunction</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">generate</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">write</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">AsyncFunction</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">write</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u4ECE\u4E0A\u9762\u7684\u4FE1\u606F\u4E2D\u53EF\u4EE5\u770B\u51FA\uFF0C\u76EE\u524D\u7ECF\u8FC7 Build \u9636\u6BB5\u7684 <code>bundle</code> \u5BF9\u8C61\u5176\u5B9E\u5E76\u6CA1\u6709\u8FDB\u884C\u6A21\u5757\u7684\u6253\u5305\uFF0C\u8FD9\u4E2A\u5BF9\u8C61\u7684\u4F5C\u7528\u5728\u4E8E\u5B58\u50A8\u5404\u4E2A\u6A21\u5757\u7684\u5185\u5BB9\u53CA\u4F9D\u8D56\u5173\u7CFB\uFF0C\u540C\u65F6\u66B4\u9732<code>generate</code>\u548C<code>write</code>\u65B9\u6CD5\uFF0C\u4EE5\u8FDB\u5165\u5230\u540E\u7EED\u7684 <code>Output</code> \u9636\u6BB5\uFF08<code>write</code>\u548C<code>generate</code>\u65B9\u6CD5\u552F\u4E00\u7684\u533A\u522B\u5728\u4E8E\u524D\u8005\u6253\u5305\u5B8C\u4EA7\u7269\u4F1A\u5199\u5165\u78C1\u76D8\uFF0C\u800C\u540E\u8005\u4E0D\u4F1A\uFF09\u3002</p><p>\u6240\u4EE5\uFF0C\u771F\u6B63\u8FDB\u884C\u6253\u5305\u7684\u8FC7\u7A0B\u4F1A\u5728 <code>Output</code> \u9636\u6BB5\u8FDB\u884C\uFF0C\u5373\u5728<code>bundle</code>\u5BF9\u8C61\u7684 <code>generate</code>\u6216\u8005<code>write</code>\u65B9\u6CD5\u4E2D\u8FDB\u884C\u3002\u8FD8\u662F\u4EE5\u4E0A\u9762\u7684 demo \u4E3A\u4F8B\uFF0C\u6211\u4EEC\u7A0D\u7A0D\u6539\u52A8\u4E00\u4E0B\u6784\u5EFA\u903B\u8F91:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> rollup </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rollup</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">build</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bundle</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rollup</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">rollup</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    input</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./src/index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bundle</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">generate</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    format</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">es</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">result:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">build</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u6267\u884C\u540E\u53EF\u4EE5\u5F97\u5230\u5982\u4E0B\u7684\u8F93\u51FA:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">output</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      exports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      facadeModuleId</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/Users/code/rollup-demo/src/index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      isEntry</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      isImplicitEntry</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      type</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">chunk</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">const a = 1;</span><span style="color:#A6ACCD;">\\n\\n</span><span style="color:#C3E88D;">console.log(a);</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      dynamicImports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      fileName</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u5176\u4F59\u5C5E\u6027\u7701\u7565</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u91CC\u53EF\u4EE5\u770B\u5230\u6240\u6709\u7684\u8F93\u51FA\u4FE1\u606F\uFF0C\u751F\u6210\u7684 <code>output</code> \u6570\u7EC4\u5373\u4E3A\u6253\u5305\u5B8C\u6210\u7684\u7ED3\u679C\u3002\u5F53\u7136\uFF0C\u5982\u679C\u4F7F\u7528 <code>bundle.write</code> \u4F1A\u6839\u636E\u914D\u7F6E\u5C06\u6700\u540E\u7684\u4EA7\u7269\u5199\u5165\u5230\u6307\u5B9A\u7684\u78C1\u76D8\u76EE\u5F55\u4E2D\u3002</p><p>\u56E0\u6B64\uFF0C<strong>\u5BF9\u4E8E\u4E00\u6B21\u5B8C\u6574\u7684\u6784\u5EFA\u8FC7\u7A0B\u800C\u8A00\uFF0C</strong> <strong>Rollup</strong> **\u4F1A\u5148\u8FDB\u5165\u5230 Build \u9636\u6BB5\uFF0C\u89E3\u6790\u5404\u6A21\u5757\u7684\u5185\u5BB9\u53CA\u4F9D\u8D56\u5173\u7CFB\uFF0C\u7136\u540E\u8FDB\u5165 **<code>Output</code> <strong>\u9636\u6BB5\uFF0C\u5B8C\u6210\u6253\u5305\u53CA\u8F93\u51FA\u7684\u8FC7\u7A0B</strong>\u3002\u5BF9\u4E8E\u4E0D\u540C\u7684\u9636\u6BB5\uFF0CRollup \u63D2\u4EF6\u4F1A\u6709\u4E0D\u540C\u7684\u63D2\u4EF6\u5DE5\u4F5C\u6D41\u7A0B\uFF0C\u63A5\u4E0B\u6765\u6211\u4EEC\u5C31\u6765\u62C6\u89E3\u4E00\u4E0B Rollup \u63D2\u4EF6\u5728 <code>Build</code> \u548C <code>Output</code> \u4E24\u4E2A\u9636\u6BB5\u7684\u8BE6\u7EC6\u5DE5\u4F5C\u6D41\u7A0B\u3002</p><h3 id="\u62C6\u89E3\u63D2\u4EF6\u5DE5\u4F5C\u6D41" tabindex="-1">\u62C6\u89E3\u63D2\u4EF6\u5DE5\u4F5C\u6D41 <a class="header-anchor" href="#\u62C6\u89E3\u63D2\u4EF6\u5DE5\u4F5C\u6D41" aria-hidden="true">#</a></h3><h4 id="\u63D2\u4EF6-hook-\u7C7B\u578B" tabindex="-1">\u63D2\u4EF6 Hook \u7C7B\u578B <a class="header-anchor" href="#\u63D2\u4EF6-hook-\u7C7B\u578B" aria-hidden="true">#</a></h4><p>\u5728\u5177\u4F53\u8BB2\u8FF0 Rollup \u63D2\u4EF6\u5DE5\u4F5C\u6D41\u4E4B\u524D\uFF0C\u5148\u7ED9\u5927\u5BB6\u4ECB\u7ECD\u4E00\u4E0B\u4E0D\u540C\u63D2\u4EF6 Hook \u7684\u7C7B\u578B\uFF0C\u8FD9\u4E9B\u7C7B\u578B\u4EE3\u8868\u4E86\u4E0D\u540C\u63D2\u4EF6\u7684\u6267\u884C\u7279\u70B9\uFF0C\u662F\u6211\u4EEC\u7406\u89E3 Rollup \u63D2\u4EF6\u5DE5\u4F5C\u6D41\u7684\u57FA\u7840\uFF0C\u56E0\u6B64\u6709\u5FC5\u8981\u8DDF\u5927\u5BB6\u597D\u597D\u62C6\u89E3\u4E00\u4E0B\u3002</p><p>\u901A\u8FC7\u4E0A\u6587\u7684\u4F8B\u5B50\uFF0C\u76F8\u4FE1\u4F60\u53EF\u4EE5\u76F4\u89C2\u5730\u7406\u89E3 Rollup \u4E24\u5927\u6784\u5EFA\u9636\u6BB5\uFF08<code>Build</code>\u548C<code>Output</code>\uFF09\u5404\u81EA\u7684\u539F\u7406\u3002\u53EF\u80FD\u4F60\u4F1A\u6709\u7591\u95EE\uFF0C\u8FD9\u4E24\u4E2A\u9636\u6BB5\u5230\u5E95\u8DDF\u63D2\u4EF6\u673A\u5236\u6709\u4EC0\u4E48\u5173\u7CFB\u5462\uFF1F\u5B9E\u9645\u4E0A\uFF0C\u63D2\u4EF6\u7684\u5404\u79CD Hook \u53EF\u4EE5\u6839\u636E\u8FD9\u4E24\u4E2A\u6784\u5EFA\u9636\u6BB5\u5206\u4E3A\u4E24\u7C7B: <code>Build Hook</code> \u4E0E <code>Output Hook</code>\u3002</p><ul><li><code>Build Hook</code>\u5373\u5728<code>Build</code>\u9636\u6BB5\u6267\u884C\u7684\u94A9\u5B50\u51FD\u6570\uFF0C\u5728\u8FD9\u4E2A\u9636\u6BB5\u4E3B\u8981\u8FDB\u884C\u6A21\u5757\u4EE3\u7801\u7684\u8F6C\u6362\u3001AST \u89E3\u6790\u4EE5\u53CA\u6A21\u5757\u4F9D\u8D56\u7684\u89E3\u6790\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u9636\u6BB5\u7684 Hook \u5BF9\u4E8E\u4EE3\u7801\u7684\u64CD\u4F5C\u7C92\u5EA6\u4E00\u822C\u4E3A<code>\u6A21\u5757</code>\u7EA7\u522B\uFF0C\u4E5F\u5C31\u662F\u5355\u6587\u4EF6\u7EA7\u522B\u3002</li><li><code>Ouput Hook</code>(\u5B98\u65B9\u79F0\u4E3A<code>Output Generation Hook</code>)\uFF0C\u5219\u4E3B\u8981\u8FDB\u884C\u4EE3\u7801\u7684\u6253\u5305\uFF0C\u5BF9\u4E8E\u4EE3\u7801\u800C\u8A00\uFF0C\u64CD\u4F5C\u7C92\u5EA6\u4E00\u822C\u4E3A <code>chunk</code>\u7EA7\u522B(\u4E00\u4E2A chunk \u901A\u5E38\u6307\u5F88\u591A\u6587\u4EF6\u6253\u5305\u5230\u4E00\u8D77\u7684\u4EA7\u7269)\u3002</li></ul><p>\u9664\u4E86\u6839\u636E\u6784\u5EFA\u9636\u6BB5\u53EF\u4EE5\u5C06 Rollup \u63D2\u4EF6\u8FDB\u884C\u5206\u7C7B\uFF0C\u6839\u636E\u4E0D\u540C\u7684 Hook \u6267\u884C\u65B9\u5F0F\u4E5F\u4F1A\u6709\u4E0D\u540C\u7684\u5206\u7C7B\uFF0C\u4E3B\u8981\u5305\u62EC <code>Async</code>\u3001<code>Sync</code>\u3001<code>Parallel</code>\u3001<code>Squential</code>\u3001<code>First </code>\u8FD9\u4E94\u79CD\u3002\u5728\u540E\u6587\u4E2D\u6211\u4EEC\u5C06\u63A5\u89E6\u5404\u79CD\u5404\u6837\u7684\u63D2\u4EF6 Hook\uFF0C\u4F46\u65E0\u8BBA\u54EA\u4E2A Hook \u90FD\u79BB\u4E0D\u5F00\u8FD9\u4E94\u79CD\u6267\u884C\u65B9\u5F0F\u3002</p><h5 id="async\u3001sync" tabindex="-1">Async\u3001Sync <a class="header-anchor" href="#async\u3001sync" aria-hidden="true">#</a></h5><p>\u9996\u5148\u662F <code>Async</code> \u548C <code>Sync</code> \u94A9\u5B50\u51FD\u6570\uFF0C\u4E24\u8005\u5176\u5B9E\u662F\u76F8\u5BF9\u7684\uFF0C\u5206\u522B\u4EE3\u8868<code>\u5F02\u6B65</code>\u548C<code>\u540C\u6B65</code>\u7684\u94A9\u5B50\u51FD\u6570\uFF0C\u4E24\u8005\u6700\u5927\u7684\u533A\u522B\u5728\u4E8E\u540C\u6B65\u94A9\u5B50\u91CC\u9762\u4E0D\u80FD\u6709\u5F02\u6B65\u903B\u8F91\uFF0C\u800C\u5F02\u6B65\u94A9\u5B50\u53EF\u4EE5\u6709\u3002</p><h5 id="parallel" tabindex="-1">Parallel <a class="header-anchor" href="#parallel" aria-hidden="true">#</a></h5><p>\u8FD9\u91CC\u6307\u5E76\u884C\u7684\u94A9\u5B50\u51FD\u6570\u3002\u5982\u679C\u6709\u591A\u4E2A\u63D2\u4EF6\u5B9E\u73B0\u4E86\u8FD9\u4E2A\u94A9\u5B50\u7684\u903B\u8F91\uFF0C\u4E00\u65E6\u6709\u94A9\u5B50\u51FD\u6570\u662F\u5F02\u6B65\u903B\u8F91\uFF0C\u5219\u5E76\u53D1\u6267\u884C\u94A9\u5B50\u51FD\u6570\uFF0C\u4E0D\u4F1A\u7B49\u5F85\u5F53\u524D\u94A9\u5B50\u5B8C\u6210(\u5E95\u5C42\u4F7F\u7528 <code>Promise.all</code>) \u3002</p><p>\u6BD4\u5982\u5BF9\u4E8E <code>Build</code> \u9636\u6BB5\u7684 <code>buildStart</code> \u94A9\u5B50\uFF0C\u5B83\u7684\u6267\u884C\u65F6\u673A\u5176\u5B9E\u662F\u5728\u6784\u5EFA\u521A\u5F00\u59CB\u7684\u65F6\u5019\uFF0C\u5404\u4E2A\u63D2\u4EF6\u53EF\u4EE5\u5728\u8FD9\u4E2A\u94A9\u5B50\u5F53\u4E2D\u505A\u4E00\u4E9B\u72B6\u6001\u7684\u521D\u59CB\u5316\u64CD\u4F5C\uFF0C\u4F46\u5176\u5B9E\u63D2\u4EF6\u4E4B\u95F4\u7684\u64CD\u4F5C\u5E76\u4E0D\u662F\u76F8\u4E92\u4F9D\u8D56\u7684\uFF0C\u4E5F\u5C31\u662F\u53EF\u4EE5\u5E76\u53D1\u6267\u884C\uFF0C\u4ECE\u800C\u63D0\u5347\u6784\u5EFA\u6027\u80FD\u3002\u53CD\u4E4B\uFF0C\u5BF9\u4E8E\u9700\u8981<strong>\u4F9D\u8D56\u5176\u4ED6\u63D2\u4EF6\u5904\u7406\u7ED3\u679C</strong>\u7684\u60C5\u51B5\u5C31\u4E0D\u9002\u5408\u7528 <code>Parallel</code> \u94A9\u5B50\u4E86\uFF0C\u6BD4\u5982 <code>transform</code>\u3002</p><h5 id="sequential" tabindex="-1">Sequential <a class="header-anchor" href="#sequential" aria-hidden="true">#</a></h5><p><strong>Sequential</strong> \u6307\u4E32\u884C\u7684\u94A9\u5B50\u51FD\u6570\u3002\u8FD9\u79CD Hook \u5F80\u5F80\u9002\u7528\u4E8E\u63D2\u4EF6\u95F4\u5904\u7406\u7ED3\u679C\u76F8\u4E92\u4F9D\u8D56\u7684\u60C5\u51B5\uFF0C\u524D\u4E00\u4E2A\u63D2\u4EF6 Hook \u7684\u8FD4\u56DE\u503C\u4F5C\u4E3A\u540E\u7EED\u63D2\u4EF6\u7684\u5165\u53C2\uFF0C\u8FD9\u79CD\u60C5\u51B5\u5C31\u9700\u8981\u7B49\u5F85\u524D\u4E00\u4E2A\u63D2\u4EF6\u6267\u884C\u5B8C Hook\uFF0C\u83B7\u5F97\u5176\u6267\u884C\u7ED3\u679C\uFF0C\u7136\u540E\u624D\u80FD\u8FDB\u884C\u4E0B\u4E00\u4E2A\u63D2\u4EF6\u76F8\u5E94 Hook \u7684\u8C03\u7528\uFF0C\u5982<code>transform</code>\u3002</p><h5 id="frist" tabindex="-1">Frist <a class="header-anchor" href="#frist" aria-hidden="true">#</a></h5><p>\u5982\u679C\u6709\u591A\u4E2A\u63D2\u4EF6\u5B9E\u73B0\u4E86\u8FD9\u4E2A Hook\uFF0C\u90A3\u4E48 Hook \u5C06\u4F9D\u6B21\u8FD0\u884C\uFF0C\u76F4\u5230\u8FD4\u56DE\u4E00\u4E2A\u975E null \u6216\u975E undefined \u7684\u503C\u4E3A\u6B62\u3002\u6BD4\u8F83\u5178\u578B\u7684 Hook \u662F <code>resolveId</code>\uFF0C\u4E00\u65E6\u6709\u63D2\u4EF6\u7684 resolveId \u8FD4\u56DE\u4E86\u4E00\u4E2A\u8DEF\u5F84\uFF0C\u5C06\u505C\u6B62\u6267\u884C\u540E\u7EED\u63D2\u4EF6\u7684 resolveId \u903B\u8F91\u3002</p><p>\u521A\u521A\u6211\u4EEC\u4ECB\u7ECD\u4E86 Rollup \u5F53\u4E2D\u4E0D\u540C\u63D2\u4EF6 Hook \u7684\u7C7B\u578B\uFF0C\u5B9E\u9645\u4E0A\u4E0D\u540C\u7684\u7C7B\u578B\u662F\u53EF\u4EE5\u53E0\u52A0\u7684\uFF0C<code>Async</code>/<code>Sync</code> \u53EF\u4EE5\u642D\u914D\u540E\u9762\u4E09\u79CD\u7C7B\u578B\u4E2D\u7684\u4EFB\u610F\u4E00\u79CD\uFF0C\u6BD4\u5982\u4E00\u4E2A Hook\u65E2\u53EF\u4EE5\u662F <code>Async</code> \u4E5F\u53EF\u4EE5\u662F <code>First</code> \u7C7B\u578B\uFF0C\u63A5\u7740\u6211\u4EEC\u5C06\u6765\u5177\u4F53\u5206\u6790 Rollup \u5F53\u4E2D\u7684\u63D2\u4EF6\u5DE5\u4F5C\u6D41\u7A0B\uFF0C\u91CC\u9762\u4F1A\u6D89\u53CA\u5230\u5177\u4F53\u7684\u4E00\u4E9B Hook\uFF0C\u5927\u5BB6\u53EF\u4EE5\u5177\u4F53\u5730\u611F\u53D7\u4E00\u4E0B\u3002</p><h4 id="build-\u9636\u6BB5\u5DE5\u4F5C\u6D41" tabindex="-1">Build \u9636\u6BB5\u5DE5\u4F5C\u6D41 <a class="header-anchor" href="#build-\u9636\u6BB5\u5DE5\u4F5C\u6D41" aria-hidden="true">#</a></h4><p>\u9996\u5148\uFF0C\u6211\u4EEC\u6765\u5206\u6790 Build \u9636\u6BB5\u7684\u63D2\u4EF6\u5DE5\u4F5C\u6D41\u7A0B\u3002\u5BF9\u4E8E Build \u9636\u6BB5\uFF0C\u63D2\u4EF6 Hook \u7684\u8C03\u7528\u6D41\u7A0B\u5982\u4E0B\u56FE\u6240\u793A\u3002\u6D41\u7A0B\u56FE\u7684\u6700\u4E0A\u9762\u58F0\u660E\u4E86\u4E0D\u540C Hook \u7684\u7C7B\u578B\uFF0C\u4E5F\u5C31\u662F\u6211\u4EEC\u5728\u4E0A\u9762\u603B\u7ED3\u7684 5 \u79CD Hook \u5206\u7C7B\uFF0C\u6BCF\u4E2A\u65B9\u5757\u4EE3\u8868\u4E86\u4E00\u4E2A Hook\uFF0C\u8FB9\u6846\u7684\u989C\u8272\u53EF\u4EE5\u8868\u793A<code>Async</code>\u548C<code>Sync</code> \u7C7B\u578B\uFF0C\u65B9\u5757\u7684\u586B\u5145\u989C\u8272\u53EF\u4EE5\u8868\u793A <code>Parallel</code>\u3001<code>Sequential</code> \u548C <code>First</code> \u7C7B\u578B\u3002</p><img src="`+V+'" style="zoom:40%;"><p>\u4E4D\u4E00\u770B\u662F\u4E0D\u662F\u611F\u89C9\u8FD9\u5F20\u56FE\u975E\u5E38\u590D\u6742\uFF1F\u6CA1\u5173\u7CFB\uFF0C\u63A5\u4E0B\u6765\u6211\u4F1A\u548C\u4F60\u4E00\u6B65\u6B65\u5206\u6790 <code>Build Hooks</code> \u7684\u5DE5\u4F5C\u6D41\u7A0B\uFF0C\u4F60\u53EF\u4EE5\u5BF9\u7167\u7740\u56FE\u4E00\u8D77\u770B\u3002</p><ol><li>\u9996\u5148\u7ECF\u5386 <code>options</code> \u94A9\u5B50\u8FDB\u884C\u914D\u7F6E\u7684\u8F6C\u6362\uFF0C\u5F97\u5230\u5904\u7406\u540E\u7684\u914D\u7F6E\u5BF9\u8C61\u3002</li><li>\u968F\u4E4B Rollup \u4F1A\u8C03\u7528<code>buildStart</code>\u94A9\u5B50\uFF0C\u6B63\u5F0F\u5F00\u59CB\u6784\u5EFA\u6D41\u7A0B\u3002</li><li>Rollup \u5148\u8FDB\u5165\u5230 <code>resolveId</code> \u94A9\u5B50\u4E2D\u89E3\u6790\u6587\u4EF6\u8DEF\u5F84\u3002(\u4ECE <code>input</code> \u914D\u7F6E\u6307\u5B9A\u7684\u5165\u53E3\u6587\u4EF6\u5F00\u59CB)\u3002</li><li>Rollup \u901A\u8FC7\u8C03\u7528<code>load</code>\u94A9\u5B50\u52A0\u8F7D\u6A21\u5757\u5185\u5BB9\u3002</li><li>\u7D27\u63A5\u7740 Rollup \u6267\u884C\u6240\u6709\u7684 <code>transform</code> \u94A9\u5B50\u6765\u5BF9\u6A21\u5757\u5185\u5BB9\u8FDB\u884C\u8FDB\u884C\u81EA\u5B9A\u4E49\u7684\u8F6C\u6362\uFF0C\u6BD4\u5982 babel \u8F6C\u8BD1\u3002</li><li>\u73B0\u5728 Rollup \u62FF\u5230\u6700\u540E\u7684\u6A21\u5757\u5185\u5BB9\uFF0C\u8FDB\u884C AST \u5206\u6790\uFF0C\u5F97\u5230\u6240\u6709\u7684 import \u5185\u5BB9\uFF0C\u8C03\u7528 moduleParsed \u94A9\u5B50: <ul><li>6.1 \u5982\u679C\u662F\u666E\u901A\u7684 import\uFF0C\u5219\u6267\u884C <code>resolveId</code> \u94A9\u5B50\uFF0C\u7EE7\u7EED\u56DE\u5230\u6B65\u9AA4<code>3</code>\u3002</li><li>6.2 \u5982\u679C\u662F\u52A8\u6001 import\uFF0C\u5219\u6267\u884C <code>resolveDynamicImport</code> \u94A9\u5B50\u89E3\u6790\u8DEF\u5F84\uFF0C\u5982\u679C\u89E3\u6790\u6210\u529F\uFF0C\u5219\u56DE\u5230\u6B65\u9AA4<code>4</code>\u52A0\u8F7D\u6A21\u5757\uFF0C\u5426\u5219\u56DE\u5230\u6B65\u9AA4<code>3</code>\u901A\u8FC7 <code>resolveId</code> \u89E3\u6790\u8DEF\u5F84\u3002</li></ul></li><li>\u76F4\u5230\u6240\u6709\u7684 import \u90FD\u89E3\u6790\u5B8C\u6BD5\uFF0CRollup \u6267\u884C<code>buildEnd</code>\u94A9\u5B50\uFF0CBuild \u9636\u6BB5\u7ED3\u675F\u3002</li></ol><p>\u5F53\u7136\uFF0C\u5728 Rollup \u89E3\u6790\u8DEF\u5F84\u7684\u65F6\u5019\uFF0C\u5373\u6267\u884C <code>resolveId</code> \u6216\u8005 <code>resolveDynamicImport</code> \u7684\u65F6\u5019\uFF0C\u6709\u4E9B\u8DEF\u5F84\u53EF\u80FD\u4F1A\u88AB\u6807\u8BB0\u4E3A <code>external</code>(\u7FFB\u8BD1\u4E3A<code>\u6392\u9664</code>)\uFF0C\u4E5F\u5C31\u662F\u8BF4\u4E0D\u53C2\u52A0 Rollup \u6253\u5305\u8FC7\u7A0B\uFF0C\u8FD9\u4E2A\u65F6\u5019\u5C31\u4E0D\u4F1A\u8FDB\u884C <code>load</code>\u3001<code>transform </code> \u7B49\u7B49\u540E\u7EED\u7684\u5904\u7406\u4E86\u3002</p><p>\u5728\u6D41\u7A0B\u56FE\u6700\u4E0A\u9762\uFF0C\u4E0D\u77E5\u9053\u5927\u5BB6\u6709\u6CA1\u6709\u6CE8\u610F\u5230 <code>watchChange</code> \u548C <code>closeWatcher</code> \u8FD9\u4E24\u4E2A Hook\uFF0C\u8FD9\u91CC\u5176\u5B9E\u662F\u5BF9\u5E94\u4E86 rollup \u7684 <code>watch</code> \u6A21\u5F0F\u3002\u5F53\u4F60\u4F7F\u7528 <code>rollup --watch</code> \u6307\u4EE4\u6216\u8005\u5728\u914D\u7F6E\u6587\u4EF6\u914D\u6709 <code>watch: true</code> \u7684\u5C5E\u6027\u65F6\uFF0C\u4EE3\u8868\u5F00\u542F\u4E86 Rollup \u7684 <code>watch</code> \u6253\u5305\u6A21\u5F0F\uFF0C\u8FD9\u4E2A\u65F6\u5019 Rollup \u5185\u90E8\u4F1A\u521D\u59CB\u5316\u4E00\u4E2A <code>watcher</code> \u5BF9\u8C61\uFF0C\u5F53\u6587\u4EF6\u5185\u5BB9\u53D1\u751F\u53D8\u5316\u65F6\uFF0Cwatcher \u5BF9\u8C61\u4F1A\u81EA\u52A8\u89E6\u53D1 <code>watchChange</code> \u94A9\u5B50\u6267\u884C\u5E76\u5BF9\u9879\u76EE\u8FDB\u884C\u91CD\u65B0\u6784\u5EFA\u3002\u5728\u5F53\u524D<strong>\u6253\u5305\u8FC7\u7A0B\u7ED3\u675F</strong>\u65F6\uFF0CRollup \u4F1A\u81EA\u52A8\u6E05\u9664 watcher \u5BF9\u8C61\u8C03\u7528 <code>closeWatcher</code> \u94A9\u5B50\u3002</p><h4 id="output-\u5DE5\u4F5C\u6D41" tabindex="-1">Output \u5DE5\u4F5C\u6D41 <a class="header-anchor" href="#output-\u5DE5\u4F5C\u6D41" aria-hidden="true">#</a></h4><p>\u63A5\u7740\u6211\u4EEC\u6765\u770B\u770B Output \u9636\u6BB5\u7684\u63D2\u4EF6\u5230\u5E95\u662F\u5982\u4F55\u6765\u8FDB\u884C\u5DE5\u4F5C\u7684\u3002\u8FD9\u4E2A\u9636\u6BB5\u7684 Hook \u76F8\u6BD4\u4E8E Build \u9636\u6BB5\u7A0D\u5FAE\u591A\u4E00\u4E9B\uFF0C\u6D41\u7A0B\u4E0A\u4E5F\u66F4\u52A0\u590D\u6742\u3002\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u5176\u4E2D\u4F1A\u6D89\u53CA\u7684 Hook \u51FD\u6570\u6BD4\u8F83\u591A\uFF0C\u53EF\u80FD\u4F1A\u7ED9\u4F60\u7406\u89E3\u6574\u4E2A\u6D41\u7A0B\u5E26\u6765\u4E00\u4E9B\u56F0\u6270\uFF0C\u56E0\u6B64\u6211\u4F1A\u5728 Hook \u6267\u884C\u7684\u9636\u6BB5\u89E3\u91CA\u5176\u5927\u81F4\u7684\u4F5C\u7528\u548C\u610F\u4E49\uFF0C\u5173\u4E8E\u5177\u4F53\u7684\u4F7F\u7528\u5927\u5BB6\u53EF\u4EE5\u53BB Rollup \u7684\u5B98\u7F51\u81EA\u884C\u67E5\u9605\uFF0C\u6BD5\u7ADF\u8FD9\u91CC\u7684\u4E3B\u7EBF\u8FD8\u662F\u5206\u6790\u63D2\u4EF6\u7684\u6267\u884C\u6D41\u7A0B\uFF0C\u63BA\u6742\u592A\u591A\u7684\u4F7F\u7528\u7EC6\u8282\u53CD\u800C\u4E0D\u6613\u4E8E\u7406\u89E3\u3002\u4E0B\u9762\u6211\u7ED3\u5408\u4E00\u5F20\u5B8C\u6574\u7684\u63D2\u4EF6\u6D41\u7A0B\u56FE\u548C\u4F60\u5177\u4F53\u5206\u6790\u4E00\u4E0B\u3002</p><img src="'+R+'" style="zoom:60%;"><ol><li>\u6267\u884C\u6240\u6709\u63D2\u4EF6\u7684 <code>outputOptions</code> \u94A9\u5B50\u51FD\u6570\uFF0C\u5BF9 <code>output</code> \u914D\u7F6E\u8FDB\u884C\u8F6C\u6362\u3002</li><li>\u6267\u884C <code>renderStart</code>\uFF0C\u5E76\u53D1\u6267\u884C renderStart \u94A9\u5B50\uFF0C\u6B63\u5F0F\u5F00\u59CB\u6253\u5305\u3002</li><li>\u5E76\u53D1\u6267\u884C\u6240\u6709\u63D2\u4EF6\u7684 <code>banner</code>\u3001<code>footer</code>\u3001<code>intro</code>\u3001<code>outro</code> \u94A9\u5B50(\u5E95\u5C42\u7528 Promise.all \u5305\u88F9\u6240\u6709\u7684\u8FD9\u56DB\u79CD\u94A9\u5B50\u51FD\u6570)\uFF0C\u8FD9\u56DB\u4E2A\u94A9\u5B50\u529F\u80FD\u5F88\u7B80\u5355\uFF0C\u5C31\u662F\u5F80\u6253\u5305\u4EA7\u7269\u7684\u56FA\u5B9A\u4F4D\u7F6E(\u6BD4\u5982\u5934\u90E8\u548C\u5C3E\u90E8)\u63D2\u5165\u4E00\u4E9B\u81EA\u5B9A\u4E49\u7684\u5185\u5BB9\uFF0C\u6BD4\u5982\u534F\u8BAE\u58F0\u660E\u5185\u5BB9\u3001\u9879\u76EE\u4ECB\u7ECD\u7B49\u7B49\u3002</li><li>\u4ECE\u5165\u53E3\u6A21\u5757\u5F00\u59CB\u626B\u63CF\uFF0C\u9488\u5BF9\u52A8\u6001 import \u8BED\u53E5\u6267\u884C <code>renderDynamicImport </code>\u94A9\u5B50\uFF0C\u6765\u81EA\u5B9A\u4E49\u52A8\u6001 import \u7684\u5185\u5BB9\u3002</li><li>\u5BF9\u6BCF\u4E2A\u5373\u5C06\u751F\u6210\u7684 <code>chunk</code>\uFF0C\u6267\u884C <code>augmentChunkHash</code> \u94A9\u5B50\uFF0C\u6765\u51B3\u5B9A\u662F\u5426\u66F4\u6539 chunk \u7684\u54C8\u5E0C\u503C\uFF0C\u5728 <code>watch</code> \u6A21\u5F0F\u4E0B\u5373\u53EF\u80FD\u4F1A\u591A\u6B21\u6253\u5305\u7684\u573A\u666F\u4E0B\uFF0C\u8FD9\u4E2A\u94A9\u5B50\u4F1A\u6BD4\u8F83\u9002\u7528\u3002</li><li>\u5982\u679C\u6CA1\u6709\u9047\u5230 <code>i<wbr>mport.meta</code> \u8BED\u53E5\uFF0C\u5219\u8FDB\u5165\u4E0B\u4E00\u6B65\uFF0C\u5426\u5219: <ul><li><strong>6.1</strong> \u5BF9\u4E8E <code>i<wbr>mport.meta.url</code> \u8BED\u53E5\u8C03\u7528 <code>resolveFileUrl</code> \u6765\u81EA\u5B9A\u4E49 url \u89E3\u6790\u903B\u8F91</li><li><strong>6.2</strong> \u5BF9\u4E8E\u5176\u4ED6 <code>i<wbr>mport.meta</code> \u5C5E\u6027\uFF0C\u5219\u8C03\u7528 <code>resolveImportMeta</code> \u6765\u8FDB\u884C\u81EA\u5B9A\u4E49\u7684\u89E3\u6790\u3002</li></ul></li><li>\u63A5\u7740 Rollup \u4F1A\u751F\u6210\u6240\u6709 chunk \u7684\u5185\u5BB9\uFF0C\u9488\u5BF9\u6BCF\u4E2A chunk \u4F1A\u4F9D\u6B21\u8C03\u7528\u63D2\u4EF6\u7684 <code>renderChunk</code> \u65B9\u6CD5\u8FDB\u884C\u81EA\u5B9A\u4E49\u64CD\u4F5C\uFF0C\u4E5F\u5C31\u662F\u8BF4\uFF0C\u5728\u8FD9\u91CC\u65F6\u5019\u4F60\u53EF\u4EE5\u76F4\u63A5\u64CD\u4F5C\u6253\u5305\u4EA7\u7269\u4E86\u3002</li><li>\u968F\u540E\u4F1A\u8C03\u7528 <code>generateBundle</code> \u94A9\u5B50\uFF0C\u8FD9\u4E2A\u94A9\u5B50\u7684\u5165\u53C2\u91CC\u9762\u4F1A\u5305\u542B\u6240\u6709\u7684\u6253\u5305\u4EA7\u7269\u4FE1\u606F\uFF0C\u5305\u62EC <code>chunk</code> (\u6253\u5305\u540E\u7684\u4EE3\u7801)\u3001<code>asset </code>(\u6700\u7EC8\u7684\u9759\u6001\u8D44\u6E90\u6587\u4EF6)\u3002\u4F60\u53EF\u4EE5\u5728\u8FD9\u91CC\u5220\u9664\u4E00\u4E9B chunk \u6216\u8005 asset\uFF0C\u6700\u7EC8\u8FD9\u4E9B\u5185\u5BB9\u5C06\u4E0D\u4F1A\u4F5C\u4E3A\u4EA7\u7269\u8F93\u51FA\u3002</li><li>\u524D\u9762\u63D0\u5230\u4E86 <code>rollup.rollup </code>\u65B9\u6CD5\u4F1A\u8FD4\u56DE\u4E00\u4E2A <code>bundle</code> \u5BF9\u8C61\uFF0C\u8FD9\u4E2A\u5BF9\u8C61\u662F\u5305\u542B <code>generate</code> \u548C <code>write</code> \u4E24\u4E2A\u65B9\u6CD5\uFF0C\u4E24\u4E2A\u65B9\u6CD5\u552F\u4E00\u7684\u533A\u522B\u5728\u4E8E\u540E\u8005\u4F1A\u5C06\u4EE3\u7801\u5199\u5165\u5230\u78C1\u76D8\u4E2D\uFF0C\u540C\u65F6\u4F1A\u89E6\u53D1 <code>writeBundle</code> \u94A9\u5B50\uFF0C\u4F20\u5165\u6240\u6709\u7684\u6253\u5305\u4EA7\u7269\u4FE1\u606F\uFF0C\u5305\u62EC chunk \u548C asset\uFF0C\u548C <code>generateBundle </code> \u94A9\u5B50\u975E\u5E38\u76F8\u4F3C\u3002\u4E0D\u8FC7\u503C\u5F97\u6CE8\u610F\u7684\u662F\uFF0C\u8FD9\u4E2A\u94A9\u5B50\u6267\u884C\u7684\u65F6\u5019\uFF0C\u4EA7\u7269\u5DF2\u7ECF\u8F93\u51FA\u4E86\uFF0C\u800C <code>generateBundle</code> \u6267\u884C\u7684\u65F6\u5019\u4EA7\u7269\u8FD8\u5E76\u6CA1\u6709\u8F93\u51FA\u3002\u987A\u5E8F\u5982\u4E0B\u56FE\u6240\u793A:</li></ol><img src="'+w+`"><ol start="10"><li>\u5F53\u4E0A\u8FF0\u7684 <code>bundle</code> \u7684 <code>close</code> \u65B9\u6CD5\u88AB\u8C03\u7528\u65F6\uFF0C\u4F1A\u89E6\u53D1 <code>closeBundle</code> \u94A9\u5B50\uFF0C\u5230\u8FD9\u91CC Output \u9636\u6BB5\u6B63\u5F0F\u7ED3\u675F\u3002</li></ol><blockquote><p>\u6CE8\u610F: \u5F53\u6253\u5305\u8FC7\u7A0B\u4E2D\u4EFB\u4F55\u9636\u6BB5\u51FA\u73B0\u9519\u8BEF\uFF0C\u4F1A\u89E6\u53D1 renderError \u94A9\u5B50\uFF0C\u7136\u540E\u6267\u884C closeBundle \u94A9\u5B50\u7ED3\u675F\u6253\u5305\u3002</p></blockquote><p>\u5230\u8FD9\u91CC\uFF0C\u6211\u4EEC\u7EC8\u4E8E\u68B3\u7406\u5B8C\u4E86 Rollup \u5F53\u4E2D\u5B8C\u6574\u7684\u63D2\u4EF6\u5DE5\u4F5C\u6D41\u7A0B\uFF0C\u4ECE\u4E00\u5F00\u59CB\u5728<strong>\u6784\u5EFA\u751F\u547D\u5468\u671F</strong>\u4E2D\u5BF9\u4E24\u5927\u6784\u5EFA\u9636\u6BB5\u7684\u611F\u6027\u8BA4\u8BC6\uFF0C\u5230\u73B0\u5728<strong>\u63D2\u4EF6\u5DE5\u4F5C\u6D41</strong>\u7684\u5177\u4F53\u5206\u6790\uFF0C\u4E0D\u7981\u611F\u53F9 Rollup \u770B\u4F3C\u7B80\u5355\uFF0C\u5B9E\u5219\u5185\u90E8\u7EC6\u8282\u7E41\u6742\u3002\u5E0C\u671B\u4F60\u80FD\u5BF9\u7167\u6D41\u7A0B\u56FE\u597D\u597D\u590D\u4E60\u51E0\u904D\uFF0C\u5F7B\u5E95\u6D88\u5316\u8FD9\u90E8\u5206\u7684\u77E5\u8BC6\u70B9\uFF0C\u4E0D\u4EC5\u4EC5\u80FD\u52A0\u6DF1\u4F60\u5BF9 Rollup \u63D2\u4EF6\u673A\u5236\u7684\u7406\u89E3\uFF0C\u5E76\u4E14\u5BF9 Rollup \u672C\u8EAB\u6253\u5305\u539F\u7406\u7684\u638C\u63E1\u4E5F\u4F1A\u66F4\u4E0A\u4E00\u5C42\u697C\u3002</p><h3 id="\u5E38\u7528-hook-\u5B9E\u6218" tabindex="-1">\u5E38\u7528 hook \u5B9E\u6218 <a class="header-anchor" href="#\u5E38\u7528-hook-\u5B9E\u6218" aria-hidden="true">#</a></h3><p>\u8BFB\u5230\u8FD9\u91CC\u4F60\u53EF\u80FD\u4F1A\u8BF4\u4E86\uFF1A\u4E0A\u9762\u8BB2\u4E86\u90A3\u4E48\u591A Rollup \u63D2\u4EF6\u673A\u5236\u7684\u5185\u5BB9\uFF0C\u4F46\u771F\u6B63\u8981\u53BB\u5199\u4E00\u4E2A\u63D2\u4EF6\uFF0C\u611F\u89C9\u8FD8\u662F\u5F88\u56F0\u96BE\u554A\u3002</p><p>\u8FD9\u91CC\u6211\u60F3\u8981\u5206\u4EAB\u4E24\u4E2A\u89C2\u70B9\uFF1A\u9996\u5148\u662F<strong>\u4E8C\u516B\u5B9A\u5F8B</strong>\uFF0C\u4E5F\u5C31\u662F 20% \u7684 API \u5E94\u5BF9 80% \u7684\u573A\u666F\uFF0C\u8FD9\u653E\u5728 Rollup \u5F53\u4E2D\u4ECD\u7136\u662F\u9002\u7528\u7684\u3002\u7ECF\u5E38\u4F7F\u7528\u5230\u7684 Hook \u4E5F\u5E76\u4E0D\u591A\uFF0C\u51B5\u4E14 Rollup \u63D2\u4EF6\u7684\u5199\u6CD5\u4E5F\u975E\u5E38\u7B80\u5355\uFF0C\u81F3\u5C11\u6BD4 Webpack \u63D2\u4EF6\u8981\u5BB9\u6613\u7684\u591A\uFF0C\u56E0\u6B64\u638C\u63E1 Rollup \u7684\u63D2\u4EF6\u5F00\u53D1\u96BE\u5EA6\u5E76\u4E0D\u5927\uFF0C\u8FD9\u4E2A\u5927\u5BB6\u653E\u5FC3\u3002</p><p>\u5176\u6B21\uFF0C<strong>\u5B66\u4F1A\u6A21\u4EFF</strong>\u4E5F\u7279\u522B\u91CD\u8981\u3002\u5C24\u5176\u662F\u521A\u5F00\u59CB\u4EC0\u4E48\u7ECF\u9A8C\u90FD\u6CA1\u6709\u7684\u65F6\u5019\uFF0C\u89C2\u5BDF\u548C\u6A21\u4EFF\u522B\u4EBA\u4F18\u79C0\u7684\u5B9E\u73B0\u4E0D\u5931\u4E3A\u4E00\u79CD\u9AD8\u6548\u7684\u5B66\u4E60\u65B9\u6CD5\uFF0C\u6162\u6162\u5730\u81EA\u5DF1\u4E5F\u4F1A\u8F7B\u8F66\u719F\u8DEF\uFF0C\u6210\u4E3A\u4E00\u4E2A\u7ECF\u9A8C\u4E30\u5BCC\u7684\u8001\u53F8\u673A\u3002</p><p>\u5B9E\u9645\u4E0A\u5F00\u53D1 Rollup \u63D2\u4EF6\u5C31\u662F\u5728\u7F16\u5199\u4E00\u4E2A\u4E2A Hook \u51FD\u6570\uFF0C\u4F60\u53EF\u4EE5\u7406\u89E3\u4E3A\u4E00\u4E2A Rollup \u63D2\u4EF6\u57FA\u672C\u5C31\u662F\u5404\u79CD Hook \u51FD\u6570\u7684\u7EC4\u5408\u3002\u56E0\u6B64\uFF0C\u63A5\u4E0B\u6765\u6211\u4F1A\u8BE6\u7EC6\u4ECB\u7ECD\u4E00\u4E9B\u5E38\u7528\u7684 Hook\uFF0C\u5E76\u4EE5\u4E00\u4E9B\u5B98\u65B9\u7684\u63D2\u4EF6\u5B9E\u73B0\u4E3A\u4F8B\uFF0C\u4ECE Hook \u7684\u7279\u6027\u3001\u5E94\u7528\u573A\u666F\u3001\u5165\u53C2\u548C\u8FD4\u56DE\u503C\u7684\u610F\u4E49\u53CA\u5B9E\u73B0\u4EE3\u7801\u793A\u4F8B\u8FD9\u51E0\u4E2A\u89D2\u5EA6\u5E26\u4F60\u638C\u63E1\u5404\u79CD Hook \u5B9E\u9645\u7684\u4F7F\u7528\uFF0C\u5982\u6B64\u4E00\u6765\uFF0C\u5F00\u53D1\u4E00\u4E2A\u5B8C\u6574\u7684\u63D2\u4EF6\u5BF9\u4F60\u6765\u8BF4\u60F3\u5FC5\u4E5F\u4E0D\u5728\u8BDD\u4E0B\u4E86\u3002</p><h4 id="\u8DEF\u5F84\u89E3\u6790\uFF1Aresolveid" tabindex="-1">\u8DEF\u5F84\u89E3\u6790\uFF1AresolveId <a class="header-anchor" href="#\u8DEF\u5F84\u89E3\u6790\uFF1Aresolveid" aria-hidden="true">#</a></h4><p>resolveId \u94A9\u5B50\u4E00\u822C\u7528\u6765\u89E3\u6790\u6A21\u5757\u8DEF\u5F84\uFF0C\u4E3A <code>Async + First</code> \u7C7B\u578B\u5373<code>\u5F02\u6B65\u4F18\u5148</code>\u7684\u94A9\u5B50\u3002</p><p>\u8FD9\u91CC\u6211\u4EEC\u62FF\u5B98\u65B9\u7684 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Frollup%2Fplugins%2Fblob%2Fmaster%2Fpackages%2Falias%2Fsrc%2Findex.ts" target="_blank" rel="noreferrer">alias \u63D2\u4EF6</a> \u6765\u8BF4\u660E\uFF0C\u8FD9\u4E2A\u63D2\u4EF6\u7528\u6CD5\u6F14\u793A\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// rollup.config.js</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> alias </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@rollup/plugin-alias</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">input</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src/index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">output</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">dir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">output</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">format</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cjs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">alias</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">entries</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u5C06\u628A import xxx from &#39;module-a&#39; </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u8F6C\u6362\u4E3A import xxx from &#39;./module-a&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">find</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">module-a</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">replacement</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./module-a.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">      ]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>\u63D2\u4EF6\u7684\u4EE3\u7801\u7B80\u5316\u540E\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">alias</span><span style="color:#A6ACCD;">(options) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u83B7\u53D6 entries \u914D\u7F6E</span></span>
<span class="line"><span style="color:#A6ACCD;">  const entries </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getEntries</span><span style="color:#A6ACCD;">(options);</span></span>
<span class="line"><span style="color:#A6ACCD;">  return {</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u4F20\u5165\u4E09\u4E2A\u53C2\u6570\uFF0C\u5F53\u524D\u6A21\u5757\u8DEF\u5F84\u3001\u5F15\u7528\u5F53\u524D\u6A21\u5757\u7684\u6A21\u5757\u8DEF\u5F84\u3001\u5176\u4F59\u53C2\u6570</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">resolveId</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">importee</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">importer</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">resolveOptions</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u5148\u68C0\u67E5\u80FD\u4E0D\u80FD\u5339\u914D\u522B\u540D\u89C4\u5219</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">matchedEntry</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">entries</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">find</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">entry</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">matches</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">entry</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">find</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">importee</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u5982\u679C\u4E0D\u80FD\u5339\u914D\u66FF\u6362\u89C4\u5219\uFF0C\u6216\u8005\u5F53\u524D\u6A21\u5757\u662F\u5165\u53E3\u6A21\u5757\uFF0C\u5219\u4E0D\u4F1A\u7EE7\u7EED\u540E\u9762\u7684\u522B\u540D\u66FF\u6362\u6D41\u7A0B</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">matchedEntry</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">importerId</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// return null \u540E\uFF0C\u5F53\u524D\u7684\u6A21\u5757\u8DEF\u5F84\u4F1A\u4EA4\u7ED9\u4E0B\u4E00\u4E2A\u63D2\u4EF6\u5904\u7406</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u6B63\u5F0F\u66FF\u6362\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">updatedId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">normalizeId</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">importee</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">matchedEntry</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">find</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">matchedEntry</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">replacement</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u6BCF\u4E2A\u63D2\u4EF6\u6267\u884C\u65F6\u90FD\u4F1A\u7ED1\u5B9A\u4E00\u4E2A\u4E0A\u4E0B\u6587\u5BF9\u8C61\u4F5C\u4E3A this</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u8FD9\u91CC\u7684 this.resolve \u4F1A\u6267\u884C\u6240\u6709\u63D2\u4EF6(\u9664\u5F53\u524D\u63D2\u4EF6\u5916)\u7684 resolveId \u94A9\u5B50</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">updatedId</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">importer</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">assign</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> skipSelf</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolveOptions</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      )</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">resolved</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u66FF\u6362\u540E\u7684\u8DEF\u5F84\u5373 updateId \u4F1A\u7ECF\u8FC7\u522B\u7684\u63D2\u4EF6\u8FDB\u884C\u5904\u7406</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">finalResult</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">PartialResolvedId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolved</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">finalResult</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;">// \u5982\u679C\u5176\u5B83\u63D2\u4EF6\u6CA1\u6709\u5904\u7406\u8FD9\u4E2A\u8DEF\u5F84\uFF0C\u5219\u76F4\u63A5\u8FD4\u56DE updateId</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">finalResult</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">updatedId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">finalResult</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>\u4ECE\u8FD9\u91CC\u4F60\u53EF\u4EE5\u770B\u5230 resolveId \u94A9\u5B50\u51FD\u6570\u7684\u4E00\u4E9B\u5E38\u7528\u4F7F\u7528\u65B9\u5F0F\uFF0C\u5B83\u7684\u5165\u53C2\u5206\u522B\u662F<code>\u5F53\u524D\u6A21\u5757\u8DEF\u5F84</code>\u3001<code>\u5F15\u7528\u5F53\u524D\u6A21\u5757\u7684\u6A21\u5757\u8DEF\u5F84</code>\u3001<code>\u89E3\u6790\u53C2\u6570</code>\uFF0C\u8FD4\u56DE\u503C\u53EF\u4EE5\u662F null\u3001string \u6216\u8005\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u6211\u4EEC\u5206\u60C5\u51B5\u8BA8\u8BBA\u3002</p><ul><li>\u8FD4\u56DE\u503C\u4E3A null \u65F6\uFF0C\u4F1A\u9ED8\u8BA4\u4EA4\u7ED9\u4E0B\u4E00\u4E2A\u63D2\u4EF6\u7684 resolveId \u94A9\u5B50\u5904\u7406\u3002</li><li>\u8FD4\u56DE\u503C\u4E3A string \u65F6\uFF0C\u5219\u505C\u6B62\u540E\u7EED\u63D2\u4EF6\u7684\u5904\u7406\u3002\u8FD9\u91CC\u4E3A\u4E86\u8BA9\u66FF\u6362\u540E\u7684\u8DEF\u5F84\u80FD\u88AB\u5176\u4ED6\u63D2\u4EF6\u5904\u7406\uFF0C\u7279\u610F\u8C03\u7528\u4E86 this.resolve \u6765\u4EA4\u7ED9\u5176\u5B83\u63D2\u4EF6\u5904\u7406\uFF0C\u5426\u5219\u5C06\u4E0D\u4F1A\u8FDB\u5165\u5230\u5176\u5B83\u63D2\u4EF6\u7684\u5904\u7406\u3002</li><li>\u8FD4\u56DE\u503C\u4E3A\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u4E5F\u4F1A\u505C\u6B62\u540E\u7EED\u63D2\u4EF6\u7684\u5904\u7406\uFF0C\u4E0D\u8FC7\u8FD9\u4E2A\u5BF9\u8C61\u5C31\u53EF\u4EE5\u5305\u542B<a href="https://link.juejin.cn/?target=https%3A%2F%2Frollupjs.org%2Fguide%2Fen%2F%23resolveid" target="_blank" rel="noreferrer">\u66F4\u591A\u7684\u4FE1\u606F</a>\u4E86\uFF0C\u5305\u62EC\u89E3\u6790\u540E\u7684\u8DEF\u5F84\u3001\u662F\u5426\u88AB enternal\u3001\u662F\u5426\u9700\u8981 tree-shaking \u7B49\u7B49\uFF0C\u4E0D\u8FC7\u5927\u90E8\u5206\u60C5\u51B5\u4E0B\u8FD4\u56DE\u4E00\u4E2A string \u5C31\u591F\u7528\u4E86\u3002</li></ul><h4 id="load" tabindex="-1">load <a class="header-anchor" href="#load" aria-hidden="true">#</a></h4><p>load \u4E3A<code>Async + First</code>\u7C7B\u578B\uFF0C\u5373<strong>\u5F02\u6B65\u4F18\u5148</strong>\u7684\u94A9\u5B50\uFF0C\u548C<code>resolveId</code>\u7C7B\u4F3C\u3002\u5B83\u7684\u4F5C\u7528\u662F\u901A\u8FC7 resolveId \u89E3\u6790\u540E\u7684\u8DEF\u5F84\u6765\u52A0\u8F7D\u6A21\u5757\u5185\u5BB9\u3002\u8FD9\u91CC\uFF0C\u6211\u4EEC\u4EE5\u5B98\u65B9\u7684 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Frollup%2Fplugins%2Fblob%2Fmaster%2Fpackages%2Fimage%2Fsrc%2Findex.js" target="_blank" rel="noreferrer">image \u63D2\u4EF6</a> \u4E3A\u4F8B\u6765\u4ECB\u7ECD\u4E00\u4E0B load \u94A9\u5B50\u7684\u4F7F\u7528\u3002\u6E90\u7801\u7B80\u5316\u540E\u5982\u4E0B\u6240\u793A:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> mimeTypes </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">.jpg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">image/jpeg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u540E\u9762\u56FE\u7247\u7C7B\u578B\u7701\u7565</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">image</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">opts</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{})</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">assign</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{},</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defaults</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">opts</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">image</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    load</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mime</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mimeTypes</span><span style="color:#F07178;">[</span><span style="color:#82AAFF;">extname</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">mime</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u5982\u679C\u4E0D\u662F\u56FE\u7247\u7C7B\u578B\uFF0C\u8FD4\u56DE null\uFF0C\u4EA4\u7ED9\u4E0B\u4E00\u4E2A\u63D2\u4EF6\u5904\u7406</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u52A0\u8F7D\u56FE\u7247\u5177\u4F53\u5185\u5BB9</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isSvg</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mime</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mimeTypes</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.svg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">format</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isSvg</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">base64</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">source</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">readFileSync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">format</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">/[</span><span style="color:#C3E88D;">\\r\\n</span><span style="color:#89DDFF;">]+/</span><span style="color:#F78C6C;">gm</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dataUri</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getDataUri</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">format</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isSvg</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mime</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">source</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">dom</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">domTemplate</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dataUri</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">constTemplate</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dataUri</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">trim</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u4ECE\u4E2D\u53EF\u4EE5\u770B\u5230\uFF0Cload \u94A9\u5B50\u7684\u5165\u53C2\u662F\u6A21\u5757 id\uFF0C\u8FD4\u56DE\u503C\u4E00\u822C\u662F null\u3001string \u6216\u8005\u4E00\u4E2A\u5BF9\u8C61\uFF1A</p><ul><li>\u5982\u679C\u8FD4\u56DE\u503C\u4E3A null\uFF0C\u5219\u4EA4\u7ED9\u4E0B\u4E00\u4E2A\u63D2\u4EF6\u5904\u7406\uFF1B</li><li>\u5982\u679C\u8FD4\u56DE\u503C\u4E3A string \u6216\u8005\u5BF9\u8C61\uFF0C\u5219\u7EC8\u6B62\u540E\u7EED\u63D2\u4EF6\u7684\u5904\u7406\uFF0C\u5982\u679C\u662F\u5BF9\u8C61\u53EF\u4EE5\u5305\u542B SourceMap\u3001AST \u7B49<a href="https://link.juejin.cn/?target=https%3A%2F%2Frollupjs.org%2Fguide%2Fen%2F%23load" target="_blank" rel="noreferrer">\u66F4\u8BE6\u7EC6\u7684\u4FE1\u606F</a>\u3002</li></ul><h4 id="\u4EE3\u7801\u8F6C\u6362\uFF1Atransform" tabindex="-1">\u4EE3\u7801\u8F6C\u6362\uFF1Atransform <a class="header-anchor" href="#\u4EE3\u7801\u8F6C\u6362\uFF1Atransform" aria-hidden="true">#</a></h4><p><code>transform</code> \u94A9\u5B50\u4E5F\u662F\u975E\u5E38\u5E38\u89C1\u7684\u4E00\u4E2A\u94A9\u5B50\u51FD\u6570\uFF0C\u4E3A <code>Async + Sequential</code> \u7C7B\u578B\uFF0C\u4E5F\u5C31\u662F<code>\u5F02\u6B65\u4E32\u884C</code>\u94A9\u5B50\uFF0C\u4F5C\u7528\u662F\u5BF9\u52A0\u8F7D\u540E\u7684\u6A21\u5757\u5185\u5BB9\u8FDB\u884C\u81EA\u5B9A\u4E49\u7684\u8F6C\u6362\u3002\u6211\u4EEC\u4EE5\u5B98\u65B9\u7684 <code>replace</code> \u63D2\u4EF6\u4E3A\u4F8B\uFF0C\u8FD9\u4E2A\u63D2\u4EF6\u7684\u4F7F\u7528\u65B9\u5F0F\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// rollup.config.js</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> replace </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@rollup/plugin-replace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">input</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src/index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">output</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">dir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">output</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">format</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cjs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u5C06\u4F1A\u628A\u4EE3\u7801\u4E2D\u6240\u6709\u7684 __TEST__ \u66FF\u6362\u4E3A 1</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">replace</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">__TEST__</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>\u5185\u90E8\u5B9E\u73B0\u4E5F\u5E76\u4E0D\u590D\u6742\uFF0C\u4E3B\u8981\u901A\u8FC7\u5B57\u7B26\u4E32\u66FF\u6362\u6765\u5B9E\u73B0\uFF0C\u6838\u5FC3\u903B\u8F91\u7B80\u5316\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> MagicString </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">magic-string</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">replace</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">options</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{})</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">replace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    transform</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u7701\u7565\u4E00\u4E9B\u8FB9\u754C\u60C5\u51B5\u7684\u5904\u7406</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u6267\u884C\u4EE3\u7801\u66FF\u6362\u7684\u903B\u8F91\uFF0C\u5E76\u751F\u6210\u6700\u540E\u7684\u4EE3\u7801\u548C SourceMap</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">executeReplacement</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">executeReplacement</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">magicString</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">MagicString</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u901A\u8FC7 magicString.overwrite \u65B9\u6CD5\u5B9E\u73B0\u5B57\u7B26\u4E32\u66FF\u6362</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#82AAFF;">codeHasReplacements</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">magicString</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">magicString</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">isSourceMapEnabled</span><span style="color:#F07178;">()) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">map</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">magicString</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">generateMap</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> hires</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u8FD4\u56DE\u4E00\u4E2A\u5E26\u6709 code \u548C map \u5C5E\u6027\u7684\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Frollupjs.org%2Fguide%2Fen%2F%23transform" target="_blank" rel="noreferrer">transform \u94A9\u5B50</a>\u7684\u5165\u53C2\u5206\u522B\u4E3A<code>\u6A21\u5757\u4EE3\u7801</code>\u3001<code>\u6A21\u5757 ID</code>\uFF0C\u8FD4\u56DE\u4E00\u4E2A\u5305\u542B <code>code</code>(\u4EE3\u7801\u5185\u5BB9) \u548C <code>map</code>(SourceMap \u5185\u5BB9) \u5C5E\u6027\u7684\u5BF9\u8C61\uFF0C\u5F53\u7136\u4E5F\u53EF\u4EE5\u8FD4\u56DE null \u6765\u8DF3\u8FC7\u5F53\u524D\u63D2\u4EF6\u7684 transform \u5904\u7406\u3002\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C<strong>\u5F53\u524D\u63D2\u4EF6\u8FD4\u56DE\u7684\u4EE3\u7801\u4F1A\u4F5C\u4E3A\u4E0B\u4E00\u4E2A\u63D2\u4EF6 transform \u94A9\u5B50\u7684\u7B2C\u4E00\u4E2A\u5165\u53C2</strong>\uFF0C\u5B9E\u73B0\u7C7B\u4F3C\u4E8E\u7011\u5E03\u6D41\u7684\u5904\u7406\u3002</p><h4 id="chunk-\u7EA7\u4EE3\u7801\u4FEE\u6539-renderchunk" tabindex="-1">Chunk \u7EA7\u4EE3\u7801\u4FEE\u6539: renderChunk <a class="header-anchor" href="#chunk-\u7EA7\u4EE3\u7801\u4FEE\u6539-renderchunk" aria-hidden="true">#</a></h4><p>\u8FD9\u91CC\u6211\u4EEC\u7EE7\u7EED\u4EE5 <code>replace </code>\u63D2\u4EF6\u4E3E\u4F8B\uFF0C\u5728\u8FD9\u4E2A\u63D2\u4EF6\u4E2D\uFF0C\u4E5F\u540C\u6837\u5B9E\u73B0\u4E86 renderChunk \u94A9\u5B50\u51FD\u6570:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">replace</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">options</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{})</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">replace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    transform</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// transform \u4EE3\u7801\u7701\u7565</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">    renderChunk</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">chunk</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">chunk</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">fileName</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u7701\u7565\u4E00\u4E9B\u8FB9\u754C\u60C5\u51B5\u7684\u5904\u7406</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u62FF\u5230 chunk \u7684\u4EE3\u7801\u53CA\u6587\u4EF6\u540D\uFF0C\u6267\u884C\u66FF\u6362\u903B\u8F91</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">executeReplacement</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u53EF\u4EE5\u770B\u5230\u8FD9\u91CC replace \u63D2\u4EF6\u4E3A\u4E86\u66FF\u6362\u7ED3\u679C\u66F4\u52A0\u51C6\u786E\uFF0C\u5728 renderChunk \u94A9\u5B50\u4E2D\u53C8\u8FDB\u884C\u4E86\u4E00\u6B21\u66FF\u6362\uFF0C\u56E0\u4E3A\u540E\u7EED\u7684\u63D2\u4EF6\u4ECD\u7136\u53EF\u80FD\u5728 transform \u4E2D\u8FDB\u884C\u6A21\u5757\u5185\u5BB9\u8F6C\u6362\uFF0C\u8FDB\u800C\u53EF\u80FD\u51FA\u73B0\u7B26\u5408\u66FF\u6362\u89C4\u5219\u7684\u5B57\u7B26\u4E32\u3002</p><p>\u8FD9\u91CC\u6211\u4EEC\u628A\u5173\u6CE8\u70B9\u653E\u5230 renderChunk \u51FD\u6570\u672C\u8EAB\uFF0C\u53EF\u4EE5\u770B\u5230\u6709\u4E24\u4E2A\u5165\u53C2\uFF0C\u5206\u522B\u4E3A <code>chunk \u4EE3\u7801\u5185\u5BB9</code>\u3001<a href="https://link.juejin.cn/?target=https%3A%2F%2Frollupjs.org%2Fguide%2Fen%2F%23generatebundle" target="_blank" rel="noreferrer">chunk \u5143\u4FE1\u606F</a>\uFF0C\u8FD4\u56DE\u503C\u8DDF <code>transform</code> \u94A9\u5B50\u7C7B\u4F3C\uFF0C\u65E2\u53EF\u4EE5\u8FD4\u56DE\u5305\u542B code \u548C map \u5C5E\u6027\u7684\u5BF9\u8C61\uFF0C\u4E5F\u53EF\u4EE5\u901A\u8FC7\u8FD4\u56DE null \u6765\u8DF3\u8FC7\u5F53\u524D\u94A9\u5B50\u7684\u5904\u7406\u3002</p><h4 id="\u4EA7\u7269\u751F\u6210\u6700\u540E\u4E00\u6B65-generatebundle" tabindex="-1">\u4EA7\u7269\u751F\u6210\u6700\u540E\u4E00\u6B65: generateBundle <a class="header-anchor" href="#\u4EA7\u7269\u751F\u6210\u6700\u540E\u4E00\u6B65-generatebundle" aria-hidden="true">#</a></h4><p>generateBundle \u4E5F\u662F<code>\u5F02\u6B65\u4E32\u884C</code>\u7684\u94A9\u5B50\uFF0C\u4F60\u53EF\u4EE5\u5728\u8FD9\u4E2A\u94A9\u5B50\u91CC\u9762\u81EA\u5B9A\u4E49\u5220\u9664\u4E00\u4E9B\u65E0\u7528\u7684 chunk \u6216\u8005\u9759\u6001\u8D44\u6E90\uFF0C\u6216\u8005\u81EA\u5DF1\u6DFB\u52A0\u4E00\u4E9B\u6587\u4EF6\u3002\u8FD9\u91CC\u6211\u4EEC\u4EE5 Rollup \u5B98\u65B9\u7684<code>html</code>\u63D2\u4EF6\u6765\u5177\u4F53\u8BF4\u660E\uFF0C\u8FD9\u4E2A\u63D2\u4EF6\u7684\u4F5C\u7528\u662F\u901A\u8FC7\u62FF\u5230 Rollup \u6253\u5305\u540E\u7684\u8D44\u6E90\u6765\u751F\u6210\u5305\u542B\u8FD9\u4E9B\u8D44\u6E90\u7684 HTML \u6587\u4EF6\uFF0C\u6E90\u7801\u7B80\u5316\u540E\u5982\u4E0B\u6240\u793A:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">html</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">opts</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">RollupHtmlOptions</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Plugin</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u521D\u59CB\u5316\u914D\u7F6E</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> generateBundle</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">output</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">NormalizedOutputOptions</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bundle</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">OutputBundle</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u7701\u7565\u4E00\u4E9B\u8FB9\u754C\u60C5\u51B5\u7684\u5904\u7406</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// 1. \u83B7\u53D6\u6253\u5305\u540E\u7684\u6587\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">files</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getFiles</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">bundle</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// 2. \u7EC4\u88C5 HTML\uFF0C\u63D2\u5165\u76F8\u5E94 meta\u3001link \u548C script \u6807\u7B7E</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">source</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">template</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">attributes</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bundle</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">files</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">publicPath</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">title</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// 3. \u901A\u8FC7\u4E0A\u4E0B\u6587\u5BF9\u8C61\u7684 emitFile \u65B9\u6CD5\uFF0C\u8F93\u51FA html \u6587\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">htmlFile</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">EmittedAsset</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        type</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">asset</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">source</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Rollup HTML Asset</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">fileName</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">emitFile</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">htmlFile</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u76F8\u4FE1\u4ECE\u63D2\u4EF6\u7684\u5177\u4F53\u5B9E\u73B0\u4E2D\uFF0C\u4F60\u4E5F\u80FD\u611F\u53D7\u5230\u8FD9\u4E2A\u94A9\u5B50\u7684\u5F3A\u5927\u4F5C\u7528\u4E86\u3002\u5165\u53C2\u5206\u522B\u4E3A <code>output \u914D\u7F6E</code>\u3001<a href="https://link.juejin.cn/?target=https%3A%2F%2Frollupjs.org%2Fguide%2Fen%2F%23generatebundle" target="_blank" rel="noreferrer">\u6240\u6709\u6253\u5305\u4EA7\u7269\u7684\u5143\u4FE1\u606F\u5BF9\u8C61</a>\uFF0C\u901A\u8FC7\u64CD\u4F5C\u5143\u4FE1\u606F\u5BF9\u8C61\u4F60\u53EF\u4EE5\u5220\u9664\u4E00\u4E9B\u4E0D\u9700\u8981\u7684 chunk \u6216\u8005\u9759\u6001\u8D44\u6E90\uFF0C\u4E5F\u53EF\u4EE5\u901A\u8FC7 \u63D2\u4EF6\u4E0A\u4E0B\u6587\u5BF9\u8C61\u7684 <code>emitFile</code> \u65B9\u6CD5\u8F93\u51FA\u81EA\u5B9A\u4E49\u6587\u4EF6\u3002</p><p>\u5E38\u7528\u7684 Rollup \u94A9\u5B50\u6211\u4EEC\u5C31\u5148\u4ECB\u7ECD\u5230\u8FD9\u91CC\uFF0C\u76F8\u4FE1\u8FD9\u4E9B\u77E5\u8BC6\u70B9\u5DF2\u7ECF\u8DB3\u591F\u4F60\u5E94\u4ED8\u5927\u591A\u6570\u7684\u6784\u5EFA\u573A\u666F\u4E86\u3002</p><h3 id="\u603B\u7ED3-8" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3-8" aria-hidden="true">#</a></h3><p>\u5728\u8FD9\u7BC7\u6587\u7AE0\u4E2D\uFF0C\u6211\u4EEC\u9996\u5148\u8BA4\u8BC6\u5230 Rollup \u4E3A\u4E86\u8FFD\u6C42\u6269\u5C55\u6027\u548C\u53EF\u7EF4\u62A4\u6027\uFF0C\u5F15\u5165\u4E86\u63D2\u4EF6\u673A\u5236\uFF0C\u800C\u540E\u7ED9\u4F60\u4ECB\u7ECD\u4E86 Rollup \u7684 <code>Build</code> \u548C<code>Output</code> \u4E24\u5927\u6784\u5EFA\u9636\u6BB5\uFF0C\u63A5\u7740\u7ED9\u4F60\u8BE6\u7EC6\u5730\u5206\u6790\u4E86\u4E24\u5927\u6784\u5EFA\u9636\u6BB5\u7684\u63D2\u4EF6\u5DE5\u4F5C\u6D41\uFF0C\u6700\u540E\u901A\u8FC7\u51E0\u4E2A\u5B9E\u9645\u7684\u5B98\u65B9\u63D2\u4EF6\u5E26\u4F60\u719F\u6089\u4E86\u4E00\u4E9B\u5E38\u89C1\u7684 Hook\u3002</p><p>Rollup \u7684\u63D2\u4EF6\u5F00\u53D1\u6574\u4F53\u4E0A\u662F\u975E\u5E38\u7B80\u6D01\u548C\u7075\u6D3B\u7684\uFF0C\u603B\u7ED3\u4E3A\u4EE5\u4E0B\u51E0\u4E2A\u65B9\u9762:</p><ul><li><strong>\u63D2\u4EF6\u903B\u8F91\u96C6\u4E2D\u7BA1\u7406</strong>\u3002\u5404\u4E2A\u9636\u6BB5\u7684 Hook \u90FD\u53EF\u4EE5\u653E\u5728\u4E00\u4E2A\u63D2\u4EF6\u4E2D\u7F16\u5199\uFF0C\u6BD4\u5982\u4E0A\u8FF0\u4E24\u4E2A Webpack \u7684 Loader \u548C Plugin \u529F\u80FD\u5728 Rollup \u53EA\u9700\u8981\u7528\u4E00\u4E2A\u63D2\u4EF6\uFF0C\u5206\u522B\u901A\u8FC7 transform \u548C renderChunk \u4E24\u4E2A Hook \u6765\u5B9E\u73B0\u3002</li><li><strong>\u63D2\u4EF6 API \u7B80\u6D01\uFF0C\u7B26\u5408\u76F4\u89C9</strong>\u3002Rollup \u63D2\u4EF6\u57FA\u672C\u4E0A\u53EA\u9700\u8981\u8FD4\u56DE\u4E00\u4E2A\u5305\u542B name \u548C\u5404\u79CD\u94A9\u5B50\u51FD\u6570\u7684\u5BF9\u8C61\u5373\u53EF\uFF0C\u4E5F\u5C31\u662F\u58F0\u660E\u4E00\u4E2A name \u5C5E\u6027\uFF0C\u7136\u540E\u5199\u51E0\u4E2A\u94A9\u5B50\u51FD\u6570\u5373\u53EF\u3002</li><li><strong>\u63D2\u4EF6\u95F4\u7684\u4E92\u76F8\u8C03\u7528</strong>\u3002\u6BD4\u5982\u521A\u521A\u4ECB\u7ECD\u7684<code>alias</code>\u63D2\u4EF6\uFF0C\u53EF\u4EE5\u901A\u8FC7\u63D2\u4EF6\u4E0A\u4E0B\u6587\u5BF9\u8C61\u7684<code>resolve</code>\u65B9\u6CD5\uFF0C\u7EE7\u7EED\u8C03\u7528\u5176\u5B83\u63D2\u4EF6\u7684 <code>resolveId</code>\u94A9\u5B50\uFF0C\u7C7B\u4F3C\u7684\u8FD8\u6709<code>load</code>\u65B9\u6CD5\uFF0C\u8FD9\u5C31\u5927\u5927\u589E\u52A0\u4E86\u63D2\u4EF6\u7684\u7075\u6D3B\u6027\u3002</li></ul><p>\u73B0\u5728\uFF0C\u76F8\u4FE1\u4F60\u5DF2\u7ECF\u4ECE\u5B8F\u89C2\u5230\u7EC6\u8282\u4E0A\uFF0C\u5DF2\u7ECF\u5BF9 Rollup \u63D2\u4EF6\u6709\u4E86\u5168\u9762\u7684\u638C\u63E1\uFF0C\u4E3A\u63A5\u4E0B\u6765\u7684 Vite \u5B66\u4E60\u6253\u4E0B\u4E86\u575A\u5B9E\u7684\u57FA\u7840\u3002</p><h2 id="vite-\u63D2\u4EF6\u5F00\u53D1" tabindex="-1">Vite \u63D2\u4EF6\u5F00\u53D1 <a class="header-anchor" href="#vite-\u63D2\u4EF6\u5F00\u53D1" aria-hidden="true">#</a></h2><p>\u8FD9\u7BC7\u6587\u7AE0\uFF0C\u6211\u4EEC\u5C06\u6DF1\u5165\u5E94\u7528 Vite \u7684\u5404\u9879\u9AD8\u7EA7\u80FD\u529B\uFF0C\u9047\u5230\u66F4\u591A\u6709\u6311\u6218\u7684\u5F00\u53D1\u573A\u666F\u3002\u4F60\u4E0D\u4EC5\u80FD\u5B66\u4F1A\u4E00\u7CFB\u5217\u6709\u96BE\u5EA6\u7684<strong>\u89E3\u51B3\u65B9\u6848</strong>\uFF0C\u76F4\u63A5\u8FD0\u7528\u5230\u5B9E\u9645\u9879\u76EE\u4E2D\uFF0C\u8FD8\u80FD\u7CFB\u7EDF\u63D0\u9AD8\u81EA\u5DF1\u7684<strong>\u77E5\u8BC6\u6DF1\u5EA6</strong>\uFF0C\u4F53\u4F1A\u590D\u6742\u9879\u76EE\u573A\u666F\u4E2D\u6784\u5EFA\u5DE5\u5177\u5982\u4F55\u63D0\u4F9B\u9AD8\u5EA6\u81EA\u5B9A\u4E49\u7684\u80FD\u529B\uFF0C\u4EE5\u53CA\u5982\u4F55\u5BF9\u9879\u76EE\u8FDB\u884C\u6027\u80FD\u4F18\u5316\u3002</p><p>\u8BF4\u5230\u81EA\u5B9A\u4E49\u7684\u80FD\u529B\uFF0C\u4F60\u80AF\u5B9A\u5F88\u5BB9\u6613\u60F3\u5230<code>\u63D2\u4EF6\u673A\u5236</code>\uFF0C\u5229\u7528\u4E00\u4E2A\u4E2A\u63D2\u4EF6\u6765\u6269\u5C55\u6784\u5EFA\u5DE5\u5177\u81EA\u8EAB\u7684\u80FD\u529B\u3002\u6CA1\u9519\uFF0C\u8FD9\u4E00\u8282\u4E2D\u6211\u4EEC\u5C06\u7CFB\u7EDF\u5B66\u4E60 Vite \u7684\u63D2\u4EF6\u673A\u5236\uFF0C\u5E26\u4F60\u638C\u63E1 Vite \u63D2\u4EF6\u5F00\u53D1\u7684\u57FA\u672C\u77E5\u8BC6\u4EE5\u53CA\u5B9E\u6218\u5F00\u53D1\u6280\u5DE7\u3002</p><p>\u867D\u7136 Vite \u7684\u63D2\u4EF6\u673A\u5236\u662F\u57FA\u4E8E Rollup \u6765\u8BBE\u8BA1\u7684\uFF0C\u6211\u4EEC\u4E5F\u5DF2\u7ECF\u5BF9 Rollup \u7684\u63D2\u4EF6\u673A\u5236\u8FDB\u884C\u4E86\u8BE6\u7EC6\u7684\u89E3\u8BFB\uFF0C\u4F46\u5B9E\u9645\u4E0A Vite \u7684\u63D2\u4EF6\u673A\u5236\u4E5F\u5305\u542B\u4E86\u81EA\u5DF1\u72EC\u6709\u7684\u4E00\u90E8\u5206\uFF0C\u4E0E Rollup \u7684\u5404\u4E2A\u63D2\u4EF6 Hook \u5E76\u975E\u5B8C\u5168\u517C\u5BB9\uFF0C\u56E0\u6B64\u6211\u4EEC\u5C06\u91CD\u70B9\u5173\u6CE8 Vite \u72EC\u6709\u7684\u90E8\u5206\u4EE5\u53CA\u548C Rollup \u6240\u533A\u522B\u7684\u90E8\u5206\uFF0C\u800C\u5BF9\u4E8E Vite \u548C Rollup \u4E2D\u76F8\u540C\u7684 Hook (\u5982<code>resolveId</code>\u3001<code>load</code>\u3001<code>transform</code>)\u53EA\u662F\u7A0D\u5FAE\u63D0\u53CA\uFF0C\u5C31\u4E0D\u518D\u5C55\u5F00\u8D58\u8FF0\u4E86\u3002</p><p>\u8BA9\u6211\u4EEC\u5148\u4ECE\u4E00\u4E2A\u7B80\u5355\u7684\u4F8B\u5B50\u5165\u624B\u5427\uFF01</p><h3 id="\u63D2\u4EF6\u793A\u4F8B" tabindex="-1">\u63D2\u4EF6\u793A\u4F8B <a class="header-anchor" href="#\u63D2\u4EF6\u793A\u4F8B" aria-hidden="true">#</a></h3><p>Vite \u63D2\u4EF6\u4E0E Rollup \u63D2\u4EF6\u7ED3\u6784\u7C7B\u4F3C\uFF0C\u4E3A\u4E00\u4E2A <code>name</code> \u548C\u5404\u79CD\u63D2\u4EF6 Hook \u7684\u5BF9\u8C61:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u63D2\u4EF6\u540D\u79F0</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-xxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">load</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u94A9\u5B50\u903B\u8F91</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><blockquote><p>\u5982\u679C\u63D2\u4EF6\u662F\u4E00\u4E2A npm \u5305\uFF0C\u5728<code>package.json</code>\u4E2D\u7684\u5305\u547D\u540D\u4E5F\u63A8\u8350\u4EE5<code>vite-plugin</code>\u5F00\u5934</p></blockquote><p>\u4E00\u822C\u60C5\u51B5\u4E0B\u56E0\u4E3A\u8981\u8003\u8651\u5230\u5916\u90E8\u4F20\u53C2\uFF0C\u6211\u4EEC\u4E0D\u4F1A\u76F4\u63A5\u5199\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u800C\u662F\u5B9E\u73B0\u4E00\u4E2A\u8FD4\u56DE\u63D2\u4EF6\u5BF9\u8C61\u7684 <code>\u5DE5\u5382\u51FD\u6570</code>\uFF0C\u5982\u4E0B\u4EE3\u7801\u6240\u793A:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// myPlugin.js</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">myVitePlugin</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">options</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-xxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    load</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u5728\u94A9\u5B50\u903B\u8F91\u4E2D\u53EF\u4EE5\u901A\u8FC7\u95ED\u5305\u8BBF\u95EE\u5916\u90E8\u7684 options \u4F20\u53C2</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u4F7F\u7528\u65B9\u5F0F</span></span>
<span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">myVitePlugin</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./myVitePlugin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">myVitePlugin</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">/* \u7ED9\u63D2\u4EF6\u4F20\u53C2 */</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="hook-\u4ECB\u7ECD" tabindex="-1">hook \u4ECB\u7ECD <a class="header-anchor" href="#hook-\u4ECB\u7ECD" aria-hidden="true">#</a></h3><h4 id="\u901A\u7528-hook" tabindex="-1">\u901A\u7528 hook <a class="header-anchor" href="#\u901A\u7528-hook" aria-hidden="true">#</a></h4><p>Vite <strong>\u5F00\u53D1\u9636\u6BB5</strong>\u4F1A\u6A21\u62DF Rollup \u7684\u884C\u4E3A\u3002</p><img src="`+s+`"><p>Vite \u4F1A\u8C03\u7528\u4E00\u7CFB\u5217\u4E0E Rollup \u517C\u5BB9\u7684\u94A9\u5B50\uFF0C\u8FD9\u4E2A\u94A9\u5B50\u4E3B\u8981\u5206\u4E3A\u4E09\u4E2A\u9636\u6BB5</p><ul><li><strong>\u670D\u52A1\u5668\u542F\u52A8\u9636\u6BB5</strong>: <code>options</code> \u548C <code>buildStart</code> \u94A9\u5B50\u4F1A\u5728\u670D\u52A1\u542F\u52A8\u65F6\u88AB\u8C03\u7528\u3002</li><li><strong>\u8BF7\u6C42\u54CD\u5E94\u9636\u6BB5</strong>: \u5F53\u6D4F\u89C8\u5668\u53D1\u8D77\u8BF7\u6C42\u65F6\uFF0CVite \u5185\u90E8\u4F9D\u6B21\u8C03\u7528 <code>resolveId</code>\u3001<code>load </code>\u548C <code>transform</code> \u94A9\u5B50\u3002</li><li><strong>\u670D\u52A1\u5668\u5173\u95ED\u9636\u6BB5</strong>: Vite \u4F1A\u4F9D\u6B21\u6267\u884C <code>buildEnd</code> \u548C <code>closeBundle</code> \u94A9\u5B50\u3002</li></ul><p>\u9664\u4E86\u4EE5\u4E0A\u94A9\u5B50\uFF0C\u5176\u4ED6 Rollup \u63D2\u4EF6\u94A9\u5B50(\u5982<code>moduleParsed</code>\u3001<code>renderChunk</code>)\u5747\u4E0D\u4F1A\u5728 Vite <strong>\u5F00\u53D1\u9636\u6BB5</strong>\u8C03\u7528\u3002\u800C\u751F\u4EA7\u73AF\u5883\u4E0B\uFF0C\u7531\u4E8E Vite \u76F4\u63A5\u4F7F\u7528 Rollup\uFF0CVite \u63D2\u4EF6\u4E2D\u6240\u6709 Rollup \u7684\u63D2\u4EF6\u94A9\u5B50\u90FD\u4F1A\u751F\u6548\u3002</p><h4 id="\u72EC\u6709-hook" tabindex="-1">\u72EC\u6709 hook <a class="header-anchor" href="#\u72EC\u6709-hook" aria-hidden="true">#</a></h4><p>\u63A5\u4E0B\u6765\u7ED9\u5927\u5BB6\u4ECB\u7ECD Vite \u4E2D\u7279\u6709\u7684\u4E00\u4E9B Hook\uFF0C\u8FD9\u4E9B Hook \u53EA\u4F1A\u5728 Vite \u5185\u90E8\u8C03\u7528\uFF0C\u800C\u653E\u5230 Rollup \u4E2D\u4F1A\u88AB\u76F4\u63A5\u5FFD\u7565\u3002</p><h5 id="config" tabindex="-1">config <a class="header-anchor" href="#config" aria-hidden="true">#</a></h5><p>Vite \u5728\u8BFB\u53D6\u5B8C\u914D\u7F6E\u6587\u4EF6\uFF08\u5373<code>vite.config.ts</code>\uFF09\u4E4B\u540E\uFF0C\u4F1A\u62FF\u5230\u7528\u6237\u5BFC\u51FA\u7684\u914D\u7F6E\u5BF9\u8C61\uFF0C\u7136\u540E\u6267\u884C config \u94A9\u5B50\u3002\u5728\u8FD9\u4E2A\u94A9\u5B50\u91CC\u9762\uFF0C\u4F60\u53EF\u4EE5\u5BF9\u914D\u7F6E\u6587\u4EF6\u5BFC\u51FA\u7684\u5BF9\u8C61\u8FDB\u884C\u81EA\u5B9A\u4E49\u7684\u64CD\u4F5C\uFF0C\u5982\u4E0B\u4EE3\u7801\u6240\u793A:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// \u8FD4\u56DE\u90E8\u5206\u914D\u7F6E\uFF08\u63A8\u8350\uFF09</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> editConfigPlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-modify-config</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">config</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">alias</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">react</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> require</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>\u5B98\u65B9\u63A8\u8350\u7684\u59FF\u52BF\u662F\u5728 config \u94A9\u5B50\u4E2D\u8FD4\u56DE\u4E00\u4E2A\u914D\u7F6E\u5BF9\u8C61\uFF0C\u8FD9\u4E2A\u914D\u7F6E\u5BF9\u8C61\u4F1A\u548C Vite \u5DF2\u6709\u7684\u914D\u7F6E\u8FDB\u884C\u6DF1\u5EA6\u7684\u5408\u5E76\u3002\u4E0D\u8FC7\u4F60\u4E5F\u53EF\u4EE5\u901A\u8FC7\u94A9\u5B50\u7684\u5165\u53C2\u62FF\u5230 config \u5BF9\u8C61\u8FDB\u884C\u81EA\u5B9A\u4E49\u7684\u4FEE\u6539\uFF0C\u5982\u4E0B\u4EE3\u7801\u6240\u793A:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> mutateConfigPlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">mutate-config</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// command \u4E3A \`serve\`(\u5F00\u53D1\u73AF\u5883) \u6216\u8005 \`build\`(\u751F\u4EA7\u73AF\u5883)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">config</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">command</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">})</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u751F\u4EA7\u73AF\u5883\u4E2D\u4FEE\u6539 root \u53C2\u6570</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">command</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">build</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">root</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">__dirname</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>\u5728\u4E00\u4E9B\u6BD4\u8F83\u6DF1\u5C42\u7684\u5BF9\u8C61\u914D\u7F6E\u4E2D\uFF0C\u8FD9\u79CD\u76F4\u63A5\u4FEE\u6539\u914D\u7F6E\u7684\u65B9\u5F0F\u4F1A\u663E\u5F97\u6BD4\u8F83\u9EBB\u70E6\uFF0C\u5982 <code>optimizeDeps.esbuildOptions.plugins</code>\uFF0C\u9700\u8981\u5199\u5F88\u591A\u7684\u6837\u677F\u4EE3\u7801\uFF0C\u7C7B\u4F3C\u4E0B\u9762\u8FD9\u6837:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// \u9632\u6B62\u51FA\u73B0 undefined \u7684\u60C5\u51B5</span></span>
<span class="line"><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">optimizeDeps </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">optimizeDeps </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">optimizeDeps</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">esbuildOptions </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">optimizeDeps</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">esbuildOptions </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">optimizeDeps</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">esbuildOptions</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">plugins </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">optimizeDeps</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">esbuildOptions</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">plugins </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> []</span></span>
<span class="line"></span></code></pre></div><p>\u56E0\u6B64\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0C\u5EFA\u8BAE\u76F4\u63A5\u8FD4\u56DE\u4E00\u4E2A\u914D\u7F6E\u5BF9\u8C61\uFF0C\u8FD9\u6837\u4F1A\u65B9\u4FBF\u5F88\u591A:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#82AAFF;">config</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    optimizeDeps</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      esbuildOptions</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="configresolved" tabindex="-1">configResolved <a class="header-anchor" href="#configresolved" aria-hidden="true">#</a></h5><p>Vite \u5728\u89E3\u6790\u5B8C\u914D\u7F6E\u4E4B\u540E\u4F1A\u8C03\u7528 <code>configResolved </code>\u94A9\u5B50\uFF0C\u8FD9\u4E2A\u94A9\u5B50\u4E00\u822C\u7528\u6765\u8BB0\u5F55\u6700\u7EC8\u7684\u914D\u7F6E\u4FE1\u606F\uFF0C\u800C\u4E0D\u5EFA\u8BAE\u518D\u4FEE\u6539\u914D\u7F6E\uFF0C\u7528\u6CD5\u5982\u4E0B\u56FE\u6240\u793A:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> exmaplePlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">read-config</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    configResolved</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">resolvedConfig</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u8BB0\u5F55\u6700\u7EC8\u914D\u7F6E</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">config</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolvedConfig</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u5728\u5176\u4ED6\u94A9\u5B50\u4E2D\u53EF\u4EE5\u8BBF\u95EE\u5230\u914D\u7F6E</span></span>
<span class="line"><span style="color:#F07178;">    transform</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">config</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="configureserver" tabindex="-1">configureServer <a class="header-anchor" href="#configureserver" aria-hidden="true">#</a></h5><p>\u8FD9\u4E2A\u94A9\u5B50\u4EC5\u5728<strong>\u5F00\u53D1\u9636\u6BB5</strong>\u4F1A\u88AB\u8C03\u7528\uFF0C\u7528\u4E8E\u6269\u5C55 Vite \u7684 Dev Server\uFF0C\u4E00\u822C\u7528\u4E8E\u589E\u52A0\u81EA\u5B9A\u4E49 server \u4E2D\u95F4\u4EF6\uFF0C\u5982\u4E0B\u4EE3\u7801\u6240\u793A:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> myPlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">configure-server</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">configureServer</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u59FF\u52BF 1: \u5728 Vite \u5185\u7F6E\u4E2D\u95F4\u4EF6\u4E4B\u524D\u6267\u884C</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">middlewares</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u81EA\u5B9A\u4E49\u8BF7\u6C42\u5904\u7406\u903B\u8F91</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u59FF\u52BF 2: \u5728 Vite \u5185\u7F6E\u4E2D\u95F4\u4EF6\u4E4B\u540E\u6267\u884C </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">middlewares</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u81EA\u5B9A\u4E49\u8BF7\u6C42\u5904\u7406\u903B\u8F91</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h5 id="transformindexhtml" tabindex="-1">transformIndexHtml <a class="header-anchor" href="#transformindexhtml" aria-hidden="true">#</a></h5><p>\u8FD9\u4E2A\u94A9\u5B50\u7528\u6765\u7075\u6D3B\u63A7\u5236 HTML \u7684\u5185\u5BB9\uFF0C\u4F60\u53EF\u4EE5\u62FF\u5230\u539F\u59CB\u7684 html \u5185\u5BB9\u540E\u8FDB\u884C\u4EFB\u610F\u7684\u8F6C\u6362:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> htmlPlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">html-transform</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    transformIndexHtml</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">/&lt;</span><span style="color:#A6ACCD;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">.*?</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">&lt;</span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">title&gt;</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">&lt;title&gt;\u6362\u4E86\u4E2A\u6807\u9898&lt;/title&gt;</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#F07178;">      )</span></span>
<span class="line"><span style="color:#F07178;">    }</span></span>
<span class="line"><span style="color:#F07178;">  }</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"><span style="color:#676E95;">// \u4E5F\u53EF\u4EE5\u8FD4\u56DE\u5982\u4E0B\u7684\u5BF9\u8C61\u7ED3\u6784\uFF0C\u4E00\u822C\u7528\u4E8E\u6DFB\u52A0\u67D0\u4E9B\u6807\u7B7E</span></span>
<span class="line"><span style="color:#A6ACCD;">const</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">htmlPlugin</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">html-transform</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    transformIndexHtml</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u6CE8\u5165\u6807\u7B7E</span></span>
<span class="line"><span style="color:#F07178;">        tags</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;">// \u653E\u5230 body \u672B\u5C3E\uFF0C\u53EF\u53D6\u503C\u8FD8\u6709\`head\`|\`head-prepend\`|\`body-prepend\`\uFF0C\u987E\u540D\u601D\u4E49</span></span>
<span class="line"><span style="color:#F07178;">            injectTo</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">body</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;">// \u6807\u7B7E\u5C5E\u6027\u5B9A\u4E49</span></span>
<span class="line"><span style="color:#F07178;">            attrs</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> type</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> src</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./index.ts</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;">// \u6807\u7B7E\u540D</span></span>
<span class="line"><span style="color:#F07178;">            tag</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">script</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">        ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="handlehotupdate" tabindex="-1">handleHotUpdate <a class="header-anchor" href="#handlehotupdate" aria-hidden="true">#</a></h5><p>\u8FD9\u4E2A\u94A9\u5B50\u4F1A\u5728 Vite \u670D\u52A1\u7AEF\u5904\u7406\u70ED\u66F4\u65B0\u65F6\u88AB\u8C03\u7528\uFF0C\u4F60\u53EF\u4EE5\u5728\u8FD9\u4E2A\u94A9\u5B50\u4E2D\u62FF\u5230\u70ED\u66F4\u65B0\u76F8\u5173\u7684\u4E0A\u4E0B\u6587\u4FE1\u606F\uFF0C\u8FDB\u884C\u70ED\u66F4\u6A21\u5757\u7684\u8FC7\u6EE4\uFF0C\u6216\u8005\u8FDB\u884C\u81EA\u5B9A\u4E49\u7684\u70ED\u66F4\u5904\u7406\u3002\u4E0B\u9762\u662F\u4E00\u4E2A\u7B80\u5355\u7684\u4F8B\u5B50:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> handleHmrPlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> handleHotUpdate</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u9700\u8981\u70ED\u66F4\u7684\u6587\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">file</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u9700\u8981\u70ED\u66F4\u7684\u6A21\u5757\uFF0C\u5982\u4E00\u4E2A Vue \u5355\u6587\u4EF6\u4F1A\u6D89\u53CA\u591A\u4E2A\u6A21\u5757</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">modules</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u65F6\u95F4\u6233</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">timestamp</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// Vite Dev Server \u5B9E\u4F8B</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">server</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u8BFB\u53D6\u6700\u65B0\u7684\u6587\u4EF6\u5185\u5BB9</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">read</span><span style="color:#F07178;">())</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u81EA\u884C\u5904\u7406 HMR \u4E8B\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ws</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        type</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">custom</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        event</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">special-update</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        data</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> a</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u524D\u7AEF\u4EE3\u7801\u4E2D\u52A0\u5165</span></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hot) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hot</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">special-update</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u6267\u884C\u81EA\u5B9A\u4E49\u66F4\u65B0</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// { a: 1 }</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">location</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">reload</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u4EE5\u4E0A\u5C31\u662F Vite \u72EC\u6709\u7684\u4E94\u4E2A\u94A9\u5B50\uFF0C\u6211\u4EEC\u6765\u91CD\u65B0\u68B3\u7406\u4E00\u4E0B:</p><ul><li><code>config</code>: \u7528\u6765\u8FDB\u4E00\u6B65\u4FEE\u6539\u914D\u7F6E\u3002</li><li><code>configResolved</code>: \u7528\u6765\u8BB0\u5F55\u6700\u7EC8\u7684\u914D\u7F6E\u4FE1\u606F\u3002</li><li><code>configureServer</code>: \u7528\u6765\u83B7\u53D6 Vite Dev Server \u5B9E\u4F8B\uFF0C\u6DFB\u52A0\u4E2D\u95F4\u4EF6\u3002</li><li><code>transformIndexHtml</code>: \u7528\u6765\u8F6C\u6362 HTML \u7684\u5185\u5BB9\u3002</li><li><code>handleHotUpdate</code>: \u7528\u6765\u8FDB\u884C\u70ED\u66F4\u65B0\u6A21\u5757\u7684\u8FC7\u6EE4\uFF0C\u6216\u8005\u8FDB\u884C\u81EA\u5B9A\u4E49\u7684\u70ED\u66F4\u65B0\u5904\u7406\u3002</li></ul><h4 id="hook-\u6267\u884C\u987A\u5E8F" tabindex="-1">hook \u6267\u884C\u987A\u5E8F <a class="header-anchor" href="#hook-\u6267\u884C\u987A\u5E8F" aria-hidden="true">#</a></h4><p>\u6211\u4EEC\u5B66\u4E60\u5230\u4E86 Vite \u7684\u901A\u7528\u94A9\u5B50\u548C\u72EC\u6709\u94A9\u5B50\uFF0C\u4F30\u8BA1\u4F60\u73B0\u5728\u8111\u5B50\u91CC\u9762\u4E00\u70B9\u4E71: \u8FD9\u4E48\u591A\u7684\u94A9\u5B50\uFF0C\u5230\u5E95\u8C01\u5148\u6267\u884C\u3001\u8C01\u540E\u6267\u884C\u5462\uFF1F</p><p>\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u4E00\u4E2A\u5177\u4F53\u7684\u4EE3\u7801\u793A\u4F8B\u6765\u6C47\u603B\u4E00\u4E0B\u6240\u6709\u7684\u94A9\u5B50\u3002\u5728 Vite \u7684\u811A\u624B\u67B6\u5DE5\u7A0B\u4E2D\u65B0\u5EFA <code>test-hooks-plugin.ts</code>:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// test-hooks-plugin.ts</span></span>
<span class="line"><span style="color:#676E95;">// \u6CE8: \u8BF7\u6C42\u54CD\u5E94\u9636\u6BB5\u7684\u94A9\u5B50</span></span>
<span class="line"><span style="color:#676E95;">// \u5982 resolveId, load, transform, transformIndexHtml\u5728\u4E0B\u6587\u4ECB\u7ECD</span></span>
<span class="line"><span style="color:#676E95;">// \u4EE5\u4E0B\u4E3A\u670D\u52A1\u542F\u52A8\u548C\u5173\u95ED\u7684\u94A9\u5B50</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">testHookPlugin</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">test-hooks-plugin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// Vite \u72EC\u6709\u94A9\u5B50</span></span>
<span class="line"><span style="color:#F07178;">    config</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">config</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// Vite \u72EC\u6709\u94A9\u5B50</span></span>
<span class="line"><span style="color:#F07178;">    configResolved</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">resolvedCofnig</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">configResolved</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u901A\u7528\u94A9\u5B50</span></span>
<span class="line"><span style="color:#F07178;">    options</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">opts</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">options</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">opts</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// Vite \u72EC\u6709\u94A9\u5B50</span></span>
<span class="line"><span style="color:#F07178;">    configureServer</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">configureServer</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u624B\u52A8\u9000\u51FA\u8FDB\u7A0B</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">kill</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">pid</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">SIGTERM</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">3000</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u901A\u7528\u94A9\u5B50</span></span>
<span class="line"><span style="color:#F07178;">    buildStart</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">buildStart</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u901A\u7528\u94A9\u5B50</span></span>
<span class="line"><span style="color:#F07178;">    buildEnd</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">buildEnd</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u901A\u7528\u94A9\u5B50</span></span>
<span class="line"><span style="color:#F07178;">    closeBundle</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">closeBundle</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5C06\u63D2\u4EF6\u52A0\u5165\u5230 Vite \u914D\u7F6E\u6587\u4EF6\u4E2D\uFF0C\u7136\u540E\u542F\u52A8\uFF0C\u4F60\u53EF\u4EE5\u89C2\u5BDF\u5230\u5404\u4E2A Hook \u7684\u6267\u884C\u987A\u5E8F:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">$ pnpm run dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">hook@</span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> dev </span><span style="color:#FFCB6B;">D</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">\\workspace\\notes\\vite\\vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">hook</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> vite</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">config</span></span>
<span class="line"><span style="color:#A6ACCD;">configResolved</span></span>
<span class="line"><span style="color:#A6ACCD;">options</span></span>
<span class="line"><span style="color:#A6ACCD;">configureServer</span></span>
<span class="line"><span style="color:#A6ACCD;">buildStart</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  vite v2</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">9.6</span><span style="color:#A6ACCD;"> dev server running </span><span style="color:#FFCB6B;">at</span><span style="color:#89DDFF;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Local</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">http</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;">//localhost:3000/</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Network</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> use </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">--host</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> to expose</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  ready </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> 339ms</span><span style="color:#89DDFF;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">buildEnd</span></span>
<span class="line"><span style="color:#A6ACCD;">closeBundle</span></span>
<span class="line"></span></code></pre></div><p>\u7531\u6B64\u6211\u4EEC\u53EF\u4EE5\u68B3\u7406\u51FA Vite \u63D2\u4EF6\u7684\u6267\u884C\u987A\u5E8F:</p><img src="`+I+`"><ul><li>\u670D\u52A1\u542F\u52A8\u9636\u6BB5: <code>config</code>\u3001<code>configResolved</code>\u3001<code>options</code>\u3001<code>configureServer</code>\u3001<code>buildStart</code></li><li>\u8BF7\u6C42\u54CD\u5E94\u9636\u6BB5: \u5982\u679C\u662F <code>html</code> \u6587\u4EF6\uFF0C\u4EC5\u6267\u884C <code>transformIndexHtml</code> \u94A9\u5B50\uFF1B\u5BF9\u4E8E\u975E HTML \u6587\u4EF6\uFF0C\u5219\u4F9D\u6B21\u6267\u884C <code>resolveId</code>\u3001<code>load </code>\u548C<code>transform</code> \u94A9\u5B50\u3002</li><li>\u70ED\u66F4\u65B0\u9636\u6BB5: \u6267\u884C <code>handleHotUpdate</code> \u94A9\u5B50\u3002</li><li>\u670D\u52A1\u5173\u95ED\u9636\u6BB5: \u4F9D\u6B21\u6267\u884C <code>buildEnd</code> \u548C <code>closeBundle</code> \u94A9\u5B50\u3002<code>apply</code>\u53C2\u6570\u8FD8\u53EF\u4EE5\u914D\u7F6E\u6210\u4E00\u4E2A\u51FD\u6570\uFF0C\u8FDB\u884C\u66F4\u7075\u6D3B\u7684\u63A7\u5236:</li></ul><h3 id="\u63D2\u4EF6\u5E94\u7528\u4F4D\u7F6E" tabindex="-1">\u63D2\u4EF6\u5E94\u7528\u4F4D\u7F6E <a class="header-anchor" href="#\u63D2\u4EF6\u5E94\u7528\u4F4D\u7F6E" aria-hidden="true">#</a></h3><p>\u68B3\u7406\u5B8C Vite \u7684\u5404\u4E2A\u94A9\u5B50\u51FD\u6570\u4E4B\u540E\uFF0C\u63A5\u4E0B\u6765\u8BA9\u6211\u4EEC\u6765\u4E86\u89E3\u4E00\u4E0B Vite \u63D2\u4EF6\u7684<strong>\u5E94\u7528\u60C5\u666F</strong>\u548C<strong>\u5E94\u7528\u987A\u5E8F</strong>\u3002</p><p>\u9ED8\u8BA4\u60C5\u51B5\u4E0B Vite \u63D2\u4EF6\u540C\u65F6\u88AB\u7528\u4E8E\u5F00\u53D1\u73AF\u5883\u548C\u751F\u4EA7\u73AF\u5883\uFF0C\u4F60\u53EF\u4EE5\u901A\u8FC7 <code>apply</code> \u5C5E\u6027\u6765\u51B3\u5B9A\u5E94\u7528\u573A\u666F:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// &#39;serve&#39; \u8868\u793A\u4EC5\u7528\u4E8E\u5F00\u53D1\u73AF\u5883\uFF0C&#39;build&#39;\u8868\u793A\u4EC5\u7528\u4E8E\u751F\u4EA7\u73AF\u5883</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">apply</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">serve</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>apply </code>\u53C2\u6570\u8FD8\u53EF\u4EE5\u914D\u7F6E\u6210\u4E00\u4E2A\u51FD\u6570\uFF0C\u8FDB\u884C\u66F4\u7075\u6D3B\u7684\u63A7\u5236:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#82AAFF;">apply</span><span style="color:#A6ACCD;">(config</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> command </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u53EA\u7528\u4E8E\u975E SSR \u60C5\u51B5\u4E0B\u7684\u751F\u4EA7\u73AF\u5883\u6784\u5EFA</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">command</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">build</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ssr</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u540C\u65F6\uFF0C\u4F60\u4E5F\u53EF\u4EE5\u901A\u8FC7 <code>enforce</code> \u5C5E\u6027\u6765\u6307\u5B9A\u63D2\u4EF6\u7684\u6267\u884C\u987A\u5E8F:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u9ED8\u8BA4\u4E3A\`normal\`\uFF0C\u53EF\u53D6\u503C\u8FD8\u6709\`pre\`\u548C\`post\`</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">enforce</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pre</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>Vite \u4E2D\u63D2\u4EF6\u7684\u6267\u884C\u987A\u5E8F\u5982\u4E0B\u56FE\u6240\u793A:</p><img src="`+P+`"><p>Vite \u4F1A\u4F9D\u6B21\u6267\u884C\u5982\u4E0B\u7684\u63D2\u4EF6:</p><ul><li>Alias (\u8DEF\u5F84\u522B\u540D)\u76F8\u5173\u7684\u63D2\u4EF6\u3002</li><li>\u2B50\uFE0F \u5E26\u6709 <code>enforce: &#39;pre&#39;</code> \u7684\u7528\u6237\u63D2\u4EF6\u3002</li><li>Vite \u6838\u5FC3\u63D2\u4EF6\u3002</li><li>\u2B50\uFE0F \u6CA1\u6709 enforce \u503C\u7684\u7528\u6237\u63D2\u4EF6\uFF0C\u4E5F\u53EB<code>\u666E\u901A\u63D2\u4EF6</code>\u3002</li><li>Vite \u751F\u4EA7\u73AF\u5883\u6784\u5EFA\u7528\u7684\u63D2\u4EF6\u3002</li><li>\u2B50\uFE0F \u5E26\u6709 <code>enforce: &#39;post&#39;</code> \u7684\u7528\u6237\u63D2\u4EF6\u3002</li><li>Vite \u540E\u7F6E\u6784\u5EFA\u63D2\u4EF6(\u5982\u538B\u7F29\u63D2\u4EF6)\u3002</li></ul><h3 id="\u63D2\u4EF6\u5F00\u53D1\u5B9E\u6218" tabindex="-1">\u63D2\u4EF6\u5F00\u53D1\u5B9E\u6218 <a class="header-anchor" href="#\u63D2\u4EF6\u5F00\u53D1\u5B9E\u6218" aria-hidden="true">#</a></h3><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u5C06\u4E00\u8D77\u7F16\u5199\u4E24\u4E2A Vite \u63D2\u4EF6\uFF0C\u5206\u522B\u662F <code>\u865A\u62DF\u6A21\u5757\u52A0\u8F7D\u63D2\u4EF6</code> \u548C <code>Svgr \u63D2\u4EF6</code>\uFF0C\u4F60\u5C06\u5B66\u4F1A\u4ECE\u63D2\u4EF6\u5F00\u53D1\u7684\u5E38\u89C1\u5957\u8DEF\u548C\u5404\u79CD\u5F00\u53D1\u6280\u5DE7\u3002</p><h4 id="\u865A\u62DF\u6A21\u5757\u52A0\u8F7D" tabindex="-1">\u865A\u62DF\u6A21\u5757\u52A0\u8F7D <a class="header-anchor" href="#\u865A\u62DF\u6A21\u5757\u52A0\u8F7D" aria-hidden="true">#</a></h4><p>\u9996\u5148\u6211\u4EEC\u6765\u5B9E\u73B0\u4E00\u4E2A\u865A\u62DF\u6A21\u5757\u7684\u52A0\u8F7D\u63D2\u4EF6\uFF0C\u53EF\u80FD\u4F60\u4F1A\u6709\u7591\u95EE: \u4EC0\u4E48\u662F\u865A\u62DF\u6A21\u5757\u5462\uFF1F</p><p>\u4F5C\u4E3A\u6784\u5EFA\u5DE5\u5177\uFF0C\u4E00\u822C\u9700\u8981\u5904\u7406\u4E24\u79CD\u5F62\u5F0F\u7684\u6A21\u5757\uFF0C\u4E00\u79CD\u5B58\u5728\u4E8E\u771F\u5B9E\u7684\u78C1\u76D8\u6587\u4EF6\u7CFB\u7EDF\u4E2D\uFF0C\u53E6\u4E00\u79CD\u5E76\u4E0D\u5728\u78C1\u76D8\u800C\u5728\u5185\u5B58\u5F53\u4E2D\uFF0C\u4E5F\u5C31\u662F<code>\u865A\u62DF\u6A21\u5757</code>\u3002\u901A\u8FC7\u865A\u62DF\u6A21\u5757\uFF0C\u6211\u4EEC\u65E2\u53EF\u4EE5\u628A\u81EA\u5DF1\u624B\u5199\u7684\u4E00\u4E9B\u4EE3\u7801\u5B57\u7B26\u4E32\u4F5C\u4E3A\u5355\u72EC\u7684\u6A21\u5757\u5185\u5BB9\uFF0C\u53C8\u53EF\u4EE5\u5C06\u5185\u5B58\u4E2D\u67D0\u4E9B\u7ECF\u8FC7\u8BA1\u7B97\u5F97\u51FA\u7684<strong>\u53D8\u91CF</strong>\u4F5C\u4E3A\u6A21\u5757\u5185\u5BB9\u8FDB\u884C\u52A0\u8F7D\uFF0C\u975E\u5E38\u7075\u6D3B\u548C\u65B9\u4FBF\u3002\u63A5\u4E0B\u6765\u8BA9\u6211\u4EEC\u901A\u8FC7\u4E00\u4E9B\u5177\u4F53\u7684\u4F8B\u5B50\u6765\u5B9E\u64CD\u4E00\u4E0B\uFF0C\u9996\u5148\u901A\u8FC7\u811A\u624B\u67B6\u547D\u4EE4\u521D\u59CB\u5316\u4E00\u4E2A <code>react + ts</code> \u9879\u76EE:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm init vite</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\u901A\u8FC7 <code>pnpm i</code> \u5B89\u88C5\u4F9D\u8D56\uFF0C\u63A5\u7740\u65B0\u5EFA <code>plugins</code> \u76EE\u5F55\uFF0C\u5F00\u59CB\u63D2\u4EF6\u7684\u5F00\u53D1:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// plugins/virtual-module.ts</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Plugin</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ResolvedConfig</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u865A\u62DF\u6A21\u5757\u540D\u79F0</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> virtualFibModuleId </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">virtual:fib</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">// Vite \u4E2D\u7EA6\u5B9A\u5BF9\u4E8E\u865A\u62DF\u6A21\u5757\uFF0C\u89E3\u6790\u540E\u7684\u8DEF\u5F84\u9700\u8981\u52A0\u4E0A\`\\0\`\u524D\u7F00</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> resolvedFibVirtualModuleId </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">\\0</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> virtualFibModuleId</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">virtualFibModulePlugin</span><span style="color:#89DDFF;">():</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Plugin</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">ResolvedConfig</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-virtual-module</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    resolveId</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">virtualFibModuleId</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolvedFibVirtualModuleId</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">    load</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u52A0\u8F7D\u865A\u62DF\u6A21\u5757</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolvedFibVirtualModuleId</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">export default function fib(n) { return n &lt;= 1 ? n : fib(n - 1) + fib(n - 2); }</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u7740\u6211\u4EEC\u5728\u9879\u76EE\u4E2D\u6765\u4F7F\u7528\u8FD9\u4E2A\u63D2\u4EF6:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> virtual </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./plugins/virtual-module.ts</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u914D\u7F6E\u63D2\u4EF6</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#82AAFF;">react</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">virtual</span><span style="color:#F07178;">()]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\u5728 <code>main.tsx</code> \u4E2D\u52A0\u5165\u5982\u4E0B\u7684\u4EE3\u7801:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> fib </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">virtual:fib</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">alert</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">\u7ED3\u679C: </span><span style="color:#89DDFF;">\${</span><span style="color:#82AAFF;">fib</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">}\`</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u91CC\u6211\u4EEC\u4F7F\u7528\u4E86 <code>virtual:fib</code> \u8FD9\u4E2A\u865A\u62DF\u6A21\u5757\uFF0C\u867D\u7136\u8FD9\u4E2A\u6A21\u5757\u4E0D\u5B58\u5728\u771F\u5B9E\u7684\u6587\u4EF6\u7CFB\u7EDF\u4E2D\uFF0C\u4F46\u4F60\u6253\u5F00\u6D4F\u89C8\u5668\u540E\u53EF\u4EE5\u53D1\u73B0\u8FD9\u4E2A\u6A21\u5757\u5BFC\u51FA\u7684\u51FD\u6570\u662F\u53EF\u4EE5\u6B63\u5E38\u6267\u884C\u7684:</p><img src="`+M+`"><p>\u63A5\u7740\u6211\u4EEC\u6765\u5C1D\u8BD5\u4E00\u4E0B\u5982\u4F55\u901A\u8FC7\u865A\u62DF\u6A21\u5757\u6765\u8BFB\u53D6\u5185\u5B58\u4E2D\u7684\u53D8\u91CF\uFF0C\u5728 <code>virtual-module.ts</code> \u4E2D\u589E\u52A0\u5982\u4E0B\u4EE3\u7801:</p><div class="language-diff"><button class="copy"></button><span class="lang">diff</span><pre><code><span class="line"><span style="color:#A6ACCD;">import { Plugin, ResolvedConfig } from &#39;vite&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">const virtualFibModuleId = &#39;virtual:fib&#39;;</span></span>
<span class="line"><span style="color:#A6ACCD;">const resolvedFibVirtualModuleId = &#39;\\0&#39; + virtualFibModuleId;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;"> const virtualEnvModuleId = &#39;virtual:env&#39;;</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;"> const resolvedEnvVirtualModuleId = &#39;\\0&#39; + virtualEnvModuleId;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">export default function virtualFibModulePlugin(): Plugin {</span></span>
<span class="line"><span style="color:#A6ACCD;">	let config: ResolvedConfig | null = null;</span></span>
<span class="line"><span style="color:#A6ACCD;">  return {</span></span>
<span class="line"><span style="color:#A6ACCD;">    name: &#39;vite-plugin-virtual-fib-module&#39;,</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">     configResolved(c: ResolvedConfig) {</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">       config = c;</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">     },</span></span>
<span class="line"><span style="color:#A6ACCD;">    resolveId(id) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      if (id === virtualFibModuleId) { </span></span>
<span class="line"><span style="color:#A6ACCD;">        return resolvedFibVirtualModuleId;</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">       if (id === virtualEnvModuleId) { </span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">        return resolvedEnvVirtualModuleId;</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">    },</span></span>
<span class="line"><span style="color:#A6ACCD;">    load(id) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      if (id === resolvedFibVirtualModuleId) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        return &#39;export default function fib(n) { return n &lt;= 1 ? n : fib(n - 1) + fib(n - 2); }&#39;;</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">      if (id === resolvedEnvVirtualModuleId) {</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">        return \`export default \${JSON.stringify(config!.env)}\`;</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5728\u65B0\u589E\u7684\u8FD9\u4E9B\u4EE3\u7801\u4E2D\uFF0C\u6211\u4EEC\u6CE8\u518C\u4E86\u4E00\u4E2A\u65B0\u7684\u865A\u62DF\u6A21\u5757 <code>virtual:env</code>\uFF0C\u7D27\u63A5\u7740\u6211\u4EEC\u53BB\u9879\u76EE\u53BB\u4F7F\u7528:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// main.tsx</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> env </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">virtual:env</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(env)</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u7740\u4F60\u53EF\u4EE5\u53BB\u6D4F\u89C8\u5668\u89C2\u5BDF\u4E00\u4E0B\u8F93\u51FA\u7684\u60C5\u51B5:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">BASE_URL</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">MODE</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">development</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">DEV</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">PROD</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#FFCB6B;">BASE_URL</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#FFCB6B;">DEV</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#FFCB6B;">MODE</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">development</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#FFCB6B;">PROD</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"></span></code></pre></div><img src="`+T+`"><p>Vite \u73AF\u5883\u53D8\u91CF\u80FD\u6B63\u786E\u5730\u5728\u6D4F\u89C8\u5668\u4E2D\u6253\u5370\u51FA\u6765\uFF0C\u8BF4\u660E\u5728\u5185\u5B58\u4E2D\u8BA1\u7B97\u51FA\u6765\u7684 <code>virtual:env</code> \u6A21\u5757\u7684\u786E\u88AB\u6210\u529F\u5730\u52A0\u8F7D\u4E86\u3002\u4ECE\u4E2D\u4F60\u53EF\u4EE5\u770B\u5230\uFF0C\u865A\u62DF\u6A21\u5757\u7684\u5185\u5BB9\u5B8C\u5168\u80FD\u591F\u88AB\u52A8\u6001\u8BA1\u7B97\u51FA\u6765\uFF0C\u56E0\u6B64\u5B83\u7684\u7075\u6D3B\u6027\u548C\u53EF\u5B9A\u5236\u7A0B\u5EA6\u975E\u5E38\u9AD8\uFF0C\u5B9E\u7528\u6027\u4E5F\u5F88\u5F3A\uFF0C\u5728 Vite \u5185\u90E8\u7684\u63D2\u4EF6\u88AB\u6DF1\u5EA6\u5730\u4F7F\u7528\uFF0C\u793E\u533A\u5F53\u4E2D\u4E5F\u6709\u4E0D\u5C11\u77E5\u540D\u7684\u63D2\u4EF6(\u5982 <code>vite-plugin-windicss</code>\u3001<code>vite-plugin-svg-icons</code>\u7B49)\u4E5F\u4F7F\u7528\u4E86\u865A\u62DF\u6A21\u5757\u7684\u6280\u672F\u3002</p><h4 id="svg-\u7EC4\u4EF6\u5F62\u5F0F\u52A0\u8F7D" tabindex="-1">Svg \u7EC4\u4EF6\u5F62\u5F0F\u52A0\u8F7D <a class="header-anchor" href="#svg-\u7EC4\u4EF6\u5F62\u5F0F\u52A0\u8F7D" aria-hidden="true">#</a></h4><p>\u5728\u4E00\u822C\u7684\u9879\u76EE\u5F00\u53D1\u8FC7\u7A0B\u4E2D\uFF0C\u6211\u4EEC\u6709\u65F6\u5019\u5E0C\u671B\u80FD\u5C06 svg \u5F53\u505A\u4E00\u4E2A\u7EC4\u4EF6\u6765\u5F15\u5165\uFF0C\u8FD9\u6837\u6211\u4EEC\u53EF\u4EE5\u5F88\u65B9\u4FBF\u5730\u4FEE\u6539 svg \u7684\u5404\u79CD\u5C5E\u6027\uFF0C\u76F8\u6BD4\u4E8E<code>img</code>\u6807\u7B7E\u7684\u5F15\u5165\u65B9\u5F0F\u4E5F\u66F4\u52A0\u4F18\u96C5\u3002\u4F46 Vite \u672C\u8EAB\u5E76\u4E0D\u652F\u6301\u5C06 svg \u8F6C\u6362\u4E3A\u7EC4\u4EF6\u7684\u4EE3\u7801\uFF0C\u9700\u8981\u6211\u4EEC\u901A\u8FC7\u63D2\u4EF6\u6765\u5B9E\u73B0\u3002</p><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u5C31\u6765\u5199\u4E00\u4E2A Vite \u63D2\u4EF6\uFF0C\u5B9E\u73B0\u5728 React \u9879\u76EE\u80FD\u591F\u901A\u8FC7\u7EC4\u4EF6\u65B9\u5F0F\u6765\u4F7F\u7528 svg \u8D44\u6E90\u3002\u9996\u5148\u5B89\u88C5\u4E00\u4E0B\u9700\u8981\u7684\u4F9D\u8D56:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i resolve </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">svgr</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">core </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u7740\u5728 <code>plugins</code> \u76EE\u5F55\u65B0\u5EFA <code>svgr.ts</code>:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Plugin</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">as</span><span style="color:#A6ACCD;"> fs </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">as</span><span style="color:#A6ACCD;"> resolve </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">resolve</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">interface</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SvgrOptions</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// svg \u8D44\u6E90\u6A21\u5757\u9ED8\u8BA4\u5BFC\u51FA\uFF0Curl \u6216\u8005\u7EC4\u4EF6</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">defaultExport</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">url</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">component</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">viteSvgrPlugin</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SvgrOptions</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defaultExport</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">url</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-svgr</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> transform</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u8F6C\u6362\u903B\u8F91: svg -&gt; React \u7EC4\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u8BA9\u6211\u4EEC\u5148\u6765\u68B3\u7406\u4E00\u4E0B\u5F00\u53D1\u9700\u6C42\uFF0C\u7528\u6237\u901A\u8FC7\u4F20\u5165 <code>defaultExport</code> \u53EF\u4EE5\u63A7\u5236 svg \u8D44\u6E90\u7684\u9ED8\u8BA4\u5BFC\u51FA:</p><ul><li>\u5F53 <code>defaultExport</code>\u4E3A <code>component</code>\uFF0C\u9ED8\u8BA4\u5F53\u505A\u7EC4\u4EF6\u6765\u4F7F\u7528\uFF0C\u5373:</li></ul><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> Logo </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./Logo.svg</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u5728\u7EC4\u4EF6\u4E2D\u76F4\u63A5\u4F7F\u7528</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Logo</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"></span></code></pre></div><ul><li>\u5F53<code>defaultExports</code>\u4E3A<code>url</code>\uFF0C\u9ED8\u8BA4\u5F53\u505A url \u4F7F\u7528\uFF0C\u5982\u679C\u9700\u8981\u7528\u4F5C\u7EC4\u4EF6\uFF0C\u53EF\u4EE5\u901A\u8FC7<code>\u5177\u540D\u5BFC\u5165</code>\u7684\u65B9\u5F0F\u6765\u652F\u6301:</li></ul><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> logoUrl</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ReactComponent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Logo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./logo.svg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// url \u4F7F\u7528</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">img</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">={</span><span style="color:#A6ACCD;">logoUrl</span><span style="color:#89DDFF;">} /&gt;</span></span>
<span class="line"><span style="color:#676E95;">// \u7EC4\u4EF6\u65B9\u5F0F\u4F7F\u7528</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Logo</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u660E\u786E\u4E86\u9700\u6C42\u4E4B\u540E\uFF0C\u63A5\u4E0B\u6765\u8BA9\u6211\u4EEC\u6765\u6574\u7406\u4E00\u4E0B\u63D2\u4EF6\u5F00\u53D1\u7684\u6574\u4F53\u601D\u8DEF\uFF0C\u4E3B\u8981\u903B\u8F91\u5728 <code>transform </code>\u94A9\u5B50\u4E2D\u5B8C\u6210\uFF0C\u6D41\u7A0B\u5982\u4E0B:</p><ul><li><ol><li>\u6839\u636E id \u5165\u53C2\u8FC7\u6EE4\u51FA svg \u8D44\u6E90\uFF1B</li></ol></li><li><ol><li>\u8BFB\u53D6 svg \u6587\u4EF6\u5185\u5BB9\uFF1B</li></ol></li><li><ol><li>\u5229\u7528 <code>@svgr/core</code> \u5C06 svg \u8F6C\u6362\u4E3A React \u7EC4\u4EF6\u4EE3\u7801;</li></ol></li><li><ol><li>\u5904\u7406\u9ED8\u8BA4\u5BFC\u51FA\u4E3A url \u7684\u60C5\u51B5\uFF1B</li></ol></li><li><ol><li>\u5C06\u7EC4\u4EF6\u7684 jsx \u4EE3\u7801\u8F6C\u8BD1\u4E3A\u6D4F\u89C8\u5668\u53EF\u8FD0\u884C\u7684\u4EE3\u7801\u3002</li></ol></li></ul><p>\u4E0B\u9762\u662F\u63D2\u4EF6\u7684\u5B8C\u6574\u7684\u4EE3\u7801\uFF0C\u4F60\u53EF\u4EE5\u53C2\u8003\u5B66\u4E60:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Plugin</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">as</span><span style="color:#A6ACCD;"> fs </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">as</span><span style="color:#A6ACCD;"> resolve </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">resolve</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">interface</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SvgrOptions</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">defaultExport</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">url</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">component</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">viteSvgrPlugin</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SvgrOptions</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Plugin</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defaultExport</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">component</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-svgr</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> transform</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// 1. \u6839\u636E id \u5165\u53C2\u8FC7\u6EE4\u51FA svg \u8D44\u6E90\uFF1B</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">endsWith</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.svg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">svgrTransform</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">require</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@svgr/core</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">transform</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u89E3\u6790 esbuild \u7684\u8DEF\u5F84\uFF0C\u540E\u7EED\u8F6C\u8BD1 jsx \u4F1A\u7528\u5230\uFF0C\u6211\u4EEC\u8FD9\u91CC\u76F4\u63A5\u62FF vite \u4E2D\u7684 esbuild \u5373\u53EF</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">esbuildPackagePath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sync</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">esbuild</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> basedir</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">require</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">esbuild</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">require</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">esbuildPackagePath</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// 2. \u8BFB\u53D6 svg \u6587\u4EF6\u5185\u5BB9\uFF1B</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">svg</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">promises</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFile</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// 3. \u5229\u7528 \`@svgr/core\` \u5C06 svg \u8F6C\u6362\u4E3A React \u7EC4\u4EF6\u4EE3\u7801</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">svgrResult</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">svgrTransform</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">svg</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> componentName</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ReactComponent</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// 4. \u5904\u7406\u9ED8\u8BA4\u5BFC\u51FA\u4E3A url \u7684\u60C5\u51B5</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">componentCode</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">svgrResult</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">defaultExport</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">url</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u52A0\u4E0A Vite \u9ED8\u8BA4\u7684 \`export default \u8D44\u6E90\u8DEF\u5F84\`</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">componentCode</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">componentCode</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">svgrResult</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">export default ReactComponent</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">export { ReactComponent }</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// 5. \u5229\u7528 esbuild\uFF0C\u5C06\u7EC4\u4EF6\u4E2D\u7684 jsx \u4EE3\u7801\u8F6C\u8BD1\u4E3A\u6D4F\u89C8\u5668\u53EF\u8FD0\u884C\u7684\u4EE3\u7801;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">esbuild</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">transform</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">componentCode</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        loader</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">jsx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        map</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// TODO</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>\u63A5\u4E0B\u6765\u8BA9\u6211\u4EEC\u5728\u9879\u76EE\u4E2D\u4F7F\u7528\u8FD9\u4E2A\u63D2\u4EF6:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> svgr </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./plugins/svgr</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u8FD4\u56DE\u7684\u914D\u7F6E</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u7701\u7565\u5176\u5B83\u63D2\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#82AAFF;">svgr</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> defaultExport</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">component</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u7740\u6211\u4EEC\u5728\u9879\u76EE\u4E2D\u7528\u7EC4\u4EF6\u7684\u65B9\u5F0F\u5F15\u5165 svg:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// App.tsx</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> Logo </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./logo.svg</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">App</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Logo</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> App</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u6253\u5F00\u6D4F\u89C8\u5668\uFF0C\u53EF\u4EE5\u770B\u5230\u7EC4\u4EF6\u5DF2\u7ECF\u6B63\u5E38\u663E\u793A:</p><img src="`+H+`" style="zoom:60%;"><h4 id="\u8C03\u8BD5\u6280\u5DE7" tabindex="-1">\u8C03\u8BD5\u6280\u5DE7 <a class="header-anchor" href="#\u8C03\u8BD5\u6280\u5DE7" aria-hidden="true">#</a></h4><p>\u5728\u5F00\u53D1\u8C03\u8BD5\u63D2\u4EF6\u7684\u8FC7\u7A0B\uFF0C\u63A8\u8350\u5927\u5BB6\u5728\u672C\u5730\u88C5\u4E0A<code>vite-plugin-inspect</code>\u63D2\u4EF6\uFF0C\u5E76\u5728 Vite \u4E2D\u4F7F\u7528\u5B83:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm i vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">inspect </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"></span></code></pre></div><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> inspect </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-inspect</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u8FD4\u56DE\u7684\u914D\u7F6E</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u7701\u7565\u5176\u5B83\u63D2\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">inspect</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u6837\u5F53\u4F60\u518D\u6B21\u542F\u52A8\u9879\u76EE\u65F6\uFF0C\u4F1A\u53D1\u73B0\u591A\u51FA\u4E00\u4E2A\u8C03\u8BD5\u5730\u5740:</p><img src="`+L+'"><p>\u4F60\u53EF\u4EE5\u901A\u8FC7\u8FD9\u4E2A\u5730\u5740\u6765\u67E5\u770B\u9879\u76EE\u4E2D\u5404\u4E2A\u6A21\u5757\u7684\u7F16\u8BD1\u7ED3\u679C\uFF1A</p><img src="'+O+'"><p>\u70B9\u51FB\u7279\u5B9A\u7684\u6587\u4EF6\u540E\uFF0C\u4F60\u53EF\u4EE5\u770B\u5230\u8FD9\u4E2A\u6A21\u5757\u7ECF\u8FC7\u5404\u4E2A\u63D2\u4EF6\u5904\u7406\u540E\u7684\u4E2D\u95F4\u7ED3\u679C\uFF0C\u5982\u4E0B\u56FE\u6240\u793A:</p><img src="'+N+`"><p>\u901A\u8FC7\u8FD9\u4E2A\u9762\u677F\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5F88\u6E05\u695A\u5730\u770B\u5230\u76F8\u5E94\u6A21\u5757\u7ECF\u8FC7\u63D2\u4EF6\u5904\u7406\u540E\u53D8\u6210\u4E86\u4EC0\u4E48\u6837\u5B50\uFF0C\u8BA9\u63D2\u4EF6\u7684\u8C03\u8BD5\u66F4\u52A0\u65B9\u4FBF\u3002</p><h3 id="\u603B\u7ED3-9" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3-9" aria-hidden="true">#</a></h3><p>\u4F60\u9700\u8981\u91CD\u70B9\u638C\u63E1 Vite <strong>\u63D2\u4EF6\u94A9\u5B50\u7684\u542B\u4E49</strong>\u3001<strong>\u4F5C\u7528\u987A\u5E8F</strong>\u4EE5\u53CA<strong>\u63D2\u4EF6\u7684\u5B9E\u6218\u5F00\u53D1</strong>\u3002</p><p>\u9996\u5148\u6211\u4EEC\u901A\u8FC7\u4E00\u4E2A\u6700\u7B80\u5355\u7684\u793A\u4F8B\u8BA9\u4F60\u5BF9 Vite \u63D2\u4EF6\u7684\u7ED3\u6784\u6709\u4E86\u521D\u6B65\u7684\u5370\u8C61\uFF0C\u7136\u540E\u5BF9 Vite \u4E2D\u7684\u5404\u79CD\u94A9\u5B50\u51FD\u6570\u8FDB\u884C\u4E86\u4ECB\u7ECD\uFF0C\u4E3B\u8981\u5305\u62EC<code>\u901A\u7528\u94A9\u5B50</code>\u548C<code>\u72EC\u6709\u94A9\u5B50</code>\uFF0C\u901A\u7528\u94A9\u5B50\u4E0E Rollup \u517C\u5BB9\uFF0C\u800C\u72EC\u6709\u94A9\u5B50\u5728 Rollup \u4E2D\u4F1A\u88AB\u5FFD\u7565\u3002\u800C\u7531\u4E8E\u4E0A\u4E00\u8282\u5DF2\u7ECF\u8BE6\u7EC6\u4ECB\u7ECD\u4E86 Rollup \u7684\u63D2\u4EF6\u673A\u5236\uFF0C\u5BF9\u4E8E\u901A\u7528\u94A9\u5B50\u6211\u4EEC\u6CA1\u6709\u7EE7\u7EED\u5C55\u5F00\uFF0C\u800C\u662F\u8BE6\u7EC6\u4ECB\u7ECD\u4E86 5 \u4E2A\u72EC\u6709\u94A9\u5B50\uFF0C\u5206\u522B\u662F: <code>config</code>\u3001<code>configResolved</code>\u3001<code>configureServer</code>\u3001<code>transformIndexHtml </code>\u548C <code>handleHotUpdate</code>\u3002\u4E0D\u4EC5\u5982\u6B64\uFF0C\u6211\u8FD8\u7ED9\u4F60\u4ECE\u5B8F\u89C2\u89D2\u5EA6\u5206\u6790\u4E86 Vite \u63D2\u4EF6\u7684\u4F5C\u7528\u573A\u666F\u548C\u4F5C\u7528\u987A\u5E8F\uFF0C\u4F60\u53EF\u4EE5\u5206\u522B\u901A\u8FC7<code>apply</code>\u548C<code>enforce</code>\u4E24\u4E2A\u53C2\u6570\u6765\u8FDB\u884C\u624B\u52A8\u7684\u63A7\u5236\u3002</p><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u6B63\u5F0F\u8FDB\u5165\u63D2\u4EF6\u5F00\u53D1\u5B9E\u6218\u7684\u73AF\u8282\uFF0C\u5B9E\u73B0\u4E86 <code>\u865A\u62DF\u6A21\u5757\u52A0\u8F7D\u63D2\u4EF6</code> \u548C <code>Svg \u7EC4\u4EF6\u52A0\u8F7D\u63D2\u4EF6</code>\uFF0C\u76F8\u4FE1\u4F60\u5DF2\u7ECF\u5BF9\u865A\u62DF\u6A21\u5757\u7684\u6982\u5FF5\u548C\u4F7F\u7528\u6709\u4E86\u76F4\u89C2\u7684\u4E86\u89E3\uFF0C\u4E5F\u80FD\u901A\u8FC7\u540E\u8005\u7684\u5F00\u53D1\u8FC7\u7A0B\u4E86\u89E3\u5230\u5982\u4F55\u5728 Vite \u4E2D\u96C6\u6210\u5176\u5B83\u7684\u524D\u7AEF\u7F16\u8BD1\u5DE5\u5177\u3002\u603B\u4F53\u6765\u8BF4\uFF0CVite \u63D2\u4EF6\u7684\u8BBE\u8BA1\u79C9\u627F\u4E86 Rollup \u7684\u63D2\u4EF6\u8BBE\u8BA1\u7406\u5FF5\uFF0C\u901A\u8FC7\u4E00\u4E2A\u4E2A\u8BED\u4E49\u5316\u7684 Hook \u6765\u7EC4\u7EC7\uFF0C\u5341\u5206\u7B80\u6D01\u548C\u7075\u6D3B\uFF0C\u4E0A\u624B\u96BE\u5EA6\u5E76\u4E0D\u5927\uFF0C\u4F46\u771F\u6B63\u96BE\u7684\u5730\u65B9\u5728\u4E8E\u5982\u4F55\u5229\u7528 Vite \u63D2\u4EF6\u53BB\u89E3\u51B3\u5B9E\u9645\u5F00\u53D1\u8FC7\u7A0B\u7684\u95EE\u9898\u3002</p><h2 id="hmr-api-\u539F\u7406" tabindex="-1">HMR API \u539F\u7406 <a class="header-anchor" href="#hmr-api-\u539F\u7406" aria-hidden="true">#</a></h2><p>\u5F00\u59CB\u4ECA\u5929\u7684\u5185\u5BB9\u4E4B\u524D\uFF0C\u6211\u60F3\u5148\u95EE\u4F60\u4E00\u4E2A\u65E5\u5E38\u5F00\u53D1\u4E2D\u7684\u95EE\u9898\uFF1A\u5728\u4EE3\u7801\u53D8\u66F4\u4E4B\u540E\uFF0C\u5982\u4F55\u5B9E\u65F6\u770B\u5230\u66F4\u65B0\u540E\u7684\u9875\u9762\u6548\u679C\u5462\uFF1F</p><p>\u5F88\u4E45\u4E4B\u524D\u901A\u8FC7 live reload \u4E5F\u5C31\u662F\u81EA\u52A8\u5237\u65B0\u9875\u9762\u7684\u65B9\u5F0F\u6765\u89E3\u51B3\u7684\u3002\u4E0D\u8FC7\u968F\u7740\u524D\u7AEF\u5DE5\u7A0B\u7684\u65E5\u76CA\u5E9E\u5927\uFF0C\u5F00\u53D1\u573A\u666F\u4E5F\u8D8A\u6765\u8D8A\u590D\u6742\uFF0C\u8FD9\u79CD <code>live reload</code> \u7684\u65B9\u5F0F\u5728\u8BF8\u591A\u7684\u573A\u666F\u4E0B\u5374\u663E\u5F97\u5341\u5206\u9E21\u808B\uFF0C\u7B80\u5355\u6765\u8BF4\u5C31\u662F <code>\u6A21\u5757\u5C40\u90E8\u66F4\u65B0</code>+<code>\u72B6\u6001\u4FDD\u5B58</code> \u7684\u9700\u6C42\u5728 <code>live reload</code> \u7684\u65B9\u6848\u6CA1\u6709\u5F97\u5230\u6EE1\u8DB3\uFF0C\u4ECE\u800C\u5BFC\u81F4\u5F00\u53D1\u4F53\u9A8C\u6B20\u4F73\u3002\u5F53\u7136\uFF0C\u9488\u5BF9\u90E8\u5206\u573A\u666F\u4E5F\u6709\u4E00\u4E9B\u4E34\u65F6\u7684\u89E3\u51B3\u65B9\u6848\uFF0C\u6BD4\u5982\u72B6\u6001\u5B58\u50A8\u5230\u6D4F\u89C8\u5668\u7684\u672C\u5730\u7F13\u5B58(localStorage \u5BF9\u8C61)\u4E2D\uFF0C\u6216\u8005\u76F4\u63A5 mock \u4E00\u4E9B\u6570\u636E\u3002\u4F46\u8FD9\u4E9B\u65B9\u5F0F\u672A\u514D\u8FC7\u4E8E\u7C97\u7CD9\uFF0C\u65E0\u6CD5\u6EE1\u8DB3\u901A\u7528\u7684\u5F00\u53D1\u573A\u666F\uFF0C\u4E14\u5B9E\u73B0\u4E0A\u4E5F\u4E0D\u591F\u4F18\u96C5\u3002</p><p>\u90A3\u4E48\uFF0C\u5982\u679C\u5728\u6539\u52A8\u4EE3\u7801\u540E\uFF0C\u60F3\u8981\u8FDB\u884C\u6A21\u5757\u7EA7\u522B\u7684\u5C40\u90E8\u66F4\u65B0\u8BE5\u600E\u4E48\u505A\u5462\uFF1F\u4E1A\u754C\u4E00\u822C\u4F7F\u7528 HMR \u6280\u672F\u6765\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\uFF0C\u50CF Webpack\u3001Parcel \u8FD9\u4E9B\u4F20\u7EDF\u7684\u6253\u5305\u5DE5\u5177\u5E95\u5C42\u90FD\u5B9E\u73B0\u4E86\u4E00\u5957 HMR API\uFF0C\u800C\u6211\u4EEC\u4ECA\u5929\u8981\u8BB2\u7684\u5C31\u662F Vite \u81EA\u5DF1\u6240\u5B9E\u73B0\u7684 HMR API\uFF0C\u76F8\u6BD4\u4E8E\u4F20\u7EDF\u7684\u6253\u5305\u5DE5\u5177\uFF0CVite \u7684 HMR API \u57FA\u4E8E ESM \u6A21\u5757\u89C4\u8303\u6765\u5B9E\u73B0\uFF0C\u53EF\u4EE5\u8FBE\u5230\u6BEB\u79D2\u7EA7\u522B\u7684\u66F4\u65B0\u901F\u5EA6\uFF0C\u6027\u80FD\u975E\u5E38\u5F3A\u608D\u3002\u63A5\u4E0B\u6765\uFF0C\u8BA9\u6211\u4EEC\u4E00\u8D77\u6765\u8C08\u8C08\u5728 Vite \u5F53\u4E2D\uFF0C\u8FD9\u4E00\u5957 HMR \u76F8\u5173\u7684 API \u662F\u5982\u4F55\u8BBE\u8BA1\u7684\uFF0C\u4EE5\u53CA\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u8FD9\u4E9B API \u5B9E\u73B0\u54EA\u4E9B\u529F\u80FD\u3002</p><h3 id="hmr-\u7B80\u4ECB" tabindex="-1">HMR \u7B80\u4ECB <a class="header-anchor" href="#hmr-\u7B80\u4ECB" aria-hidden="true">#</a></h3><p>HMR \u7684\u5168\u79F0\u53EB\u505A <code>Hot Module Replacement</code>\uFF0C\u5373<code>\u6A21\u5757\u70ED\u66FF\u6362</code>\u6216\u8005<code>\u6A21\u5757\u70ED\u66F4\u65B0</code>\u3002\u5728\u8BA1\u7B97\u673A\u9886\u57DF\u5F53\u4E2D\u4E5F\u6709\u4E00\u4E2A\u7C7B\u4F3C\u7684\u6982\u5FF5\u53EB<code>\u70ED\u63D2\u62D4</code>\uFF0C\u6211\u4EEC\u7ECF\u5E38\u4F7F\u7528\u7684 USB \u8BBE\u5907\u5C31\u662F\u4E00\u4E2A\u5178\u578B\u7684\u4EE3\u8868\uFF0C\u5F53\u6211\u4EEC\u63D2\u5165 U \u76D8\u7684\u65F6\u5019\uFF0C\u7CFB\u7EDF\u9A71\u52A8\u4F1A\u52A0\u8F7D\u5728\u65B0\u589E\u7684 U \u76D8\u5185\u5BB9\uFF0C\u4E0D\u4F1A\u91CD\u542F\u7CFB\u7EDF\uFF0C\u4E5F\u4E0D\u4F1A\u4FEE\u6539\u7CFB\u7EDF\u5176\u5B83\u6A21\u5757\u7684\u5185\u5BB9\u3002HMR \u7684\u4F5C\u7528\u5176\u5B9E\u4E00\u6837\uFF0C\u5C31\u662F\u5728\u9875\u9762\u6A21\u5757\u66F4\u65B0\u7684\u65F6\u5019\uFF0C\u76F4\u63A5\u628A<strong>\u9875\u9762\u4E2D\u53D1\u751F\u53D8\u5316\u7684\u6A21\u5757\u66FF\u6362\u4E3A\u65B0\u7684\u6A21\u5757</strong>\uFF0C\u540C\u65F6\u4E0D\u4F1A\u5F71\u54CD\u5176\u5B83\u6A21\u5757\u7684\u6B63\u5E38\u8FD0\u4F5C\u3002\u901A\u8FC7 HMR \u7684\u6280\u672F\u6211\u4EEC\u5C31\u53EF\u4EE5\u5B9E\u73B0<code>\u5C40\u90E8\u5237\u65B0</code>\u548C<code>\u72B6\u6001\u4FDD\u5B58</code>\uFF0C\u4ECE\u800C\u89E3\u51B3\u4E4B\u524D\u63D0\u5230\u7684\u79CD\u79CD\u95EE\u9898\u3002</p><h3 id="hmr-api" tabindex="-1">HMR API <a class="header-anchor" href="#hmr-api" aria-hidden="true">#</a></h3><p>Vite \u4F5C\u4E3A\u4E00\u4E2A\u5B8C\u6574\u7684\u6784\u5EFA\u5DE5\u5177\uFF0C\u672C\u8EAB\u5B9E\u73B0\u4E86\u4E00\u5957 HMR \u7CFB\u7EDF\uFF0C\u503C\u5F97\u6CE8\u610F\u7684\u662F\uFF0C\u8FD9\u5957 HMR \u7CFB\u7EDF\u57FA\u4E8E\u539F\u751F\u7684 ESM \u6A21\u5757\u89C4\u8303\u6765\u5B9E\u73B0\uFF0C\u5728\u6587\u4EF6\u53D1\u751F\u6539\u53D8\u65F6 Vite \u4F1A\u4FA6\u6D4B\u5230\u76F8\u5E94 ES \u6A21\u5757\u7684\u53D8\u5316\uFF0C\u4ECE\u800C\u89E6\u53D1\u76F8\u5E94\u7684 API\uFF0C\u5B9E\u73B0\u5C40\u90E8\u7684\u66F4\u65B0\u3002</p><p>Vite \u7684 HMR API \u8BBE\u8BA1\u4E5F\u5E76\u975E\u7A7A\u7A74\u6765\u98CE\uFF0C\u5B83\u57FA\u4E8E\u4E00\u5957\u5B8C\u6574\u7684 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fwithastro%2Fesm-hmr" target="_blank" rel="noreferrer">ESM HMR \u89C4\u8303</a> \u6765\u5B9E\u73B0\uFF0C\u8FD9\u4E2A\u89C4\u8303\u7531\u540C\u65F6\u671F\u7684 no-bundle \u6784\u5EFA\u5DE5\u5177 Snowpack\u3001WMR \u4E0E Vite \u4E00\u8D77\u5236\u5B9A\uFF0C\u662F\u4E00\u4E2A\u6BD4\u8F83\u901A\u7528\u7684\u89C4\u8303\u3002</p><p>\u6211\u4EEC\u53EF\u4EE5\u76F4\u89C2\u5730\u6765\u770B\u4E00\u770B HMR API \u7684\u7C7B\u578B\u5B9A\u4E49:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">interface</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ImportMeta</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">readonly</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">hot</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">readonly</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">accept</span><span style="color:#89DDFF;">():</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">void</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">accept</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">cb</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">mod</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">void</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">void</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">accept</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">dep</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">cb</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">mod</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">void</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">void</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">accept</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">deps</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#A6ACCD;">[]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">cb</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">mods</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#A6ACCD;">[]</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">void</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">void</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">prune</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">cb</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">void</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">void</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">dispose</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">cb</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">void</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">void</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">decline</span><span style="color:#89DDFF;">():</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">void</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">invalidate</span><span style="color:#89DDFF;">():</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">void</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">on</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">event</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">cb</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(...</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#A6ACCD;">[]</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">void</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">void</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u91CC\u7A0D\u5FAE\u89E3\u91CA\u4E00\u4E0B\uFF0C<code>i<wbr>mport.meta </code>\u5BF9\u8C61\u4E3A\u73B0\u4EE3\u6D4F\u89C8\u5668\u539F\u751F\u7684\u4E00\u4E2A\u5185\u7F6E\u5BF9\u8C61\uFF0CVite \u6240\u505A\u7684\u4E8B\u60C5\u5C31\u662F\u5728\u8FD9\u4E2A\u5BF9\u8C61\u4E0A\u7684 <code>hot</code> \u5C5E\u6027\u4E2D\u5B9A\u4E49\u4E86\u4E00\u5957\u5B8C\u6574\u7684\u5C5E\u6027\u548C\u65B9\u6CD5\u3002\u56E0\u6B64\uFF0C\u5728 Vite \u5F53\u4E2D\uFF0C\u4F60\u5C31\u53EF\u4EE5\u901A\u8FC7 <code>i<wbr>mport.meta.hot</code> \u6765\u8BBF\u95EE\u5173\u4E8E HMR \u7684\u8FD9\u4E9B\u5C5E\u6027\u548C\u65B9\u6CD5\uFF0C\u6BD4\u5982<code>i<wbr>mport.meta.hot.accept()</code>\u3002</p><h4 id="hot-accept" tabindex="-1">hot.accept <a class="header-anchor" href="#hot-accept" aria-hidden="true">#</a></h4><p>\u5728 <code>i<wbr>mport.meta.hot</code> \u5BF9\u8C61\u4E0A\u6709\u4E00\u4E2A\u975E\u5E38\u5173\u952E\u7684\u65B9\u6CD5<code>accept</code>\uFF0C\u56E0\u4E3A\u5B83\u51B3\u5B9A\u4E86 Vite \u8FDB\u884C\u70ED\u66F4\u65B0\u7684\u8FB9\u754C\uFF0C\u90A3\u4E48\u5982\u4F55\u6765\u7406\u89E3\u8FD9\u4E2A<code>accept</code>\u7684\u542B\u4E49\u5462\uFF1F</p><p>\u4ECE\u5B57\u9762\u4E0A\u6765\u770B\uFF0C\u5B83\u8868\u793A\u63A5\u53D7\u7684\u610F\u601D\u3002\u5B83\u662F\u7528\u6765<strong>\u63A5\u53D7\u6A21\u5757\u66F4\u65B0</strong>\u7684\u3002 \u4E00\u65E6 Vite \u63A5\u53D7\u4E86\u8FD9\u4E2A\u66F4\u65B0\uFF0C\u5F53\u524D\u6A21\u5757\u5C31\u4F1A\u88AB\u8BA4\u4E3A\u662F HMR \u7684\u8FB9\u754C\u3002\u90A3\u4E48\uFF0CVite \u63A5\u53D7\u8C01\u7684\u66F4\u65B0\u5462\uFF1F\u8FD9\u91CC\u4F1A\u6709\u4E09\u79CD\u60C5\u51B5\uFF1A</p><ul><li>\u63A5\u53D7<strong>\u81EA\u8EAB\u6A21\u5757</strong>\u7684\u66F4\u65B0</li><li>\u63A5\u53D7<strong>\u67D0\u4E2A\u5B50\u6A21\u5757</strong>\u7684\u66F4\u65B0</li><li>\u63A5\u53D7<strong>\u591A\u4E2A\u5B50\u6A21\u5757</strong>\u7684\u66F4\u65B0</li></ul><p>\u8FD9\u4E09\u79CD\u60C5\u51B5\u5206\u522B\u5BF9\u5E94 accept \u65B9\u6CD5\u4E09\u79CD\u4E0D\u540C\u7684\u4F7F\u7528\u65B9\u5F0F\uFF0C\u4E0B\u9762\u6211\u4EEC\u5C31\u4E00\u8D77\u6765\u5206\u6790\u4E00\u4E0B\u3002</p><h5 id="\u63A5\u6536\u81EA\u8EAB\u66F4\u65B0" tabindex="-1">\u63A5\u6536\u81EA\u8EAB\u66F4\u65B0 <a class="header-anchor" href="#\u63A5\u6536\u81EA\u8EAB\u66F4\u65B0" aria-hidden="true">#</a></h5><p>\u5F53\u6A21\u5757\u63A5\u53D7\u81EA\u8EAB\u7684\u66F4\u65B0\u65F6\uFF0C\u5219\u5F53\u524D\u6A21\u5757\u4F1A\u88AB\u8BA4\u4E3A HMR \u7684\u8FB9\u754C\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C\u9664\u4E86\u5F53\u524D\u6A21\u5757\uFF0C\u5176\u4ED6\u7684\u6A21\u5757\u5747\u672A\u53D7\u5230\u4EFB\u4F55\u5F71\u54CD\u3002</p><p>\u4E3A\u4E86\u52A0\u6DF1\u4F60\u7684\u7406\u89E3\uFF0C\u8FD9\u91CC\u6211\u4EEC\u4EE5\u4E00\u4E2A<a href="./.html">\u5B9E\u9645\u7684\u4F8B\u5B50</a>\u8FDB\u884C\u6D4B\u8BD5\u3002\u9996\u5148\u5C55\u793A\u4E00\u4E0B\u6574\u4F53\u7684\u76EE\u5F55\u7ED3\u6784:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">.</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 favicon</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">svg</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">html</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u2514\u2500\u2500 </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 package</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">json</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 src</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u251C\u2500\u2500 main</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ts</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u251C\u2500\u2500 render</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ts</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u251C\u2500\u2500 state</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ts</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u251C\u2500\u2500 style</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">css</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u2514\u2500\u2500 vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">env</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">d</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ts</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2514\u2500\u2500 tsconfig</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">json</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u91CC\u653E\u51FA\u4E00\u4E9B\u5173\u952E\u6587\u4EF6\u7684\u5185\u5BB9\uFF0C\u5982\u4E0B\u9762\u7684 <code>index.html</code>\uFF1A</p><div class="language-html"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F07178;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">lang</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">en</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">charset</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UTF-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">link</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">rel</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">icon</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">image/svg+xml</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">href</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">favicon.svg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">viewport</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">content</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width=device-width, initial-scale=1.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">Vite App</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">app</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      count: </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">span</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">count</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">0</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">span</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">    &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/main.ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u91CC\u9762\u7684 DOM \u7ED3\u6784\u6BD4\u8F83\u7B80\u5355\uFF0C\u540C\u65F6\u5F15\u5165\u4E86 <code>/src/main.ts</code> \u8FD9\u4E2A\u6587\u4EF6\uFF0C\u5185\u5BB9\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">render</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./render</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">initState</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./state</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">initState</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u6587\u4EF6\u4F9D\u8D56\u4E86 <code>render.ts</code> \u548C <code>state.ts</code>\uFF0C\u524D\u8005\u8D1F\u8D23\u6E32\u67D3\u6587\u672C\u5185\u5BB9\uFF0C\u800C\u540E\u8005\u8D1F\u8D23\u8BB0\u5F55\u5F53\u524D\u7684\u9875\u9762\u72B6\u6001:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// src/render.ts</span></span>
<span class="line"><span style="color:#676E95;">// \u8D1F\u8D23\u6E32\u67D3\u6587\u672C\u5185\u5BB9</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./style.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> render </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">app</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">querySelector</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">HTMLDivElement</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">!</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">innerHTML</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">    &lt;h1&gt;Hello Vite!&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">    &lt;p target=&quot;_blank&quot;&gt;This is hmr test.123&lt;/p&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">  </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// src/state.ts</span></span>
<span class="line"><span style="color:#676E95;">// \u8D1F\u8D23\u8BB0\u5F55\u5F53\u524D\u7684\u9875\u9762\u72B6\u6001</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">initState</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">count</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">setInterval</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">countEle</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">count</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">countEle</span><span style="color:#89DDFF;">!.</span><span style="color:#A6ACCD;">innerText</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;">  </span><span style="color:#89DDFF;">++</span><span style="color:#A6ACCD;">count</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u4ED3\u5E93\u5F53\u4E2D\u5173\u952E\u7684\u4EE3\u7801\u5C31\u76EE\u524D\u8FD9\u4E9B\u4E86\u3002\u73B0\u5728\uFF0C\u4F60\u53EF\u4EE5\u6267\u884C <code>pnpm i</code> \u5B89\u88C5\u4F9D\u8D56\uFF0C\u7136\u540E <code>npm run dev</code> \u542F\u52A8\u9879\u76EE\u3002</p><p>\u6BCF\u9694\u4E00\u79D2\u949F\uFF0C\u4F60\u53EF\u4EE5\u770B\u5230\u8FD9\u91CC\u7684 <code>count</code> \u503C\u4F1A\u52A0\u4E00\u3002\u73B0\u5728\u4F60\u53EF\u4EE5\u8BD5\u7740\u6539\u52A8\u4E00\u4E0B <code>render.ts</code> \u7684\u6E32\u67D3\u5185\u5BB9\uFF0C\u6BD4\u5982\u589E\u52A0\u4E00\u4E9B\u6587\u672C:</p><div class="language-diff"><button class="copy"></button><span class="lang">diff</span><pre><code><span class="line"><span style="color:#A6ACCD;">// render.ts</span></span>
<span class="line"><span style="color:#A6ACCD;">export const render = () =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  const app = document.querySelector&lt;HTMLDivElement&gt;(&#39;#app&#39;)!</span></span>
<span class="line"><span style="color:#A6ACCD;">  app.innerHTML = \`</span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;h1&gt;Hello Vite!&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">   &lt;p target=&quot;_blank&quot;&gt;This is hmr test.123 \u8FD9\u662F\u589E\u52A0\u7684\u6587\u672C&lt;/p&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  \`</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>\u9875\u9762\u7684\u6E32\u67D3\u5185\u5BB9\u5DF2\u7ECF\u66F4\u65B0\uFF0C\u4F46\u4E0D\u77E5\u9053\u4F60\u6709\u6CA1\u6709\u6CE8\u610F\u5230\u6700\u4E0B\u9762\u7684<code>count</code>\u503C\u77AC\u95F4\u88AB\u7F6E\u96F6\u4E86\uFF0C\u5E76\u4E14\u67E5\u770B\u63A7\u5236\u53F0\uFF0C\u4E5F\u6709\u8FD9\u6837\u7684 log\uFF1A</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">[vite] page reload src</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">render</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ts</span></span>
<span class="line"></span></code></pre></div><p>\u5F88\u660E\u663E\uFF0C\u5F53 <code>render.ts</code> \u6A21\u5757\u53D1\u751F\u53D8\u66F4\u65F6\uFF0CVite \u53D1\u73B0\u5E76\u6CA1\u6709 HMR \u76F8\u5173\u7684\u5904\u7406\uFF0C\u7136\u540E\u76F4\u63A5\u5237\u65B0\u9875\u9762\u4E86\u3002</p><p>\u73B0\u5728\u8BA9\u6211\u4EEC\u5728 <code>render.ts</code> \u4E2D\u52A0\u4E0A\u5982\u4E0B\u7684\u4EE3\u7801:</p><div class="language-diff"><button class="copy"></button><span class="lang">diff</span><pre><code><span class="line"><span style="color:#A6ACCD;">// \u6761\u4EF6\u5B88\u536B</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;"> if (i<wbr>mport.meta.hot) {</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">  i<wbr>mport.meta.hot.accept((mod) =&gt; mod.render())</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;"> }</span></span>
<span class="line"></span></code></pre></div><p><code>i<wbr>mport.meta.hot</code> \u5BF9\u8C61\u53EA\u6709\u5728\u5F00\u53D1\u9636\u6BB5\u624D\u4F1A\u88AB\u6CE8\u5165\u5230\u5168\u5C40\uFF0C\u751F\u4EA7\u73AF\u5883\u662F\u8BBF\u95EE\u4E0D\u5230\u7684\uFF0C\u53E6\u5916\u589E\u52A0\u6761\u4EF6\u5B88\u536B\u4E4B\u540E\uFF0C\u6253\u5305\u65F6\u8BC6\u522B\u5230 if \u6761\u4EF6\u4E0D\u6210\u7ACB\uFF0C\u4F1A\u81EA\u52A8\u628A\u8FD9\u90E8\u5206\u4EE3\u7801\u4ECE\u6253\u5305\u4EA7\u7269\u4E2D\u79FB\u9664\uFF0C\u6765\u4F18\u5316\u8D44\u6E90\u4F53\u79EF\u3002\u56E0\u6B64\uFF0C\u6211\u4EEC\u9700\u8981\u589E\u52A0\u8FD9\u4E2A\u6761\u4EF6\u5B88\u536B\u8BED\u53E5\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u53EF\u4EE5\u6CE8\u610F\u5230\u6211\u4EEC\u5BF9\u4E8E <code>i<wbr>mport.meta.hot.accept</code> \u7684\u4F7F\u7528:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hot</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">accept</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">mod</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> mod</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;">())</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u91CC\u6211\u4EEC\u4F20\u5165\u4E86\u4E00\u4E2A\u56DE\u8C03\u51FD\u6570\u4F5C\u4E3A\u53C2\u6570\uFF0C\u5165\u53C2\u5373\u4E3A Vite \u7ED9\u6211\u4EEC\u63D0\u4F9B\u7684\u66F4\u65B0\u540E\u7684\u6A21\u5757\u5185\u5BB9\uFF0C\u5728\u6D4F\u89C8\u5668\u4E2D\u6253\u5370 <code>mod</code> \u5185\u5BB9\u5982\u4E0B\uFF0C\u6B63\u597D\u662F<code>render</code> \u6A21\u5757\u6700\u65B0\u7684\u5185\u5BB9:</p><p>\u6211\u4EEC\u5728\u56DE\u8C03\u4E2D\u8C03\u7528\u4E86\u4E00\u4E0B <code>mod.render</code> \u65B9\u6CD5\uFF0C\u4E5F\u5C31\u662F\u5F53\u6A21\u5757\u53D8\u52A8\u540E\uFF0C\u6BCF\u6B21\u90FD\u91CD\u65B0\u6E32\u67D3\u4E00\u904D\u5185\u5BB9\u3002\u8FD9\u65F6\u4F60\u53EF\u4EE5\u8BD5\u7740\u6539\u52A8\u4E00\u4E0B\u6E32\u67D3\u7684\u5185\u5BB9\uFF0C\u7136\u540E\u5230\u6D4F\u89C8\u5668\u4E2D\u6CE8\u610F\u4E00\u4E0B <code>count</code> \u7684\u60C5\u51B5\uFF0C\u5E76\u6CA1\u6709\u88AB\u91CD\u65B0\u7F6E\u96F6\uFF0C\u800C\u662F\u4FDD\u7559\u4E86\u539F\u6709\u7684\u72B6\u6001:</p><p>\u73B0\u5728 <code>render</code> \u6A21\u5757\u66F4\u65B0\u540E\uFF0C\u53EA\u4F1A\u91CD\u65B0\u6E32\u67D3\u8FD9\u4E2A\u6A21\u5757\u7684\u5185\u5BB9\uFF0C\u800C\u5BF9\u4E8E state \u6A21\u5757\u7684\u5185\u5BB9\u5E76\u6CA1\u6709\u5F71\u54CD\uFF0C\u5E76\u4E14\u63A7\u5236\u53F0\u7684 log \u4E5F\u53D1\u751F\u4E86\u53D8\u5316:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">[vite] hmr update </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">render</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ts</span><span style="color:#A6ACCD;"> (x3)</span></span>
<span class="line"></span></code></pre></div><p>\u73B0\u5728\u6211\u4EEC\u7B97\u662F\u5B9E\u73B0\u4E86\u521D\u6B65\u7684 HMR\uFF0C\u4E5F\u5728\u5B9E\u9645\u7684\u4EE3\u7801\u4E2D\u4F53\u4F1A\u5230\u4E86 accept \u65B9\u6CD5\u7684\u7528\u9014\u3002\u5F53\u7136\uFF0C\u5728\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\u6211\u4EEC\u4F20\u5165\u4E86\u4E00\u4E2A\u56DE\u8C03\u51FD\u6570\u6765\u624B\u52A8\u8C03\u7528 render \u903B\u8F91\uFF0C\u4F46\u4E8B\u5B9E\u4E0A\u4F60\u4E5F\u53EF\u4EE5\u4EC0\u4E48\u53C2\u6570\u90FD\u4E0D\u4F20\uFF0C\u8FD9\u6837 Vite \u53EA\u4F1A\u628A <code>render</code>\u6A21\u5757\u7684\u6700\u65B0\u5185\u5BB9\u6267\u884C\u4E00\u904D\uFF0C\u4F46 <code>render</code> \u6A21\u5757\u5185\u90E8\u53EA\u58F0\u660E\u4E86\u4E00\u4E2A\u51FD\u6570\uFF0C\u56E0\u6B64\u76F4\u63A5\u8C03\u7528 <code>i<wbr>mport.meta.hot.accept() </code>\u5E76\u4E0D\u4F1A\u91CD\u65B0\u6E32\u67D3\u9875\u9762\u3002</p><h5 id="\u63A5\u6536\u4F9D\u8D56\u6A21\u5757\u66F4\u65B0" tabindex="-1">\u63A5\u6536\u4F9D\u8D56\u6A21\u5757\u66F4\u65B0 <a class="header-anchor" href="#\u63A5\u6536\u4F9D\u8D56\u6A21\u5757\u66F4\u65B0" aria-hidden="true">#</a></h5><p>\u4E0A\u9762\u4ECB\u7ECD\u4E86 <code>\u63A5\u53D7\u81EA\u8EAB\u6A21\u5757\u66F4\u65B0</code> \u7684\u60C5\u51B5\uFF0C\u73B0\u5728\u6765\u5206\u6790\u4E00\u4E0B <code>\u63A5\u53D7\u4F9D\u8D56\u6A21\u5757\u66F4\u65B0</code> \u662F\u5982\u4F55\u505A\u5230\u7684\u3002\u5148\u7ED9\u5927\u5BB6\u653E\u4E00\u5F20\u539F\u7406\u56FE\uFF0C\u76F4\u89C2\u5730\u611F\u53D7\u4E00\u4E0B:</p><img src="`+J+`"><p>\u8FD8\u662F\u62FF\u793A\u4F8B\u9879\u76EE\u6765\u4E3E\u4F8B\uFF0C<code>main </code>\u6A21\u5757\u4F9D\u8D56 <code>render</code> \u6A21\u5757\uFF0C\u4E5F\u5C31\u662F\u8BF4\uFF0C<code>main</code>\u6A21\u5757\u662F <code>render</code> \u7236\u6A21\u5757\uFF0C\u90A3\u4E48\u6211\u4EEC\u4E5F\u53EF\u4EE5\u5728 <code>main</code> \u6A21\u5757\u4E2D\u63A5\u53D7<code>render</code>\u6A21\u5757\u7684\u66F4\u65B0\uFF0C\u6B64\u65F6 HMR \u8FB9\u754C\u5C31\u662F <code>main</code> \u6A21\u5757\u4E86\u3002</p><p>\u6211\u4EEC\u5C06 <code>render</code>\u6A21\u5757\u7684 accept \u76F8\u5173\u4EE3\u7801\u5148\u5220\u9664:</p><div class="language-diff"><button class="copy"></button><span class="lang">diff</span><pre><code><span class="line"><span style="color:#A6ACCD;">// render.ts</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> if (i<wbr>mport.meta.hot) {</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#F07178;">   i<wbr>mport.meta.hot.accept((mod) =&gt; mod.render())</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> }</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\u518D <code>main</code> \u6A21\u5757\u589E\u52A0\u5982\u4E0B\u4EE3\u7801:</p><div class="language-diff"><button class="copy"></button><span class="lang">diff</span><pre><code><span class="line"><span style="color:#A6ACCD;">// main.ts</span></span>
<span class="line"><span style="color:#A6ACCD;">import { render } from &#39;./render&#39;;</span></span>
<span class="line"><span style="color:#A6ACCD;">import &#39;./state&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">render();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">if (i<wbr>mport.meta.hot) {</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">  i<wbr>mport.meta.hot.accept(&#39;./render.ts&#39;, (newModule) =&gt; {</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">    newModule.render();</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">  })</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5728\u8FD9\u91CC\u6211\u4EEC\u540C\u6837\u662F\u8C03\u7528 accept \u65B9\u6CD5\uFF0C\u4E0E\u4E4B\u524D\u4E0D\u540C\u7684\u662F\uFF0C\u7B2C\u4E00\u4E2A\u53C2\u6570\u4F20\u5165\u4E00\u4E2A\u4F9D\u8D56\u7684\u8DEF\u5F84\uFF0C\u4E5F\u5C31\u662F <code>render</code> \u6A21\u5757\u7684\u8DEF\u5F84\uFF0C\u8FD9\u5C31\u76F8\u5F53\u4E8E\u544A\u8BC9 Vite: \u6211\u76D1\u542C\u4E86 <code>render</code> \u6A21\u5757\u7684\u66F4\u65B0\uFF0C\u5F53\u5B83\u7684\u5185\u5BB9\u66F4\u65B0\u7684\u65F6\u5019\uFF0C\u8BF7\u628A\u6700\u65B0\u7684\u5185\u5BB9\u4F20\u7ED9\u6211\u3002\u540C\u6837\u7684\uFF0C\u7B2C\u4E8C\u4E2A\u53C2\u6570\u4E2D\u5B9A\u4E49\u4E86\u6A21\u5757\u53D8\u5316\u540E\u7684\u56DE\u8C03\u51FD\u6570\uFF0C\u8FD9\u91CC\u62FF\u5230\u4E86 <code>render</code> \u6A21\u5757\u6700\u65B0\u7684\u5185\u5BB9\uFF0C\u7136\u540E\u6267\u884C\u5176\u4E2D\u7684\u6E32\u67D3\u903B\u8F91\uFF0C\u8BA9\u9875\u9762\u5C55\u793A\u6700\u65B0\u7684\u5185\u5BB9\u3002</p><p>\u901A\u8FC7\u63A5\u53D7\u4E00\u4E2A\u4F9D\u8D56\u6A21\u5757\u7684\u66F4\u65B0\uFF0C\u6211\u4EEC\u540C\u6837\u53C8\u5B9E\u73B0\u4E86 HMR \u529F\u80FD\uFF0C\u4F60\u53EF\u4EE5\u8BD5\u7740\u6539\u52A8 <code>render</code>\u6A21\u5757\u7684\u5185\u5BB9\uFF0C\u53EF\u4EE5\u53D1\u73B0\u9875\u9762\u5185\u5BB9\u6B63\u5E38\u66F4\u65B0\uFF0C\u5E76\u4E14\u72B6\u6001\u4F9D\u7136\u4FDD\u6301\u7740\u539F\u6837\u3002</p><h5 id="\u63A5\u53D7\u591A\u4E2A\u5B50\u6A21\u5757\u7684\u66F4\u65B0" tabindex="-1">\u63A5\u53D7\u591A\u4E2A\u5B50\u6A21\u5757\u7684\u66F4\u65B0 <a class="header-anchor" href="#\u63A5\u53D7\u591A\u4E2A\u5B50\u6A21\u5757\u7684\u66F4\u65B0" aria-hidden="true">#</a></h5><img src="`+U+`"><p>\u8FD9\u91CC\u7684\u610F\u601D\u662F<strong>\u7236\u6A21\u5757\u53EF\u4EE5\u63A5\u53D7\u591A\u4E2A\u5B50\u6A21\u5757\u7684\u66F4\u65B0\uFF0C\u5F53\u5176\u4E2D\u4EFB\u4F55\u4E00\u4E2A\u5B50\u6A21\u5757\u66F4\u65B0\u4E4B\u540E\uFF0C\u7236\u6A21\u5757\u4F1A\u6210\u4E3A HMR \u8FB9\u754C</strong>\u3002\u8FD8\u662F\u62FF\u4E4B\u524D\u7684\u4F8B\u5B50\u6765\u6F14\u793A\uFF0C\u73B0\u5728\u6211\u4EEC\u66F4\u6539<code>main</code>\u6A21\u5757\u4EE3\u7801:</p><div class="language-diff"><button class="copy"></button><span class="lang">diff</span><pre><code><span class="line"><span style="color:#A6ACCD;">// main.ts</span></span>
<span class="line"><span style="color:#A6ACCD;">import { render } from &#39;./render&#39;;</span></span>
<span class="line"><span style="color:#A6ACCD;">import { initState } from &#39;./state&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">render();</span></span>
<span class="line"><span style="color:#A6ACCD;">initState();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">if (i<wbr>mport.meta.hot) {</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">  i<wbr>mport.meta.hot.accept([&#39;./render.ts&#39;, &#39;./state.ts&#39;], (modules) =&gt; {</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">    console.log(modules);</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">  })</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5728\u4EE3\u7801\u4E2D\u6211\u4EEC\u901A\u8FC7 accept \u65B9\u6CD5\u63A5\u53D7\u4E86<code>render</code>\u548C<code>state</code>\u4E24\u4E2A\u6A21\u5757\u7684\u66F4\u65B0\uFF0C\u63A5\u7740\u8BA9\u6211\u4EEC\u624B\u52A8\u6539\u52A8\u4E00\u4E0B\u67D0\u4E00\u4E2A\u6A21\u5757\u7684\u4EE3\u7801\uFF0C\u89C2\u5BDF\u4E00\u4E0B\u56DE\u8C03\u4E2D<code>modules</code>\u7684\u6253\u5370\u5185\u5BB9\u3002\u4F8B\u5982\u5F53\u6211\u6539\u52A8 <code>state</code>\u6A21\u5757\u7684\u5185\u5BB9\u65F6\uFF0C\u56DE\u8C03\u4E2D\u62FF\u5230\u7684 modules \u662F\u8FD9\u6837\u7684:</p><img src="`+W+`"><p>\u53EF\u4EE5\u770B\u5230 Vite \u7ED9\u6211\u4EEC\u7684\u56DE\u8C03\u4F20\u6765\u7684\u53C2\u6570 <code>modules</code> \u5176\u5B9E\u662F\u4E00\u4E2A\u6570\u7EC4\uFF0C\u548C\u6211\u4EEC\u7B2C\u4E00\u4E2A\u53C2\u6570\u58F0\u660E\u7684\u5B50\u6A21\u5757\u6570\u7EC4\u4E00\u4E00\u5BF9\u5E94\u3002\u56E0\u6B64 <code>modules</code> \u6570\u7EC4\u7B2C\u4E00\u4E2A\u5143\u7D20\u662F <code>undefined</code>\uFF0C\u8868\u793A <code>render</code> \u6A21\u5757\u5E76\u6CA1\u6709\u53D1\u751F\u53D8\u5316\uFF0C\u7B2C\u4E8C\u4E2A\u5143\u7D20\u4E3A\u4E00\u4E2A Module \u5BF9\u8C61\uFF0C\u4E5F\u5C31\u662F\u7ECF\u8FC7\u53D8\u52A8\u540E <code>state</code> \u6A21\u5757\u7684\u6700\u65B0\u5185\u5BB9\u3002\u4E8E\u662F\u5728\u8FD9\u91CC\uFF0C\u6211\u4EEC\u6839\u636E <code>modules</code> \u8FDB\u884C\u81EA\u5B9A\u4E49\u7684\u66F4\u65B0\uFF0C\u4FEE\u6539 <code>main.ts</code>:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// main.ts</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">render</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./render</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">initState</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./state</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">initState</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hot) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hot</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">accept</span><span style="color:#F07178;">([</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./render.ts</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./state.ts</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">modules</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">renderModule</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stateModule</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">modules</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">renderModule</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">renderModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">render</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">stateModule</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">stateModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">initState</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u73B0\u5728\uFF0C\u4F60\u53EF\u4EE5\u6539\u52A8\u4E24\u4E2A\u6A21\u5757\u7684\u5185\u5BB9\uFF0C\u53EF\u4EE5\u53D1\u73B0\uFF0C\u9875\u9762\u7684\u76F8\u5E94\u6A21\u5757\u4F1A\u66F4\u65B0\uFF0C\u5E76\u4E14\u5BF9\u5176\u5B83\u7684\u6A21\u5757\u6CA1\u6709\u5F71\u54CD\u3002\u4F46\u5B9E\u9645\u4E0A\u4F60\u4F1A\u53D1\u73B0\u53E6\u5916\u4E00\u4E2A\u95EE\u9898\uFF0C\u5F53\u6539\u52A8\u4E86<code>state</code>\u6A21\u5757\u7684\u5185\u5BB9\u4E4B\u540E\uFF0C\u9875\u9762\u7684\u5185\u5BB9\u4F1A\u53D8\u5F97\u9519\u4E71:</p><img src="`+z+`"><p>\u8FD9\u662F\u4E3A\u4EC0\u4E48\u5462\uFF1F\u6211\u4EEC\u5FEB\u901F\u56DE\u987E\u4E00\u4E0B <code>state</code>\u6A21\u5757\u7684\u5185\u5BB9:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// state.ts</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">initState</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">count</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">setInterval</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">countEle</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">count</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">countEle</span><span style="color:#89DDFF;">!.</span><span style="color:#A6ACCD;">innerText</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;">  </span><span style="color:#89DDFF;">++</span><span style="color:#A6ACCD;">count</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5176\u4E2D\u8BBE\u7F6E\u4E86\u4E00\u4E2A\u5B9A\u65F6\u5668\uFF0C\u4F46\u5F53\u6A21\u5757\u66F4\u6539\u4E4B\u540E\uFF0C\u8FD9\u4E2A\u5B9A\u65F6\u5668\u5E76\u6CA1\u6709\u88AB\u9500\u6BC1\uFF0C\u7D27\u63A5\u7740\u6211\u4EEC\u5728 accept \u65B9\u6CD5\u8C03\u7528 <code>initState</code> \u65B9\u6CD5\u53C8\u521B\u5EFA\u4E86\u4E00\u4E2A\u65B0\u7684\u5B9A\u65F6\u5668\uFF0C\u5BFC\u81F4 count \u7684\u503C\u9519\u4E71\u3002\u90A3\u5982\u4F55\u6765\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\u5462\uFF1F\u8FD9\u5C31\u6D89\u53CA\u5230\u65B0\u7684 HMR \u65B9\u6CD5\u2014\u2014<code>dispose</code>\u65B9\u6CD5\u4E86\u3002</p><h4 id="hot-dispose" tabindex="-1">hot.dispose <a class="header-anchor" href="#hot-dispose" aria-hidden="true">#</a></h4><p>\u8FD9\u4E2A\u65B9\u6CD5\u76F8\u8F83\u800C\u8A00\u5C31\u597D\u7406\u89E3\u591A\u4E86\uFF0C\u4EE3\u8868\u5728\u6A21\u5757\u66F4\u65B0\u3001\u65E7\u6A21\u5757\u9700\u8981\u9500\u6BC1\u65F6\u9700\u8981\u505A\u7684\u4E00\u4E9B\u4E8B\u60C5\uFF0C\u62FF\u521A\u521A\u7684\u573A\u666F\u6765\u8BF4\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u5728 <code>state</code> \u6A21\u5757\u4E2D\u8C03\u7528 dispose \u65B9\u6CD5\u6765\u8F7B\u677E\u89E3\u51B3\u5B9A\u65F6\u5668\u5171\u5B58\u7684\u95EE\u9898\uFF0C\u4EE3\u7801\u6539\u52A8\u5982\u4E0B:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// state.ts</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> timer</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">undefined</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hot) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hot</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dispose</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">timer</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">clearInterval</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">timer</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">initState</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">count</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">timer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">setInterval</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">countEle</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">count</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">countEle</span><span style="color:#89DDFF;">!.</span><span style="color:#A6ACCD;">innerText</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;">  </span><span style="color:#89DDFF;">++</span><span style="color:#A6ACCD;">count</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u6B64\u65F6\uFF0C\u6211\u4EEC\u518D\u6765\u5230\u6D4F\u89C8\u5668\u89C2\u5BDF\u4E00\u4E0B HMR \u7684\u6548\u679C:</p><img src="`+Q+'"><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u5F53\u6211\u7A0D\u7A0D\u6539\u52A8\u4E00\u4E0B <code>state</code> \u6A21\u5757\u7684\u5185\u5BB9(\u6BD4\u5982\u52A0\u4E2A\u7A7A\u683C)\uFF0C\u9875\u9762\u786E\u5B9E\u4F1A\u66F4\u65B0\uFF0C\u800C\u4E14\u4E5F\u6CA1\u6709\u72B6\u6001\u9519\u4E71\u7684\u95EE\u9898\uFF0C\u8BF4\u660E\u6211\u4EEC\u5728\u6A21\u5757\u9500\u6BC1\u524D\u6E05\u9664\u5B9A\u65F6\u5668\u7684\u64CD\u4F5C\u662F\u751F\u6548\u7684\u3002\u4F46\u4F60\u53C8\u53EF\u4EE5\u5F88\u660E\u663E\u5730\u770B\u5230\u4E00\u4E2A\u65B0\u7684\u95EE\u9898: \u539F\u6765\u7684\u72B6\u6001\u4E22\u5931\u4E86\uFF0C<code>count</code> \u7684\u5185\u5BB9\u4ECE <code>64</code> \u7A81\u7136\u53D8\u6210<code>1</code>\u3002\u8FD9\u53C8\u662F\u4E3A\u4EC0\u4E48\u5462\uFF1F</p><p>\u8BA9\u6211\u4EEC\u6765\u91CD\u65B0\u68B3\u7406\u4E00\u904D\u70ED\u66F4\u65B0\u7684\u903B\u8F91:</p><img src="'+G+`"><p>\u5F53\u6211\u4EEC\u6539\u52A8\u4E86 <code>state</code> \u6A21\u5757\u7684\u4EE3\u7801\uFF0C<code>main</code>\u6A21\u5757\u63A5\u53D7\u66F4\u65B0\uFF0C\u6267\u884C accept \u65B9\u6CD5\u4E2D\u7684\u56DE\u8C03\uFF0C\u63A5\u7740\u4F1A\u6267\u884C <code>state</code> \u6A21\u5757\u7684 <code>initState </code>\u65B9\u6CD5\u3002\u6CE8\u610F\u4E86\uFF0C\u6B64\u65F6\u65B0\u5EFA\u7684 <code>initState</code> \u65B9\u6CD5\u7684\u786E\u4F1A\u521D\u59CB\u5316\u5B9A\u65F6\u5668\uFF0C\u4F46\u540C\u65F6\u4E5F\u4F1A\u521D\u59CB\u5316 count \u53D8\u91CF\uFF0C\u4E5F\u5C31\u662F <code>count</code> \u4ECE 0 \u5F00\u59CB\u8BA1\u6570\u4E86\uFF01</p><p>\u8FD9\u663E\u7136\u662F\u4E0D\u7B26\u5408\u9884\u671F\u7684\uFF0C\u6211\u4EEC\u671F\u671B\u7684\u662F\u6BCF\u6B21\u6539\u52A8 <code>state</code> \u6A21\u5757\uFF0C\u4E4B\u524D\u7684\u72B6\u6001\u90FD\u4FDD\u5B58\u4E0B\u6765\u3002\u600E\u4E48\u6765\u5B9E\u73B0\u5462\uFF1F</p><h4 id="hot-data" tabindex="-1">hot.data <a class="header-anchor" href="#hot-data" aria-hidden="true">#</a></h4><p>\u8FD9\u5C31\u4E0D\u5F97\u4E0D\u63D0\u5230 hot \u5BF9\u8C61\u4E0A\u7684 data \u5C5E\u6027\u4E86\uFF0C\u8FD9\u4E2A\u5C5E\u6027\u7528\u6765\u5728\u4E0D\u540C\u7684\u6A21\u5757\u5B9E\u4F8B\u95F4\u5171\u4EAB\u4E00\u4E9B\u6570\u636E\u3002 \u4F7F\u7528\u4E0A\u4E5F\u975E\u5E38\u7B80\u5355\uFF0C\u8BA9\u6211\u4EEC\u6765\u91CD\u6784\u4E00\u4E0B <code>state</code> \u6A21\u5757:</p><div class="language-diff"><button class="copy"></button><span class="lang">diff</span><pre><code><span class="line"><span style="color:#A6ACCD;">let timer: number | undefined;</span></span>
<span class="line"><span style="color:#A6ACCD;">if (i<wbr>mport.meta.hot) {</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">  // \u521D\u59CB\u5316 count</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">  if (!i<wbr>mport.meta.hot.data.count) {</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">    i<wbr>mport.meta.hot.data.count = 0;</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  i<wbr>mport.meta.hot.dispose(() =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">    if (timer) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      clearInterval(timer);</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  })</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">export function initState() {</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">  const getAndIncCount = () =&gt; {</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">    const data = i<wbr>mport.meta.hot?.data || {</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">      count: 0</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">    };</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">    data.count = data.count + 1;</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">    return data.count;</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">  };</span></span>
<span class="line"><span style="color:#A6ACCD;">  timer = setInterval(() =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">    let countEle = document.getElementById(&#39;count&#39;);</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">    countEle!.innerText =  getAndIncCount() + &#39;&#39;;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }, 1000);</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>\u6211\u4EEC\u5728 <code>i<wbr>mport.meta.hot.data</code> \u5BF9\u8C61\u4E0A\u6302\u8F7D\u4E86\u4E00\u4E2A<code>count</code> \u5C5E\u6027\uFF0C\u5728\u4E8C\u6B21\u6267\u884C <code>initState</code> \u7684\u65F6\u5019\u4FBF\u4F1A\u590D\u7528 <code>i<wbr>mport.meta.hot.data</code> \u4E0A\u8BB0\u5F55\u7684 count \u503C\uFF0C\u4ECE\u800C\u5B9E\u73B0\u72B6\u6001\u7684\u4FDD\u5B58\u3002</p><p>\u6B64\u65F6\uFF0C\u6211\u4EEC\u7EC8\u4E8E\u5927\u529F\u544A\u6210\uFF0C\u57FA\u672C\u5B9E\u73B0\u4E86\u8FD9\u4E2A\u793A\u4F8B\u5E94\u7528\u7684 HMR \u7684\u529F\u80FD\u3002\u5728\u8FD9\u4E2A\u8FC7\u7A0B\u4E2D\uFF0C\u6211\u4EEC\u7528\u5230\u4E86\u6838\u5FC3\u7684<code>accept</code>\u3001<code>dispose</code> \u548C<code>data</code> \u5C5E\u6027\u548C\u65B9\u6CD5\u3002\u5F53\u7136\u8FD8\u6709\u4E00\u4E9B\u65B9\u6CD5\u5C06\u4F1A\u7ED9\u5927\u5BB6\u8FDB\u884C\u4ECB\u7ECD\uFF0C\u4F46\u76F8\u8F83\u800C\u8A00\u5C31\u6BD4\u8F83\u7B80\u5355\u4E86\uFF0C\u800C\u4E14\u7528\u7684\u4E5F\u4E0D\u591A\uFF0C\u5927\u5BB6\u53EA\u9700\u8981\u7559\u4E0B\u521D\u6B65\u7684\u5370\u8C61\uFF0C\u77E5\u9053\u8FD9\u4E9B\u65B9\u6CD5\u7684\u7528\u9014\u662F\u4EC0\u4E48\uFF0C\u9700\u8981\u7528\u5230\u7684\u65F6\u5019\u518D\u6765\u67E5\u9605\u5373\u53EF\u3002</p><h4 id="\u5176\u4ED6\u65B9\u6CD5" tabindex="-1">\u5176\u4ED6\u65B9\u6CD5 <a class="header-anchor" href="#\u5176\u4ED6\u65B9\u6CD5" aria-hidden="true">#</a></h4><h5 id="hot-decline" tabindex="-1">hot.decline <a class="header-anchor" href="#hot-decline" aria-hidden="true">#</a></h5><p>\u8FD9\u4E2A\u65B9\u6CD5\u8C03\u7528\u4E4B\u540E\uFF0C\u76F8\u5F53\u4E8E\u8868\u793A\u6B64\u6A21\u5757\u4E0D\u53EF\u70ED\u66F4\u65B0\uFF0C\u5F53\u6A21\u5757\u66F4\u65B0\u65F6\u4F1A\u5F3A\u5236\u8FDB\u884C\u9875\u9762\u5237\u65B0\u3002</p><h5 id="hot-invalidate" tabindex="-1">hot.invalidate <a class="header-anchor" href="#hot-invalidate" aria-hidden="true">#</a></h5><p>\u5F3A\u5236\u5237\u65B0\u9875\u9762\u3002</p><h5 id="\u81EA\u5B9A\u4E49\u4E8B\u4EF6" tabindex="-1">\u81EA\u5B9A\u4E49\u4E8B\u4EF6 <a class="header-anchor" href="#\u81EA\u5B9A\u4E49\u4E8B\u4EF6" aria-hidden="true">#</a></h5><p>\u4F60\u8FD8\u53EF\u4EE5\u901A\u8FC7 <code>i<wbr>mport.meta.hot.on</code> \u6765\u76D1\u542C HMR \u7684\u81EA\u5B9A\u4E49\u4E8B\u4EF6\uFF0C\u5185\u90E8\u6709\u8FD9\u51E0\u4E2A\u4E8B\u4EF6\u4F1A\u81EA\u52A8\u89E6\u53D1:</p><ul><li><code>vite:beforeUpdate</code> \u5F53\u6A21\u5757\u66F4\u65B0\u65F6\u89E6\u53D1\uFF1B</li><li><code>vite:beforeFullReload</code> \u5F53\u5373\u5C06\u91CD\u65B0\u5237\u65B0\u9875\u9762\u65F6\u89E6\u53D1\uFF1B</li><li><code>vite:beforePrune</code> \u5F53\u4E0D\u518D\u9700\u8981\u7684\u6A21\u5757\u5373\u5C06\u88AB\u5254\u9664\u65F6\u89E6\u53D1\uFF1B</li><li><code>vite:error</code> \u5F53\u53D1\u751F\u9519\u8BEF\u65F6\uFF08\u4F8B\u5982\uFF0C\u8BED\u6CD5\u9519\u8BEF\uFF09\u89E6\u53D1\u3002</li></ul><p>\u5982\u679C\u4F60\u60F3\u81EA\u5B9A\u4E49\u4E8B\u4EF6\u53EF\u4EE5\u901A\u8FC7\u4E0A\u8282\u4E2D\u63D0\u5230\u7684 <code>handleHotUpdate</code> \u8FD9\u4E2A\u63D2\u4EF6 Hook \u6765\u8FDB\u884C\u89E6\u53D1:</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// \u63D2\u4EF6 Hook</span></span>
<span class="line"><span style="color:#82AAFF;">handleHotUpdate</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> server </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ws</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    type</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">custom</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    event</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">custom-update</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    data</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">// \u524D\u7AEF\u4EE3\u7801</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hot</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">custom-update</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u81EA\u5B9A\u4E49\u66F4\u65B0\u903B\u8F91</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="\u603B\u7ED3-10" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3-10" aria-hidden="true">#</a></h3><p>\u5728\u8FD9\u4E00\u8282\u4E2D\uFF0C\u4F60\u9700\u8981\u91CD\u70B9\u638C\u63E1 <strong>HMR \u7684\u6982\u5FF5</strong>\u3001**Vite HMR API \u7684\u4F7F\u7528 **\u4EE5\u53CA <strong>HMR \u7684\u66F4\u65B0\u539F\u7406</strong>\u3002</p><p>\u6211\u4EEC\u9996\u5148\u8BA4\u8BC6\u4E86 HMR \u8FD9\u4E2A\u6982\u5FF5\uFF0C\u4E86\u89E3\u5B83\u76F8\u6BD4\u4E8E\u4F20\u7EDF\u7684 live reload \u6240\u89E3\u51B3\u7684\u95EE\u9898\uFF1A<code>\u6A21\u5757\u5C40\u90E8\u66F4\u65B0</code>\u548C<code>\u72B6\u6001\u4FDD\u5B58</code>\u3002\u7136\u540E\u6211\u5E26\u4F60\u719F\u6089\u4E86 Vite HMR \u4E2D\u7684\u5404\u79CD API\uFF0C\u5C24\u5176\u662F accept \u65B9\u6CD5\uFF0C\u6839\u636E accept \u7684\u4E0D\u540C\u7528\u6CD5\uFF0C\u6211\u4EEC\u5206\u4E86\u4E09\u79CD\u60C5\u51B5\u6765\u8BA8\u8BBA Vite \u63A5\u53D7\u66F4\u65B0\u7684\u7B56\u7565: <code>\u63A5\u53D7\u81EA\u8EAB\u66F4\u65B0</code>\u3001<code>\u63A5\u53D7\u4F9D\u8D56\u6A21\u5757\u7684\u66F4\u65B0</code>\u548C<code>\u63A5\u53D7\u591A\u4E2A\u5B50\u6A21\u5757\u7684\u66F4\u65B0</code>\uFF0C\u5E76\u901A\u8FC7\u5177\u4F53\u7684\u793A\u4F8B\u6765\u8FDB\u884C\u8FD9\u4E09\u79CD\u60C5\u51B5\u7684\u4EE3\u7801\u6F14\u793A\uFF0C\u53EF\u4EE5\u770B\u5230\u5728\u4EE3\u7801\u53D1\u751F\u53D8\u52A8\u7684\u65F6\u5019\uFF0CVite \u4F1A\u5B9A\u4F4D\u5230\u53D1\u751F\u53D8\u5316\u7684\u5C40\u90E8\u6A21\u5757\uFF0C\u4E5F\u5C31\u662F\u627E\u5230\u5BF9\u5E94\u7684 HMR \u8FB9\u754C\uFF0C\u7136\u540E\u57FA\u4E8E\u8FD9\u4E2A\u8FB9\u754C\u8FDB\u884C\u66F4\u65B0\uFF0C\u5176\u4ED6\u7684\u6A21\u5757\u5E76\u6CA1\u6709\u53D7\u5230\u5F71\u54CD\uFF0C\u8FD9\u4E5F\u662F Vite \u4E2D\u7684\u70ED\u66F4\u65B0\u7684\u65F6\u95F4\u4E5F\u5230\u8FBE\u6BEB\u79D2\u7EA7\u522B\u7684\u91CD\u8981\u539F\u56E0\u3002</p><p>\u5728 Vite \u4E2D\uFF0CHMR \u662F\u4E00\u5957\u6BD4\u8F83\u590D\u6742\u7684\u7CFB\u7EDF\uFF0C\u4E0D\u8FC7\u4E00\u65E6\u7406\u89E3\u4E86\u672C\u6587\u63D0\u5230\u7684<code>HMR \u8FB9\u754C</code>\u7684\u4F5C\u7528\u539F\u7406\uFF0C\u90A3\u4E48\u5728\u540E\u9762\u89E3\u8BFB Vite HMR \u6E90\u7801\u7684\u65F6\u5019\u5C06\u4F1A\u500D\u611F\u8F7B\u677E\u3002\u5927\u5BB6\u52A0\u6CB9\u5427\uFF01</p><h2 id="\u4EE3\u7801\u5206\u5272" tabindex="-1">\u4EE3\u7801\u5206\u5272 <a class="header-anchor" href="#\u4EE3\u7801\u5206\u5272" aria-hidden="true">#</a></h2><p>\u5728\u751F\u4EA7\u73AF\u5883\u4E0B\uFF0C\u4E3A\u4E86\u63D0\u9AD8\u9875\u9762\u52A0\u8F7D\u6027\u80FD\uFF0C\u6784\u5EFA\u5DE5\u5177\u4E00\u822C\u5C06\u9879\u76EE\u7684\u4EE3\u7801\u6253\u5305(bundle)\u5230\u4E00\u8D77\uFF0C\u8FD9\u6837\u4E0A\u7EBF\u4E4B\u540E\u53EA\u9700\u8981\u8BF7\u6C42\u5C11\u91CF\u7684 JS \u6587\u4EF6\uFF0C\u5927\u5927\u51CF\u5C11 HTTP \u8BF7\u6C42\u3002Vite \u4E5F\u4E0D\u4F8B\u5916\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B Vite \u5229\u7528\u5E95\u5C42\u6253\u5305\u5F15\u64CE Rollup \u6765\u5B8C\u6210\u9879\u76EE\u7684\u6A21\u5757\u6253\u5305\u3002</p><p>\u67D0\u79CD\u610F\u4E49\u4E0A\u6765\u8BF4\uFF0C\u5BF9\u7EBF\u4E0A\u73AF\u5883\u8FDB\u884C\u9879\u76EE\u6253\u5305\u662F\u4E00\u4E2A\u5FC5\u987B\u7684\u64CD\u4F5C\u3002\u4F46\u968F\u7740\u524D\u7AEF\u5DE5\u7A0B\u7684\u65E5\u6E10\u590D\u6742\uFF0C\u5355\u4EFD\u7684\u6253\u5305\u4EA7\u7269\u4F53\u79EF\u8D8A\u6765\u8D8A\u5E9E\u5927\uFF0C\u4F1A\u51FA\u73B0\u4E00\u7CFB\u5217\u5E94\u7528\u52A0\u8F7D\u6027\u80FD\u95EE\u9898\uFF0C\u800C\u4EE3\u7801\u5206\u5272\u53EF\u4EE5\u5F88\u597D\u5730\u89E3\u51B3\u5B83\u4EEC\u3002</p><p>\u672C\u7BC7\u6587\u7AE0\uFF0C\u6211\u4EEC\u5C06\u56F4\u7ED5<code>\u4EE3\u7801\u5206\u5272</code>\u5C55\u5F00\u5B66\u4E60\u3002\u9996\u5148\u6211\u4EEC\u5C06\u4E00\u8D77\u5206\u6790<code>Code Splitting</code> \u89E3\u51B3\u4E86\u5355\u4EA7\u7269\u6253\u5305\u6A21\u5F0F\u4E0B\u7684\u54EA\u4E9B\u95EE\u9898\uFF0C\u7136\u540E\u7528\u5177\u4F53\u7684\u9879\u76EE\u793A\u4F8B\u4F53\u9A8C\u4E00\u4E0B Vite \u9ED8\u8BA4\u81EA\u5E26\u7684 <code>Code Splitting</code> \u6548\u679C\u3002\u4ECE\u4E2D\uFF0C\u4F60\u5C06\u4E86\u89E3\u5230 Vite \u7684\u9ED8\u8BA4\u5206\u5305\u7B56\u7565\uFF0C\u4EE5\u53CA\u5E95\u5C42\u6240\u4F7F\u7528\u7684 Rollup \u62C6\u5305 API \u2014\u2014 <code>munaulChunks</code>\u3002</p><p>\u5F53\u7136\uFF0C\u5728\u5B9E\u9645\u7684\u9879\u76EE\u573A\u666F\u4E2D\uFF0C\u53EA\u7528 Vite \u9ED8\u8BA4\u7684\u7B56\u7565\u662F\u4E0D\u591F\u7684\uFF0C\u6211\u4EEC\u4F1A\u66F4\u6DF1\u5165\u4E00\u6B65\uFF0C\u5B66\u4E60 Rollup \u5E95\u5C42\u62C6\u5305\u7684\u5404\u79CD\u9AD8\u7EA7\u59FF\u52BF\uFF0C\u5B9E\u73B0<strong>\u81EA\u5B9A\u4E49\u62C6\u5305</strong>\u3002\u540C\u65F6\u6211\u4E5F\u4F1A\u5E26\u5927\u5BB6\u901A\u8FC7\u5B9E\u9645\u6848\u4F8B\u590D\u73B0 Rollup \u81EA\u5B9A\u4E49\u62C6\u5305\u7ECF\u5E38\u9047\u5230\u7684\u5751\u2014\u2014<code>\u5FAA\u73AF\u5F15\u7528</code>\u95EE\u9898\uFF0C\u4E00\u8D77\u5206\u6790\u95EE\u9898\u51FA\u73B0\u7684\u539F\u56E0\uFF0C\u4E5F\u5206\u4EAB\u4E00\u4E9B\u81EA\u5DF1\u7684\u89E3\u51B3\u601D\u8DEF\u548C\u65B9\u6848\uFF0C\u8BA9\u5927\u5BB6\u5BF9 Vite \u53CA Rollup \u7684\u4EE3\u7801\u5206\u5272\u6709\u66F4\u52A0\u6DF1\u5165\u7684\u638C\u63E1\u3002</p><p>\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u6587\u4E2D\u4F1A\u591A\u6B21\u63D0\u5230<code>bundle</code>\u3001<code>chunk</code>\u3001<code>vendor</code>\u8FD9\u4E9B\u6784\u5EFA\u9886\u57DF\u7684\u4E13\u4E1A\u6982\u5FF5\uFF0C\u8FD9\u91CC\u7ED9\u5927\u5BB6\u63D0\u524D\u89E3\u91CA\u4E00\u4E0B:</p><ul><li><code>bundle</code> \u6307\u7684\u662F\u6574\u4F53\u7684\u6253\u5305\u4EA7\u7269\uFF0C\u5305\u542B JS \u548C\u5404\u79CD\u9759\u6001\u8D44\u6E90\u3002</li><li><code>chunk</code>\u6307\u7684\u662F\u6253\u5305\u540E\u7684 JS \u6587\u4EF6\uFF0C\u662F <code>bundle</code> \u7684\u5B50\u96C6\u3002</li><li><code>vendor</code>\u662F\u6307\u7B2C\u4E09\u65B9\u5305\u7684\u6253\u5305\u4EA7\u7269\uFF0C\u662F\u4E00\u79CD\u7279\u6B8A\u7684 chunk\u3002</li></ul><h3 id="code-splitting-\u89E3\u51B3\u7684\u95EE\u9898" tabindex="-1">Code Splitting \u89E3\u51B3\u7684\u95EE\u9898 <a class="header-anchor" href="#code-splitting-\u89E3\u51B3\u7684\u95EE\u9898" aria-hidden="true">#</a></h3><p>\u5728\u4F20\u7EDF\u7684\u5355 chunk \u6253\u5305\u6A21\u5F0F\u4E0B\uFF0C\u5F53\u9879\u76EE\u4EE3\u7801\u8D8A\u6765\u8D8A\u5E9E\u5927\uFF0C\u6700\u540E\u4F1A\u5BFC\u81F4\u6D4F\u89C8\u5668\u4E0B\u8F7D\u4E00\u4E2A\u5DE8\u5927\u7684\u6587\u4EF6\uFF0C\u4ECE\u9875\u9762\u52A0\u8F7D\u6027\u80FD\u7684\u89D2\u5EA6\u6765\u8BF4\uFF0C\u4E3B\u8981\u4F1A\u5BFC\u81F4\u4E24\u4E2A\u95EE\u9898:</p><ol><li>\u65E0\u6CD5\u505A\u5230<strong>\u6309\u9700\u52A0\u8F7D</strong>\uFF0C\u5373\u4F7F\u662F\u5F53\u524D\u9875\u9762\u4E0D\u9700\u8981\u7684\u4EE3\u7801\u4E5F\u4F1A\u8FDB\u884C\u52A0\u8F7D\u3002</li><li>\u7EBF\u4E0A<strong>\u7F13\u5B58\u590D\u7528\u7387</strong>\u6781\u4F4E\uFF0C\u6539\u52A8\u4E00\u884C\u4EE3\u7801\u5373\u53EF\u5BFC\u81F4\u6574\u4E2A bundle \u4EA7\u7269\u7F13\u5B58\u5931\u6548\u3002</li></ol><h2 id="\u63D2\u4EF6\u6D41\u6C34\u7EBF" tabindex="-1">\u63D2\u4EF6\u6D41\u6C34\u7EBF <a class="header-anchor" href="#\u63D2\u4EF6\u6D41\u6C34\u7EBF" aria-hidden="true">#</a></h2><p>\u5728\u5F00\u53D1\u9636\u6BB5\uFF0CVite \u5B9E\u73B0\u4E86\u4E00\u4E2A\u6309\u9700\u52A0\u8F7D\u7684\u670D\u52A1\u5668\uFF0C\u6BCF\u4E00\u4E2A\u6587\u4EF6\u8BF7\u6C42\u90FD\u4F1A\u7ECF\u5386\u4E00\u7CFB\u5217\u7684\u7F16\u8BD1\u8FC7\u7A0B\uFF0C\u7136\u540E\u518D\u5C06\u7F16\u8BD1\u7ED3\u679C\u4EA4\u7ED9 Rollup \u8FDB\u884C\u6A21\u5757\u6253\u5305\u3002</p><p>\u5728\u751F\u4EA7\u73AF\u5883\u4E0B\uFF0CVite \u540C\u6837\u4F1A\u6267\u884C\u4E00\u7CFB\u5217\u7F16\u8BD1\u8FC7\u7A0B\uFF0C\u5C06\u7F16\u8BD1\u7ED3\u679C\u4EA4\u7ED9 Rollup \u8FDB\u884C\u6A21\u5757\u6253\u5305\u3002</p><p>\u4E0A\u8FF0\u8FD9\u4E00\u7CFB\u5217\u7684\u7F16\u8BD1\u8FC7\u7A0B\u6307\u7684\u5C31\u662F Vite \u7684\u63D2\u4EF6\u6D41\u6C34\u7EBF\uFF08Pipeline\uFF09\uFF0C\u63D2\u4EF6\u6D41\u6C34\u7EBF\u662F Vite \u6784\u5EFA\u80FD\u529B\u7684\u6838\u5FC3\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u6211\u4EEC\u5C31\u4E00\u8D77\u5206\u6790\u4E00\u4E0B Vite \u662F\u5982\u4F55\u8C03\u5EA6\u548C\u7EC4\u7EC7\u5404\u4E2A\u63D2\u4EF6\uFF0C\u8BF4\u8BF4 Vite \u63D2\u4EF6\u5BB9\u5668\uFF08PluginContainer\uFF09\u673A\u5236\u7684\u5B9E\u73B0\uFF0C\u540C\u65F6\u68B3\u7406\u5F00\u53D1\u9636\u6BB5\u548C\u751F\u4EA7\u73AF\u5883\u5404\u81EA\u7528\u5230\u7684\u63D2\u4EF6\uFF0C\u5E76\u5206\u6790\u5404\u81EA\u7684\u529F\u80FD\u548C\u5B9E\u73B0\u539F\u7406\u3002</p><h3 id="\u63D2\u4EF6\u5BB9\u5668" tabindex="-1">\u63D2\u4EF6\u5BB9\u5668 <a class="header-anchor" href="#\u63D2\u4EF6\u5BB9\u5668" aria-hidden="true">#</a></h3><p>\u751F\u4EA7\u73AF\u5883\u4E2D\uFF0CVite \u76F4\u63A5\u8C03\u7528 Rollup \u8FDB\u884C\u6253\u5305\uFF0C\u6240\u4EE5 Rollup \u53EF\u4EE5\u8C03\u5EA6\u5404\u79CD\u63D2\u4EF6\uFF1B \u5F00\u53D1\u73AF\u5883\u4E2D\uFF0CVite \u6A21\u62DF Rollup \u7684\u63D2\u4EF6\u673A\u5236\uFF0C\u8BBE\u8BA1\u4E86 PluginContainer \u5BF9\u8C61\u6765\u8C03\u5EA6\u5404\u4E2A\u63D2\u4EF6\u3002</p><p>PluginContainer\uFF08\u63D2\u4EF6\u5BB9\u5668\uFF09\u5BF9\u8C61\u975E\u5E38\u91CD\u8981\uFF0C\u4E0B\u9762\u6211\u4EEC\u5C31\u6765\u770B\u4E0B Vite \u7684\u63D2\u4EF6\u5BB9\u5668\u673A\u5236\u662F\u5982\u4F55\u5B9E\u73B0\u7684\u3002</p><p>PluginContainer \u7684 <a href="https://github.com/vitejs/vite/blob/main/packages/vite/src/node/server/pluginContainer.ts" target="_blank" rel="noreferrer">\u5B9E\u73B0</a> \u501F\u9274\u4E8E WMR \u7684 <code>rollup-plugin-container.js</code>\uFF0C\u4E3B\u8981\u5206\u4E3A\u4E24\u90E8\u5206\uFF1A</p><ul><li>\u5B9E\u73B0 Rollup \u63D2\u4EF6\u94A9\u5B50\u7684\u8C03\u5EA6</li><li>\u5B9E\u73B0\u63D2\u4EF6\u94A9\u5B50\u5185\u90E8\u7684 Context \u5BF9\u8C61</li></ul><p>\u4F60\u53EF\u4EE5\u901A\u8FC7 <a href="https://github.com/vitejs/vite/blob/main/packages/vite/src/node/server/pluginContainer.ts#L500" target="_blank" rel="noreferrer">container \u7684\u5B9A\u4E49</a> \u6765\u770B\u770B Rollup \u5404\u4E2A\u94A9\u5B50\u7684\u5B9E\u73B0\u65B9\u5F0F\u3002</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> container</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">PluginContainer</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5F02\u6B65\u4E32\u884C\u94A9\u5B50</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">options</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> (</span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rollupOptions</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugin</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">of</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugins</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">options</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">continue</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">options</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span></span>
<span class="line"><span style="color:#F07178;">        (</span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">call</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">minimalContext</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">acornInjectPlugins</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">parser</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">acorn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Parser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">extend</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">...</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">arraify</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">acornInjectPlugins</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      )</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">acorn</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      acornInjectPlugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">options</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  getModuleInfo</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5F02\u6B65\u5E76\u884C\u94A9\u5B50</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">buildStart</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">plugins</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">buildStart</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">buildStart</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">call</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Context</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">plugin</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">container</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">options</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">NormalizedInputOptions</span></span>
<span class="line"><span style="color:#F07178;">          )</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    )</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5F02\u6B65\u4F18\u5148\u94A9\u5B50</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">resolveId</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">rawId</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">importer</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">join</span><span style="color:#A6ACCD;">(root</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">index.html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">skip</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">skip</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ssr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">ssr</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">scan</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!!</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">scan</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ctx</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Context</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ssr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!!</span><span style="color:#A6ACCD;">ssr</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_scan</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">scan</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_resolveSkips</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">skip</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolveStart</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isDebug</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">performance</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">now</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">partial</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Partial</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">PartialResolvedId</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugin</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">of</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugins</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">resolveId</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">continue</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">skip</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">has</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">plugin</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">continue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_activePlugin</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">pluginResolveStart</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isDebug</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">performance</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">now</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">resolveId</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">call</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">ctx</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">rawId</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">importer</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          custom</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">custom</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          isEntry</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!!</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">isEntry</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">ssr</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">scan</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      )</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">continue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">string</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">assign</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">partial</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">isDebug</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">debugPluginResolve</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">timeFrom</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">pluginResolveStart</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">prettifyUrl</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">root</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// resolveId() is hookFirst - first non-null result is returned.</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">break</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">isDebug</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rawId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">rawId</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">startsWith</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">FS_PREFIX</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rawId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// avoid spamming</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">seenResolves</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">]) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">seenResolves</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">debugResolve</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">\`\${</span><span style="color:#82AAFF;">timeFrom</span><span style="color:#A6ACCD;">(resolveStart)</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">colors</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cyan</span><span style="color:#A6ACCD;">(rawId)</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> -&gt; </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">colors</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dim</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">            id</span></span>
<span class="line"><span style="color:#A6ACCD;">          )</span><span style="color:#89DDFF;">}\`</span></span>
<span class="line"><span style="color:#F07178;">        )</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">partial</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">isExternalUrl</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">normalizePath</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">partial</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">PartialResolvedId</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5F02\u6B65\u4F18\u5148\u94A9\u5B50</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">load</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ssr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">ssr</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ctx</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Context</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ssr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!!</span><span style="color:#A6ACCD;">ssr</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugin</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">of</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugins</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">load</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">continue</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_activePlugin</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugin</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">load</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">call</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ssr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">isObject</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">updateModuleInfo</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5F02\u6B65\u4E32\u884C\u94A9\u5B50</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">transform</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">inMap</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">inMap</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ssr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">ssr</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ctx</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">TransformContext</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">inMap</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">SourceMap</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ssr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!!</span><span style="color:#A6ACCD;">ssr</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugin</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">of</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugins</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">transform</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">continue</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_activePlugin</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugin</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_activeId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_activeCode</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">start</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isDebug</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">performance</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">now</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">TransformResult</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">undefined</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">transform</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">call</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ssr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">catch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">error</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">continue</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">isDebug</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">debugPluginTransform</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">timeFrom</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">start</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">prettifyUrl</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">root</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      )</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">isObject</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">undefined</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">code</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">map</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">isDebugSourcemapCombineFocused</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">              </span><span style="color:#676E95;">// @ts-expect-error inject plugin name for debug purpose</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">map</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sourcemapChain</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">map</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">updateModuleInfo</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      map</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">_getCombinedSourcemap</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">close</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">closed</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">return</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ctx</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Context</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">plugins</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">p</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">p</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">buildEnd</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">p</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">buildEnd</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">call</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">    )</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">plugins</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">p</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">p</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">closeBundle</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">p</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">closeBundle</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">call</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">    )</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">closed</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> container</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5728\u524D\u9762\u7684 <a href="https://www.yueluo.club/detail?articleId=626b187965e52c4388404749" target="_blank" rel="noreferrer">Rollup \u63D2\u4EF6\u673A\u5236</a> \u6587\u4E2D\uFF0C\u6211\u4EEC\u5DF2\u7ECF\u5206\u6790\u8FC7 Rollup \u4E2D\u5F02\u6B65\u3001\u4E32\u884C\u3001\u5E76\u884C\u7B49\u94A9\u5B50\u7C7B\u578B\u7684\u6267\u884C\u539F\u7406\u3002\u73B0\u5728\u9605\u8BFB\u4E0A\u8FF0\u4EE3\u7801\u5E76\u4E0D\u56F0\u96BE\u3002</p><p>\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u5728\u5404\u79CD\u94A9\u5B50\u88AB\u8C03\u7528\u7684\u65F6\u5019\uFF0CVite \u90FD\u4F1A\u5F3A\u5236\u5C06\u94A9\u5B50\u51FD\u6570\u7684 this \u7ED1\u5B9A\u4E00\u4E2A\u4E0A\u4E0B\u6587\u5BF9\u8C61\uFF0C\u4F8B\u5982\uFF1A</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#A6ACCD;">async </span><span style="color:#82AAFF;">load</span><span style="color:#A6ACCD;">(id</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> options) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ssr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">ssr</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ctx</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Context</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ssr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!!</span><span style="color:#A6ACCD;">ssr</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugin</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">of</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugins</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">load</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">continue</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_activePlugin</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugin</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">load</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">call</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ssr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">isObject</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">updateModuleInfo</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u90A3\u4E48\u8FD9\u4E2A\u5BF9\u8C61\u662F\u7528\u6765\u5E72\u4EC0\u4E48\u7684\uFF1F</p><p>\u5728 Rollup \u94A9\u5B50\u51FD\u6570\u4E2D\uFF0C\u6211\u4EEC\u53EF\u4EE5\u8C03\u7528 <code>this.emitFile</code>\u3001<code>this.resolve</code> \u7B49\u8BF8\u591A\u4E0A\u4E0B\u6587\u65B9\u6CD5\u3002</p><blockquote><p><a href="https://rollupjs.org/guide/en/#plugin-context" target="_blank" rel="noreferrer">https://rollupjs.org/guide/en/#plugin-context</a></p></blockquote><p>\u56E0\u6B64\uFF0CVite \u9664\u4E86\u8981\u6A21\u62DF\u5404\u4E2A\u63D2\u4EF6\u7684\u8FD0\u884C\u6D41\u7A0B\uFF0C\u8FD8\u9700\u8981\u6A21\u62DF\u63D2\u4EF6\u6267\u884C\u7684\u4E0A\u4E0B\u6587\u5BF9\u8C61\uFF0C\u4EE3\u7801\u4E2D\u7684 <a href="https://github.com/vitejs/vite/blob/main/packages/vite/src/node/server/pluginContainer.ts#L237" target="_blank" rel="noreferrer">Context</a> \u5BF9\u8C61\u5C31\u662F\u7528\u6765\u5B8C\u6210\u8FD9\u4E9B\u4E8B\u60C5\u3002</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">RollupPluginContext</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rollup</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">type</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">PluginContext</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Omit</span><span style="color:#89DDFF;">&lt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">RollupPluginContext</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// not documented</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cache</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// deprecated</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">emitAsset</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">emitChunk</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">getAssetFileName</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">getChunkFileName</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">isExternal</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">moduleIds</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">resolveId</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">load</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> watchFiles </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Set</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Context</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">implements</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">PluginContext</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5B9E\u73B0\u5404\u79CD\u4E0A\u4E0B\u6587\u65B9\u6CD5</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u89E3\u6790\u6A21\u5757 AST(\u8C03\u7528 acorn)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">parse</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">opts</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{})</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">parser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      sourceType</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      ecmaVersion</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">latest</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      locations</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">opts</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u89E3\u6790\u6A21\u5757\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">resolve</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#A6ACCD;">importer</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">skipSelf</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">skip</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Set</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Plugin</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">undefined</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">skipSelf</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">_activePlugin</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">skip</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Set</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">_resolveSkips</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">skip</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">_activePlugin</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">out</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">container</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolveId</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">importer</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">skip</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> ssr</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">ssr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">out</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">string</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">out</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">out</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">out</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">ResolvedId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">null</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u4EE5\u4E0B\u4E24\u4E2A\u65B9\u6CD5\u5747\u4ECE Vite \u7684\u6A21\u5757\u4F9D\u8D56\u56FE\u4E2D\u83B7\u53D6\u76F8\u5173\u7684\u4FE1\u606F</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">getModuleInfo</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getModuleInfo</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">getModuleIds</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">moduleGraph</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">moduleGraph</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">idToModuleMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">keys</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Array</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">Symbol</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">iterator</span><span style="color:#F07178;">]()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u8BB0\u5F55\u5F00\u53D1\u9636\u6BB5 watch \u7684\u6587\u4EF6</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">addWatchFile</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">watchFiles</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">_addedImports</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">_addedImports</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Set</span><span style="color:#F07178;">()))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">watcher</span><span style="color:#F07178;">) </span><span style="color:#82AAFF;">ensureWatchedFile</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">watcher</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">root</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">getWatchFiles</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">watchFiles</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">warn</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u6253\u5370 warning \u4FE1\u606F</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">error</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u6253\u5370 error \u4FE1\u606F</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// ...</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5F88\u663E\u7136\uFF0CVite \u5C06 Rollup \u7684 <code>PluginCxontext</code> \u5BF9\u8C61\u91CD\u65B0\u5B9E\u73B0\u4E86\u4E00\u904D\uFF0C\u56E0\u4E3A\u53EA\u662F\u5F00\u53D1\u9636\u6BB5\u7528\u5230\uFF0C\u6240\u4EE5\u53BB\u9664\u4E86\u4E00\u4E9B\u6253\u5305\u76F8\u5173\u7684\u65B9\u6CD5\u5B9E\u73B0\u3002\u540C\u65F6\uFF0C\u4E0A\u4E0B\u6587\u5BF9\u8C61\u4E0E Vite \u5F00\u53D1\u9636\u6BB5\u7684 ModuleGraph \u76F8\u7ED3\u5408\uFF0C\u5B9E\u73B0\u5F00\u53D1\u65F6\u7684 HMR\u3002</p><p>\u53E6\u5916\uFF0Ctransform \u94A9\u5B50\u4E5F\u4F1A\u4E00\u4E2A\u63D2\u4EF6\u7684\u4E0A\u4E0B\u6587\u5BF9\u8C61\uFF0C\u4E0D\u8FC7\u8FD9\u4E2A\u5BF9\u8C61\u548C\u5176\u4ED6\u94A9\u5B50\u4E0D\u540C\uFF0C\u5B9E\u73B0\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TransformContext</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Context</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">inMap</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SourceMap</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">super</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">filename</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">originalCode</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">inMap</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">sourcemapChain</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">inMap</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">_getCombinedSourcemap</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">createIfNull</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">combinedMap</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">getCombinedSourcemap</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">_getCombinedSourcemap</span><span style="color:#F07178;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">SourceMap</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u53EF\u4EE5\u770B\u5230\uFF0CTransformContext \u7EE7\u627F\u81EA\u4E4B\u524D\u6240\u8BF4\u7684 Context \u5BF9\u8C61\uFF0C\u4E5F\u5C31\u662F\u8BF4 transform \u94A9\u5B50\u7684\u4E0A\u4E0B\u6587\u5BF9\u8C61\u76F8\u6BD4\u5176\u4ED6\u94A9\u5B50\u53EA\u662F\u505A\u4E86\u4E00\u4E9B\u6269\u5C55\uFF0C\u589E\u52A0\u4E86 sourcemap \u5408\u5E76\u7684\u529F\u80FD\uFF0C\u5E76\u5C06\u4E0D\u540C\u63D2\u4EF6\u7684 transform \u94A9\u5B50\u6267\u884C\u540E\u8FD4\u56DE\u7684 sourcemap \u8FDB\u884C\u5408\u5E76\uFF0C\u4EE5\u4FDD\u8BC1 soucemap \u7684\u51C6\u786E\u6027\u548C\u5B8C\u6574\u6027\u3002</p><h3 id="\u63D2\u4EF6\u5DE5\u4F5C\u6D41\u6982\u89C8" tabindex="-1">\u63D2\u4EF6\u5DE5\u4F5C\u6D41\u6982\u89C8 <a class="header-anchor" href="#\u63D2\u4EF6\u5DE5\u4F5C\u6D41\u6982\u89C8" aria-hidden="true">#</a></h3><p>\u4E0B\u9762\u662F <a href="https://github.com/vitejs/vite/blob/main/packages/vite/src/node/plugins/index.ts#L28" target="_blank" rel="noreferrer">resolvePlugins \u51FD\u6570</a> \u7684\u5B9E\u73B0\uFF0CVite \u6240\u6709\u63D2\u4EF6\u5C31\u662F\u5728\u8FD9\u91CC\u88AB\u6536\u96C6\u8D77\u6765\u7684\u3002\u5177\u4F53\u5B9E\u73B0\u5982\u4E0B\uFF1A</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">resolvePlugins</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ResolvedConfig</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;">prePlugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Plugin</span><span style="color:#A6ACCD;">[]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;">normalPlugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Plugin</span><span style="color:#A6ACCD;">[]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;">postPlugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Plugin</span><span style="color:#A6ACCD;">[]</span></span>
<span class="line"><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Plugin</span><span style="color:#A6ACCD;">[]</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isBuild</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">command</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">build</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u6536\u96C6\u751F\u4EA7\u73AF\u5883\u6784\u5EFA\u7684\u63D2\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buildPlugins</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isBuild</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">import</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../build</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolveBuildPlugins</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">config</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> pre</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> post</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [] </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// 1. \u522B\u540D\u63D2\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">isBuild</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">preAliasPlugin</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">aliasPlugin</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> entries</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">alias</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// 2. \u7528\u6237\u81EA\u5B9A\u4E49 pre \u63D2\u4EF6(\u5E26\u6709\`enforce: &quot;pre&quot;\`\u5C5E\u6027)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">prePlugins</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// 3. Vite \u6838\u5FC3\u6784\u5EFA\u63D2\u4EF6</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// ...</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// 4. \u7528\u6237\u63D2\u4EF6\uFF08\u4E0D\u5E26\u6709 \`enforce\` \u5C5E\u6027\uFF09</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">normalPlugins</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// 5. Vite \u751F\u4EA7\u73AF\u5883\u63D2\u4EF6 &amp; \u7528\u6237\u63D2\u4EF6(\u5E26\u6709 \`enforce: &quot;post&quot;\`\u5C5E\u6027)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">definePlugin</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">config</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">cssPostPlugin</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">config</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">buildPlugins</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">pre</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">postPlugins</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">buildPlugins</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">post</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// 6. \u4E00\u4E9B\u5F00\u53D1\u9636\u6BB5\u7279\u6709\u7684\u63D2\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">...</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">isBuild</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#82AAFF;">clientInjectionsPlugin</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">config</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">importAnalysisPlugin</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">config</span><span style="color:#F07178;">)])</span></span>
<span class="line"><span style="color:#F07178;">  ]</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">filter</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">Boolean</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Plugin</span><span style="color:#F07178;">[]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u4ECE\u4E0A\u8FF0\u4EE3\u7801\u4E2D\u6211\u4EEC\u53EF\u4EE5\u603B\u7ED3\u51FA Vite \u63D2\u4EF6\u7684\u5177\u4F53\u6267\u884C\u987A\u5E8F\uFF1A</p><ul><li>\u522B\u540D\u63D2\u4EF6\u3002<code>vite:pre-alias</code> \u548C <code>@rollup/plugin-alias</code>\uFF0C\u7528\u4E8E\u8DEF\u5F84\u522B\u540D\u66FF\u6362\u3002</li><li>\u7528\u6237\u81EA\u5B9A\u4E49 pre \u63D2\u4EF6\uFF0C\u4E5F\u5C31\u662F\u5E26\u6709 <code>enfore: &quot;pre&quot;</code> \u5C5E\u6027\u7684\u81EA\u5B9A\u4E49\u63D2\u4EF6\u3002</li><li>Vite \u6838\u5FC3\u6784\u5EFA\u63D2\u4EF6\u3002</li><li>\u7528\u6237\u81EA\u5B9A\u4E49\u7684\u666E\u901A\u63D2\u4EF6\uFF0C\u5373\u4E0D\u5E26\u6709 <code>enfore</code> \u5C5E\u6027\u7684\u63D2\u4EF6\u3002</li><li>Vite \u751F\u4EA7\u73AF\u5883\u63D2\u4EF6\u548C\u7528\u6237\u63D2\u4EF6\u4E2D\u5E26\u6709 <code>enfore: &quot;post&quot;</code> \u5C5E\u6027\u7684\u63D2\u4EF6\u3002</li><li>\u4E00\u4E9B\u5F00\u53D1\u9636\u6BB5\u7279\u6709\u7684\u63D2\u4EF6\uFF0C\u5305\u62EC\u73AF\u5883\u53D8\u91CF\u6CE8\u5165\u63D2\u4EF6 <code>clientInjectionPlugin</code> \u548C import \u8BED\u53E5\u5206\u6790\u53CA\u91CD\u5199\u63D2\u4EF6 <code>importAnalysisPlugin</code>\u3002</li></ul><h3 id="\u63D2\u4EF6\u529F\u80FD\u68B3\u7406" tabindex="-1">\u63D2\u4EF6\u529F\u80FD\u68B3\u7406 <a class="header-anchor" href="#\u63D2\u4EF6\u529F\u80FD\u68B3\u7406" aria-hidden="true">#</a></h3><p>\u9664\u4E86\u7528\u6237\u81EA\u5B9A\u4E49\u63D2\u4EF6\u4E4B\u5916\uFF0C\u6211\u4EEC\u9700\u8981\u68B3\u7406\u7684 Vite \u5185\u7F6E\u63D2\u4EF6\u6709\u4EE5\u4E0B\u8FD9\u51E0\u7C7B\uFF1A</p><ul><li>\u522B\u540D\u63D2\u4EF6</li><li>\u6838\u5FC3\u6784\u5EFA\u63D2\u4EF6</li><li>\u751F\u4EA7\u73AF\u5883\u7279\u6709\u63D2\u4EF6</li><li>\u5F00\u53D1\u73AF\u5883\u7279\u6709\u63D2\u4EF6</li></ul><h4 id="\u522B\u540D\u63D2\u4EF6" tabindex="-1">\u522B\u540D\u63D2\u4EF6 <a class="header-anchor" href="#\u522B\u540D\u63D2\u4EF6" aria-hidden="true">#</a></h4><p>\u522B\u540D\u63D2\u4EF6\u6709\u4E24\u4E2A\uFF0C\u5206\u522B\u662F <a href="https://github.com/vitejs/vite/blob/72cb33e947e7aa72d27ed0c5eacb2457d523dfbf/packages/vite/src/node/plugins/preAlias.ts" target="_blank" rel="noreferrer">vite:pre-alias</a> \u548C <a href="https://github.com/vitejs/vite/blob/72cb33e947e7aa72d27ed0c5eacb2457d523dfbf/packages/vite/src/node/plugins/index.ts#L3" target="_blank" rel="noreferrer">@rollup/plugin-alias</a>\u3002</p><p>\u524D\u8005\u4E3B\u8981\u662F\u4E3A\u4E86\u5C06 bare import \u8DEF\u5F84\u91CD\u5B9A\u5411\u5230\u9884\u6784\u5EFA\u4F9D\u8D56\u7684\u8DEF\u5F84\u3002</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#676E95;">// \u5047\u8BBE React \u5DF2\u7ECF\u8FC7 Vite \u9884\u6784\u5EFA</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> React </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">// \u4F1A\u88AB\u91CD\u5B9A\u5411\u5230\u9884\u6784\u5EFA\u4EA7\u7269\u7684\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> React </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/node_modules/.vite/react.js</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><p>\u540E\u8005\u5219\u5B9E\u73B0\u4E86\u6BD4\u8F83\u901A\u7528\u7684\u8DEF\u5F84\u522B\u540D\uFF08\u5373 <code>resolve.alias</code> \u914D\u7F6E\uFF09\u7684\u529F\u80FD\uFF0C\u4F7F\u7528\u7684\u662F <a href="https://github.com/rollup/plugins/tree/master/packages/alias#rollupplugin-alias" target="_blank" rel="noreferrer">Rollup \u7684\u5B98\u65B9 Alias \u63D2\u4EF6</a> \u3002</p><h4 id="\u6838\u5FC3\u7F16\u8BD1\u63D2\u4EF6" tabindex="-1">\u6838\u5FC3\u7F16\u8BD1\u63D2\u4EF6 <a class="header-anchor" href="#\u6838\u5FC3\u7F16\u8BD1\u63D2\u4EF6" aria-hidden="true">#</a></h4><p><strong>1. module preload \u7279\u6027\u7684 Polyfill</strong></p><p>\u5F53\u4F60\u5728 Vite \u914D\u7F6E\u6587\u4EF6\u4E2D\u5F00\u542F\u4E0B\u9762\u8FD9\u4E2A\u914D\u7F6E\u65F6\uFF1A</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">build</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">polyfillModulePreload</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>Vite \u4F1A\u81EA\u52A8\u5E94\u7528 <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/modulePreloadPolyfill.ts#L7" target="_blank" rel="noreferrer">moudlePreloadPolyfillPlugin</a> \u63D2\u4EF6\uFF0C\u5728\u4EA7\u7269\u4E2D\u6CE8\u5165 module preload \u7684 Polyfill \u4EE3\u7801\u3002\u5B9E\u73B0\u539F\u7406\u5982\u4E0B\uFF1A</p><ul><li>\u626B\u63CF\u51FA\u5F53\u524D\u6240\u6709\u7684 modulepreload \u6807\u7B7E\uFF0C\u62FF\u5230 link \u6807\u7B7E\u5BF9\u5E94\u7684\u5730\u5740\uFF0C\u901A\u8FC7\u6267\u884C fetch \u5B9E\u73B0\u9884\u52A0\u8F7D\uFF1B</li><li>\u901A\u8FC7 MutationObserver \u76D1\u542C DOM \u53D8\u5316\uFF0C\u4E00\u65E6\u53D1\u73B0\u5305\u542B modulepreload \u5C5E\u6027\u7684 link \u6807\u7B7E\uFF0C\u540C\u6837\u901A\u8FC7 fetch \u8BF7\u6C42\u5B9E\u73B0\u9884\u52A0\u8F7D\u3002</li></ul><blockquote><p>\u7531\u4E8E\u90E8\u5206\u652F\u6301\u539F\u751F ESM \u7684\u6D4F\u89C8\u5668\u5E76\u4E0D\u652F\u6301 module preload\uFF0C\u56E0\u6B64\u67D0\u4E9B\u60C5\u51B5\u4E0B\u9700\u8981\u6CE8\u5165\u76F8\u5E94\u7684 polyfill \u8FDB\u884C\u964D\u7EA7\u3002</p></blockquote><p><strong>2. \u8DEF\u5F84\u89E3\u6790\u63D2\u4EF6</strong></p><p>\u8DEF\u5F84\u89E3\u6790\u63D2\u4EF6\uFF08\u5373 <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/resolve.ts" target="_blank" rel="noreferrer">vite:resolve</a>\uFF09\u662F Vite \u4E2D\u6BD4\u8F83\u6838\u5FC3\u7684\u63D2\u4EF6\uFF0C\u51E0\u4E4E\u6240\u6709\u91CD\u8981\u7684 Vite \u7279\u6027\u90FD\u79BB\u4E0D\u5F00\u8FD9\u4E2A\u63D2\u4EF6\u7684\u5B9E\u73B0\uFF0C\u4F8B\u5982\u4F9D\u8D56\u9884\u6784\u5EFA\u3001HMR\u3001SSR \u7B49\u3002\u540C\u65F6\u5B83\u4E5F\u662F\u5B9E\u73B0\u76F8\u5F53\u590D\u6742\u7684\u63D2\u4EF6\uFF0C\u4E00\u65B9\u9762\u5B9E\u73B0\u4E86 <a href="https://nodejs.org/api/modules.html#modules_all_together" target="_blank" rel="noreferrer">Node.js \u5B98\u65B9\u7684 resolve \u7B97\u6CD5</a>\uFF0C\u53E6\u4E00\u65B9\u9762\u9700\u8981\u652F\u6301\u524D\u9762\u6240\u8BF4\u7684\u5404\u9879\u7279\u6027\uFF0C\u53EF\u4EE5\u8BF4\u662F\u4E13\u95E8\u7ED9 Vite \u5B9E\u73B0\u4E86\u4E00\u5957\u8DEF\u5F84\u89E3\u6790\u7B97\u6CD5\u3002</p><p><strong>3. \u5185\u8054\u811A\u672C\u52A0\u8F7D\u63D2\u4EF6</strong></p><p>\u5BF9\u4E8E HTML \u4E2D\u7684\u5185\u8054\u811A\u672C\uFF0CVite \u4F1A\u901A\u8FC7 <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/html.ts#L38" target="_blank" rel="noreferrer">vite:html-inline-script-proxy</a> \u63D2\u4EF6\u6765\u8FDB\u884C\u52A0\u8F7D\u3002\u6BD4\u5982\u4E0B\u9762\u8FD9\u4E2A script \u6807\u7B7E\uFF1A</p><div class="language-html"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> React </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(React)</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u4E9B\u5185\u5BB9\u4F1A\u5728\u540E\u7EED\u7684 <code>build-html</code> \u63D2\u4EF6\u4ECE HTML \u4EE3\u7801\u4E2D\u5254\u9664\uFF0C\u5E76\u4E14\u53D8\u6210\u4E0B\u9762\u7684\u8FD9\u4E00\u884C\u4EE3\u7801\u63D2\u5165\u5230\u9879\u76EE\u5165\u53E3\u6A21\u5757\u7684\u4EE3\u7801\u4E2D\uFF1A</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../vite-app/index.html?http-proxy&amp;index=0.js</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><p><code>vite:html-inline-script-proxy</code> \u5C31\u662F\u7528\u6765\u52A0\u8F7D\u8FD9\u6837\u7684\u6A21\u5757\uFF0C\u5B9E\u73B0\u5982\u4E0B\uFF1A</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">htmlInlineScriptProxyPlugin</span><span style="color:#89DDFF;">():</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Plugin</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite:html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    resolveId</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">htmlProxyRE</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">test</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    load</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">proxyMatch</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">match</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">htmlProxyRE</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">proxyMatch</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">index</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Number</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">proxyMatch</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">])</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">file</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">cleanUrl</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">html</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFileSync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">file</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">htmlCommentRE</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">match</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">RegExpExecArray</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">undefined</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">scriptModuleRE</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lastIndex</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">i</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">i</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">index</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">++</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">match</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">scriptModuleRE</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exec</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">html</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">match</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">match</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">2</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Error</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">No matching html proxy module found from </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><strong>4. CSS \u7F16\u8BD1\u63D2\u4EF6</strong></p><p><a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/css.ts#L137" target="_blank" rel="noreferrer">vite:css</a> \u63D2\u4EF6\uFF0C\u4E3B\u8981\u5B9E\u73B0\u4E0B\u9762\u8FD9\u4E9B\u529F\u80FD\uFF1A</p><ul><li>CSS \u9884\u5904\u7406\u5668\u7684\u7F16\u8BD1</li><li>CSS Modules</li><li>Postcss \u7F16\u8BD1</li><li>\u901A\u8FC7 @import \u8BB0\u5F55\u4F9D\u8D56\uFF0C\u4FBF\u4E8E HMR</li></ul><p>\u8FD9\u4E2A\u63D2\u4EF6\u7684\u6838\u5FC3\u5728\u4E8E <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/css.ts#L568" target="_blank" rel="noreferrer">compileCSS</a> \u51FD\u6570\u7684\u5B9E\u73B0\u3002</p><p><strong>5. EsBuild \u8F6C\u8BD1\u63D2\u4EF6</strong></p><p><a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/esbuild.ts" target="_blank" rel="noreferrer">vite:esbuild</a> \u63D2\u4EF6\uFF0C\u7528\u6765\u7F16\u8BD1 .js\u3001.ts\u3001.jsx \u548C tsx\uFF0C\u4EE3\u66FF\u4E86\u4F20\u7EDF\u7684 Babel \u6216\u8005 TSC \u7684\u529F\u80FD\uFF0C\u8FD9\u4E5F\u662F Vite \u5F00\u53D1\u9636\u6BB5\u6027\u80FD\u5F3A\u608D\u7684\u4E00\u4E2A\u539F\u56E0\u3002</p><p>\u63D2\u4EF6\u4E2D\u4E3B\u8981\u7684\u903B\u8F91\u662F <code>transformWithEsBuild</code> \u51FD\u6570\uFF0C\u53EF\u4EE5\u901A\u8FC7\u8FD9\u4E2A\u51FD\u6570\u5B9E\u73B0\u4EE3\u7801\u8F6C\u8BD1\u3002Vite \u672C\u8EAB\u4E5F\u5BFC\u51FA\u4E86\u8FD9\u4E2A\u51FD\u6570\uFF0C\u4F5C\u4E3A\u4E00\u79CD\u901A\u7528\u7684 transform \u80FD\u529B\u3002</p><p>\u4F7F\u7528\u65B9\u6CD5\u5982\u4E0B\uFF1A</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">transformWithEsbuild</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u4F20\u5165\u4E24\u4E2A\u53C2\u6570: code, filename</span></span>
<span class="line"><span style="color:#82AAFF;">transformWithEsbuild</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&lt;h1&gt;hello&lt;/h1&gt;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./index.tsx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// {</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">//   warnings: [],</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">//   code: &#39;/* @__PURE__ */ React.createElement(&quot;h1&quot;, null, &quot;hello&quot;);\\n&#39;,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">//   map: {/* sourcemap \u4FE1\u606F */}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// }</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p><strong>6. \u9759\u6001\u8D44\u6E90\u52A0\u8F7D\u63D2\u4EF6</strong></p><p>\u9759\u6001\u8D44\u6E90\u52A0\u8F7D\u63D2\u4EF6\u5305\u62EC\uFF1A</p><ul><li><a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/json.ts#L30" target="_blank" rel="noreferrer">vite:json</a>\uFF1A\u7528\u6765\u52A0\u8F7D JSON \u6587\u4EF6\uFF0C\u901A\u8FC7 <code>@rollup/pluginutils</code> \u7684 <code>dataToEsm</code> \u65B9\u6CD5\u53EF\u4EE5\u5B9E\u73B0 JSON \u7684\u5177\u540D\u5BFC\u5165</li><li><a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/wasm.ts#L45" target="_blank" rel="noreferrer">vite:wasm</a>\uFF1A\u7528\u6765\u52A0\u8F7D <code>.wasm</code> \u683C\u5F0F\u7684\u6587\u4EF6</li><li><a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/worker.ts" target="_blank" rel="noreferrer">vite:worker</a>\uFF1A\u7528\u6765\u52A0\u8F7D Web Worker \u811A\u672C\uFF0C\u63D2\u4EF6\u5185\u90E8\u4F1A\u4F7F\u7528 Rollup \u5BF9 Worker \u811A\u672C\u8FDB\u884C\u6253\u5305</li><li><a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/asset.ts#L37" target="_blank" rel="noreferrer">vite:asset</a>\uFF1A\u5F00\u53D1\u9636\u6BB5\u5B9E\u73B0\u4E86\u5176\u4ED6\u683C\u5F0F\u9759\u6001\u8D44\u6E90\u7684\u52A0\u8F7D\uFF0C\u751F\u4EA7\u73AF\u5883\u4F1A\u901A\u8FC7 <code>renderChunk</code> \u94A9\u5B50\u5C06\u9759\u6001\u8D44\u6E90\u5730\u5740\u91CD\u5199\u4E3A\u4EA7\u7269\u7684\u6587\u4EF6\u5730\u5740\u3002 <ul><li>\u5982<code>./img.png</code> \u91CD\u5199\u4E3A <code>https://cdn.xxx.com/assets/img.91ee297e.png</code></li></ul></li></ul><p>Rollup \u672C\u8EAB\u5B58\u5728 <a href="https://bundlers.tooling.report/hashing/asset-cascade/" target="_blank" rel="noreferrer">asset cascade</a> \u95EE\u9898\uFF0C\u5373\u9759\u6001\u8D44\u6E90\u54C8\u5E0C\u66F4\u65B0\uFF0C\u5F15\u7528\u5B83\u7684 JS \u7684\u54C8\u5E0C\u5E76\u6CA1\u6709\u66F4\u65B0\uFF08<a href="https://github.com/rollup/rollup/issues/3415" target="_blank" rel="noreferrer">issue</a>\uFF09\u3002\u56E0\u6B64 Vite \u5728\u9759\u6001\u8D44\u6E90\u5904\u7406\u7684\u65F6\u5019\uFF0C\u5E76\u6CA1\u6709\u4EA4\u7ED9 Rollup \u751F\u6210\u54C8\u5E0C\uFF0C\u800C\u662F\u6839\u636E\u8D44\u6E90\u5185\u5BB9\u751F\u6210\u54C8\u5E0C\uFF08<a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/asset.ts#L306" target="_blank" rel="noreferrer">\u6E90\u7801\u5B9E\u73B0</a>\uFF09\uFF0C\u5E76\u624B\u52A8\u8FDB\u884C\u8DEF\u5F84\u91CD\u5199\uFF0C\u4EE5\u907F\u514D <code>asset-cascade</code> \u95EE\u9898\u3002</p><h4 id="\u751F\u4EA7\u73AF\u5883\u7279\u6709\u63D2\u4EF6" tabindex="-1">\u751F\u4EA7\u73AF\u5883\u7279\u6709\u63D2\u4EF6 <a class="header-anchor" href="#\u751F\u4EA7\u73AF\u5883\u7279\u6709\u63D2\u4EF6" aria-hidden="true">#</a></h4><p><strong>1. \u5168\u5C40\u53D8\u91CF\u66FF\u6362\u63D2\u4EF6</strong></p><p>\u63D0\u4F9B\u5168\u5C40\u53D8\u91CF\u66FF\u6362\u7684\u529F\u80FD\uFF0C\u5982\u4E0B\u9762\u7684\u8FD9\u4E2A\u914D\u7F6E\uFF1A</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#676E95;">// vite.config.ts</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> version </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2.0.0</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">define</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">__APP_VERSION__</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">JSON.stringify(</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">version</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">)</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5168\u5C40\u53D8\u91CF\u66FF\u6362\u7684\u529F\u80FD\u4E0E <a href="https://github.com/rollup/plugins/tree/master/packages/replace" target="_blank" rel="noreferrer">@rollup/plugin-replace</a> \u5DEE\u4E0D\u591A\uFF0C\u5F53\u7136\u5728\u5B9E\u73B0\u4E0A Vite \u6709\u6240\u533A\u522B\uFF1A</p><ul><li>\u5F00\u53D1\u73AF\u5883\u4E0B\uFF0CVite \u4F1A\u5C06\u6240\u6709\u7684\u5168\u5C40\u53D8\u91CF\u6302\u8F7D\u5230 window \u5BF9\u8C61\uFF0C\u4E0D\u7528\u7ECF\u8FC7 define \u63D2\u4EF6\u7684\u5904\u7406\uFF0C\u8282\u7701\u7F16\u8BD1\u5F00\u9500\uFF1B</li><li>\u751F\u4EA7\u73AF\u5883\u4E0B\uFF0CVite \u4F1A\u4F7F\u7528 <a href="https://github.com/vitejs/vite/blob/main/packages/vite/src/node/plugins/define.ts" target="_blank" rel="noreferrer">define \u63D2\u4EF6</a>\uFF0C\u8FDB\u884C\u5B57\u7B26\u4E32\u66FF\u6362\u4EE5\u53CA sourcemap \u751F\u6210\u3002</li></ul><blockquote><p>SSR \u6784\u5EFA\u5F00\u53D1\u73AF\u5883\u65F6\u4E5F\u4F1A\u4F7F\u7528\u8FD9\u4E2A\u63D2\u4EF6\uFF0C\u4EC5\u7528\u6765\u66FF\u6362\u5B57\u7B26\u4E32\u3002</p></blockquote><p><strong>2. CSS \u540E\u5904\u7406\u63D2\u4EF6</strong></p><p>CSS \u540E\u5904\u7406\u63D2\u4EF6\u5373 <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/css.ts#L137" target="_blank" rel="noreferrer">vite:css-post</a> \u63D2\u4EF6\uFF0C\u529F\u80FD\u5982\u4E0B\uFF1A</p><ul><li>\u5F00\u53D1\u9636\u6BB5 CSS \u54CD\u5E94\u7ED3\u679C\u5904\u7406</li><li>\u751F\u4EA7\u73AF\u5883 CSS \u6587\u4EF6\u751F\u6210</li></ul><p>\u9996\u5148\uFF0C\u5728\u5F00\u53D1\u9636\u6BB5\uFF0C\u8FD9\u4E2A\u63D2\u4EF6\u4F1A\u5C06\u4E4B\u524D\u7684 CSS \u7F16\u8BD1\u63D2\u4EF6\u5904\u7406\u540E\u7684\u7ED3\u679C\uFF0C\u5305\u88C5\u6210\u4E00\u4E2A ESM \u6A21\u5757\uFF0C\u8FD4\u56DE\u7ED9\u6D4F\u89C8\u5668\uFF08<a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/css.ts#L284" target="_blank" rel="noreferrer">\u4EE3\u7801\u94FE\u63A5</a>\uFF09\u3002</p><p>\u5176\u6B21\uFF0C\u751F\u4EA7\u73AF\u5883\u4E2D\uFF0CVite \u9ED8\u8BA4\u4F1A\u901A\u8FC7\u8FD9\u4E2A\u63D2\u4EF6\u8FDB\u884C CSS \u7684 code splitting\uFF0C\u5373\u5BF9\u6BCF\u4E2A\u5F02\u6B65 chunk\uFF0CVite \u4F1A\u5C06\u5176\u4F9D\u8D56\u7684 CSS \u4EE3\u7801\u5355\u72EC\u6253\u5305\u6210\u4E00\u4E2A\u6587\u4EF6\uFF08<a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/css.ts#L400" target="_blank" rel="noreferrer">\u4EE3\u7801\u94FE\u63A5</a>\uFF09\u3002</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> fileHandle </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">emitFile</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> chunk</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.css</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">asset</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> chunkCSS</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u5982\u679C CSS \u7684 code splitting \u529F\u80FD\u88AB\u5173\u95ED\uFF08\u901A\u8FC7 <code>build.cssCodeSplit</code> \u914D\u7F6E\uFF09\u90A3\u4E48 vite \u4F1A\u5C06\u6240\u6709\u7684 CSS \u4EE3\u7801\u6253\u5305\u5230\u540C\u4E00\u4E2A CSS \u6587\u4EF6\u4E2D\uFF08<a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/css.ts#L433" target="_blank" rel="noreferrer">\u4EE3\u7801\u94FE\u63A5</a>\uFF09\u3002</p><p>\u6700\u540E\uFF0C\u63D2\u4EF6\u4F1A\u8C03\u7528 EsBuild \u5BF9 CSS \u8FDB\u884C\u538B\u7F29\uFF0C\u5B9E\u73B0\u5728 <code>minifyCSS</code> \u51FD\u6570\uFF08<a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/css.ts#L905" target="_blank" rel="noreferrer">\u4EE3\u7801\u94FE\u63A5</a>\uFF09\u3002</p><p><strong>3. HTML \u6784\u5EFA\u63D2\u4EF6</strong></p><p>HTML \u6784\u5EFA\u63D2\u4EF6\u4F1A\u8C03\u7528 <code>build-html</code> \u63D2\u4EF6\u3002\u4E4B\u524D\u6211\u4EEC\u5728\u5185\u8054\u811A\u672C\u52A0\u8F7D\u63D2\u4EF6\u4E2D\u63D0\u5230\u8FC7\uFF0C\u9879\u76EE\u6839\u76EE\u5F55\u4E0B\u7684 html \u4F1A\u8F6C\u6362\u4E3A\u4E00\u6BB5 JavaScript \u4EE3\u7801\u3002</p><div class="language-html"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;">!DOCTYPE html&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">lang</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">en</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">charset</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UTF-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">http-equiv</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">X-UA-Compatible</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">content</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">IE=edge</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">viewport</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">content</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width=device-width, initial-scale=1.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">Document</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  // \u666E\u901A\u65B9\u5F0F\u5F15\u5165</span></span>
<span class="line"><span style="color:#89DDFF;">  &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./index.ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  // \u5185\u8054\u811A\u672C</span></span>
<span class="line"><span style="color:#89DDFF;">  &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> React </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(React)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u9996\u5148\uFF0C\u5F53 Vite \u5728\u751F\u4EA7\u73AF\u5883 transform \u8FD9\u6BB5\u5165\u53E3 HTML \u65F6\uFF0C\u4F1A\u505A 3 \u4EF6\u4E8B\u60C5\uFF1A</p><ul><li>\u5BF9 HTML \u6267\u884C\u5404\u4E2A\u63D2\u4EF6\u4E2D\u5E26\u6709 <code>enforce: &quot;pre&quot;</code> \u5C5E\u6027\u7684 <code>transformIndexHtml</code> \u94A9\u5B50\uFF1B</li><li>\u5C06\u5176\u4E2D\u7684 script \u6807\u7B7E\u5185\u5BB9\u5220\u9664\uFF0C\u5E76\u5C06\u5176\u8F6C\u6362\u4E3A <code>import</code> \u8BED\u53E5\uFF0C\u4F8B\u5982 <code>import &#39;./index.ts&#39;</code>\uFF0C\u5E76\u8BB0\u5F55\u4E0B\u6765\uFF1B</li><li>\u5728 transform \u94A9\u5B50\u4E2D\u8FD4\u56DE\u8BB0\u5F55\u4E0B\u6765\u7684 import \u5185\u5BB9\uFF0C\u5C06 import \u8BED\u53E5\u4F5C\u4E3A\u6A21\u5757\u5185\u5BB9\u8FDB\u884C\u52A0\u8F7D\u4E5F\u5C31\u662F\u8BF4\uFF0C\u867D\u7136 Vite \u5904\u7406\u7684\u662F\u4E00\u4E2A HTML \u6587\u4EF6\uFF0C\u4F46\u6700\u540E\u8FDB\u884C\u6253\u5305\u7684\u5185\u5BB9\u5C06\u662F\u4E00\u6BB5 JS \u5185\u5BB9\uFF08<a href="https://github.com/vitejs/vite/blob/main/packages/vite/src/node/plugins/html.ts#L233" target="_blank" rel="noreferrer">\u4EE3\u7801\u94FE\u63A5</a>\uFF09\u3002</li></ul><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">buildHtmlPlugin</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite:build</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">transform</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">endsWith</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">js</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u7701\u7565 HTML AST \u904D\u5386\u8FC7\u7A0B(\u901A\u8FC7 @vue/compiler-dom \u5B9E\u73B0)</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u6536\u96C6 script \u6807\u7B7E\uFF0C\u8F6C\u6362\u6210 import \u8BED\u53E5\uFF0C\u62FC\u63A5\u5230 js \u5B57\u7B26\u4E32\u4E2D</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">js</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5176\u6B21\uFF0C\u5728\u751F\u6210\u4EA7\u7269\u7684\u6700\u540E\u4E00\u6B65\u5373 <code>generateBundle</code> \u94A9\u5B50\u4E2D\uFF0C\u6839\u636E\u5165\u53E3 Chunk \u7684\u5185\u5BB9\uFF0C\u5206\u60C5\u51B5\u8FDB\u884C\u5904\u7406\u3002</p><p>\u5982\u679C\u53EA\u6709 import \u8BED\u53E5\uFF0C\u5148\u901A\u8FC7 Rollup \u63D0\u4F9B\u7684 chunk \u548C bundle \u5BF9\u8C61\u83B7\u53D6\u5165\u53E3 chunk \u6240\u6709\u7684\u4F9D\u8D56 chunk\uFF0C\u5E76\u5C06\u8FD9\u4E9B chunk \u8FDB\u884C\u540E\u5E8F\u6392\u5217\u3002\u5982 a \u4F9D\u8D56 b\uFF0Cb \u4F9D\u8D56 c\uFF0C\u6700\u540E\u7684\u4F9D\u8D56\u6570\u7EC4\u5C31\u662F <code>[c, b, a]</code> \u3002\u7136\u540E\u4F9D\u6B21\u5C06 c, b, a \u751F\u6210\u4E09\u4E2A script \u6807\u7B7E\uFF0C\u63D2\u5165\u5230 HTML \u4E2D\u3002\u6700\u540E\uFF0CVite \u4F1A\u5C06\u5165\u53E3 chunk \u7684\u5185\u5BB9\u4ECE bundle \u4EA7\u7269\u4E2D\u79FB\u9664\uFF0C\u56E0\u6B64\u5B83\u7684\u5185\u5BB9\u53EA\u8981 import \u8BED\u53E5\uFF0C\u800C\u5B83 import \u7684 chunk \u5DF2\u7ECF\u4F5C\u4E3A script \u6807\u7B7E\u63D2\u5165\u5230 HTML \u4E2D\uFF0C\u5165\u53E3 chunk \u4E5F\u5C31\u6CA1\u6709\u5B58\u5728\u7684\u610F\u4E49\u4E86\u3002</p><p>\u5982\u679C\u9664\u4E86 import \u8BED\u53E5\uFF0C\u8FD8\u6709\u5176\u4ED6\u5185\u5BB9\uFF0CVite \u5C31\u4F1A\u5C06\u5165\u53E3 Chunk \u5355\u72EC\u751F\u6210\u4E00\u4E2A script \u6807\u7B7E\uFF0C\u5206\u6790\u51FA\u4F9D\u8D56\u7684\u540E\u7EED\u6392\u5217\uFF0C\u7136\u540E\u901A\u8FC7\u6CE8\u5165 <code>&lt;link rel=&quot;modulepreload&quot;&gt;</code> \u6807\u7B7E\u5BF9\u5165\u53E3\u6587\u4EF6\u7684\u4F9D\u8D56 chunk \u8FDB\u884C\u9884\u52A0\u8F7D\u3002</p><p>\u6700\u540E\uFF0C\u63D2\u4EF6\u4F1A\u8C03\u7528\u7528\u6237\u63D2\u4EF6\u4E2D\u5E26\u6709 <code>enforce: &quot;post&quot;</code> \u5C5E\u6027\u7684 transformIndexHtml \u94A9\u5B50\uFF0C\u5BF9 HTML \u8FDB\u884C\u8FDB\u4E00\u6B65\u7684\u5904\u7406\u3002</p><p><strong>4. commonjs \u8F6C\u6362\u63D2\u4EF6</strong></p><p>\u5F00\u53D1\u73AF\u5883\u4E2D\uFF0CVite \u4F1A\u4F7F\u7528 EsBuild \u5C06 commonjs \u8F6C\u6362\u4E3A ESM\u3002\u751F\u4EA7\u73AF\u5883\u4E2D\uFF0CVite \u4F1A\u76F4\u63A5\u4F7F\u7528 Rollup \u7684\u5B98\u65B9\u63D2\u4EF6 <a href="https://github.com/rollup/plugins/tree/master/packages/commonjs" target="_blank" rel="noreferrer">@rollup/plugin-commonjs</a>\u3002</p><p><strong>5. data-uri \u63D2\u4EF6</strong></p><p><a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/dataUri.ts#L14" target="_blank" rel="noreferrer">data-uri</a> \u63D2\u4EF6\u7528\u6765\u652F\u6301 import \u6A21\u5757\u4E2D\u542B\u6709 Base64 \u7F16\u7801\u7684\u60C5\u51B5\uFF0C\u5982\uFF1A</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> batman </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data:application/json;base64, eyAiYmF0bWFuIjogInRydWUiIH0=</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><p>**6. dynamic-import-vars \u63D2\u4EF6 **</p><p>\u7528\u4E8E\u652F\u6301\u5728\u52A8\u6001 import \u4E2D\u4F7F\u7528\u53D8\u91CF\u7684\u529F\u80FD\uFF0C\u5982\u4E0B\u793A\u4F8B\u4EE3\u7801\uFF1A</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">importLocale</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">locale</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">import</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">./locales/</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">locale</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">.js</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5185\u90E8\u4F7F\u7528\u7684\u662F Rollup \u7684\u5B98\u65B9\u63D2\u4EF6 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Frollup%2Fplugins%2Ftree%2Fmaster%2Fpackages%2Fdynamic-import-vars" target="_blank" rel="noreferrer">@rollup/plugin-dynamic-import-vars</a>\u3002</p><p><strong>7. import-meta-url \u652F\u6301\u63D2\u4EF6</strong></p><p>\u7528\u6765\u8F6C\u6362\u5982\u4E0B\u683C\u5F0F\u7684\u8D44\u6E90 URL\uFF1A</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">URL</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./foo.png</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">url)</span></span>
<span class="line"></span></code></pre></div><p>\u5C06\u5176\u8F6C\u6362\u4E3A\u751F\u4EA7\u73AF\u5883\u7684 URL \u683C\u5F0F\uFF1A</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#676E95;">// \u4F7F\u7528 self.location \u6765\u4FDD\u8BC1\u4F4E\u7248\u672C\u6D4F\u89C8\u5668\u548C Web Worker \u73AF\u5883\u7684\u517C\u5BB9\u6027</span></span>
<span class="line"><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">URL</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./assets.a4b3d56d.png, self.location)</span></span>
<span class="line"></span></code></pre></div><p>\u540C\u65F6\uFF0C\u5BF9\u4E8E\u52A8\u6001 import \u7684\u60C5\u51B5\u4E5F\u80FD\u8FDB\u884C\u652F\u6301\uFF1A</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getImageUrl</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">URL</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">./dir/</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">.png</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">href</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>Vite \u8BC6\u522B\u5230 <code>./dir/\${name}.png</code> \u8FD9\u6837\u7684\u6A21\u677F\u5B57\u7B26\u4E32\uFF0C\u4F1A\u5C06\u6574\u884C\u4EE3\u7801\u8F6C\u6362\u6210\u4E0B\u9762\u8FD9\u6837\uFF1A</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getImageUrl</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">globEager</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./dir/**.png</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)[</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">./dir/</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">.png</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">default</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/assetImportMetaUrl.ts#L18" target="_blank" rel="noreferrer">\u63D2\u4EF6\u4EE3\u7801\u94FE\u63A5</a></p><p><strong>8. import \u5206\u6790\u63D2\u4EF6</strong></p><p><a href="https://github.com/vitejs/vite/blob/v2.7.0/packages/vite/src/node/plugins/importAnalysisBuild.ts#L87" target="_blank" rel="noreferrer">vite:build-import-analysis</a> \u63D2\u4EF6\u4F1A\u5728\u751F\u4EA7\u73AF\u5883\u6253\u5305\u65F6\u7528\u4F5C import \u8BED\u53E5\u5206\u6790\u548C\u91CD\u5199\uFF0C\u4E3B\u8981\u76EE\u7684\u662F\u5BF9\u52A8\u6001 import \u7684\u6A21\u5757\u8FDB\u884C\u9884\u52A0\u8F7D\u5904\u7406\u3002</p><p>\u5BF9\u542B\u6709\u52A8\u6001 import \u7684 chunk \u800C\u8A00\uFF0C\u4F1A\u5728\u63D2\u4EF6\u7684 transform \u94A9\u5B50\u4E2D\u6DFB\u52A0\u4E00\u6BB5\u5DE5\u5177\u4EE3\u7801\u7528\u6765\u8FDB\u884C\u6A21\u5757\u9884\u52A0\u8F7D\uFF0C\u903B\u8F91\u5E76\u4E0D\u590D\u6742\uFF08<a href="https://github.com/vitejs/vite/blob/v2.7.0/packages/vite/src/node/plugins/importAnalysisBuild.ts#L43" target="_blank" rel="noreferrer">\u4EE3\u7801\u94FE\u63A5</a>\uFF09\u3002</p><p>\u5173\u952E\u4EE3\u7801\u7B80\u5316\u540E\u5982\u4E0B:</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">preload</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">importModule</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">deps</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">deps</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">dep</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u5982\u679C\u5F02\u6B65\u6A21\u5757\u7684\u4F9D\u8D56\u8FD8\u6CA1\u6709\u52A0\u8F7D</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#82AAFF;">alreadyLoaded</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">dep</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u521B\u5EFA link \u6807\u7B7E\u52A0\u8F7D\uFF0C\u5305\u62EC JS \u6216\u8005 CSS</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">head</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">appendChild</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">createLink</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">dep</span><span style="color:#F07178;">))  </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u5982\u679C\u662F CSS\uFF0C\u8FDB\u884C\u7279\u6B8A\u5904\u7406\uFF0C\u540E\u6587\u4F1A\u4ECB\u7ECD</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">isCss</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">dep</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">link</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">load</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolve</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">link</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  )</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">importModule</span><span style="color:#F07178;">())</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u6211\u4EEC\u77E5\u9053\uFF0CVite \u5185\u7F6E\u4E86 CSS \u4EE3\u7801\u5206\u5272\u7684\u80FD\u529B\uFF0C\u5F53\u4E00\u4E2A\u6A21\u5757\u901A\u8FC7\u52A8\u6001 import \u5F15\u5165\u7684\u65F6\u5019\uFF0C\u8FD9\u4E2A\u6A21\u5757\u5C31\u4F1A\u88AB\u5355\u72EC\u6253\u5305\u6210\u4E00\u4E2A chunk\uFF0C\u4E0E\u6B64\u540C\u65F6\u8FD9\u4E2A\u6A21\u5757\u4E2D\u7684\u6837\u5F0F\u4EE3\u7801\u4E5F\u4F1A\u6253\u5305\u6210\u5355\u72EC\u7684 CSS \u6587\u4EF6\u3002\u5982\u679C\u5F02\u6B65\u6A21\u5757\u7684 CSS \u548C JS \u540C\u65F6\u9884\u52A0\u8F7D\uFF0C\u90A3\u4E48\u5728\u67D0\u4E9B\u6D4F\u89C8\u5668\u4E0B\uFF08\u5982 IE\uFF09\u5C31\u4F1A\u51FA\u73B0 <a href="https://en.wikipedia.org/wiki/Flash_of_unstyled_content" target="_blank" rel="noreferrer">FOUC \u95EE\u9898</a> \uFF0C\u9875\u9762\u6837\u5F0F\u4F1A\u95EA\u70C1\uFF0C\u5F71\u54CD\u7528\u6237\u4F53\u9A8C\u3002 Vite \u901A\u8FC7\u76D1\u542C link \u6807\u7B7E load \u4E8B\u4EF6\u7684\u65B9\u5F0F\u6765\u4FDD\u8BC1 CSS \u5728 JS \u4E4B\u524D\u52A0\u8F7D\u5B8C\u6210\uFF0C\u4ECE\u800C\u89E3\u51B3 FOUC \u95EE\u9898\u3002</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (isCss) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rej</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">link</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">load</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">link</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rej</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u73B0\u5728\uFF0C\u6211\u4EEC\u5DF2\u7ECF\u77E5\u9053\u9884\u52A0\u8F7D\u7684\u5B9E\u73B0\u65B9\u6CD5\uFF0C\u90A3\u4E48 Vite \u662F\u5982\u4F55\u5C06\u52A8\u6001 import \u7F16\u8BD1\u6210\u9884\u52A0\u8F7D\u7684\u4EE3\u7801\u7684\u5462\uFF1F</p><p>\u4ECE\u6E90\u7801\u7684 <a href="https://github.com/vitejs/vite/blob/v2.7.0/packages/vite/src/node/plugins/importAnalysisBuild.ts#L111" target="_blank" rel="noreferrer">transform \u94A9\u5B50\u5B9E\u73B0</a> \u4E2D\uFF0C\u53EF\u4EE5\u770B\u5230 Vite \u4F1A\u5C06\u52A8\u6001 import \u7684\u4EE3\u7801\u8FDB\u884C\u8F6C\u6362\uFF0C\u5982\u4E0B\u4EE3\u7801\u6240\u793A\uFF1A</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> \u8F6C\u6362\u524D</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;">// \u8F6C\u6362\u540E</span></span>
<span class="line"><span style="color:#82AAFF;">__vitePreload</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> true </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">__VITE_PRELOAD__</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>\u5176\u4E2D\uFF0C<code>__vitePreload</code> \u4F1A\u88AB\u52A0\u8F7D\u4E3A\u524D\u6587\u7684 preload \u5DE5\u5177\u51FD\u6570\uFF0C<code>true</code> \u4F1A\u5728 <a href="https://github.com/vitejs/vite/blob/v2.7.0/packages/vite/src/node/plugins/importAnalysisBuild.ts#L208" target="_blank" rel="noreferrer">renderChunk</a> \u4E2D\u88AB\u66FF\u6362\u4E3A true \u6216\u8005 false\uFF0C\u8868\u793A\u662F\u5426\u4E3A Modern \u6A21\u5F0F\u6253\u5305\u3002\u5BF9\u4E8E <code>&quot;__VITE_PRELOAD__&quot;</code> \uFF0CVite \u4F1A\u5728 <a href="https://github.com/vitejs/vite/blob/v2.7.0/packages/vite/src/node/plugins/importAnalysisBuild.ts#L234" target="_blank" rel="noreferrer">generateBundle</a> \u9636\u6BB5\uFF0C\u5206\u6790\u51FA a \u6A21\u5757\u6240\u6709\u4F9D\u8D56\u6587\u4EF6\uFF08\u5305\u62EC CSS\uFF09\uFF0C\u5C06\u4F9D\u8D56\u6587\u4EF6\u540D\u7684\u6570\u7EC4\u4F5C\u4E3A preload \u5DE5\u5177\u51FD\u6570\u7684\u7B2C\u4E8C\u4E2A\u53C2\u6570\u3002</p><p>\u540C\u65F6\uFF0C\u5BF9\u4E8E Vite \u72EC\u6709\u7684 <code>i<wbr>mport.meta.glob</code> \u8BED\u6CD5\uFF0C\u4E5F\u4F1A\u5728\u8FD9\u4E2A\u63D2\u4EF6\u4E2D\u8FDB\u884C\u7F16\u8BD1\uFF1A</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> modules </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">glob</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./dir/*.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>\u4F1A\u901A\u8FC7\u63D2\u4EF6\u8F6C\u6362\u6210\u4E0B\u9762\u8FD9\u6BB5\u4EE3\u7801:</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> modules </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">./dir/foo.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./dir/foo.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">./dir/bar.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./dir/bar.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5177\u4F53\u7684\u5B9E\u73B0\u5728 <a href="https://github.com/vitejs/vite/blob/075128a8dd0a2680540179dad2277a797f793199/packages/vite/src/node/importGlob.ts#L11" target="_blank" rel="noreferrer">transformImportGlob</a> \u51FD\u6570\u4E2D\uFF0C\u9664\u4E86\u88AB\u8BE5\u63D2\u4EF6\u4F7F\u7528\u5916\uFF0C\u8FD9\u4E2A\u51FD\u6570\u8FD8\u4F9D\u8D56\u9884\u6784\u5EFA\u3001\u5F00\u53D1\u73AF\u5883 import \u5206\u6790\u7B49\u6838\u5FC3\u6D41\u7A0B\u4F7F\u7528\u3002</p><p>**9. JS \u538B\u7F29\u63D2\u4EF6 **</p><p>Vite \u4E2D\u63D0\u4F9B\u4E86\u4E24\u79CD JS \u4EE3\u7801\u538B\u7F29\u7684\u5DE5\u5177\uFF0C\u5373 EsBuild \u548C Terser\uFF0C\u5206\u522B\u7531\u4E24\u4E2A\u63D2\u4EF6\u5B9E\u73B0\uFF1A</p><ul><li><a href="https://github.com/vitejs/vite/blob/v2.7.0/packages/vite/src/node/plugins/esbuild.ts#L217" target="_blank" rel="noreferrer">vite:esbuild-transpile</a>\u3002\u5728 renderChunk \u9636\u6BB5\uFF0C\u8C03\u7528 EsBuild \u7684 transform API\uFF0C\u5E76\u6307\u5B9A minify \u53C2\u6570\uFF0C\u4ECE\u800C\u5B9E\u73B0 JS \u7684\u538B\u7F29\u3002</li><li><a href="https://github.com/vitejs/vite/blob/v2.7.0/packages/vite/src/node/plugins/terser.ts#L6" target="_blank" rel="noreferrer">vite:terser</a>\u3002\u540C\u6837\u5728 renderChunk \u9636\u6BB5\uFF0CVite \u4F1A\u5728\u5355\u72EC\u7684 Worker \u8FDB\u7A0B\u4E2D\u8C03\u7528 Terser \u8FDB\u884C JS \u4EE3\u7801\u538B\u7F29\u3002</li></ul><p><strong>10. \u6784\u5EFA\u62A5\u544A\u63D2\u4EF6</strong></p><p>\u4E3B\u8981\u7531\u4E09\u4E2A\u63D2\u4EF6\u8F93\u51FA\u6784\u5EFA\u62A5\u544A\uFF1A</p><ul><li><a href="https://github.com/vitejs/vite/blob/v2.7.0/packages/vite/src/node/plugins/manifest.ts" target="_blank" rel="noreferrer">vite:manifest</a> \u3002\u63D0\u4F9B\u6253\u5305\u540E\u7684\u5404\u79CD\u8D44\u6E90\u6587\u4EF6\u53CA\u5176\u5173\u8054\u4FE1\u606F\uFF0C\u5982\u4E0B\u5185\u5BB9\u6240\u793A\uFF1A</li></ul><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#676E95;">// manifest.json</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">index.html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">file</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">assets/index.8edffa56.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">src</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">index.html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">isEntry</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// JS \u5F15\u7528</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_vendor.71e8fac3.js</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">    ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">css</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u6837\u5F0F\u6587\u4EF6\u5E94\u7528</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">assets/index.458f9883.css</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">    ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">assets</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u9759\u6001\u8D44\u6E90\u5F15\u7528</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">assets/img.9f0de7da.png</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">    ]</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_vendor.71e8fac3.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">file</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">assets/vendor.71e8fac3.js</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><ul><li><a href="https://github.com/vitejs/vite/blob/v2.7.0/packages/vite/src/node/ssr/ssrManifestPlugin.ts" target="_blank" rel="noreferrer">vite:ssr-manifest</a> \u3002\u63D0\u4F9B\u6BCF\u4E2A\u6A21\u5757\u4E0E chunk \u4E4B\u95F4\u7684\u6620\u5C04\u5173\u7CFB\uFF0C\u65B9\u4FBF SSR \u65F6\u901A\u8FC7\u6E32\u67D3\u7684\u7EC4\u4EF6\u6765\u786E\u5B9A\u54EA\u4E9B chunk \u4F1A\u88AB\u8C03\u7528\uFF0C\u4ECE\u800C\u6309\u9700\u8FDB\u884C\u9884\u52A0\u8F7D\u3002</li></ul><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#676E95;">// ssr-manifest.json</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">node_modules/object-assign/index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: [</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/assets/vendor.71e8fac3.js</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">node_modules/object-assign/index.js?commonjs-proxy</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: [</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/assets/vendor.71e8fac3.js</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u7701\u7565\u5176\u5B83\u6A21\u5757\u4FE1\u606F</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><ul><li><a href="https://github.com/vitejs/vite/blob/v2.7.0/packages/vite/src/node/plugins/reporter.ts" target="_blank" rel="noreferrer">vite:reporter</a> \u3002\u4E3B\u8981\u63D0\u4F9B\u6253\u5305\u65F6\u7684\u547D\u4EE4\u884C\u6784\u5EFA\u65E5\u5FD7\u3002</li></ul><h4 id="\u5F00\u53D1\u73AF\u5883\u7279\u6709\u63D2\u4EF6" tabindex="-1">\u5F00\u53D1\u73AF\u5883\u7279\u6709\u63D2\u4EF6 <a class="header-anchor" href="#\u5F00\u53D1\u73AF\u5883\u7279\u6709\u63D2\u4EF6" aria-hidden="true">#</a></h4><p><strong>1. \u5BA2\u6237\u7AEF\u73AF\u5883\u53D8\u91CF\u6CE8\u5165\u63D2\u4EF6</strong></p><p>\u5728\u5F00\u53D1\u73AF\u5883\u4E2D\uFF0CVite \u4F1A\u81EA\u52A8\u5F80 HTML \u4E2D\u6CE8\u5165\u4E00\u6BB5 client \u811A\u672C\uFF08<a href="https://github.com/vitejs/vite/blob/v2.7.0/packages/vite/src/node/server/middlewares/indexHtml.ts#L88" target="_blank" rel="noreferrer">\u4EE3\u7801\u94FE\u63A5</a>\uFF09\u3002</p><div class="language-html"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/@vite/client</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u6BB5\u811A\u672C\u4E3B\u8981\u63D0\u4F9B<code>\u6CE8\u5165\u73AF\u5883\u53D8\u91CF</code>\u3001<code>\u5904\u7406 HMR \u66F4\u65B0\u903B\u8F91</code>\u3001<code>\u6784\u5EFA\u51FA\u73B0\u9519\u8BEF\u65F6\u63D0\u4F9B\u62A5\u9519\u754C\u9762</code> \u7B49\u529F\u80FD\u3002</p><p>\u6211\u4EEC\u8FD9\u91CC\u8981\u4ECB\u7ECD\u7684 <a href="https://github.com/vitejs/vite/blob/v2.7.0/packages/vite/src/node/plugins/clientInjections.ts#L15" target="_blank" rel="noreferrer">vite:client-inject</a> \u5C31\u662F\u6765\u5B8C\u6210\u65F6\u73AF\u5883\u53D8\u91CF\u7684\u6CE8\u5165\uFF0C\u5C06 client \u811A\u672C\u4E2D\u7684 <code>__MODE__</code>\u3001<code>__BASE__</code>\u3001<code>__DEFINE__</code> \u7B49\u5B57\u7B26\u4E32\u66FF\u6362\u4E3A\u8FD0\u884C\u65F6\u7684\u53D8\u91CF\uFF0C\u5B9E\u73B0\u73AF\u5883\u53D8\u91CF\u4EE5\u53CA HMR \u76F8\u5173\u4E0A\u4E0B\u6587\u4FE1\u606F\u7684\u6CE8\u5165\u3002</p><p><strong>2. \u5F00\u53D1\u9636\u6BB5 import \u5206\u6790\u63D2\u4EF6</strong></p><p>\u6700\u540E\uFF0CVite \u4F1A\u5728\u5F00\u53D1\u9636\u6BB5\u52A0\u5165 import \u5206\u6790\u63D2\u4EF6\uFF0C\u5373 <code>vite:import-analysis</code> \uFF0C\u4E3B\u8981\u5904\u7406 import \u8BED\u53E5\u76F8\u5173\u7684\u89E3\u6790\u548C\u91CD\u5199\u3002\u5B83\u4E3B\u8981\u56F4\u7ED5 Vite \u5F00\u53D1\u9636\u6BB5\u7684\u5404\u9879\u7279\u6027\u6765\u5B9E\u73B0\uFF0C\u4E0B\u9762\u6211\u4EEC\u6765\u68B3\u7406\u4E00\u4E0B\u8FD9\u4E2A\u63D2\u4EF6\u505A\u4E86\u54EA\u4E9B\u4E8B\u60C5\u3002</p><ul><li>\u9488\u5BF9 bare import\uFF0C\u5C06\u8DEF\u5F84\u8F6C\u6362\u4E3A\u771F\u5B9E\u7684\u6587\u4EF6\u8DEF\u5F84</li></ul><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#676E95;">// \u8F6C\u6362\u524D</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">foo</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;">// \u8F6C\u6362\u540E</span></span>
<span class="line"><span style="color:#676E95;">// tip: \u5982\u679C\u662F\u9884\u6784\u5EFA\u7684\u4F9D\u8D56\uFF0C\u5219\u4F1A\u8F6C\u6362\u4E3A\u9884\u6784\u5EFA\u4EA7\u7269\u7684\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/@fs/project/node_modules/foo/dist/foo.js</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><p>\u4E3B\u8981\u8C03\u7528 <code>PluginContainer</code> \u7684\u4E0A\u4E0B\u6587\u5BF9\u8C61\u65B9\u6CD5\u5373 <code>this.resolve</code> \u5B9E\u73B0\uFF0C\u8FD9\u4E2A\u65B9\u6CD5\u4F1A\u8C03\u7528\u6240\u6709\u63D2\u4EF6\u7684 resolveId \u65B9\u6CD5\uFF0C\u5305\u62EC\u4E4B\u524D\u4ECB\u7ECD\u7684 <code>vite:pre-alias</code> \u548C<code>vite:resolve</code>\uFF0C\u5B8C\u6210\u8DEF\u5F84\u89E3\u6790\u7684\u6838\u5FC3\u903B\u8F91\u3002</p><ul><li>\u5BF9\u4E8E HMR \u7684\u5BA2\u6237\u7AEF API\uFF0C\u5373 <code>i<wbr>mport.meta.hot</code>\uFF0CVite \u5728\u8BC6\u522B\u5230\u8FD9\u6837\u7684 import \u8BED\u53E5\u540E\uFF1A <ul><li>\u4E00\u65B9\u9762\u4F1A\u6CE8\u5165 i<wbr>mport.meta.hot \u7684\u5B9E\u73B0\uFF0C\u56E0\u4E3A\u6D4F\u89C8\u5668\u539F\u751F\u5E76\u4E0D\u5177\u5907\u8FD9\u6837\u7684 API\uFF08<a href="https://github.com/vitejs/vite/blob/v2.7.0/packages/vite/src/node/plugins/importAnalysis.ts#L502" target="_blank" rel="noreferrer">\u4EE3\u7801\u94FE\u63A5</a>\uFF09</li><li>\u53E6\u4E00\u65B9\u9762\u4F1A\u8BC6\u522B accept \u65B9\u6CD5\uFF0C\u5E76\u5224\u65AD accept \u662F\u5426\u4E3A<code>\u63A5\u53D7\u81EA\u8EAB\u66F4\u65B0</code>\u7684\u7C7B\u578B\uFF0C\u5982\u679C\u662F\uFF0C\u5219\u6807\u8BB0\u4E3A\u4E0A <code>isSelfAccepting</code> \u7684 flag\uFF0C\u4FBF\u4E8E HMR \u5728\u670D\u52A1\u7AEF\u8FDB\u884C\u66F4\u65B0\u65F6\u8FDB\u884C <code>HMR Boundary</code> \u7684\u67E5\u627E\u3002</li></ul></li><li>\u5BF9\u4E8E\u5168\u5C40\u73AF\u5883\u53D8\u91CF\u8BFB\u53D6\u8BED\u53E5\uFF0C\u5373 <code>i<wbr>mport.meta.env</code>\uFF0CVite \u4F1A\u6CE8\u5165 <code>i<wbr>mport.meta.env</code> \u7684\u5B9E\u73B0\uFF0C\u4E5F\u5C31\u662F\u5982\u4E0B\u7684<code>env</code>\u5B57\u7B26\u4E32\uFF1A</li></ul><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre><code><span class="line"><span style="color:#676E95;">// config \u5373\u89E3\u6790\u5B8C\u7684\u914D\u7F6E</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> env </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">i<wbr>mport.meta.env = </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">env</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">SSR</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">!!</span><span style="color:#A6ACCD;">ssr</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">;</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#676E95;">// \u5BF9\u7528\u6237\u914D\u7F6E\u7684 define \u5BF9\u8C61\u4E2D\uFF0C\u5C06\u5E26\u6709 i<wbr>mport.meta.env \u524D\u7F00\u7684\u5168\u5C40\u53D8\u91CF\u6302\u5230 i<wbr>mport.meta.env \u5BF9\u8C61\u4E0A</span></span>
<span class="line"><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> (</span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> key </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">define) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">startsWith</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">i<wbr>mport.meta.env.</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">define</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">env</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`\${</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> = </span><span style="color:#89DDFF;">\${</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">typeof</span><span style="color:#A6ACCD;"> val </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">string</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> val </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#A6ACCD;">(val)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">;</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><ul><li>\u5BF9\u4E8E <code>i<wbr>mport.meta.glob</code> \u8BED\u6CD5\uFF0CVite \u540C\u6837\u4F1A\u8C03\u7528\u4E4B\u524D\u63D0\u5230\u7684 <code>transformImportGlob</code> \u51FD\u6570\u6765\u8FDB\u884C\u8BED\u6CD5\u8F6C\u6362\uFF0C\u4F46\u4E0E\u751F\u4EA7\u73AF\u5883\u7684\u5904\u7406\u4E0D\u540C\uFF0C\u5728\u8F6C\u6362\u4E4B\u540E\uFF0CVite \u4F1A\u5C06\u8BE5\u6A21\u5757\u901A\u8FC7 glob \u5BFC\u5165\u7684\u4F9D\u8D56\u6A21\u5757\u8BB0\u5F55\u5728 server \u5B9E\u4F8B\u4E0A\uFF0C\u4EE5\u4FBF\u4E8E HMR \u66F4\u65B0\u7684\u65F6\u5019\u80FD\u5F97\u5230\u66F4\u51C6\u786E\u7684\u6A21\u5757\u4F9D\u8D56\u4FE1\u606F\uFF08<a href="https://github.com/vitejs/vite/blob/v2.7.0/packages/vite/src/node/plugins/importAnalysis.ts#L324" target="_blank" rel="noreferrer">\u4EE3\u7801\u94FE\u63A5</a>\uFF09\u3002</li></ul><h3 id="\u603B\u7ED3-11" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3-11" aria-hidden="true">#</a></h3><p>\u672C\u7BC7\u6587\u7AE0\u4E2D\uFF0C\u6211\u4EEC\u4ECB\u7ECD\u4E86 Vite \u7684\u63D2\u4EF6\u673A\u5236\u5B9E\u73B0\u4EE5\u53CA\u5404\u4E2A\u7F16\u8BD1\u63D2\u4EF6\u7684\u4F5C\u7528\u4E0E\u5B9E\u73B0\u3002\u5176\u4E2D\uFF0C\u6211\u4EEC\u9700\u8981\u638C\u63E1 PluginContainer \u7684\u5B9E\u73B0\u673A\u5236\u548C Vite \u5185\u7F6E\u63D2\u4EF6\u5404\u81EA\u7684\u4F5C\u7528\u3002</p><p>\u9996\u5148\uFF0CPluginContainer \u4E3B\u8981\u7531\u4E24\u90E8\u5206\u7EC4\u6210\uFF0C\u5305\u62EC Rollup \u63D2\u4EF6\u94A9\u5B50\u7684\u8C03\u5EA6\u548C\u63D2\u4EF6\u94A9\u5B50\u5185\u90E8\u7684 Context \u4E0A\u4E0B\u6587\u5BF9\u8C61\u5B9E\u73B0\uFF0C\u603B\u4F53\u4E0A\u6A21\u62DF\u4E86 Rollup \u7684\u63D2\u4EF6\u673A\u5236\u3002</p><p>\u5176\u6B21\uFF0CVite \u5185\u7F6E\u7684\u63D2\u4EF6\u5305\u62EC\u56DB\u5927\u7C7B\uFF1A\u522B\u540D\u63D2\u4EF6\u3001\u6838\u5FC3\u6784\u5EFA\u63D2\u4EF6\u3001\u751F\u4EA7\u73AF\u5883\u63D2\u4EF6\u548C\u5F00\u53D1\u73AF\u5883\u7279\u6709\u63D2\u4EF6\u3002\u8FD9\u4E9B\u63D2\u4EF6\u5305\u542B\u4E86 Vite \u6838\u5FC3\u7684\u7F16\u8BD1\u903B\u8F91\uFF0C\u6211\u4EEC\u5728\u5B66\u4E60\u8FD9\u4E9B\u63D2\u4EF6\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u8981\u5C3D\u53EF\u80FD\u6293\u5173\u952E\u7684\u5B9E\u73B0\u601D\u8DEF\uFF0C\u9AD8\u6548\u7406\u89E3\u63D2\u4EF6\u80CC\u540E\u7684\u539F\u7406\uFF0C\u8FD9\u6837\u5B66\u4E60\u6548\u7387\u4F1A\u66F4\u9AD8\u3002\u5F53\u4F60\u7406\u89E3\u4E86\u5404\u4E2A\u63D2\u4EF6\u7684\u5B9E\u73B0\u539F\u7406\u4E4B\u540E\uFF0C\u5982\u679C\u9047\u5230\u67D0\u4E9B\u573A\u666F\u4E0B\u9700\u8981\u8C03\u8BD5\u67D0\u4E9B\u63D2\u4EF6\u4EE3\u7801\uFF0C\u4E5F\u53EF\u4EE5\u505A\u5230\u6E38\u5203\u6709\u4F59\u3002</p>`,1262),Z=[X];function Y(K,ss,ns,as,ls,ps){return l(),a("div",null,Z)}const ts=n($,[["render",Y]]);export{cs as __pageData,ts as default};
